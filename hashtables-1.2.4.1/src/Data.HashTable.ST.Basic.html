<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE BangPatterns #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE CPP          #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE MagicHash    #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-comment">{-|

A basic open-addressing hash table using linear probing. Use this hash table if
you...

  * want the fastest possible lookups, and very fast inserts.

  * don't care about wasting a little bit of memory to get it.

  * don't care that a table resize might pause for a long time to rehash all
    of the key-value mappings.

  * have a workload which is not heavy with deletes; deletes clutter the table
    with deleted markers and force the table to be completely rehashed fairly
    often.

Of the hash tables in this collection, this hash table has the best lookup
performance, while maintaining competitive insert performance.

/Space overhead/

This table is not especially memory-efficient; firstly, the table has a maximum
load factor of 0.83 and will be resized if load exceeds this value. Secondly,
to improve insert and lookup performance, we store a 16-bit hash code for each
key in the table.

Each hash table entry requires at least 2.25 words (on a 64-bit machine), two
for the pointers to the key and value and one quarter word for the hash code.
We don't count key and value pointers as overhead, because they have to be
there -- so the overhead for a full slot is at least one quarter word -- but
empty slots in the hash table count for a full 2.25 words of overhead. Define
@m@ as the number of slots in the table, @n@ as the number of key value
mappings, and @ws@ as the machine word size in /bytes/. If the load factor is
@k=n\/m@, the amount of space /wasted/ per mapping in words is:

@
w(n) = (m*(2*ws + 2) - n*(2*ws)) / ws
@

Since @m=n\/k@,

@
w(n) = n\/k * (2*ws + 2) - n*(2*ws)
     = (n * (2 + 2*ws*(1-k)) / k) / ws
@

Solving for @k=0.83@, the maximum load factor, gives a /minimum/ overhead of
0.71 words per mapping on a 64-bit machine, or 1.01 words per mapping on a
32-bit machine. If @k=0.5@, which should be under normal usage the /maximum/
overhead situation, then the overhead would be 2.5 words per mapping on a
64-bit machine, or 3.0 words per mapping on a 32-bit machine.

/Space overhead: experimental results/

In randomized testing on a 64-bit machine (see
@test\/compute-overhead\/ComputeOverhead.hs@ in the source distribution), mean
overhead (that is, the number of words needed to store the key-value mapping
over and above the two words necessary for the key and the value pointers) is
approximately 1.24 machine words per key-value mapping with a standard
deviation of about 0.30 words, and 1.70 words per mapping at the 95th
percentile.

/Expensive resizes/

If enough elements are inserted into the table to make it exceed the maximum
load factor, the table is resized. A resize involves a complete rehash of all
the elements in the table, which means that any given call to 'insert' might
take /O(n)/ time in the size of the table, with a large constant factor. If a
long pause waiting for the table to resize is unacceptable for your
application, you should choose the included linear hash table instead.


/References:/

  * Knuth, Donald E. /The Art of Computer Programming/, vol. 3 Sorting and
    Searching. Addison-Wesley Publishing Company, 1973.
-}</span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Data.HashTable.ST.Basic</span><span>
</span><span id="line-84"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier">HashTable</span></a></span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#new"><span class="hs-identifier">new</span></a></span><span>
</span><span id="line-86"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#newSized"><span class="hs-identifier">newSized</span></a></span><span>
</span><span id="line-87"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#delete"><span class="hs-identifier">delete</span></a></span><span>
</span><span id="line-88"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#lookup"><span class="hs-identifier">lookup</span></a></span><span>
</span><span id="line-89"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#insert"><span class="hs-identifier">insert</span></a></span><span>
</span><span id="line-90"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#mutate"><span class="hs-identifier">mutate</span></a></span><span>
</span><span id="line-91"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#mutateST"><span class="hs-identifier">mutateST</span></a></span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#mapM_"><span class="hs-identifier">mapM_</span></a></span><span>
</span><span id="line-93"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#foldM"><span class="hs-identifier">foldM</span></a></span><span>
</span><span id="line-94"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#computeOverhead"><span class="hs-identifier">computeOverhead</span></a></span><span>
</span><span id="line-95"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span class="hs-cpp">
#if !MIN_VERSION_base(4,8,0)
</span><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Applicative</span><span class="hs-cpp">
#endif
</span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">assert</span></span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>                     </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">foldM</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mapM_</span></span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.ST</span></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ST</span></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Bits</span></span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Hashable</span></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Hashable</span></span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Hashable</span></span><span>                     </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">H</span></span><span>
</span><span id="line-108"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-109"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Monoid</span></span><span class="hs-cpp">
#if MIN_VERSION_base(4,9,0) &amp;&amp; !MIN_VERSION_base(4,11,0)
</span><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Semigroup</span><span class="hs-cpp">
#endif
</span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Primitive.ByteArray</span></span><span>          </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">A</span></span><span>
</span><span id="line-114"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.STRef</span></span><span>
</span><span id="line-115"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">GHC.Exts</span></span><span>
</span><span id="line-116"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span>                           </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">lookup</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mapM_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">read</span></span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-118"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Data.HashTable.Class.html"><span class="hs-identifier">Data.HashTable.Class</span></a></span><span>              </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C</span></span><span>
</span><span id="line-119"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Data.HashTable.Internal.Array.html"><span class="hs-identifier">Data.HashTable.Internal.Array</span></a></span><span>
</span><span id="line-120"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Data.HashTable.Internal.CacheLine.html"><span class="hs-identifier">Data.HashTable.Internal.CacheLine</span></a></span><span>
</span><span id="line-121"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Data.HashTable.Internal.IntArray.html"><span class="hs-identifier">Data.HashTable.Internal.IntArray</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.Internal.IntArray.html#Elem"><span class="hs-identifier">Elem</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Data.HashTable.Internal.IntArray.html"><span class="hs-identifier">Data.HashTable.Internal.IntArray</span></a></span><span>  </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">U</span></span><span>
</span><span id="line-123"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Data.HashTable.Internal.Utils.html"><span class="hs-identifier">Data.HashTable.Internal.Utils</span></a></span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-127"></span><span class="hs-comment">-- | An open addressing hash table using linear probing.</span><span>
</span><span id="line-128"></span><span class="hs-keyword">newtype</span><span> </span><span id="HashTable"><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-var">HashTable</span></a></span></span><span> </span><span id="local-6989586621679080953"><span class="annot"><a href="#local-6989586621679080953"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621679080952"><span class="annot"><a href="#local-6989586621679080952"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621679080951"><span class="annot"><a href="#local-6989586621679080951"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="HT"><span class="annot"><a href="Data.HashTable.ST.Basic.html#HT"><span class="hs-identifier hs-var">HT</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">STRef</span></span><span> </span><span class="annot"><a href="#local-6989586621679080953"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable_"><span class="hs-identifier hs-type">HashTable_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080953"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080952"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080951"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span class="hs-keyword">type</span><span> </span><span id="SizeRefs"><span class="annot"><a href="Data.HashTable.ST.Basic.html#SizeRefs"><span class="hs-identifier hs-var">SizeRefs</span></a></span></span><span> </span><span id="local-6989586621679080907"><span class="annot"><a href="#local-6989586621679080907"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">A.MutableByteArray</span></span><span> </span><span class="annot"><a href="#local-6989586621679080907"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span class="annot"><a href="Data.HashTable.ST.Basic.html#intSz"><span class="hs-identifier hs-type">intSz</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-133"></span><span id="intSz"><span class="annot"><span class="annottext">intSz :: Int
</span><a href="Data.HashTable.ST.Basic.html#intSz"><span class="hs-identifier hs-var hs-var">intSz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
forall b. FiniteBits b =&gt; b -&gt; Int
</span><span class="hs-identifier hs-var">finiteBitSize</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">::</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">8</span></span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span id="local-6989586621679081011"><span class="annot"><a href="Data.HashTable.ST.Basic.html#readLoad"><span class="hs-identifier hs-type">readLoad</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#SizeRefs"><span class="hs-identifier hs-type">SizeRefs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081011"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679081011"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span><span>
</span><span id="line-136"></span><span id="readLoad"><span class="annot"><span class="annottext">readLoad :: SizeRefs s -&gt; ST s Int
</span><a href="Data.HashTable.ST.Basic.html#readLoad"><span class="hs-identifier hs-var hs-var">readLoad</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SizeRefs s -&gt; Int -&gt; ST s Int) -&gt; Int -&gt; SizeRefs s -&gt; ST s Int
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">SizeRefs s -&gt; Int -&gt; ST s Int
forall a (m :: * -&gt; *).
(Prim a, PrimMonad m) =&gt;
MutableByteArray (PrimState m) -&gt; Int -&gt; m a
</span><span class="hs-identifier hs-var">A.readByteArray</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span id="local-6989586621679080991"><span class="annot"><a href="Data.HashTable.ST.Basic.html#writeLoad"><span class="hs-identifier hs-type">writeLoad</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#SizeRefs"><span class="hs-identifier hs-type">SizeRefs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080991"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679080991"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-139"></span><span id="writeLoad"><span class="annot"><span class="annottext">writeLoad :: SizeRefs s -&gt; Int -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#writeLoad"><span class="hs-identifier hs-var hs-var">writeLoad</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SizeRefs s -&gt; Int -&gt; Int -&gt; ST s ())
-&gt; Int -&gt; SizeRefs s -&gt; Int -&gt; ST s ()
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">SizeRefs s -&gt; Int -&gt; Int -&gt; ST s ()
forall a (m :: * -&gt; *).
(Prim a, PrimMonad m) =&gt;
MutableByteArray (PrimState m) -&gt; Int -&gt; a -&gt; m ()
</span><span class="hs-identifier hs-var">A.writeByteArray</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span id="local-6989586621679080898"><span class="annot"><a href="Data.HashTable.ST.Basic.html#readDelLoad"><span class="hs-identifier hs-type">readDelLoad</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#SizeRefs"><span class="hs-identifier hs-type">SizeRefs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080898"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679080898"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span><span>
</span><span id="line-142"></span><span id="readDelLoad"><span class="annot"><span class="annottext">readDelLoad :: SizeRefs s -&gt; ST s Int
</span><a href="Data.HashTable.ST.Basic.html#readDelLoad"><span class="hs-identifier hs-var hs-var">readDelLoad</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SizeRefs s -&gt; Int -&gt; ST s Int) -&gt; Int -&gt; SizeRefs s -&gt; ST s Int
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">SizeRefs s -&gt; Int -&gt; ST s Int
forall a (m :: * -&gt; *).
(Prim a, PrimMonad m) =&gt;
MutableByteArray (PrimState m) -&gt; Int -&gt; m a
</span><span class="hs-identifier hs-var">A.readByteArray</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span id="local-6989586621679080896"><span class="annot"><a href="Data.HashTable.ST.Basic.html#writeDelLoad"><span class="hs-identifier hs-type">writeDelLoad</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#SizeRefs"><span class="hs-identifier hs-type">SizeRefs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080896"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679080896"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-145"></span><span id="writeDelLoad"><span class="annot"><span class="annottext">writeDelLoad :: SizeRefs s -&gt; Int -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#writeDelLoad"><span class="hs-identifier hs-var hs-var">writeDelLoad</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SizeRefs s -&gt; Int -&gt; Int -&gt; ST s ())
-&gt; Int -&gt; SizeRefs s -&gt; Int -&gt; ST s ()
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">SizeRefs s -&gt; Int -&gt; Int -&gt; ST s ()
forall a (m :: * -&gt; *).
(Prim a, PrimMonad m) =&gt;
MutableByteArray (PrimState m) -&gt; Int -&gt; a -&gt; m ()
</span><span class="hs-identifier hs-var">A.writeByteArray</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span id="local-6989586621679081090"><span class="annot"><a href="Data.HashTable.ST.Basic.html#newSizeRefs"><span class="hs-identifier hs-type">newSizeRefs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679081090"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Basic.html#SizeRefs"><span class="hs-identifier hs-type">SizeRefs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081090"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-148"></span><span id="newSizeRefs"><span class="annot"><span class="annottext">newSizeRefs :: ST s (SizeRefs s)
</span><a href="Data.HashTable.ST.Basic.html#newSizeRefs"><span class="hs-identifier hs-var hs-var">newSizeRefs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-149"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679080893"><span class="annot"><span class="annottext">asz :: Int
</span><a href="#local-6989586621679080893"><span class="hs-identifier hs-var hs-var">asz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Data.HashTable.ST.Basic.html#intSz"><span class="hs-identifier hs-var">intSz</span></a></span><span>
</span><span id="line-150"></span><span>    </span><span id="local-6989586621679080891"><span class="annot"><span class="annottext">SizeRefs s
</span><a href="#local-6989586621679080891"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; ST s (MutableByteArray (PrimState (ST s)))
forall (m :: * -&gt; *).
PrimMonad m =&gt;
Int -&gt; Int -&gt; m (MutableByteArray (PrimState m))
</span><span class="hs-identifier hs-var">A.newAlignedPinnedByteArray</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080893"><span class="hs-identifier hs-var">asz</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Data.HashTable.ST.Basic.html#intSz"><span class="hs-identifier hs-var">intSz</span></a></span><span>
</span><span id="line-151"></span><span>    </span><span class="annot"><span class="annottext">MutableByteArray (PrimState (ST s))
-&gt; Int -&gt; Int -&gt; Word8 -&gt; ST s ()
forall (m :: * -&gt; *).
PrimMonad m =&gt;
MutableByteArray (PrimState m) -&gt; Int -&gt; Int -&gt; Word8 -&gt; m ()
</span><span class="hs-identifier hs-var">A.fillByteArray</span></span><span> </span><span class="annot"><span class="annottext">SizeRefs s
MutableByteArray (PrimState (ST s))
</span><a href="#local-6989586621679080891"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080893"><span class="hs-identifier hs-var">asz</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span>
</span><span id="line-152"></span><span>    </span><span class="annot"><span class="annottext">SizeRefs s -&gt; ST s (SizeRefs s)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">SizeRefs s
</span><a href="#local-6989586621679080891"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span class="hs-keyword">data</span><span> </span><span id="HashTable_"><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable_"><span class="hs-identifier hs-var">HashTable_</span></a></span></span><span> </span><span id="local-6989586621679081089"><span class="annot"><a href="#local-6989586621679081089"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621679081088"><span class="annot"><a href="#local-6989586621679081088"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621679081087"><span class="annot"><a href="#local-6989586621679081087"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="HashTable"><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-var">HashTable</span></a></span></span><span>
</span><span id="line-156"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="_size"><span class="annot"><span class="annottext">HashTable_ s k v -&gt; Int
</span><a href="Data.HashTable.ST.Basic.html#_size"><span class="hs-identifier hs-var hs-var">_size</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-157"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_load"><span class="annot"><span class="annottext">HashTable_ s k v -&gt; SizeRefs s
</span><a href="Data.HashTable.ST.Basic.html#_load"><span class="hs-identifier hs-var hs-var">_load</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Basic.html#SizeRefs"><span class="hs-identifier hs-type">SizeRefs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081089"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- ^ 2-element array, stores how many entries</span><span>
</span><span id="line-158"></span><span>                                  </span><span class="hs-comment">-- and deleted entries are in the table.</span><span>
</span><span id="line-159"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_hashes"><span class="annot"><span class="annottext">HashTable_ s k v -&gt; IntArray s
</span><a href="Data.HashTable.ST.Basic.html#_hashes"><span class="hs-identifier hs-var hs-var">_hashes</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.Internal.IntArray.html#IntArray"><span class="hs-identifier hs-type">U.IntArray</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081089"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_keys"><span class="annot"><span class="annottext">HashTable_ s k v -&gt; MutableArray s k
</span><a href="Data.HashTable.ST.Basic.html#_keys"><span class="hs-identifier hs-var hs-var">_keys</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MutableArray</span></span><span> </span><span class="annot"><a href="#local-6989586621679081089"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081088"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-161"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_values"><span class="annot"><span class="annottext">HashTable_ s k v -&gt; MutableArray s v
</span><a href="Data.HashTable.ST.Basic.html#_values"><span class="hs-identifier hs-var hs-var">_values</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MutableArray</span></span><span> </span><span class="annot"><a href="#local-6989586621679081089"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081087"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-166"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Data.HashTable.Class.html#HashTable"><span class="hs-identifier hs-type">C.HashTable</span></a></span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-167"></span><span>    </span><span id="local-6989586621679080869"><span class="annot"><span class="annottext">new :: ST s (HashTable s k v)
</span><a href="Data.HashTable.Class.html#new"><span class="hs-identifier hs-var hs-var hs-var hs-var">new</span></a></span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ST s (HashTable s k v)
forall s k v. ST s (HashTable s k v)
</span><a href="Data.HashTable.ST.Basic.html#new"><span class="hs-identifier hs-var">new</span></a></span><span>
</span><span id="line-168"></span><span>    </span><span id="local-6989586621679080867"><span class="annot"><span class="annottext">newSized :: Int -&gt; ST s (HashTable s k v)
</span><a href="Data.HashTable.Class.html#newSized"><span class="hs-identifier hs-var hs-var hs-var hs-var">newSized</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s (HashTable s k v)
forall s k v. Int -&gt; ST s (HashTable s k v)
</span><a href="Data.HashTable.ST.Basic.html#newSized"><span class="hs-identifier hs-var">newSized</span></a></span><span>
</span><span id="line-169"></span><span>    </span><span id="local-6989586621679080865"><span class="annot"><span class="annottext">insert :: HashTable s k v -&gt; k -&gt; v -&gt; ST s ()
</span><a href="Data.HashTable.Class.html#insert"><span class="hs-identifier hs-var hs-var hs-var hs-var">insert</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashTable s k v -&gt; k -&gt; v -&gt; ST s ()
forall k s v.
(Eq k, Hashable k) =&gt;
HashTable s k v -&gt; k -&gt; v -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#insert"><span class="hs-identifier hs-var">insert</span></a></span><span>
</span><span id="line-170"></span><span>    </span><span id="local-6989586621679080863"><span class="annot"><span class="annottext">delete :: HashTable s k v -&gt; k -&gt; ST s ()
</span><a href="Data.HashTable.Class.html#delete"><span class="hs-identifier hs-var hs-var hs-var hs-var">delete</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashTable s k v -&gt; k -&gt; ST s ()
forall k s v. (Hashable k, Eq k) =&gt; HashTable s k v -&gt; k -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#delete"><span class="hs-identifier hs-var">delete</span></a></span><span>
</span><span id="line-171"></span><span>    </span><span id="local-6989586621679080861"><span class="annot"><span class="annottext">lookup :: HashTable s k v -&gt; k -&gt; ST s (Maybe v)
</span><a href="Data.HashTable.Class.html#lookup"><span class="hs-identifier hs-var hs-var hs-var hs-var">lookup</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashTable s k v -&gt; k -&gt; ST s (Maybe v)
forall k s v.
(Eq k, Hashable k) =&gt;
HashTable s k v -&gt; k -&gt; ST s (Maybe v)
</span><a href="Data.HashTable.ST.Basic.html#lookup"><span class="hs-identifier hs-var">lookup</span></a></span><span>
</span><span id="line-172"></span><span>    </span><span id="local-6989586621679080859"><span class="annot"><span class="annottext">foldM :: (a -&gt; (k, v) -&gt; ST s a) -&gt; a -&gt; HashTable s k v -&gt; ST s a
</span><a href="Data.HashTable.Class.html#foldM"><span class="hs-identifier hs-var hs-var hs-var hs-var">foldM</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; (k, v) -&gt; ST s a) -&gt; a -&gt; HashTable s k v -&gt; ST s a
forall a k v s.
(a -&gt; (k, v) -&gt; ST s a) -&gt; a -&gt; HashTable s k v -&gt; ST s a
</span><a href="Data.HashTable.ST.Basic.html#foldM"><span class="hs-identifier hs-var">foldM</span></a></span><span>
</span><span id="line-173"></span><span>    </span><span id="local-6989586621679080857"><span class="annot"><span class="annottext">mapM_ :: ((k, v) -&gt; ST s b) -&gt; HashTable s k v -&gt; ST s ()
</span><a href="Data.HashTable.Class.html#mapM_"><span class="hs-identifier hs-var hs-var hs-var hs-var">mapM_</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((k, v) -&gt; ST s b) -&gt; HashTable s k v -&gt; ST s ()
forall k v s b. ((k, v) -&gt; ST s b) -&gt; HashTable s k v -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span>
</span><span id="line-174"></span><span>    </span><span id="local-6989586621679080855"><span class="annot"><span class="annottext">lookupIndex :: HashTable s k v -&gt; k -&gt; ST s (Maybe Word)
</span><a href="Data.HashTable.Class.html#lookupIndex"><span class="hs-identifier hs-var hs-var hs-var hs-var">lookupIndex</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashTable s k v -&gt; k -&gt; ST s (Maybe Word)
forall k s v.
(Eq k, Hashable k) =&gt;
HashTable s k v -&gt; k -&gt; ST s (Maybe Word)
</span><a href="Data.HashTable.ST.Basic.html#lookupIndex"><span class="hs-identifier hs-var">lookupIndex</span></a></span><span>
</span><span id="line-175"></span><span>    </span><span id="local-6989586621679080852"><span class="annot"><span class="annottext">nextByIndex :: HashTable s k v -&gt; Word -&gt; ST s (Maybe (Word, k, v))
</span><a href="Data.HashTable.Class.html#nextByIndex"><span class="hs-identifier hs-var hs-var hs-var hs-var">nextByIndex</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashTable s k v -&gt; Word -&gt; ST s (Maybe (Word, k, v))
forall s k v. HashTable s k v -&gt; Word -&gt; ST s (Maybe (Word, k, v))
</span><a href="Data.HashTable.ST.Basic.html#nextByIndex"><span class="hs-identifier hs-var">nextByIndex</span></a></span><span>
</span><span id="line-176"></span><span>    </span><span id="local-6989586621679080849"><span class="annot"><span class="annottext">computeOverhead :: HashTable s k v -&gt; ST s Double
</span><a href="Data.HashTable.Class.html#computeOverhead"><span class="hs-identifier hs-var hs-var hs-var hs-var">computeOverhead</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashTable s k v -&gt; ST s Double
forall s k v. HashTable s k v -&gt; ST s Double
</span><a href="Data.HashTable.ST.Basic.html#computeOverhead"><span class="hs-identifier hs-var">computeOverhead</span></a></span><span>
</span><span id="line-177"></span><span>    </span><span id="local-6989586621679080847"><span class="annot"><span class="annottext">mutate :: HashTable s k v -&gt; k -&gt; (Maybe v -&gt; (Maybe v, a)) -&gt; ST s a
</span><a href="Data.HashTable.Class.html#mutate"><span class="hs-identifier hs-var hs-var hs-var hs-var">mutate</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashTable s k v -&gt; k -&gt; (Maybe v -&gt; (Maybe v, a)) -&gt; ST s a
forall k s v a.
(Eq k, Hashable k) =&gt;
HashTable s k v -&gt; k -&gt; (Maybe v -&gt; (Maybe v, a)) -&gt; ST s a
</span><a href="Data.HashTable.ST.Basic.html#mutate"><span class="hs-identifier hs-var">mutate</span></a></span><span>
</span><span id="line-178"></span><span>    </span><span id="local-6989586621679080845"><span class="annot"><span class="annottext">mutateST :: HashTable s k v -&gt; k -&gt; (Maybe v -&gt; ST s (Maybe v, a)) -&gt; ST s a
</span><a href="Data.HashTable.Class.html#mutateST"><span class="hs-identifier hs-var hs-var hs-var hs-var">mutateST</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashTable s k v -&gt; k -&gt; (Maybe v -&gt; ST s (Maybe v, a)) -&gt; ST s a
forall k s v a.
(Eq k, Hashable k) =&gt;
HashTable s k v -&gt; k -&gt; (Maybe v -&gt; ST s (Maybe v, a)) -&gt; ST s a
</span><a href="Data.HashTable.ST.Basic.html#mutateST"><span class="hs-identifier hs-var">mutateST</span></a></span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-182"></span><span id="local-6989586621679080841"><span id="local-6989586621679080842"><span id="local-6989586621679080843"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679080836"><span id="local-6989586621679080839"><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080843"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080842"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080841"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-183"></span><span>    </span><span id="local-6989586621679080834"><span class="annot"><span class="annottext">show :: HashTable s k v -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></span></span><span> </span><span class="annot"><span class="annottext">HashTable s k v
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&lt;HashTable&gt;&quot;</span></span></span></span></span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-187"></span><span class="hs-comment">-- | See the documentation for this function in</span><span>
</span><span id="line-188"></span><span class="hs-comment">-- 'Data.HashTable.Class.new'.</span><span>
</span><span id="line-189"></span><span id="local-6989586621679080830"><span id="local-6989586621679080831"><span id="local-6989586621679080832"><span class="annot"><a href="Data.HashTable.ST.Basic.html#new"><span class="hs-identifier hs-type">new</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679080832"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080832"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080831"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080830"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-190"></span><span id="new"><span class="annot"><span class="annottext">new :: ST s (HashTable s k v)
</span><a href="Data.HashTable.ST.Basic.html#new"><span class="hs-identifier hs-var hs-var">new</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s (HashTable s k v)
forall s k v. Int -&gt; ST s (HashTable s k v)
</span><a href="Data.HashTable.ST.Basic.html#newSized"><span class="hs-identifier hs-var">newSized</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-191"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#new"><span class="hs-pragma hs-type">new</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-195"></span><span class="hs-comment">-- | See the documentation for this function in</span><span>
</span><span id="line-196"></span><span class="hs-comment">-- 'Data.HashTable.Class.newSized'.</span><span>
</span><span id="line-197"></span><span id="local-6989586621679080827"><span id="local-6989586621679080828"><span id="local-6989586621679080829"><span class="annot"><a href="Data.HashTable.ST.Basic.html#newSized"><span class="hs-identifier hs-type">newSized</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679080829"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080829"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080828"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080827"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-198"></span><span id="newSized"><span class="annot"><span class="annottext">newSized :: Int -&gt; ST s (HashTable s k v)
</span><a href="Data.HashTable.ST.Basic.html#newSized"><span class="hs-identifier hs-var hs-var">newSized</span></a></span></span><span> </span><span id="local-6989586621679080826"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080826"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-199"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;entering: newSized &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080826"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-200"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679080824"><span class="annot"><span class="annottext">m :: Int
</span><a href="#local-6989586621679080824"><span class="hs-identifier hs-var hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="Data.HashTable.Internal.Utils.html#nextBestPrime"><span class="hs-identifier hs-var">nextBestPrime</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; Int -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Int
forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">ceiling</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080826"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="Data.HashTable.ST.Basic.html#maxLoad"><span class="hs-identifier hs-var">maxLoad</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-201"></span><span>    </span><span id="local-6989586621679080819"><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679080819"><span class="hs-identifier hs-var">ht</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s (HashTable_ s k v)
forall s k v. Int -&gt; ST s (HashTable_ s k v)
</span><a href="Data.HashTable.ST.Basic.html#newSizedReal"><span class="hs-identifier hs-var">newSizedReal</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080824"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-202"></span><span>    </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; ST s (HashTable s k v)
forall s k v. HashTable_ s k v -&gt; ST s (HashTable s k v)
</span><a href="Data.HashTable.ST.Basic.html#newRef"><span class="hs-identifier hs-var">newRef</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679080819"><span class="hs-identifier hs-var">ht</span></a></span><span>
</span><span id="line-203"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#newSized"><span class="hs-pragma hs-type">newSized</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-207"></span><span id="local-6989586621679081103"><span id="local-6989586621679081104"><span id="local-6989586621679081105"><span class="annot"><a href="Data.HashTable.ST.Basic.html#newSizedReal"><span class="hs-identifier hs-type">newSizedReal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679081105"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable_"><span class="hs-identifier hs-type">HashTable_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081105"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081104"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081103"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-208"></span><span id="newSizedReal"><span class="annot"><span class="annottext">newSizedReal :: Int -&gt; ST s (HashTable_ s k v)
</span><a href="Data.HashTable.ST.Basic.html#newSizedReal"><span class="hs-identifier hs-var hs-var">newSizedReal</span></a></span></span><span> </span><span id="local-6989586621679080816"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080816"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-comment">-- make sure the hash array is a multiple of cache-line sized so we can</span><span>
</span><span id="line-210"></span><span>    </span><span class="hs-comment">-- always search a whole cache line at once</span><span>
</span><span id="line-211"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679080815"><span class="annot"><span class="annottext">m' :: Int
</span><a href="#local-6989586621679080815"><span class="hs-identifier hs-var hs-var">m'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080816"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Data.HashTable.Internal.Utils.html#numElemsInCacheLine"><span class="hs-identifier hs-var">numElemsInCacheLine</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Data.HashTable.Internal.Utils.html#numElemsInCacheLine"><span class="hs-identifier hs-var">numElemsInCacheLine</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-212"></span><span>             </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Data.HashTable.Internal.Utils.html#numElemsInCacheLine"><span class="hs-identifier hs-var">numElemsInCacheLine</span></a></span><span>
</span><span id="line-213"></span><span>    </span><span id="local-6989586621679080812"><span class="annot"><span class="annottext">IntArray s
</span><a href="#local-6989586621679080812"><span class="hs-identifier hs-var">h</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s (IntArray s)
forall s. Int -&gt; ST s (IntArray s)
</span><a href="Data.HashTable.Internal.IntArray.html#newArray"><span class="hs-identifier hs-var">U.newArray</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080815"><span class="hs-identifier hs-var">m'</span></a></span><span>
</span><span id="line-214"></span><span>    </span><span id="local-6989586621679080810"><span class="annot"><span class="annottext">MutableArray s k
</span><a href="#local-6989586621679080810"><span class="hs-identifier hs-var">k</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; k -&gt; ST s (MutableArray s k)
forall a s. Int -&gt; a -&gt; ST s (MutableArray s a)
</span><a href="Data.HashTable.Internal.Array.html#newArray"><span class="hs-identifier hs-var">newArray</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080816"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">k
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span>
</span><span id="line-215"></span><span>    </span><span id="local-6989586621679080807"><span class="annot"><span class="annottext">MutableArray s v
</span><a href="#local-6989586621679080807"><span class="hs-identifier hs-var">v</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; v -&gt; ST s (MutableArray s v)
forall a s. Int -&gt; a -&gt; ST s (MutableArray s a)
</span><a href="Data.HashTable.Internal.Array.html#newArray"><span class="hs-identifier hs-var">newArray</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080816"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">v
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span>
</span><span id="line-216"></span><span>    </span><span id="local-6989586621679080806"><span class="annot"><span class="annottext">SizeRefs s
</span><a href="#local-6989586621679080806"><span class="hs-identifier hs-var">ld</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ST s (SizeRefs s)
forall s. ST s (SizeRefs s)
</span><a href="Data.HashTable.ST.Basic.html#newSizeRefs"><span class="hs-identifier hs-var">newSizeRefs</span></a></span><span>
</span><span id="line-217"></span><span>    </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; ST s (HashTable_ s k v)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(HashTable_ s k v -&gt; ST s (HashTable_ s k v))
-&gt; HashTable_ s k v -&gt; ST s (HashTable_ s k v)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; SizeRefs s
-&gt; IntArray s
-&gt; MutableArray s k
-&gt; MutableArray s v
-&gt; HashTable_ s k v
forall s k v.
Int
-&gt; SizeRefs s
-&gt; IntArray s
-&gt; MutableArray s k
-&gt; MutableArray s v
-&gt; HashTable_ s k v
</span><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-var">HashTable</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080816"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">SizeRefs s
</span><a href="#local-6989586621679080806"><span class="hs-identifier hs-var">ld</span></a></span><span> </span><span class="annot"><span class="annottext">IntArray s
</span><a href="#local-6989586621679080812"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s k
</span><a href="#local-6989586621679080810"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s v
</span><a href="#local-6989586621679080807"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span>
</span><span id="line-220"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-221"></span><span class="hs-comment">-- | See the documentation for this function in</span><span>
</span><span id="line-222"></span><span class="hs-comment">-- 'Data.HashTable.Class.delete'.</span><span>
</span><span id="line-223"></span><span id="local-6989586621679081156"><span id="local-6989586621679081157"><span id="local-6989586621679081158"><span class="annot"><a href="Data.HashTable.ST.Basic.html#delete"><span class="hs-identifier hs-type">delete</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679081158"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679081158"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-224"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081157"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081158"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081156"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-225"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679081158"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-226"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679081157"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-227"></span><span id="delete"><span class="annot"><span class="annottext">delete :: HashTable s k v -&gt; k -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#delete"><span class="hs-identifier hs-var hs-var">delete</span></a></span></span><span> </span><span id="local-6989586621679080804"><span class="annot"><span class="annottext">HashTable s k v
</span><a href="#local-6989586621679080804"><span class="hs-identifier hs-var">htRef</span></a></span></span><span> </span><span id="local-6989586621679080803"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679080803"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-228"></span><span>    </span><span id="local-6989586621679080802"><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679080802"><span class="hs-identifier hs-var">ht</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashTable s k v -&gt; ST s (HashTable_ s k v)
forall s k v. HashTable s k v -&gt; ST s (HashTable_ s k v)
</span><a href="Data.HashTable.ST.Basic.html#readRef"><span class="hs-identifier hs-var">readRef</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable s k v
</span><a href="#local-6989586621679080804"><span class="hs-identifier hs-var">htRef</span></a></span><span>
</span><span id="line-229"></span><span>    </span><span id="local-6989586621679080800"><span class="annot"><span class="annottext">SlotFindResponse
</span><a href="#local-6989586621679080800"><span class="hs-identifier hs-var">slots</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; k -&gt; Int -&gt; ST s SlotFindResponse
forall k s v.
(Hashable k, Eq k) =&gt;
HashTable_ s k v -&gt; k -&gt; Int -&gt; ST s SlotFindResponse
</span><a href="Data.HashTable.ST.Basic.html#findSafeSlots"><span class="hs-identifier hs-var">findSafeSlots</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679080802"><span class="hs-identifier hs-var">ht</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679080803"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080798"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-230"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; ST s () -&gt; ST s ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Bool
</span><a href="Data.HashTable.ST.Basic.html#trueInt"><span class="hs-identifier hs-var">trueInt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotFindResponse -&gt; Int
</span><a href="Data.HashTable.ST.Basic.html#_slotFound"><span class="hs-identifier hs-var hs-var">_slotFound</span></a></span><span> </span><span class="annot"><span class="annottext">SlotFindResponse
</span><a href="#local-6989586621679080800"><span class="hs-identifier hs-var">slots</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ST s () -&gt; ST s ()) -&gt; ST s () -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; Int -&gt; ST s ()
forall s k v. HashTable_ s k v -&gt; Int -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#deleteFromSlot"><span class="hs-identifier hs-var">deleteFromSlot</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679080802"><span class="hs-identifier hs-var">ht</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotFindResponse -&gt; Int
</span><a href="Data.HashTable.ST.Basic.html#_slotB1"><span class="hs-identifier hs-var hs-var">_slotB1</span></a></span><span> </span><span class="annot"><span class="annottext">SlotFindResponse
</span><a href="#local-6989586621679080800"><span class="hs-identifier hs-var">slots</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-231"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-232"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679080798"><span class="annot"><span class="annottext">h :: Int
</span><a href="#local-6989586621679080798"><span class="hs-identifier hs-var hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; Int
forall k. Hashable k =&gt; k -&gt; Int
</span><a href="Data.HashTable.ST.Basic.html#hash"><span class="hs-identifier hs-var">hash</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679080803"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-233"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#delete"><span class="hs-pragma hs-type">delete</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-237"></span><span class="hs-comment">-- | See the documentation for this function in</span><span>
</span><span id="line-238"></span><span class="hs-comment">-- 'Data.HashTable.Class.lookup'.</span><span>
</span><span id="line-239"></span><span id="local-6989586621679080789"><span id="local-6989586621679080790"><span id="local-6989586621679080791"><span class="annot"><a href="Data.HashTable.ST.Basic.html#lookup"><span class="hs-identifier hs-type">lookup</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679080791"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679080791"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080790"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080791"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080789"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679080791"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679080790"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679080789"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-240"></span><span id="lookup"><span class="annot"><span class="annottext">lookup :: HashTable s k v -&gt; k -&gt; ST s (Maybe v)
</span><a href="Data.HashTable.ST.Basic.html#lookup"><span class="hs-identifier hs-var hs-var">lookup</span></a></span></span><span> </span><span id="local-6989586621679080788"><span class="annot"><span class="annottext">HashTable s k v
</span><a href="#local-6989586621679080788"><span class="hs-identifier hs-var">htRef</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080787"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679080787"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-241"></span><span>    </span><span id="local-6989586621679080786"><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679080786"><span class="hs-identifier hs-var">ht</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashTable s k v -&gt; ST s (HashTable_ s k v)
forall s k v. HashTable s k v -&gt; ST s (HashTable_ s k v)
</span><a href="Data.HashTable.ST.Basic.html#readRef"><span class="hs-identifier hs-var">readRef</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable s k v
</span><a href="#local-6989586621679080788"><span class="hs-identifier hs-var">htRef</span></a></span><span>
</span><span id="line-242"></span><span>    </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; ST s (Maybe v)
forall s v. HashTable_ s k v -&gt; ST s (Maybe v)
</span><a href="#local-6989586621679080785"><span class="hs-identifier hs-var">lookup'</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679080786"><span class="hs-identifier hs-var">ht</span></a></span><span>
</span><span id="line-243"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-244"></span><span>    </span><span id="local-6989586621679080785"><span class="annot"><span class="annottext">lookup' :: HashTable_ s k v -&gt; ST s (Maybe v)
</span><a href="#local-6989586621679080785"><span class="hs-identifier hs-var hs-var">lookup'</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span id="local-6989586621679080784"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080784"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span class="annot"><span class="annottext">SizeRefs s
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679080783"><span class="annot"><span class="annottext">IntArray s
</span><a href="#local-6989586621679080783"><span class="hs-identifier hs-var">hashes</span></a></span></span><span> </span><span id="local-6989586621679080782"><span class="annot"><span class="annottext">MutableArray s k
</span><a href="#local-6989586621679080782"><span class="hs-identifier hs-var">keys</span></a></span></span><span> </span><span id="local-6989586621679080781"><span class="annot"><span class="annottext">MutableArray s v
</span><a href="#local-6989586621679080781"><span class="hs-identifier hs-var">values</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-245"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080780"><span class="annot"><span class="annottext">b :: Int
</span><a href="#local-6989586621679080780"><span class="hs-identifier hs-var hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
</span><a href="Data.HashTable.Internal.Utils.html#whichBucket"><span class="hs-identifier hs-var">whichBucket</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080778"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080784"><span class="hs-identifier hs-var">sz</span></a></span><span>
</span><span id="line-246"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;lookup h=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080778"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; sz=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080784"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; b=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080780"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-247"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; ST s (Maybe v)
</span><a href="#local-6989586621679080777"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080780"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080784"><span class="hs-identifier hs-var">sz</span></a></span><span>
</span><span id="line-248"></span><span>
</span><span id="line-249"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-250"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621679080778"><span class="annot"><span class="annottext">h :: Int
</span><a href="#local-6989586621679080778"><span class="hs-identifier hs-var hs-var">h</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; Int
forall k. Hashable k =&gt; k -&gt; Int
</span><a href="Data.HashTable.ST.Basic.html#hash"><span class="hs-identifier hs-var">hash</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679080787"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-251"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621679080776"><span class="annot"><span class="annottext">he :: Elem
</span><a href="#local-6989586621679080776"><span class="hs-identifier hs-var hs-var">he</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Elem
</span><a href="Data.HashTable.ST.Basic.html#hashToElem"><span class="hs-identifier hs-var">hashToElem</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080778"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-252"></span><span>
</span><span id="line-253"></span><span>        </span><span id="local-6989586621679080777"><span class="annot"><span class="annottext">go :: Int -&gt; Int -&gt; Int -&gt; ST s (Maybe v)
</span><a href="#local-6989586621679080777"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080774"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080774"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080773"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080773"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080772"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080772"><span class="hs-identifier hs-var">end</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;lookup/go&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-254"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;lookup'/go: &quot;</span></span><span>
</span><span id="line-255"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080774"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-256"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;/&quot;</span></span><span>
</span><span id="line-257"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080773"><span class="hs-identifier hs-var">start</span></a></span><span>
</span><span id="line-258"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;/&quot;</span></span><span>
</span><span id="line-259"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080772"><span class="hs-identifier hs-var">end</span></a></span><span>
</span><span id="line-260"></span><span>                           </span><span class="hs-special">]</span><span>
</span><span id="line-261"></span><span>            </span><span id="local-6989586621679080770"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080770"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IntArray s -&gt; Int -&gt; Int -&gt; Elem -&gt; Elem -&gt; ST s Int
forall s. IntArray s -&gt; Int -&gt; Int -&gt; Elem -&gt; Elem -&gt; ST s Int
</span><a href="Data.HashTable.Internal.CacheLine.html#forwardSearch2"><span class="hs-identifier hs-var">forwardSearch2</span></a></span><span> </span><span class="annot"><span class="annottext">IntArray s
</span><a href="#local-6989586621679080783"><span class="hs-identifier hs-var">hashes</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080774"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080772"><span class="hs-identifier hs-var">end</span></a></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="#local-6989586621679080776"><span class="hs-identifier hs-var">he</span></a></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="Data.HashTable.ST.Basic.html#emptyMarker"><span class="hs-identifier hs-var">emptyMarker</span></a></span><span>
</span><span id="line-262"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;forwardSearch2 returned &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080770"><span class="hs-identifier hs-var">idx</span></a></span><span>
</span><span id="line-263"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080770"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080770"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080773"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080770"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080772"><span class="hs-identifier hs-var">end</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-264"></span><span>               </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe v -&gt; ST s (Maybe v)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe v
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-265"></span><span>               </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-266"></span><span>                 </span><span id="local-6989586621679080765"><span class="annot"><span class="annottext">Elem
</span><a href="#local-6989586621679080765"><span class="hs-identifier hs-var">h0</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IntArray s -&gt; Int -&gt; ST s Elem
forall s. IntArray s -&gt; Int -&gt; ST s Elem
</span><a href="Data.HashTable.Internal.IntArray.html#readArray"><span class="hs-identifier hs-var">U.readArray</span></a></span><span> </span><span class="annot"><span class="annottext">IntArray s
</span><a href="#local-6989586621679080783"><span class="hs-identifier hs-var">hashes</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080770"><span class="hs-identifier hs-var">idx</span></a></span><span>
</span><span id="line-267"></span><span>                 </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;h0 was &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Elem -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="#local-6989586621679080765"><span class="hs-identifier hs-var">h0</span></a></span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span>                 </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Elem -&gt; Bool
</span><a href="Data.HashTable.ST.Basic.html#recordIsEmpty"><span class="hs-identifier hs-var">recordIsEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="#local-6989586621679080765"><span class="hs-identifier hs-var">h0</span></a></span><span>
</span><span id="line-270"></span><span>                   </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-271"></span><span>                       </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;record empty, returning Nothing&quot;</span></span><span>
</span><span id="line-272"></span><span>                       </span><span class="annot"><span class="annottext">Maybe v -&gt; ST s (Maybe v)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe v
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-273"></span><span>                   </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-274"></span><span>                     </span><span id="local-6989586621679080762"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679080762"><span class="hs-identifier hs-var">k'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutableArray s k -&gt; Int -&gt; ST s k
forall s a. MutableArray s a -&gt; Int -&gt; ST s a
</span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s k
</span><a href="#local-6989586621679080782"><span class="hs-identifier hs-var">keys</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080770"><span class="hs-identifier hs-var">idx</span></a></span><span>
</span><span id="line-275"></span><span>                     </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679080787"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">k -&gt; k -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679080762"><span class="hs-identifier hs-var">k'</span></a></span><span>
</span><span id="line-276"></span><span>                       </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-277"></span><span>                         </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;value found at &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080770"><span class="hs-identifier hs-var">idx</span></a></span><span>
</span><span id="line-278"></span><span>                         </span><span id="local-6989586621679080760"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679080760"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutableArray s v -&gt; Int -&gt; ST s v
forall s a. MutableArray s a -&gt; Int -&gt; ST s a
</span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s v
</span><a href="#local-6989586621679080781"><span class="hs-identifier hs-var">values</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080770"><span class="hs-identifier hs-var">idx</span></a></span><span>
</span><span id="line-279"></span><span>                         </span><span class="annot"><span class="annottext">Maybe v -&gt; ST s (Maybe v)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe v -&gt; ST s (Maybe v)) -&gt; Maybe v -&gt; ST s (Maybe v)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">v -&gt; Maybe v
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679080760"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-280"></span><span>                       </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-281"></span><span>                         </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;value not found, recursing&quot;</span></span><span>
</span><span id="line-282"></span><span>                         </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080770"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080774"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-283"></span><span>                           </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; ST s (Maybe v)
</span><a href="#local-6989586621679080777"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080770"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080770"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080774"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-284"></span><span>                           </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; ST s (Maybe v)
</span><a href="#local-6989586621679080777"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080770"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080773"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080772"><span class="hs-identifier hs-var">end</span></a></span><span>
</span><span id="line-285"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#lookup"><span class="hs-pragma hs-type">lookup</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-286"></span><span>
</span><span id="line-287"></span><span>
</span><span id="line-288"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-289"></span><span class="hs-comment">-- | See the documentation for this function in</span><span>
</span><span id="line-290"></span><span class="hs-comment">-- 'Data.HashTable.Class.insert'.</span><span>
</span><span id="line-291"></span><span id="local-6989586621679080757"><span id="local-6989586621679080758"><span id="local-6989586621679080759"><span class="annot"><a href="Data.HashTable.ST.Basic.html#insert"><span class="hs-identifier hs-type">insert</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679080759"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679080759"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-292"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080758"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080759"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080757"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-293"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679080759"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-294"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679080757"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-295"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679080758"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-296"></span><span id="insert"><span class="annot"><span class="annottext">insert :: HashTable s k v -&gt; k -&gt; v -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#insert"><span class="hs-identifier hs-var hs-var">insert</span></a></span></span><span> </span><span id="local-6989586621679080756"><span class="annot"><span class="annottext">HashTable s k v
</span><a href="#local-6989586621679080756"><span class="hs-identifier hs-var">htRef</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080755"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679080755"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080754"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679080754"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-297"></span><span>    </span><span id="local-6989586621679080753"><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679080753"><span class="hs-identifier hs-var">ht</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashTable s k v -&gt; ST s (HashTable_ s k v)
forall s k v. HashTable s k v -&gt; ST s (HashTable_ s k v)
</span><a href="Data.HashTable.ST.Basic.html#readRef"><span class="hs-identifier hs-var">readRef</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable s k v
</span><a href="#local-6989586621679080756"><span class="hs-identifier hs-var">htRef</span></a></span><span>
</span><span id="line-298"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;insert: h=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080752"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-299"></span><span>    </span><span id="local-6989586621679080751"><span class="annot"><span class="annottext">slots :: SlotFindResponse
</span><a href="#local-6989586621679080751"><span class="hs-identifier hs-var">slots</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Basic.html#SlotFindResponse"><span class="hs-identifier hs-type">SlotFindResponse</span></a></span><span> </span><span id="local-6989586621679080749"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080749"><span class="hs-identifier hs-var">foundInt</span></a></span></span><span> </span><span id="local-6989586621679080748"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080748"><span class="hs-identifier hs-var">b0</span></a></span></span><span> </span><span id="local-6989586621679080747"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080747"><span class="hs-identifier hs-var">b1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; k -&gt; Int -&gt; ST s SlotFindResponse
forall k s v.
(Hashable k, Eq k) =&gt;
HashTable_ s k v -&gt; k -&gt; Int -&gt; ST s SlotFindResponse
</span><a href="Data.HashTable.ST.Basic.html#findSafeSlots"><span class="hs-identifier hs-var">findSafeSlots</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679080753"><span class="hs-identifier hs-var">ht</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679080755"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080752"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-300"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679080746"><span class="annot"><span class="annottext">found :: Bool
</span><a href="#local-6989586621679080746"><span class="hs-identifier hs-var hs-var">found</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Bool
</span><a href="Data.HashTable.ST.Basic.html#trueInt"><span class="hs-identifier hs-var">trueInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080749"><span class="hs-identifier hs-var">foundInt</span></a></span><span>
</span><span id="line-301"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;insert: findSafeSlots returned &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">SlotFindResponse -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">SlotFindResponse
</span><a href="#local-6989586621679080751"><span class="hs-identifier hs-var">slots</span></a></span><span>
</span><span id="line-302"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; ST s () -&gt; ST s ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679080746"><span class="hs-identifier hs-var">found</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080748"><span class="hs-identifier hs-var">b0</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080747"><span class="hs-identifier hs-var">b1</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ST s () -&gt; ST s ()) -&gt; ST s () -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; Int -&gt; ST s ()
forall s k v. HashTable_ s k v -&gt; Int -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#deleteFromSlot"><span class="hs-identifier hs-var">deleteFromSlot</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679080753"><span class="hs-identifier hs-var">ht</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080747"><span class="hs-identifier hs-var">b1</span></a></span><span>
</span><span id="line-303"></span><span>    </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; Int -&gt; Elem -&gt; k -&gt; v -&gt; ST s ()
forall s k v. HashTable_ s k v -&gt; Int -&gt; Elem -&gt; k -&gt; v -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#insertIntoSlot"><span class="hs-identifier hs-var">insertIntoSlot</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679080753"><span class="hs-identifier hs-var">ht</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080748"><span class="hs-identifier hs-var">b0</span></a></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="#local-6989586621679080742"><span class="hs-identifier hs-var">he</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679080755"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679080754"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-304"></span><span>    </span><span id="local-6989586621679080741"><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679080741"><span class="hs-identifier hs-var">ht'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; ST s (HashTable_ s k v)
forall k s v.
(Eq k, Hashable k) =&gt;
HashTable_ s k v -&gt; ST s (HashTable_ s k v)
</span><a href="Data.HashTable.ST.Basic.html#checkOverflow"><span class="hs-identifier hs-var">checkOverflow</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679080753"><span class="hs-identifier hs-var">ht</span></a></span><span>
</span><span id="line-305"></span><span>    </span><span class="annot"><span class="annottext">HashTable s k v -&gt; HashTable_ s k v -&gt; ST s ()
forall s k v. HashTable s k v -&gt; HashTable_ s k v -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#writeRef"><span class="hs-identifier hs-var">writeRef</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable s k v
</span><a href="#local-6989586621679080756"><span class="hs-identifier hs-var">htRef</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679080741"><span class="hs-identifier hs-var">ht'</span></a></span><span>
</span><span id="line-306"></span><span>
</span><span id="line-307"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-308"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679080752"><span class="annot"><span class="annottext">h :: Int
</span><a href="#local-6989586621679080752"><span class="hs-identifier hs-var hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; Int
forall k. Hashable k =&gt; k -&gt; Int
</span><a href="Data.HashTable.ST.Basic.html#hash"><span class="hs-identifier hs-var">hash</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679080755"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-309"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679080742"><span class="annot"><span class="annottext">he :: Elem
</span><a href="#local-6989586621679080742"><span class="hs-identifier hs-var hs-var">he</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Elem
</span><a href="Data.HashTable.ST.Basic.html#hashToElem"><span class="hs-identifier hs-var">hashToElem</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080752"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-310"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#insert"><span class="hs-pragma hs-type">insert</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-311"></span><span>
</span><span id="line-312"></span><span>
</span><span id="line-313"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-314"></span><span class="hs-comment">-- | See the documentation for this function in</span><span>
</span><span id="line-315"></span><span class="hs-comment">-- 'Data.HashTable.Class.mutate'.</span><span>
</span><span id="line-316"></span><span id="local-6989586621679080735"><span id="local-6989586621679080736"><span id="local-6989586621679080737"><span id="local-6989586621679080738"><span class="annot"><a href="Data.HashTable.ST.Basic.html#mutate"><span class="hs-identifier hs-type">mutate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679080738"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679080738"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-317"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080737"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080738"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080736"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-318"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679080738"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-319"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679080736"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679080736"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679080735"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679080737"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080735"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span><span>
</span><span id="line-321"></span><span id="mutate"><span class="annot"><span class="annottext">mutate :: HashTable s k v -&gt; k -&gt; (Maybe v -&gt; (Maybe v, a)) -&gt; ST s a
</span><a href="Data.HashTable.ST.Basic.html#mutate"><span class="hs-identifier hs-var hs-var">mutate</span></a></span></span><span> </span><span id="local-6989586621679080734"><span class="annot"><span class="annottext">HashTable s k v
</span><a href="#local-6989586621679080734"><span class="hs-identifier hs-var">htRef</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080733"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679080733"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080732"><span class="annot"><span class="annottext">Maybe v -&gt; (Maybe v, a)
</span><a href="#local-6989586621679080732"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashTable s k v -&gt; k -&gt; (Maybe v -&gt; ST s (Maybe v, a)) -&gt; ST s a
forall k s v a.
(Eq k, Hashable k) =&gt;
HashTable s k v -&gt; k -&gt; (Maybe v -&gt; ST s (Maybe v, a)) -&gt; ST s a
</span><a href="Data.HashTable.ST.Basic.html#mutateST"><span class="hs-identifier hs-var">mutateST</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable s k v
</span><a href="#local-6989586621679080734"><span class="hs-identifier hs-var">htRef</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679080733"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Maybe v, a) -&gt; ST s (Maybe v, a)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">((Maybe v, a) -&gt; ST s (Maybe v, a))
-&gt; (Maybe v -&gt; (Maybe v, a)) -&gt; Maybe v -&gt; ST s (Maybe v, a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Maybe v -&gt; (Maybe v, a)
</span><a href="#local-6989586621679080732"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-322"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#mutate"><span class="hs-pragma hs-type">mutate</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-323"></span><span>
</span><span id="line-324"></span><span>
</span><span id="line-325"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-326"></span><span class="hs-comment">-- | See the documentation for this function in</span><span>
</span><span id="line-327"></span><span class="hs-comment">-- 'Data.HashTable.Class.mutateST'.</span><span>
</span><span id="line-328"></span><span id="local-6989586621679080727"><span id="local-6989586621679080728"><span id="local-6989586621679080729"><span id="local-6989586621679080730"><span class="annot"><a href="Data.HashTable.ST.Basic.html#mutateST"><span class="hs-identifier hs-type">mutateST</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679080730"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679080730"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-329"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080729"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080730"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080728"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-330"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679080730"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-331"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679080728"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679080729"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679080728"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679080727"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-332"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679080729"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080727"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span><span>
</span><span id="line-333"></span><span id="mutateST"><span class="annot"><span class="annottext">mutateST :: HashTable s k v -&gt; k -&gt; (Maybe v -&gt; ST s (Maybe v, a)) -&gt; ST s a
</span><a href="Data.HashTable.ST.Basic.html#mutateST"><span class="hs-identifier hs-var hs-var">mutateST</span></a></span></span><span> </span><span id="local-6989586621679080726"><span class="annot"><span class="annottext">HashTable s k v
</span><a href="#local-6989586621679080726"><span class="hs-identifier hs-var">htRef</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080725"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679080725"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080724"><span class="annot"><span class="annottext">Maybe v -&gt; ST s (Maybe v, a)
</span><a href="#local-6989586621679080724"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-334"></span><span>    </span><span id="local-6989586621679080723"><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679080723"><span class="hs-identifier hs-var">ht</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashTable s k v -&gt; ST s (HashTable_ s k v)
forall s k v. HashTable s k v -&gt; ST s (HashTable_ s k v)
</span><a href="Data.HashTable.ST.Basic.html#readRef"><span class="hs-identifier hs-var">readRef</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable s k v
</span><a href="#local-6989586621679080726"><span class="hs-identifier hs-var">htRef</span></a></span><span>
</span><span id="line-335"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679080722"><span class="annot"><span class="annottext">values :: MutableArray s v
</span><a href="#local-6989586621679080722"><span class="hs-identifier hs-var hs-var">values</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; MutableArray s v
forall s k v. HashTable_ s k v -&gt; MutableArray s v
</span><a href="Data.HashTable.ST.Basic.html#_values"><span class="hs-identifier hs-var hs-var">_values</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679080723"><span class="hs-identifier hs-var">ht</span></a></span><span>
</span><span id="line-336"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mutate h=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080721"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-337"></span><span>    </span><span id="local-6989586621679080720"><span class="annot"><span class="annottext">slots :: SlotFindResponse
</span><a href="#local-6989586621679080720"><span class="hs-identifier hs-var">slots</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Basic.html#SlotFindResponse"><span class="hs-identifier hs-type">SlotFindResponse</span></a></span><span> </span><span id="local-6989586621679080719"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080719"><span class="hs-identifier hs-var">foundInt</span></a></span></span><span> </span><span id="local-6989586621679080718"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080718"><span class="hs-identifier hs-var">b0</span></a></span></span><span> </span><span id="local-6989586621679080717"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080717"><span class="hs-identifier hs-var">b1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; k -&gt; Int -&gt; ST s SlotFindResponse
forall k s v.
(Hashable k, Eq k) =&gt;
HashTable_ s k v -&gt; k -&gt; Int -&gt; ST s SlotFindResponse
</span><a href="Data.HashTable.ST.Basic.html#findSafeSlots"><span class="hs-identifier hs-var">findSafeSlots</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679080723"><span class="hs-identifier hs-var">ht</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679080725"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080721"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-338"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679080716"><span class="annot"><span class="annottext">found :: Bool
</span><a href="#local-6989586621679080716"><span class="hs-identifier hs-var hs-var">found</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Bool
</span><a href="Data.HashTable.ST.Basic.html#trueInt"><span class="hs-identifier hs-var">trueInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080719"><span class="hs-identifier hs-var">foundInt</span></a></span><span>
</span><span id="line-339"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;findSafeSlots returned &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">SlotFindResponse -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">SlotFindResponse
</span><a href="#local-6989586621679080720"><span class="hs-identifier hs-var">slots</span></a></span><span>
</span><span id="line-340"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679080715"><span class="annot"><span class="annottext">Maybe v
</span><a href="#local-6989586621679080715"><span class="hs-identifier hs-var">mv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679080716"><span class="hs-identifier hs-var">found</span></a></span><span>
</span><span id="line-341"></span><span>              </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(v -&gt; Maybe v) -&gt; ST s v -&gt; ST s (Maybe v)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">v -&gt; Maybe v
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(ST s v -&gt; ST s (Maybe v)) -&gt; ST s v -&gt; ST s (Maybe v)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MutableArray s v -&gt; Int -&gt; ST s v
forall s a. MutableArray s a -&gt; Int -&gt; ST s a
</span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s v
</span><a href="#local-6989586621679080722"><span class="hs-identifier hs-var">values</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080717"><span class="hs-identifier hs-var">b1</span></a></span><span>
</span><span id="line-342"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe v -&gt; ST s (Maybe v)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe v
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-343"></span><span>    </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621679080714"><span class="annot"><span class="annottext">Maybe v
</span><a href="#local-6989586621679080714"><span class="hs-identifier hs-var">mv'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080713"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679080713"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe v -&gt; ST s (Maybe v, a)
</span><a href="#local-6989586621679080724"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe v
</span><a href="#local-6989586621679080715"><span class="hs-identifier hs-var">mv</span></a></span><span>
</span><span id="line-344"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe v
</span><a href="#local-6989586621679080715"><span class="hs-identifier hs-var">mv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe v
</span><a href="#local-6989586621679080714"><span class="hs-identifier hs-var">mv'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-345"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe v
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe v
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; ST s ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-346"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">v
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe v
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-347"></span><span>            </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; Int -&gt; ST s ()
forall s k v. HashTable_ s k v -&gt; Int -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#deleteFromSlot"><span class="hs-identifier hs-var">deleteFromSlot</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679080723"><span class="hs-identifier hs-var">ht</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080717"><span class="hs-identifier hs-var">b1</span></a></span><span>
</span><span id="line-348"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe v
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679080712"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679080712"><span class="hs-identifier hs-var">v'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-349"></span><span>            </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; Int -&gt; Elem -&gt; k -&gt; v -&gt; ST s ()
forall s k v. HashTable_ s k v -&gt; Int -&gt; Elem -&gt; k -&gt; v -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#insertIntoSlot"><span class="hs-identifier hs-var">insertIntoSlot</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679080723"><span class="hs-identifier hs-var">ht</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080718"><span class="hs-identifier hs-var">b0</span></a></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="#local-6989586621679080711"><span class="hs-identifier hs-var">he</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679080725"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679080712"><span class="hs-identifier hs-var">v'</span></a></span><span>
</span><span id="line-350"></span><span>            </span><span id="local-6989586621679080710"><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679080710"><span class="hs-identifier hs-var">ht'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; ST s (HashTable_ s k v)
forall k s v.
(Eq k, Hashable k) =&gt;
HashTable_ s k v -&gt; ST s (HashTable_ s k v)
</span><a href="Data.HashTable.ST.Basic.html#checkOverflow"><span class="hs-identifier hs-var">checkOverflow</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679080723"><span class="hs-identifier hs-var">ht</span></a></span><span>
</span><span id="line-351"></span><span>            </span><span class="annot"><span class="annottext">HashTable s k v -&gt; HashTable_ s k v -&gt; ST s ()
forall s k v. HashTable s k v -&gt; HashTable_ s k v -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#writeRef"><span class="hs-identifier hs-var">writeRef</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable s k v
</span><a href="#local-6989586621679080726"><span class="hs-identifier hs-var">htRef</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679080710"><span class="hs-identifier hs-var">ht'</span></a></span><span>
</span><span id="line-352"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">v
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679080709"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679080709"><span class="hs-identifier hs-var">v'</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-353"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; ST s () -&gt; ST s ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080718"><span class="hs-identifier hs-var">b0</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080717"><span class="hs-identifier hs-var">b1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ST s () -&gt; ST s ()) -&gt; ST s () -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-354"></span><span>                </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; Int -&gt; ST s ()
forall s k v. HashTable_ s k v -&gt; Int -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#deleteFromSlot"><span class="hs-identifier hs-var">deleteFromSlot</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679080723"><span class="hs-identifier hs-var">ht</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080717"><span class="hs-identifier hs-var">b1</span></a></span><span>
</span><span id="line-355"></span><span>            </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; Int -&gt; Elem -&gt; k -&gt; v -&gt; ST s ()
forall s k v. HashTable_ s k v -&gt; Int -&gt; Elem -&gt; k -&gt; v -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#insertIntoSlot"><span class="hs-identifier hs-var">insertIntoSlot</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679080723"><span class="hs-identifier hs-var">ht</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080718"><span class="hs-identifier hs-var">b0</span></a></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="#local-6989586621679080711"><span class="hs-identifier hs-var">he</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679080725"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679080709"><span class="hs-identifier hs-var">v'</span></a></span><span>
</span><span id="line-356"></span><span>    </span><span class="annot"><span class="annottext">a -&gt; ST s a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679080713"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-357"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-358"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679080721"><span class="annot"><span class="annottext">h :: Int
</span><a href="#local-6989586621679080721"><span class="hs-identifier hs-var hs-var">h</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; Int
forall k. Hashable k =&gt; k -&gt; Int
</span><a href="Data.HashTable.ST.Basic.html#hash"><span class="hs-identifier hs-var">hash</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679080725"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-359"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679080711"><span class="annot"><span class="annottext">he :: Elem
</span><a href="#local-6989586621679080711"><span class="hs-identifier hs-var hs-var">he</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Elem
</span><a href="Data.HashTable.ST.Basic.html#hashToElem"><span class="hs-identifier hs-var">hashToElem</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080721"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-360"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#mutateST"><span class="hs-pragma hs-type">mutateST</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-361"></span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-364"></span><span class="hs-comment">-- | See the documentation for this function in</span><span>
</span><span id="line-365"></span><span class="hs-comment">-- 'Data.HashTable.Class.foldM'.</span><span>
</span><span id="line-366"></span><span id="local-6989586621679080705"><span id="local-6989586621679080706"><span id="local-6989586621679080707"><span id="local-6989586621679080708"><span class="annot"><a href="Data.HashTable.ST.Basic.html#foldM"><span class="hs-identifier hs-type">foldM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679080708"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679080707"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679080706"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679080705"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080708"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679080708"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080705"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080707"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080706"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679080705"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080708"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span><span>
</span><span id="line-367"></span><span id="foldM"><span class="annot"><span class="annottext">foldM :: (a -&gt; (k, v) -&gt; ST s a) -&gt; a -&gt; HashTable s k v -&gt; ST s a
</span><a href="Data.HashTable.ST.Basic.html#foldM"><span class="hs-identifier hs-var hs-var">foldM</span></a></span></span><span> </span><span id="local-6989586621679080704"><span class="annot"><span class="annottext">a -&gt; (k, v) -&gt; ST s a
</span><a href="#local-6989586621679080704"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679080703"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679080703"><span class="hs-identifier hs-var">seed0</span></a></span></span><span> </span><span id="local-6989586621679080702"><span class="annot"><span class="annottext">HashTable s k v
</span><a href="#local-6989586621679080702"><span class="hs-identifier hs-var">htRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashTable s k v -&gt; ST s (HashTable_ s k v)
forall s k v. HashTable s k v -&gt; ST s (HashTable_ s k v)
</span><a href="Data.HashTable.ST.Basic.html#readRef"><span class="hs-identifier hs-var">readRef</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable s k v
</span><a href="#local-6989586621679080702"><span class="hs-identifier hs-var">htRef</span></a></span><span> </span><span class="annot"><span class="annottext">ST s (HashTable_ s k v) -&gt; (HashTable_ s k v -&gt; ST s a) -&gt; ST s a
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; ST s a
</span><a href="#local-6989586621679080701"><span class="hs-identifier hs-var">work</span></a></span><span>
</span><span id="line-368"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-369"></span><span>    </span><span id="local-6989586621679080701"><span class="annot"><span class="annottext">work :: HashTable_ s k v -&gt; ST s a
</span><a href="#local-6989586621679080701"><span class="hs-identifier hs-var hs-var">work</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span id="local-6989586621679080700"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080700"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span class="annot"><span class="annottext">SizeRefs s
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679080699"><span class="annot"><span class="annottext">IntArray s
</span><a href="#local-6989586621679080699"><span class="hs-identifier hs-var">hashes</span></a></span></span><span> </span><span id="local-6989586621679080698"><span class="annot"><span class="annottext">MutableArray s k
</span><a href="#local-6989586621679080698"><span class="hs-identifier hs-var">keys</span></a></span></span><span> </span><span id="local-6989586621679080697"><span class="annot"><span class="annottext">MutableArray s v
</span><a href="#local-6989586621679080697"><span class="hs-identifier hs-var">values</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; a -&gt; ST s a
</span><a href="#local-6989586621679080696"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679080703"><span class="hs-identifier hs-var">seed0</span></a></span><span>
</span><span id="line-370"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-371"></span><span>        </span><span id="local-6989586621679080696"><span class="annot"><span class="annottext">go :: Int -&gt; a -&gt; ST s a
</span><a href="#local-6989586621679080696"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080695"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080695"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080694"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679080694"><span class="hs-identifier hs-var">seed</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080695"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080700"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; ST s a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679080694"><span class="hs-identifier hs-var">seed</span></a></span><span>
</span><span id="line-372"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-373"></span><span>            </span><span id="local-6989586621679080693"><span class="annot"><span class="annottext">Elem
</span><a href="#local-6989586621679080693"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IntArray s -&gt; Int -&gt; ST s Elem
forall s. IntArray s -&gt; Int -&gt; ST s Elem
</span><a href="Data.HashTable.Internal.IntArray.html#readArray"><span class="hs-identifier hs-var">U.readArray</span></a></span><span> </span><span class="annot"><span class="annottext">IntArray s
</span><a href="#local-6989586621679080699"><span class="hs-identifier hs-var">hashes</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080695"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-374"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Elem -&gt; Bool
</span><a href="Data.HashTable.ST.Basic.html#recordIsEmpty"><span class="hs-identifier hs-var">recordIsEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="#local-6989586621679080693"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Elem -&gt; Bool
</span><a href="Data.HashTable.ST.Basic.html#recordIsDeleted"><span class="hs-identifier hs-var">recordIsDeleted</span></a></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="#local-6989586621679080693"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-375"></span><span>              </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int -&gt; a -&gt; ST s a
</span><a href="#local-6989586621679080696"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080695"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679080694"><span class="hs-identifier hs-var">seed</span></a></span><span>
</span><span id="line-376"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-377"></span><span>                </span><span id="local-6989586621679080691"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679080691"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutableArray s k -&gt; Int -&gt; ST s k
forall s a. MutableArray s a -&gt; Int -&gt; ST s a
</span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s k
</span><a href="#local-6989586621679080698"><span class="hs-identifier hs-var">keys</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080695"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-378"></span><span>                </span><span id="local-6989586621679080690"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679080690"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutableArray s v -&gt; Int -&gt; ST s v
forall s a. MutableArray s a -&gt; Int -&gt; ST s a
</span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s v
</span><a href="#local-6989586621679080697"><span class="hs-identifier hs-var">values</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080695"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-379"></span><span>                </span><span class="hs-glyph">!</span><span id="local-6989586621679080689"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679080689"><span class="hs-identifier hs-var">seed'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">a -&gt; (k, v) -&gt; ST s a
</span><a href="#local-6989586621679080704"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679080694"><span class="hs-identifier hs-var">seed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679080691"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679080690"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-380"></span><span>                </span><span class="annot"><span class="annottext">Int -&gt; a -&gt; ST s a
</span><a href="#local-6989586621679080696"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080695"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679080689"><span class="hs-identifier hs-var">seed'</span></a></span><span>
</span><span id="line-381"></span><span>
</span><span id="line-382"></span><span>
</span><span id="line-383"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-384"></span><span class="hs-comment">-- | See the documentation for this function in</span><span>
</span><span id="line-385"></span><span class="hs-comment">-- 'Data.HashTable.Class.mapM_'.</span><span>
</span><span id="line-386"></span><span id="local-6989586621679080685"><span id="local-6989586621679080686"><span id="local-6989586621679080687"><span id="local-6989586621679080688"><span class="annot"><a href="Data.HashTable.ST.Basic.html#mapM_"><span class="hs-identifier hs-type">mapM_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679080688"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679080687"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679080686"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080685"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080686"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080688"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080687"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679080686"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-387"></span><span id="mapM_"><span class="annot"><span class="annottext">mapM_ :: ((k, v) -&gt; ST s b) -&gt; HashTable s k v -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#mapM_"><span class="hs-identifier hs-var hs-var">mapM_</span></a></span></span><span> </span><span id="local-6989586621679080684"><span class="annot"><span class="annottext">(k, v) -&gt; ST s b
</span><a href="#local-6989586621679080684"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679080683"><span class="annot"><span class="annottext">HashTable s k v
</span><a href="#local-6989586621679080683"><span class="hs-identifier hs-var">htRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashTable s k v -&gt; ST s (HashTable_ s k v)
forall s k v. HashTable s k v -&gt; ST s (HashTable_ s k v)
</span><a href="Data.HashTable.ST.Basic.html#readRef"><span class="hs-identifier hs-var">readRef</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable s k v
</span><a href="#local-6989586621679080683"><span class="hs-identifier hs-var">htRef</span></a></span><span> </span><span class="annot"><span class="annottext">ST s (HashTable_ s k v) -&gt; (HashTable_ s k v -&gt; ST s ()) -&gt; ST s ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; ST s ()
</span><a href="#local-6989586621679080682"><span class="hs-identifier hs-var">work</span></a></span><span>
</span><span id="line-388"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-389"></span><span>    </span><span id="local-6989586621679080682"><span class="annot"><span class="annottext">work :: HashTable_ s k v -&gt; ST s ()
</span><a href="#local-6989586621679080682"><span class="hs-identifier hs-var hs-var">work</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span id="local-6989586621679080681"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080681"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span class="annot"><span class="annottext">SizeRefs s
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679080680"><span class="annot"><span class="annottext">IntArray s
</span><a href="#local-6989586621679080680"><span class="hs-identifier hs-var">hashes</span></a></span></span><span> </span><span id="local-6989586621679080679"><span class="annot"><span class="annottext">MutableArray s k
</span><a href="#local-6989586621679080679"><span class="hs-identifier hs-var">keys</span></a></span></span><span> </span><span id="local-6989586621679080678"><span class="annot"><span class="annottext">MutableArray s v
</span><a href="#local-6989586621679080678"><span class="hs-identifier hs-var">values</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s ()
</span><a href="#local-6989586621679080677"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-390"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-391"></span><span>        </span><span id="local-6989586621679080677"><span class="annot"><span class="annottext">go :: Int -&gt; ST s ()
</span><a href="#local-6989586621679080677"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080676"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080676"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080676"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080681"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; ST s ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-392"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-393"></span><span>            </span><span id="local-6989586621679080675"><span class="annot"><span class="annottext">Elem
</span><a href="#local-6989586621679080675"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IntArray s -&gt; Int -&gt; ST s Elem
forall s. IntArray s -&gt; Int -&gt; ST s Elem
</span><a href="Data.HashTable.Internal.IntArray.html#readArray"><span class="hs-identifier hs-var">U.readArray</span></a></span><span> </span><span class="annot"><span class="annottext">IntArray s
</span><a href="#local-6989586621679080680"><span class="hs-identifier hs-var">hashes</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080676"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-394"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Elem -&gt; Bool
</span><a href="Data.HashTable.ST.Basic.html#recordIsEmpty"><span class="hs-identifier hs-var">recordIsEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="#local-6989586621679080675"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Elem -&gt; Bool
</span><a href="Data.HashTable.ST.Basic.html#recordIsDeleted"><span class="hs-identifier hs-var">recordIsDeleted</span></a></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="#local-6989586621679080675"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-395"></span><span>              </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s ()
</span><a href="#local-6989586621679080677"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080676"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-396"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-397"></span><span>                </span><span id="local-6989586621679080674"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679080674"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutableArray s k -&gt; Int -&gt; ST s k
forall s a. MutableArray s a -&gt; Int -&gt; ST s a
</span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s k
</span><a href="#local-6989586621679080679"><span class="hs-identifier hs-var">keys</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080676"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-398"></span><span>                </span><span id="local-6989586621679080673"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679080673"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutableArray s v -&gt; Int -&gt; ST s v
forall s a. MutableArray s a -&gt; Int -&gt; ST s a
</span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s v
</span><a href="#local-6989586621679080678"><span class="hs-identifier hs-var">values</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080676"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-399"></span><span>                </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(k, v) -&gt; ST s b
</span><a href="#local-6989586621679080684"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679080674"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679080673"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-400"></span><span>                </span><span class="annot"><span class="annottext">Int -&gt; ST s ()
</span><a href="#local-6989586621679080677"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080676"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-401"></span><span>
</span><span id="line-402"></span><span>
</span><span id="line-403"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-404"></span><span class="hs-comment">-- | See the documentation for this function in</span><span>
</span><span id="line-405"></span><span class="hs-comment">-- 'Data.HashTable.Class.computeOverhead'.</span><span>
</span><span id="line-406"></span><span id="local-6989586621679080670"><span id="local-6989586621679080671"><span id="local-6989586621679080672"><span class="annot"><a href="Data.HashTable.ST.Basic.html#computeOverhead"><span class="hs-identifier hs-type">computeOverhead</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080672"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080671"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080670"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679080672"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span></span></span></span><span>
</span><span id="line-407"></span><span id="computeOverhead"><span class="annot"><span class="annottext">computeOverhead :: HashTable s k v -&gt; ST s Double
</span><a href="Data.HashTable.ST.Basic.html#computeOverhead"><span class="hs-identifier hs-var hs-var">computeOverhead</span></a></span></span><span> </span><span id="local-6989586621679080669"><span class="annot"><span class="annottext">HashTable s k v
</span><a href="#local-6989586621679080669"><span class="hs-identifier hs-var">htRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashTable s k v -&gt; ST s (HashTable_ s k v)
forall s k v. HashTable s k v -&gt; ST s (HashTable_ s k v)
</span><a href="Data.HashTable.ST.Basic.html#readRef"><span class="hs-identifier hs-var">readRef</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable s k v
</span><a href="#local-6989586621679080669"><span class="hs-identifier hs-var">htRef</span></a></span><span> </span><span class="annot"><span class="annottext">ST s (HashTable_ s k v)
-&gt; (HashTable_ s k v -&gt; ST s Double) -&gt; ST s Double
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; ST s Double
forall b s k v. Fractional b =&gt; HashTable_ s k v -&gt; ST s b
</span><a href="#local-6989586621679080668"><span class="hs-identifier hs-var">work</span></a></span><span>
</span><span id="line-408"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-409"></span><span>    </span><span id="local-6989586621679080668"><span class="annot"><span class="annottext">work :: HashTable_ s k v -&gt; ST s b
</span><a href="#local-6989586621679080668"><span class="hs-identifier hs-var hs-var">work</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span id="local-6989586621679080667"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080667"><span class="hs-identifier hs-var">sz'</span></a></span></span><span> </span><span id="local-6989586621679080666"><span class="annot"><span class="annottext">SizeRefs s
</span><a href="#local-6989586621679080666"><span class="hs-identifier hs-var">loadRef</span></a></span></span><span> </span><span class="annot"><span class="annottext">IntArray s
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">MutableArray s k
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">MutableArray s v
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-410"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621679080665"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080665"><span class="hs-identifier hs-var">ld</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SizeRefs s -&gt; ST s Int
forall s. SizeRefs s -&gt; ST s Int
</span><a href="Data.HashTable.ST.Basic.html#readLoad"><span class="hs-identifier hs-var">readLoad</span></a></span><span> </span><span class="annot"><span class="annottext">SizeRefs s
</span><a href="#local-6989586621679080666"><span class="hs-identifier hs-var">loadRef</span></a></span><span>
</span><span id="line-411"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679080664"><span class="annot"><span class="annottext">k :: b
</span><a href="#local-6989586621679080664"><span class="hs-identifier hs-var hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; b
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080665"><span class="hs-identifier hs-var">ld</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; b -&gt; b
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679080663"><span class="hs-identifier hs-var">sz</span></a></span><span>
</span><span id="line-412"></span><span>        </span><span class="annot"><span class="annottext">b -&gt; ST s b
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(b -&gt; ST s b) -&gt; b -&gt; ST s b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679080662"><span class="hs-identifier hs-var">constOverhead</span></a></span><span class="annot"><span class="annottext">b -&gt; b -&gt; b
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679080663"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; b -&gt; b
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; b -&gt; b
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-number">2</span></span><span class="annot"><span class="annottext">b -&gt; b -&gt; b
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679080661"><span class="hs-identifier hs-var">ws</span></a></span><span class="annot"><span class="annottext">b -&gt; b -&gt; b
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="hs-special">(</span><span class="annot"><span class="annottext">b
</span><span class="hs-number">1</span></span><span class="annot"><span class="annottext">b -&gt; b -&gt; b
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679080664"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">b -&gt; b -&gt; b
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679080664"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; b -&gt; b
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679080661"><span class="hs-identifier hs-var">ws</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-413"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-414"></span><span>        </span><span id="local-6989586621679080661"><span class="annot"><span class="annottext">ws :: b
</span><a href="#local-6989586621679080661"><span class="hs-identifier hs-var hs-var">ws</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; b
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; b) -&gt; Int -&gt; b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
forall b. FiniteBits b =&gt; b -&gt; Int
</span><span class="hs-identifier hs-var">finiteBitSize</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">::</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">8</span></span><span>
</span><span id="line-415"></span><span>        </span><span id="local-6989586621679080663"><span class="annot"><span class="annottext">sz :: b
</span><a href="#local-6989586621679080663"><span class="hs-identifier hs-var hs-var">sz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; b
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080667"><span class="hs-identifier hs-var">sz'</span></a></span><span>
</span><span id="line-416"></span><span>        </span><span class="hs-comment">-- Change these if you change the representation</span><span>
</span><span id="line-417"></span><span>        </span><span id="local-6989586621679080662"><span class="annot"><span class="annottext">constOverhead :: b
</span><a href="#local-6989586621679080662"><span class="hs-identifier hs-var hs-var">constOverhead</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-number">14</span></span><span>
</span><span id="line-418"></span><span>
</span><span id="line-419"></span><span>
</span><span id="line-420"></span><span class="hs-comment">------------------------------</span><span>
</span><span id="line-421"></span><span class="hs-comment">-- Private functions follow --</span><span>
</span><span id="line-422"></span><span class="hs-comment">------------------------------</span><span>
</span><span id="line-423"></span><span>
</span><span id="line-424"></span><span>
</span><span id="line-425"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-426"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#insertRecord"><span class="hs-pragma hs-type">insertRecord</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-427"></span><span id="local-6989586621679080988"><span id="local-6989586621679080989"><span id="local-6989586621679080990"><span class="annot"><a href="Data.HashTable.ST.Basic.html#insertRecord"><span class="hs-identifier hs-type">insertRecord</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-428"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.HashTable.Internal.IntArray.html#IntArray"><span class="hs-identifier hs-type">U.IntArray</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080990"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-429"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MutableArray</span></span><span> </span><span class="annot"><a href="#local-6989586621679080990"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080989"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-430"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MutableArray</span></span><span> </span><span class="annot"><a href="#local-6989586621679080990"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080988"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-431"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-432"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679080989"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-433"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679080988"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-434"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679080990"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-435"></span><span id="insertRecord"><span class="annot"><span class="annottext">insertRecord :: Int
-&gt; IntArray s
-&gt; MutableArray s k
-&gt; MutableArray s v
-&gt; Int
-&gt; k
-&gt; v
-&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#insertRecord"><span class="hs-identifier hs-var hs-var">insertRecord</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080659"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080659"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080658"><span class="annot"><span class="annottext">IntArray s
</span><a href="#local-6989586621679080658"><span class="hs-identifier hs-var">hashes</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080657"><span class="annot"><span class="annottext">MutableArray s k
</span><a href="#local-6989586621679080657"><span class="hs-identifier hs-var">keys</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080656"><span class="annot"><span class="annottext">MutableArray s v
</span><a href="#local-6989586621679080656"><span class="hs-identifier hs-var">values</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080655"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080655"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080654"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679080654"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080653"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679080653"><span class="hs-identifier hs-var">value</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-436"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080652"><span class="annot"><span class="annottext">b :: Int
</span><a href="#local-6989586621679080652"><span class="hs-identifier hs-var hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
</span><a href="Data.HashTable.Internal.Utils.html#whichBucket"><span class="hs-identifier hs-var">whichBucket</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080655"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080659"><span class="hs-identifier hs-var">sz</span></a></span><span>
</span><span id="line-437"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;insertRecord sz=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080659"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; h=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080655"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; b=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080652"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-438"></span><span>    </span><span class="annot"><span class="annottext">Int -&gt; ST s ()
</span><a href="#local-6989586621679080651"><span class="hs-identifier hs-var">probe</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080652"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-439"></span><span>
</span><span id="line-440"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-441"></span><span>    </span><span id="local-6989586621679080650"><span class="annot"><span class="annottext">he :: Elem
</span><a href="#local-6989586621679080650"><span class="hs-identifier hs-var hs-var">he</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Elem
</span><a href="Data.HashTable.ST.Basic.html#hashToElem"><span class="hs-identifier hs-var">hashToElem</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080655"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-442"></span><span>
</span><span id="line-443"></span><span>    </span><span id="local-6989586621679080651"><span class="annot"><span class="annottext">probe :: Int -&gt; ST s ()
</span><a href="#local-6989586621679080651"><span class="hs-identifier hs-var hs-var">probe</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080649"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080649"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;insertRecord/probe&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-444"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621679080648"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080648"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IntArray s -&gt; Int -&gt; Int -&gt; Elem -&gt; Elem -&gt; ST s Int
forall s. IntArray s -&gt; Int -&gt; Int -&gt; Elem -&gt; Elem -&gt; ST s Int
</span><a href="Data.HashTable.Internal.CacheLine.html#forwardSearch2"><span class="hs-identifier hs-var">forwardSearch2</span></a></span><span> </span><span class="annot"><span class="annottext">IntArray s
</span><a href="#local-6989586621679080658"><span class="hs-identifier hs-var">hashes</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080649"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080659"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="Data.HashTable.ST.Basic.html#emptyMarker"><span class="hs-identifier hs-var">emptyMarker</span></a></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="Data.HashTable.ST.Basic.html#deletedMarker"><span class="hs-identifier hs-var">deletedMarker</span></a></span><span>
</span><span id="line-445"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;forwardSearch2 returned &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080648"><span class="hs-identifier hs-var">idx</span></a></span><span>
</span><span id="line-446"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; ST s () -&gt; ST s ()
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080648"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ST s () -&gt; ST s ()) -&gt; ST s () -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-447"></span><span>            </span><span class="annot"><span class="annottext">IntArray s -&gt; Int -&gt; Elem -&gt; ST s ()
forall s. IntArray s -&gt; Int -&gt; Elem -&gt; ST s ()
</span><a href="Data.HashTable.Internal.IntArray.html#writeArray"><span class="hs-identifier hs-var">U.writeArray</span></a></span><span> </span><span class="annot"><span class="annottext">IntArray s
</span><a href="#local-6989586621679080658"><span class="hs-identifier hs-var">hashes</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080648"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="#local-6989586621679080650"><span class="hs-identifier hs-var">he</span></a></span><span>
</span><span id="line-448"></span><span>            </span><span class="annot"><span class="annottext">MutableArray s k -&gt; Int -&gt; k -&gt; ST s ()
forall s a. MutableArray s a -&gt; Int -&gt; a -&gt; ST s ()
</span><a href="Data.HashTable.Internal.Array.html#writeArray"><span class="hs-identifier hs-var">writeArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s k
</span><a href="#local-6989586621679080657"><span class="hs-identifier hs-var">keys</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080648"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679080654"><span class="hs-identifier hs-var">key</span></a></span><span>
</span><span id="line-449"></span><span>            </span><span class="annot"><span class="annottext">MutableArray s v -&gt; Int -&gt; v -&gt; ST s ()
forall s a. MutableArray s a -&gt; Int -&gt; a -&gt; ST s ()
</span><a href="Data.HashTable.Internal.Array.html#writeArray"><span class="hs-identifier hs-var">writeArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s v
</span><a href="#local-6989586621679080656"><span class="hs-identifier hs-var">values</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080648"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679080653"><span class="hs-identifier hs-var">value</span></a></span><span>
</span><span id="line-450"></span><span>
</span><span id="line-451"></span><span>
</span><span id="line-452"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-453"></span><span id="local-6989586621679081048"><span id="local-6989586621679081049"><span id="local-6989586621679081050"><span class="annot"><a href="Data.HashTable.ST.Basic.html#checkOverflow"><span class="hs-identifier hs-type">checkOverflow</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679081050"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679081050"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-454"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable_"><span class="hs-identifier hs-type">HashTable_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081049"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081050"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081048"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-455"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679081049"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable_"><span class="hs-identifier hs-type">HashTable_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081049"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081050"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081048"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-456"></span><span id="checkOverflow"><span class="annot"><span class="annottext">checkOverflow :: HashTable_ s k v -&gt; ST s (HashTable_ s k v)
</span><a href="Data.HashTable.ST.Basic.html#checkOverflow"><span class="hs-identifier hs-var hs-var">checkOverflow</span></a></span></span><span> </span><span id="local-6989586621679080644"><span class="annot"><span class="annottext">ht :: HashTable_ s k v
</span><a href="#local-6989586621679080644"><span class="hs-identifier hs-var">ht</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span id="local-6989586621679080643"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080643"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span id="local-6989586621679080642"><span class="annot"><span class="annottext">SizeRefs s
</span><a href="#local-6989586621679080642"><span class="hs-identifier hs-var">ldRef</span></a></span></span><span> </span><span class="annot"><span class="annottext">IntArray s
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">MutableArray s k
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">MutableArray s v
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-457"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679080641"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080641"><span class="hs-identifier hs-var">ld</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SizeRefs s -&gt; ST s Int
forall s. SizeRefs s -&gt; ST s Int
</span><a href="Data.HashTable.ST.Basic.html#readLoad"><span class="hs-identifier hs-var">readLoad</span></a></span><span> </span><span class="annot"><span class="annottext">SizeRefs s
</span><a href="#local-6989586621679080642"><span class="hs-identifier hs-var">ldRef</span></a></span><span>
</span><span id="line-458"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679080640"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080640"><span class="hs-identifier hs-var">dl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SizeRefs s -&gt; ST s Int
forall s. SizeRefs s -&gt; ST s Int
</span><a href="Data.HashTable.ST.Basic.html#readDelLoad"><span class="hs-identifier hs-var">readDelLoad</span></a></span><span> </span><span class="annot"><span class="annottext">SizeRefs s
</span><a href="#local-6989586621679080642"><span class="hs-identifier hs-var">ldRef</span></a></span><span>
</span><span id="line-459"></span><span>
</span><span id="line-460"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;checkOverflow: sz=&quot;</span></span><span>
</span><span id="line-461"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080643"><span class="hs-identifier hs-var">sz</span></a></span><span>
</span><span id="line-462"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; entries=&quot;</span></span><span>
</span><span id="line-463"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080641"><span class="hs-identifier hs-var">ld</span></a></span><span>
</span><span id="line-464"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; deleted=&quot;</span></span><span>
</span><span id="line-465"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080640"><span class="hs-identifier hs-var">dl</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-466"></span><span>
</span><span id="line-467"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080641"><span class="hs-identifier hs-var">ld</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080640"><span class="hs-identifier hs-var">dl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080643"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="Data.HashTable.ST.Basic.html#maxLoad"><span class="hs-identifier hs-var">maxLoad</span></a></span><span>
</span><span id="line-468"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080640"><span class="hs-identifier hs-var">dl</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080641"><span class="hs-identifier hs-var">ld</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span>
</span><span id="line-469"></span><span>             </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; Int -&gt; ST s (HashTable_ s k v)
forall k s v.
Hashable k =&gt;
HashTable_ s k v -&gt; Int -&gt; ST s (HashTable_ s k v)
</span><a href="Data.HashTable.ST.Basic.html#rehashAll"><span class="hs-identifier hs-var">rehashAll</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679080644"><span class="hs-identifier hs-var">ht</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080643"><span class="hs-identifier hs-var">sz</span></a></span><span>
</span><span id="line-470"></span><span>             </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; ST s (HashTable_ s k v)
forall k s v.
Hashable k =&gt;
HashTable_ s k v -&gt; ST s (HashTable_ s k v)
</span><a href="Data.HashTable.ST.Basic.html#growTable"><span class="hs-identifier hs-var">growTable</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679080644"><span class="hs-identifier hs-var">ht</span></a></span><span>
</span><span id="line-471"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; ST s (HashTable_ s k v)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679080644"><span class="hs-identifier hs-var">ht</span></a></span><span>
</span><span id="line-472"></span><span>
</span><span id="line-473"></span><span>
</span><span id="line-474"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-475"></span><span id="local-6989586621679080998"><span id="local-6989586621679080999"><span id="local-6989586621679081000"><span class="annot"><a href="Data.HashTable.ST.Basic.html#rehashAll"><span class="hs-identifier hs-type">rehashAll</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679081000"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable_"><span class="hs-identifier hs-type">HashTable_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080999"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081000"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080998"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679080999"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable_"><span class="hs-identifier hs-type">HashTable_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080999"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081000"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080998"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-476"></span><span id="rehashAll"><span class="annot"><span class="annottext">rehashAll :: HashTable_ s k v -&gt; Int -&gt; ST s (HashTable_ s k v)
</span><a href="Data.HashTable.ST.Basic.html#rehashAll"><span class="hs-identifier hs-var hs-var">rehashAll</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span id="local-6989586621679080636"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080636"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span id="local-6989586621679080635"><span class="annot"><span class="annottext">SizeRefs s
</span><a href="#local-6989586621679080635"><span class="hs-identifier hs-var">loadRef</span></a></span></span><span> </span><span id="local-6989586621679080634"><span class="annot"><span class="annottext">IntArray s
</span><a href="#local-6989586621679080634"><span class="hs-identifier hs-var">hashes</span></a></span></span><span> </span><span id="local-6989586621679080633"><span class="annot"><span class="annottext">MutableArray s k
</span><a href="#local-6989586621679080633"><span class="hs-identifier hs-var">keys</span></a></span></span><span> </span><span id="local-6989586621679080632"><span class="annot"><span class="annottext">MutableArray s v
</span><a href="#local-6989586621679080632"><span class="hs-identifier hs-var">values</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679080631"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080631"><span class="hs-identifier hs-var">sz'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-477"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;rehashing: old size &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080636"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;, new size &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080631"><span class="hs-identifier hs-var">sz'</span></a></span><span>
</span><span id="line-478"></span><span>    </span><span id="local-6989586621679080630"><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679080630"><span class="hs-identifier hs-var">ht'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s (HashTable_ s k v)
forall s k v. Int -&gt; ST s (HashTable_ s k v)
</span><a href="Data.HashTable.ST.Basic.html#newSizedReal"><span class="hs-identifier hs-var">newSizedReal</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080631"><span class="hs-identifier hs-var">sz'</span></a></span><span>
</span><span id="line-479"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679080629"><span class="annot"><span class="annottext">SizeRefs s
</span><a href="#local-6989586621679080629"><span class="hs-identifier hs-var">loadRef'</span></a></span></span><span> </span><span id="local-6989586621679080628"><span class="annot"><span class="annottext">IntArray s
</span><a href="#local-6989586621679080628"><span class="hs-identifier hs-var">newHashes</span></a></span></span><span> </span><span id="local-6989586621679080627"><span class="annot"><span class="annottext">MutableArray s k
</span><a href="#local-6989586621679080627"><span class="hs-identifier hs-var">newKeys</span></a></span></span><span> </span><span id="local-6989586621679080626"><span class="annot"><span class="annottext">MutableArray s v
</span><a href="#local-6989586621679080626"><span class="hs-identifier hs-var">newValues</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679080630"><span class="hs-identifier hs-var">ht'</span></a></span><span>
</span><span id="line-480"></span><span>    </span><span class="annot"><span class="annottext">SizeRefs s -&gt; ST s Int
forall s. SizeRefs s -&gt; ST s Int
</span><a href="Data.HashTable.ST.Basic.html#readLoad"><span class="hs-identifier hs-var">readLoad</span></a></span><span> </span><span class="annot"><span class="annottext">SizeRefs s
</span><a href="#local-6989586621679080635"><span class="hs-identifier hs-var">loadRef</span></a></span><span> </span><span class="annot"><span class="annottext">ST s Int -&gt; (Int -&gt; ST s ()) -&gt; ST s ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">SizeRefs s -&gt; Int -&gt; ST s ()
forall s. SizeRefs s -&gt; Int -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#writeLoad"><span class="hs-identifier hs-var">writeLoad</span></a></span><span> </span><span class="annot"><span class="annottext">SizeRefs s
</span><a href="#local-6989586621679080629"><span class="hs-identifier hs-var">loadRef'</span></a></span><span>
</span><span id="line-481"></span><span>    </span><span class="annot"><span class="annottext">IntArray s -&gt; MutableArray s k -&gt; MutableArray s v -&gt; ST s ()
</span><a href="#local-6989586621679080625"><span class="hs-identifier hs-var">rehash</span></a></span><span> </span><span class="annot"><span class="annottext">IntArray s
</span><a href="#local-6989586621679080628"><span class="hs-identifier hs-var">newHashes</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s k
</span><a href="#local-6989586621679080627"><span class="hs-identifier hs-var">newKeys</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s v
</span><a href="#local-6989586621679080626"><span class="hs-identifier hs-var">newValues</span></a></span><span>
</span><span id="line-482"></span><span>    </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; ST s (HashTable_ s k v)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679080630"><span class="hs-identifier hs-var">ht'</span></a></span><span>
</span><span id="line-483"></span><span>
</span><span id="line-484"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-485"></span><span>    </span><span id="local-6989586621679080625"><span class="annot"><span class="annottext">rehash :: IntArray s -&gt; MutableArray s k -&gt; MutableArray s v -&gt; ST s ()
</span><a href="#local-6989586621679080625"><span class="hs-identifier hs-var hs-var">rehash</span></a></span></span><span> </span><span id="local-6989586621679080624"><span class="annot"><span class="annottext">IntArray s
</span><a href="#local-6989586621679080624"><span class="hs-identifier hs-var">newHashes</span></a></span></span><span> </span><span id="local-6989586621679080623"><span class="annot"><span class="annottext">MutableArray s k
</span><a href="#local-6989586621679080623"><span class="hs-identifier hs-var">newKeys</span></a></span></span><span> </span><span id="local-6989586621679080622"><span class="annot"><span class="annottext">MutableArray s v
</span><a href="#local-6989586621679080622"><span class="hs-identifier hs-var">newValues</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s ()
</span><a href="#local-6989586621679080621"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-486"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-487"></span><span>        </span><span id="local-6989586621679080621"><span class="annot"><span class="annottext">go :: Int -&gt; ST s ()
</span><a href="#local-6989586621679080621"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080620"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080620"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080620"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080636"><span class="hs-identifier hs-var">sz</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; ST s ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-488"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;growTable/rehash&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-489"></span><span>                    </span><span id="local-6989586621679080619"><span class="annot"><span class="annottext">Elem
</span><a href="#local-6989586621679080619"><span class="hs-identifier hs-var">h0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IntArray s -&gt; Int -&gt; ST s Elem
forall s. IntArray s -&gt; Int -&gt; ST s Elem
</span><a href="Data.HashTable.Internal.IntArray.html#readArray"><span class="hs-identifier hs-var">U.readArray</span></a></span><span> </span><span class="annot"><span class="annottext">IntArray s
</span><a href="#local-6989586621679080634"><span class="hs-identifier hs-var">hashes</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080620"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-490"></span><span>                    </span><span class="annot"><span class="annottext">Bool -&gt; ST s () -&gt; ST s ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Elem -&gt; Bool
</span><a href="Data.HashTable.ST.Basic.html#recordIsEmpty"><span class="hs-identifier hs-var">recordIsEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="#local-6989586621679080619"><span class="hs-identifier hs-var">h0</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Elem -&gt; Bool
</span><a href="Data.HashTable.ST.Basic.html#recordIsDeleted"><span class="hs-identifier hs-var">recordIsDeleted</span></a></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="#local-6989586621679080619"><span class="hs-identifier hs-var">h0</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ST s () -&gt; ST s ()) -&gt; ST s () -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-491"></span><span>                        </span><span id="local-6989586621679080617"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679080617"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutableArray s k -&gt; Int -&gt; ST s k
forall s a. MutableArray s a -&gt; Int -&gt; ST s a
</span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s k
</span><a href="#local-6989586621679080633"><span class="hs-identifier hs-var">keys</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080620"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-492"></span><span>                        </span><span id="local-6989586621679080616"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679080616"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutableArray s v -&gt; Int -&gt; ST s v
forall s a. MutableArray s a -&gt; Int -&gt; ST s a
</span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s v
</span><a href="#local-6989586621679080632"><span class="hs-identifier hs-var">values</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080620"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-493"></span><span>                        </span><span class="annot"><span class="annottext">Int
-&gt; IntArray s
-&gt; MutableArray s k
-&gt; MutableArray s v
-&gt; Int
-&gt; k
-&gt; v
-&gt; ST s ()
forall s k v.
Int
-&gt; IntArray s
-&gt; MutableArray s k
-&gt; MutableArray s v
-&gt; Int
-&gt; k
-&gt; v
-&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#insertRecord"><span class="hs-identifier hs-var">insertRecord</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080631"><span class="hs-identifier hs-var">sz'</span></a></span><span> </span><span class="annot"><span class="annottext">IntArray s
</span><a href="#local-6989586621679080624"><span class="hs-identifier hs-var">newHashes</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s k
</span><a href="#local-6989586621679080623"><span class="hs-identifier hs-var">newKeys</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s v
</span><a href="#local-6989586621679080622"><span class="hs-identifier hs-var">newValues</span></a></span><span>
</span><span id="line-494"></span><span>                                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k -&gt; Int
forall k. Hashable k =&gt; k -&gt; Int
</span><a href="Data.HashTable.ST.Basic.html#hash"><span class="hs-identifier hs-var">hash</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679080617"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679080617"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679080616"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-495"></span><span>                    </span><span class="annot"><span class="annottext">Int -&gt; ST s ()
</span><a href="#local-6989586621679080621"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; ST s ()) -&gt; Int -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080620"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-496"></span><span>
</span><span id="line-497"></span><span>
</span><span id="line-498"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-499"></span><span id="local-6989586621679080995"><span id="local-6989586621679080996"><span id="local-6989586621679080997"><span class="annot"><a href="Data.HashTable.ST.Basic.html#growTable"><span class="hs-identifier hs-type">growTable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679080997"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable_"><span class="hs-identifier hs-type">HashTable_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080996"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080997"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080995"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679080996"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable_"><span class="hs-identifier hs-type">HashTable_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080996"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080997"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080995"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-500"></span><span id="growTable"><span class="annot"><span class="annottext">growTable :: HashTable_ s k v -&gt; ST s (HashTable_ s k v)
</span><a href="Data.HashTable.ST.Basic.html#growTable"><span class="hs-identifier hs-var hs-var">growTable</span></a></span></span><span> </span><span id="local-6989586621679080615"><span class="annot"><span class="annottext">ht :: HashTable_ s k v
</span><a href="#local-6989586621679080615"><span class="hs-identifier hs-var">ht</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span id="local-6989586621679080614"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080614"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span class="annot"><span class="annottext">SizeRefs s
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">IntArray s
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">MutableArray s k
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">MutableArray s v
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-501"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080613"><span class="annot"><span class="annottext">sz' :: Int
</span><a href="#local-6989586621679080613"><span class="hs-identifier hs-var hs-var">sz'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Int -&gt; Int
</span><a href="Data.HashTable.Internal.Utils.html#bumpSize"><span class="hs-identifier hs-var">bumpSize</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="Data.HashTable.ST.Basic.html#maxLoad"><span class="hs-identifier hs-var">maxLoad</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080614"><span class="hs-identifier hs-var">sz</span></a></span><span>
</span><span id="line-502"></span><span>    </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; Int -&gt; ST s (HashTable_ s k v)
forall k s v.
Hashable k =&gt;
HashTable_ s k v -&gt; Int -&gt; ST s (HashTable_ s k v)
</span><a href="Data.HashTable.ST.Basic.html#rehashAll"><span class="hs-identifier hs-var">rehashAll</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679080615"><span class="hs-identifier hs-var">ht</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080613"><span class="hs-identifier hs-var">sz'</span></a></span><span>
</span><span id="line-503"></span><span>
</span><span id="line-504"></span><span>
</span><span id="line-505"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-506"></span><span class="hs-comment">-- Helper data structure for findSafeSlots</span><span>
</span><span id="line-507"></span><span class="hs-keyword">newtype</span><span> </span><span id="Slot"><span class="annot"><a href="Data.HashTable.ST.Basic.html#Slot"><span class="hs-identifier hs-var">Slot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Slot"><span class="annot"><a href="Data.HashTable.ST.Basic.html#Slot"><span class="hs-identifier hs-var">Slot</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="_slot"><span class="annot"><span class="annottext">Slot -&gt; Int
</span><a href="Data.HashTable.ST.Basic.html#_slot"><span class="hs-identifier hs-var hs-var">_slot</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679080604"><span id="local-6989586621679080606"><span id="local-6989586621679080608"><span class="annot"><span class="annottext">Int -&gt; Slot -&gt; ShowS
[Slot] -&gt; ShowS
Slot -&gt; String
(Int -&gt; Slot -&gt; ShowS)
-&gt; (Slot -&gt; String) -&gt; ([Slot] -&gt; ShowS) -&gt; Show Slot
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [Slot] -&gt; ShowS
$cshowList :: [Slot] -&gt; ShowS
show :: Slot -&gt; String
$cshow :: Slot -&gt; String
showsPrec :: Int -&gt; Slot -&gt; ShowS
$cshowsPrec :: Int -&gt; Slot -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-508"></span><span>
</span><span id="line-509"></span><span>
</span><span id="line-510"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span class="hs-cpp">

#if MIN_VERSION_base(4,9,0)
</span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679080599"><span id="local-6989586621679080601"><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#Slot"><span class="hs-identifier hs-type">Slot</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-514"></span><span> </span><span id="local-6989586621679080597"><span class="annot"><span class="annottext">&lt;&gt; :: Slot -&gt; Slot -&gt; Slot
</span><span class="hs-operator hs-var hs-var hs-var hs-var">(&lt;&gt;)</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Slot -&gt; Slot -&gt; Slot
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">mappend</span></span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-517"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679080592"><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#Slot"><span class="hs-identifier hs-type">Slot</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-518"></span><span>    </span><span id="local-6989586621679080590"><span class="annot"><span class="annottext">mempty :: Slot
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">mempty</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Slot
</span><a href="Data.HashTable.ST.Basic.html#Slot"><span class="hs-identifier hs-var">Slot</span></a></span><span> </span><span class="annot"><span class="annottext">Int
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">maxBound</span></span><span>
</span><span id="line-519"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Basic.html#Slot"><span class="hs-identifier hs-type">Slot</span></a></span><span> </span><span id="local-6989586621679080588"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080588"><span class="hs-identifier hs-var">x1</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679080587"><span class="annot"><span class="annottext">mappend :: Slot -&gt; Slot -&gt; Slot
</span><span class="hs-operator hs-var hs-var hs-var hs-var">`mappend`</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Basic.html#Slot"><span class="hs-identifier hs-type">Slot</span></a></span><span> </span><span id="local-6989586621679080586"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080586"><span class="hs-identifier hs-var">x2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-520"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080585"><span class="annot"><span class="annottext">m :: Int
</span><a href="#local-6989586621679080585"><span class="hs-identifier hs-var hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
</span><a href="Data.HashTable.Internal.CacheLine.html#mask"><span class="hs-identifier hs-var">mask</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080588"><span class="hs-identifier hs-var">x1</span></a></span><span> </span><span class="annot"><span class="annottext">Int
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">maxBound</span></span><span>
</span><span id="line-521"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Slot
</span><a href="Data.HashTable.ST.Basic.html#Slot"><span class="hs-identifier hs-var">Slot</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Slot) -&gt; Int -&gt; Slot
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">complement</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080585"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080588"><span class="hs-identifier hs-var">x1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080585"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080586"><span class="hs-identifier hs-var">x2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-522"></span><span>
</span><span id="line-523"></span><span>
</span><span id="line-524"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-525"></span><span class="hs-comment">-- findSafeSlots return type</span><span>
</span><span id="line-526"></span><span class="hs-keyword">data</span><span> </span><span id="SlotFindResponse"><span class="annot"><a href="Data.HashTable.ST.Basic.html#SlotFindResponse"><span class="hs-identifier hs-var">SlotFindResponse</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SlotFindResponse"><span class="annot"><a href="Data.HashTable.ST.Basic.html#SlotFindResponse"><span class="hs-identifier hs-var">SlotFindResponse</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-527"></span><span>    </span><span id="_slotFound"><span class="annot"><span class="annottext">SlotFindResponse -&gt; Int
</span><a href="Data.HashTable.ST.Basic.html#_slotFound"><span class="hs-identifier hs-var hs-var">_slotFound</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-comment">-- we use Int because Bool won't unpack</span><span>
</span><span id="line-528"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_slotB0"><span class="annot"><span class="annottext">SlotFindResponse -&gt; Int
</span><a href="Data.HashTable.ST.Basic.html#_slotB0"><span class="hs-identifier hs-var hs-var">_slotB0</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-529"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_slotB1"><span class="annot"><span class="annottext">SlotFindResponse -&gt; Int
</span><a href="Data.HashTable.ST.Basic.html#_slotB1"><span class="hs-identifier hs-var hs-var">_slotB1</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-530"></span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679080574"><span id="local-6989586621679080576"><span id="local-6989586621679080578"><span class="annot"><span class="annottext">Int -&gt; SlotFindResponse -&gt; ShowS
[SlotFindResponse] -&gt; ShowS
SlotFindResponse -&gt; String
(Int -&gt; SlotFindResponse -&gt; ShowS)
-&gt; (SlotFindResponse -&gt; String)
-&gt; ([SlotFindResponse] -&gt; ShowS)
-&gt; Show SlotFindResponse
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [SlotFindResponse] -&gt; ShowS
$cshowList :: [SlotFindResponse] -&gt; ShowS
show :: SlotFindResponse -&gt; String
$cshow :: SlotFindResponse -&gt; String
showsPrec :: Int -&gt; SlotFindResponse -&gt; ShowS
$cshowsPrec :: Int -&gt; SlotFindResponse -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-531"></span><span>
</span><span id="line-532"></span><span>
</span><span id="line-533"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-534"></span><span class="hs-comment">-- Returns ST s (SlotFoundResponse found b0 b1),</span><span>
</span><span id="line-535"></span><span class="hs-comment">-- where</span><span>
</span><span id="line-536"></span><span class="hs-comment">--     * found :: Int  - 1 if key-value mapping is already in the table,</span><span>
</span><span id="line-537"></span><span class="hs-comment">--                       0 otherwise.</span><span>
</span><span id="line-538"></span><span class="hs-comment">--     * b0    :: Int  - The index of a slot where it would be safe to write</span><span>
</span><span id="line-539"></span><span class="hs-comment">--                       the given key (if the key is already in the mapping,</span><span>
</span><span id="line-540"></span><span class="hs-comment">--                       you have to delete it before using this slot).</span><span>
</span><span id="line-541"></span><span class="hs-comment">--     * b1    :: Int  - The index of a slot where the key currently resides.</span><span>
</span><span id="line-542"></span><span class="hs-comment">--                       Or, if the key is not in the table, b1 is a slot</span><span>
</span><span id="line-543"></span><span class="hs-comment">--                       where it is safe to write the key (b1 == b0).</span><span>
</span><span id="line-544"></span><span id="local-6989586621679081077"><span id="local-6989586621679081078"><span id="local-6989586621679081079"><span class="annot"><a href="Data.HashTable.ST.Basic.html#findSafeSlots"><span class="hs-identifier hs-type">findSafeSlots</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679081079"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679081079"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-545"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable_"><span class="hs-identifier hs-type">HashTable_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081078"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081079"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081077"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-546"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679081079"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-547"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-548"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679081078"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#SlotFindResponse"><span class="hs-identifier hs-type">SlotFindResponse</span></a></span></span></span></span><span>
</span><span id="line-549"></span><span id="findSafeSlots"><span class="annot"><span class="annottext">findSafeSlots :: HashTable_ s k v -&gt; k -&gt; Int -&gt; ST s SlotFindResponse
</span><a href="Data.HashTable.ST.Basic.html#findSafeSlots"><span class="hs-identifier hs-var hs-var">findSafeSlots</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080573"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080573"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span class="annot"><span class="annottext">SizeRefs s
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679080572"><span class="annot"><span class="annottext">IntArray s
</span><a href="#local-6989586621679080572"><span class="hs-identifier hs-var">hashes</span></a></span></span><span> </span><span id="local-6989586621679080571"><span class="annot"><span class="annottext">MutableArray s k
</span><a href="#local-6989586621679080571"><span class="hs-identifier hs-var">keys</span></a></span></span><span> </span><span class="annot"><span class="annottext">MutableArray s v
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679080570"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679080570"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621679080569"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080569"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-550"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;findSafeSlots: h=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080569"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; he=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Elem -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="#local-6989586621679080568"><span class="hs-identifier hs-var">he</span></a></span><span>
</span><span id="line-551"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; sz=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080573"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; b0=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080567"><span class="hs-identifier hs-var">b0</span></a></span><span>
</span><span id="line-552"></span><span>    </span><span id="local-6989586621679080566"><span class="annot"><span class="annottext">SlotFindResponse
</span><a href="#local-6989586621679080566"><span class="hs-identifier hs-var">response</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Slot -&gt; Int -&gt; Bool -&gt; ST s SlotFindResponse
</span><a href="#local-6989586621679080565"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Slot
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080567"><span class="hs-identifier hs-var">b0</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-553"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;go returned &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">SlotFindResponse -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">SlotFindResponse
</span><a href="#local-6989586621679080566"><span class="hs-identifier hs-var">response</span></a></span><span>
</span><span id="line-554"></span><span>    </span><span class="annot"><span class="annottext">SlotFindResponse -&gt; ST s SlotFindResponse
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">SlotFindResponse
</span><a href="#local-6989586621679080566"><span class="hs-identifier hs-var">response</span></a></span><span>
</span><span id="line-555"></span><span>
</span><span id="line-556"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-557"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679080568"><span class="annot"><span class="annottext">he :: Elem
</span><a href="#local-6989586621679080568"><span class="hs-identifier hs-var hs-var">he</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Elem
</span><a href="Data.HashTable.ST.Basic.html#hashToElem"><span class="hs-identifier hs-var">hashToElem</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080569"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-558"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679080567"><span class="annot"><span class="annottext">b0 :: Int
</span><a href="#local-6989586621679080567"><span class="hs-identifier hs-var hs-var">b0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
</span><a href="Data.HashTable.Internal.Utils.html#whichBucket"><span class="hs-identifier hs-var">whichBucket</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080569"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080573"><span class="hs-identifier hs-var">sz</span></a></span><span>
</span><span id="line-559"></span><span>    </span><span id="local-6989586621679080564"><span class="annot"><span class="annottext">haveWrapped :: Slot -&gt; Int -&gt; Bool
</span><a href="#local-6989586621679080564"><span class="hs-identifier hs-var hs-var">haveWrapped</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Basic.html#Slot"><span class="hs-identifier hs-type">Slot</span></a></span><span> </span><span id="local-6989586621679080563"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080563"><span class="hs-identifier hs-var">fp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080562"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080562"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080563"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">maxBound</span></span><span>
</span><span id="line-560"></span><span>                                    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-561"></span><span>                                    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080562"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080563"><span class="hs-identifier hs-var">fp</span></a></span><span>
</span><span id="line-562"></span><span>
</span><span id="line-563"></span><span>    </span><span class="hs-comment">-- arguments:</span><span>
</span><span id="line-564"></span><span>
</span><span id="line-565"></span><span>    </span><span class="hs-comment">--   * fp    maintains the slot in the array where it would be safe to</span><span>
</span><span id="line-566"></span><span>    </span><span class="hs-comment">--           write the given key</span><span>
</span><span id="line-567"></span><span>    </span><span class="hs-comment">--   * b     search the buckets array starting at this index.</span><span>
</span><span id="line-568"></span><span>    </span><span class="hs-comment">--   * wrap  True if we've wrapped around, False otherwise</span><span>
</span><span id="line-569"></span><span>
</span><span id="line-570"></span><span>    </span><span id="local-6989586621679080565"><span class="annot"><span class="annottext">go :: Slot -&gt; Int -&gt; Bool -&gt; ST s SlotFindResponse
</span><a href="#local-6989586621679080565"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080560"><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679080560"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080559"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080559"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080558"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679080558"><span class="hs-identifier hs-var">wrap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-571"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;go: fp=&quot;</span></span><span>
</span><span id="line-572"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Slot -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679080560"><span class="hs-identifier hs-var">fp</span></a></span><span>
</span><span id="line-573"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; b=&quot;</span></span><span>
</span><span id="line-574"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080559"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-575"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;, wrap=&quot;</span></span><span>
</span><span id="line-576"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679080558"><span class="hs-identifier hs-var">wrap</span></a></span><span>
</span><span id="line-577"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;, he=&quot;</span></span><span>
</span><span id="line-578"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Elem -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="#local-6989586621679080568"><span class="hs-identifier hs-var">he</span></a></span><span>
</span><span id="line-579"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;, emptyMarker=&quot;</span></span><span>
</span><span id="line-580"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Elem -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="Data.HashTable.ST.Basic.html#emptyMarker"><span class="hs-identifier hs-var">emptyMarker</span></a></span><span>
</span><span id="line-581"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;, deletedMarker=&quot;</span></span><span>
</span><span id="line-582"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Elem -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="Data.HashTable.ST.Basic.html#deletedMarker"><span class="hs-identifier hs-var">deletedMarker</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-583"></span><span>
</span><span id="line-584"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621679080557"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080557"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IntArray s -&gt; Int -&gt; Int -&gt; Elem -&gt; Elem -&gt; Elem -&gt; ST s Int
forall s.
IntArray s -&gt; Int -&gt; Int -&gt; Elem -&gt; Elem -&gt; Elem -&gt; ST s Int
</span><a href="Data.HashTable.Internal.CacheLine.html#forwardSearch3"><span class="hs-identifier hs-var">forwardSearch3</span></a></span><span> </span><span class="annot"><span class="annottext">IntArray s
</span><a href="#local-6989586621679080572"><span class="hs-identifier hs-var">hashes</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080559"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080573"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="#local-6989586621679080568"><span class="hs-identifier hs-var">he</span></a></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="Data.HashTable.ST.Basic.html#emptyMarker"><span class="hs-identifier hs-var">emptyMarker</span></a></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="Data.HashTable.ST.Basic.html#deletedMarker"><span class="hs-identifier hs-var">deletedMarker</span></a></span><span>
</span><span id="line-585"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;forwardSearch3 returned &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080557"><span class="hs-identifier hs-var">idx</span></a></span><span>
</span><span id="line-586"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; with sz=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080573"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;, b=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080559"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-587"></span><span>
</span><span id="line-588"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679080558"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080557"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080567"><span class="hs-identifier hs-var">b0</span></a></span><span>
</span><span id="line-589"></span><span>          </span><span class="hs-comment">-- we wrapped around in the search and didn't find our hash code;</span><span>
</span><span id="line-590"></span><span>          </span><span class="hs-comment">-- this means that the table is full of deleted elements. Just return</span><span>
</span><span id="line-591"></span><span>          </span><span class="hs-comment">-- the first place we'd be allowed to insert.</span><span>
</span><span id="line-592"></span><span>          </span><span class="hs-comment">--</span><span>
</span><span id="line-593"></span><span>          </span><span class="hs-comment">-- TODO: if we get in this situation we should probably just rehash</span><span>
</span><span id="line-594"></span><span>          </span><span class="hs-comment">-- the table, because every insert is going to be O(n).</span><span>
</span><span id="line-595"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-596"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080555"><span class="annot"><span class="annottext">sl :: Slot
</span><a href="#local-6989586621679080555"><span class="hs-identifier hs-var hs-var">sl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679080560"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">Slot -&gt; Slot -&gt; Slot
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Slot
</span><a href="Data.HashTable.ST.Basic.html#Slot"><span class="hs-identifier hs-var">Slot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Int
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;impossible&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-597"></span><span>            </span><span class="annot"><span class="annottext">SlotFindResponse -&gt; ST s SlotFindResponse
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(SlotFindResponse -&gt; ST s SlotFindResponse)
-&gt; SlotFindResponse -&gt; ST s SlotFindResponse
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; SlotFindResponse
</span><a href="Data.HashTable.ST.Basic.html#SlotFindResponse"><span class="hs-identifier hs-var">SlotFindResponse</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Slot -&gt; Int
</span><a href="Data.HashTable.ST.Basic.html#_slot"><span class="hs-identifier hs-var hs-var">_slot</span></a></span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679080555"><span class="hs-identifier hs-var">sl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Slot -&gt; Int
</span><a href="Data.HashTable.ST.Basic.html#_slot"><span class="hs-identifier hs-var hs-var">_slot</span></a></span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679080555"><span class="hs-identifier hs-var">sl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-598"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-599"></span><span>            </span><span class="hs-comment">-- because the table isn't full, we know that there must be either</span><span>
</span><span id="line-600"></span><span>            </span><span class="hs-comment">-- an empty or a deleted marker somewhere in the table. Assert this</span><span>
</span><span id="line-601"></span><span>            </span><span class="hs-comment">-- here.</span><span>
</span><span id="line-602"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; ST s () -&gt; ST s ()
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080557"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ST s () -&gt; ST s ()) -&gt; ST s () -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; ST s ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-603"></span><span>            </span><span id="local-6989586621679080553"><span class="annot"><span class="annottext">Elem
</span><a href="#local-6989586621679080553"><span class="hs-identifier hs-var">h0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IntArray s -&gt; Int -&gt; ST s Elem
forall s. IntArray s -&gt; Int -&gt; ST s Elem
</span><a href="Data.HashTable.Internal.IntArray.html#readArray"><span class="hs-identifier hs-var">U.readArray</span></a></span><span> </span><span class="annot"><span class="annottext">IntArray s
</span><a href="#local-6989586621679080572"><span class="hs-identifier hs-var">hashes</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080557"><span class="hs-identifier hs-var">idx</span></a></span><span>
</span><span id="line-604"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;h0 was &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Elem -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="#local-6989586621679080553"><span class="hs-identifier hs-var">h0</span></a></span><span>
</span><span id="line-605"></span><span>
</span><span id="line-606"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Elem -&gt; Bool
</span><a href="Data.HashTable.ST.Basic.html#recordIsEmpty"><span class="hs-identifier hs-var">recordIsEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="#local-6989586621679080553"><span class="hs-identifier hs-var">h0</span></a></span><span>
</span><span id="line-607"></span><span>              </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-608"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679080552"><span class="annot"><span class="annottext">pl :: Slot
</span><a href="#local-6989586621679080552"><span class="hs-identifier hs-var hs-var">pl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679080560"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">Slot -&gt; Slot -&gt; Slot
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Slot
</span><a href="Data.HashTable.ST.Basic.html#Slot"><span class="hs-identifier hs-var">Slot</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080557"><span class="hs-identifier hs-var">idx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-609"></span><span>                  </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;empty, returning &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Slot -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679080552"><span class="hs-identifier hs-var">pl</span></a></span><span>
</span><span id="line-610"></span><span>                  </span><span class="annot"><span class="annottext">SlotFindResponse -&gt; ST s SlotFindResponse
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(SlotFindResponse -&gt; ST s SlotFindResponse)
-&gt; SlotFindResponse -&gt; ST s SlotFindResponse
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; SlotFindResponse
</span><a href="Data.HashTable.ST.Basic.html#SlotFindResponse"><span class="hs-identifier hs-var">SlotFindResponse</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Slot -&gt; Int
</span><a href="Data.HashTable.ST.Basic.html#_slot"><span class="hs-identifier hs-var hs-var">_slot</span></a></span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679080552"><span class="hs-identifier hs-var">pl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Slot -&gt; Int
</span><a href="Data.HashTable.ST.Basic.html#_slot"><span class="hs-identifier hs-var hs-var">_slot</span></a></span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679080552"><span class="hs-identifier hs-var">pl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-611"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-612"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080551"><span class="annot"><span class="annottext">wrap' :: Bool
</span><a href="#local-6989586621679080551"><span class="hs-identifier hs-var hs-var">wrap'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Slot -&gt; Int -&gt; Bool
</span><a href="#local-6989586621679080564"><span class="hs-identifier hs-var">haveWrapped</span></a></span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679080560"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080557"><span class="hs-identifier hs-var">idx</span></a></span><span>
</span><span id="line-613"></span><span>                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Elem -&gt; Bool
</span><a href="Data.HashTable.ST.Basic.html#recordIsDeleted"><span class="hs-identifier hs-var">recordIsDeleted</span></a></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="#local-6989586621679080553"><span class="hs-identifier hs-var">h0</span></a></span><span>
</span><span id="line-614"></span><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-615"></span><span>                      </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080550"><span class="annot"><span class="annottext">pl :: Slot
</span><a href="#local-6989586621679080550"><span class="hs-identifier hs-var hs-var">pl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679080560"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">Slot -&gt; Slot -&gt; Slot
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Slot
</span><a href="Data.HashTable.ST.Basic.html#Slot"><span class="hs-identifier hs-var">Slot</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080557"><span class="hs-identifier hs-var">idx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-616"></span><span>                      </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;deleted, cont with pl=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Slot -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679080550"><span class="hs-identifier hs-var">pl</span></a></span><span>
</span><span id="line-617"></span><span>                      </span><span class="annot"><span class="annottext">Slot -&gt; Int -&gt; Bool -&gt; ST s SlotFindResponse
</span><a href="#local-6989586621679080565"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679080550"><span class="hs-identifier hs-var">pl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080557"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679080551"><span class="hs-identifier hs-var">wrap'</span></a></span><span>
</span><span id="line-618"></span><span>                  </span><span class="hs-keyword">else</span><span>
</span><span id="line-619"></span><span>                    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="#local-6989586621679080568"><span class="hs-identifier hs-var">he</span></a></span><span> </span><span class="annot"><span class="annottext">Elem -&gt; Elem -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="#local-6989586621679080553"><span class="hs-identifier hs-var">h0</span></a></span><span>
</span><span id="line-620"></span><span>                      </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-621"></span><span>                        </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;found he == h0 == &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Elem -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="#local-6989586621679080553"><span class="hs-identifier hs-var">h0</span></a></span><span>
</span><span id="line-622"></span><span>                        </span><span id="local-6989586621679080549"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679080549"><span class="hs-identifier hs-var">k'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutableArray s k -&gt; Int -&gt; ST s k
forall s a. MutableArray s a -&gt; Int -&gt; ST s a
</span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s k
</span><a href="#local-6989586621679080571"><span class="hs-identifier hs-var">keys</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080557"><span class="hs-identifier hs-var">idx</span></a></span><span>
</span><span id="line-623"></span><span>                        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679080570"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">k -&gt; k -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679080549"><span class="hs-identifier hs-var">k'</span></a></span><span>
</span><span id="line-624"></span><span>                          </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-625"></span><span>                            </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;found at &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080557"><span class="hs-identifier hs-var">idx</span></a></span><span>
</span><span id="line-626"></span><span>                            </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080548"><span class="annot"><span class="annottext">sl :: Slot
</span><a href="#local-6989586621679080548"><span class="hs-identifier hs-var hs-var">sl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679080560"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">Slot -&gt; Slot -&gt; Slot
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Slot
</span><a href="Data.HashTable.ST.Basic.html#Slot"><span class="hs-identifier hs-var">Slot</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080557"><span class="hs-identifier hs-var">idx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-627"></span><span>                            </span><span class="annot"><span class="annottext">SlotFindResponse -&gt; ST s SlotFindResponse
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(SlotFindResponse -&gt; ST s SlotFindResponse)
-&gt; SlotFindResponse -&gt; ST s SlotFindResponse
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; SlotFindResponse
</span><a href="Data.HashTable.ST.Basic.html#SlotFindResponse"><span class="hs-identifier hs-var">SlotFindResponse</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Slot -&gt; Int
</span><a href="Data.HashTable.ST.Basic.html#_slot"><span class="hs-identifier hs-var hs-var">_slot</span></a></span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679080548"><span class="hs-identifier hs-var">sl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080557"><span class="hs-identifier hs-var">idx</span></a></span><span>
</span><span id="line-628"></span><span>                          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Slot -&gt; Int -&gt; Bool -&gt; ST s SlotFindResponse
</span><a href="#local-6989586621679080565"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679080560"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080557"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679080551"><span class="hs-identifier hs-var">wrap'</span></a></span><span>
</span><span id="line-629"></span><span>                      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Slot -&gt; Int -&gt; Bool -&gt; ST s SlotFindResponse
</span><a href="#local-6989586621679080565"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679080560"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080557"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679080551"><span class="hs-identifier hs-var">wrap'</span></a></span><span>
</span><span id="line-630"></span><span>
</span><span id="line-631"></span><span>
</span><span id="line-632"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-633"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#deleteFromSlot"><span class="hs-pragma hs-type">deleteFromSlot</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-634"></span><span id="local-6989586621679081073"><span id="local-6989586621679081074"><span id="local-6989586621679081075"><span class="annot"><a href="Data.HashTable.ST.Basic.html#deleteFromSlot"><span class="hs-identifier hs-type">deleteFromSlot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable_"><span class="hs-identifier hs-type">HashTable_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081075"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081074"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081073"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679081075"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-635"></span><span id="deleteFromSlot"><span class="annot"><span class="annottext">deleteFromSlot :: HashTable_ s k v -&gt; Int -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#deleteFromSlot"><span class="hs-identifier hs-var hs-var">deleteFromSlot</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679080547"><span class="annot"><span class="annottext">SizeRefs s
</span><a href="#local-6989586621679080547"><span class="hs-identifier hs-var">loadRef</span></a></span></span><span> </span><span id="local-6989586621679080546"><span class="annot"><span class="annottext">IntArray s
</span><a href="#local-6989586621679080546"><span class="hs-identifier hs-var">hashes</span></a></span></span><span> </span><span id="local-6989586621679080545"><span class="annot"><span class="annottext">MutableArray s k
</span><a href="#local-6989586621679080545"><span class="hs-identifier hs-var">keys</span></a></span></span><span> </span><span id="local-6989586621679080544"><span class="annot"><span class="annottext">MutableArray s v
</span><a href="#local-6989586621679080544"><span class="hs-identifier hs-var">values</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679080543"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080543"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-636"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679080542"><span class="annot"><span class="annottext">Elem
</span><a href="#local-6989586621679080542"><span class="hs-identifier hs-var">he</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IntArray s -&gt; Int -&gt; ST s Elem
forall s. IntArray s -&gt; Int -&gt; ST s Elem
</span><a href="Data.HashTable.Internal.IntArray.html#readArray"><span class="hs-identifier hs-var">U.readArray</span></a></span><span> </span><span class="annot"><span class="annottext">IntArray s
</span><a href="#local-6989586621679080546"><span class="hs-identifier hs-var">hashes</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080543"><span class="hs-identifier hs-var">idx</span></a></span><span>
</span><span id="line-637"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; ST s () -&gt; ST s ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Elem -&gt; Bool
</span><a href="Data.HashTable.ST.Basic.html#recordIsFilled"><span class="hs-identifier hs-var">recordIsFilled</span></a></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="#local-6989586621679080542"><span class="hs-identifier hs-var">he</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ST s () -&gt; ST s ()) -&gt; ST s () -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-638"></span><span>        </span><span class="annot"><span class="annottext">SizeRefs s -&gt; Int -&gt; ST s ()
forall s. SizeRefs s -&gt; Int -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#bumpDelLoad"><span class="hs-identifier hs-var">bumpDelLoad</span></a></span><span> </span><span class="annot"><span class="annottext">SizeRefs s
</span><a href="#local-6989586621679080547"><span class="hs-identifier hs-var">loadRef</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-639"></span><span>        </span><span class="annot"><span class="annottext">SizeRefs s -&gt; Int -&gt; ST s ()
forall s. SizeRefs s -&gt; Int -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#bumpLoad"><span class="hs-identifier hs-var">bumpLoad</span></a></span><span> </span><span class="annot"><span class="annottext">SizeRefs s
</span><a href="#local-6989586621679080547"><span class="hs-identifier hs-var">loadRef</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-640"></span><span>        </span><span class="annot"><span class="annottext">IntArray s -&gt; Int -&gt; Elem -&gt; ST s ()
forall s. IntArray s -&gt; Int -&gt; Elem -&gt; ST s ()
</span><a href="Data.HashTable.Internal.IntArray.html#writeArray"><span class="hs-identifier hs-var">U.writeArray</span></a></span><span> </span><span class="annot"><span class="annottext">IntArray s
</span><a href="#local-6989586621679080546"><span class="hs-identifier hs-var">hashes</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080543"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="Data.HashTable.ST.Basic.html#deletedMarker"><span class="hs-identifier hs-var">deletedMarker</span></a></span><span>
</span><span id="line-641"></span><span>        </span><span class="annot"><span class="annottext">MutableArray s k -&gt; Int -&gt; k -&gt; ST s ()
forall s a. MutableArray s a -&gt; Int -&gt; a -&gt; ST s ()
</span><a href="Data.HashTable.Internal.Array.html#writeArray"><span class="hs-identifier hs-var">writeArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s k
</span><a href="#local-6989586621679080545"><span class="hs-identifier hs-var">keys</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080543"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">k
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span>
</span><span id="line-642"></span><span>        </span><span class="annot"><span class="annottext">MutableArray s v -&gt; Int -&gt; v -&gt; ST s ()
forall s a. MutableArray s a -&gt; Int -&gt; a -&gt; ST s ()
</span><a href="Data.HashTable.Internal.Array.html#writeArray"><span class="hs-identifier hs-var">writeArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s v
</span><a href="#local-6989586621679080544"><span class="hs-identifier hs-var">values</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080543"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">v
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span>
</span><span id="line-643"></span><span>
</span><span id="line-644"></span><span>
</span><span id="line-645"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-646"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#insertIntoSlot"><span class="hs-pragma hs-type">insertIntoSlot</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-647"></span><span id="local-6989586621679081051"><span id="local-6989586621679081052"><span id="local-6989586621679081053"><span class="annot"><a href="Data.HashTable.ST.Basic.html#insertIntoSlot"><span class="hs-identifier hs-type">insertIntoSlot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable_"><span class="hs-identifier hs-type">HashTable_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081053"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081052"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081051"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.HashTable.Internal.IntArray.html#Elem"><span class="hs-identifier hs-type">Elem</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679081052"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679081051"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679081053"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-648"></span><span id="insertIntoSlot"><span class="annot"><span class="annottext">insertIntoSlot :: HashTable_ s k v -&gt; Int -&gt; Elem -&gt; k -&gt; v -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#insertIntoSlot"><span class="hs-identifier hs-var hs-var">insertIntoSlot</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679080538"><span class="annot"><span class="annottext">SizeRefs s
</span><a href="#local-6989586621679080538"><span class="hs-identifier hs-var">loadRef</span></a></span></span><span> </span><span id="local-6989586621679080537"><span class="annot"><span class="annottext">IntArray s
</span><a href="#local-6989586621679080537"><span class="hs-identifier hs-var">hashes</span></a></span></span><span> </span><span id="local-6989586621679080536"><span class="annot"><span class="annottext">MutableArray s k
</span><a href="#local-6989586621679080536"><span class="hs-identifier hs-var">keys</span></a></span></span><span> </span><span id="local-6989586621679080535"><span class="annot"><span class="annottext">MutableArray s v
</span><a href="#local-6989586621679080535"><span class="hs-identifier hs-var">values</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679080534"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080534"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span id="local-6989586621679080533"><span class="annot"><span class="annottext">Elem
</span><a href="#local-6989586621679080533"><span class="hs-identifier hs-var">he</span></a></span></span><span> </span><span id="local-6989586621679080532"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679080532"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621679080531"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679080531"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-649"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679080530"><span class="annot"><span class="annottext">Elem
</span><a href="#local-6989586621679080530"><span class="hs-identifier hs-var">heOld</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IntArray s -&gt; Int -&gt; ST s Elem
forall s. IntArray s -&gt; Int -&gt; ST s Elem
</span><a href="Data.HashTable.Internal.IntArray.html#readArray"><span class="hs-identifier hs-var">U.readArray</span></a></span><span> </span><span class="annot"><span class="annottext">IntArray s
</span><a href="#local-6989586621679080537"><span class="hs-identifier hs-var">hashes</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080534"><span class="hs-identifier hs-var">idx</span></a></span><span>
</span><span id="line-650"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080529"><span class="annot"><span class="annottext">heInt :: Int
</span><a href="#local-6989586621679080529"><span class="hs-identifier hs-var hs-var">heInt</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Elem -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="#local-6989586621679080530"><span class="hs-identifier hs-var">heOld</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-651"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621679080528"><span class="annot"><span class="annottext">delInt :: Int
</span><a href="#local-6989586621679080528"><span class="hs-identifier hs-var hs-var">delInt</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Elem -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="Data.HashTable.ST.Basic.html#deletedMarker"><span class="hs-identifier hs-var">deletedMarker</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-652"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621679080527"><span class="annot"><span class="annottext">emptyInt :: Int
</span><a href="#local-6989586621679080527"><span class="hs-identifier hs-var hs-var">emptyInt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Elem -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="Data.HashTable.ST.Basic.html#emptyMarker"><span class="hs-identifier hs-var">emptyMarker</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-653"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621679080526"><span class="annot"><span class="annottext">delBump :: Int
</span><a href="#local-6989586621679080526"><span class="hs-identifier hs-var hs-var">delBump</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
</span><a href="Data.HashTable.Internal.CacheLine.html#mask"><span class="hs-identifier hs-var">mask</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080529"><span class="hs-identifier hs-var">heInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080528"><span class="hs-identifier hs-var">delInt</span></a></span><span> </span><span class="hs-comment">-- -1 if heInt == delInt,</span><span>
</span><span id="line-654"></span><span>                                      </span><span class="hs-comment">--  0  otherwise</span><span>
</span><span id="line-655"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621679080525"><span class="annot"><span class="annottext">mLoad :: Int
</span><a href="#local-6989586621679080525"><span class="hs-identifier hs-var hs-var">mLoad</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
</span><a href="Data.HashTable.Internal.CacheLine.html#mask"><span class="hs-identifier hs-var">mask</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080529"><span class="hs-identifier hs-var">heInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080528"><span class="hs-identifier hs-var">delInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
</span><a href="Data.HashTable.Internal.CacheLine.html#mask"><span class="hs-identifier hs-var">mask</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080529"><span class="hs-identifier hs-var">heInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080527"><span class="hs-identifier hs-var">emptyInt</span></a></span><span>
</span><span id="line-656"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621679080524"><span class="annot"><span class="annottext">loadBump :: Int
</span><a href="#local-6989586621679080524"><span class="hs-identifier hs-var hs-var">loadBump</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080525"><span class="hs-identifier hs-var">mLoad</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-comment">-- 1 if heInt == delInt || heInt == emptyInt,</span><span>
</span><span id="line-657"></span><span>                                </span><span class="hs-comment">-- 0 otherwise</span><span>
</span><span id="line-658"></span><span>    </span><span class="annot"><span class="annottext">SizeRefs s -&gt; Int -&gt; ST s ()
forall s. SizeRefs s -&gt; Int -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#bumpDelLoad"><span class="hs-identifier hs-var">bumpDelLoad</span></a></span><span> </span><span class="annot"><span class="annottext">SizeRefs s
</span><a href="#local-6989586621679080538"><span class="hs-identifier hs-var">loadRef</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080526"><span class="hs-identifier hs-var">delBump</span></a></span><span>
</span><span id="line-659"></span><span>    </span><span class="annot"><span class="annottext">SizeRefs s -&gt; Int -&gt; ST s ()
forall s. SizeRefs s -&gt; Int -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#bumpLoad"><span class="hs-identifier hs-var">bumpLoad</span></a></span><span> </span><span class="annot"><span class="annottext">SizeRefs s
</span><a href="#local-6989586621679080538"><span class="hs-identifier hs-var">loadRef</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080524"><span class="hs-identifier hs-var">loadBump</span></a></span><span>
</span><span id="line-660"></span><span>    </span><span class="annot"><span class="annottext">IntArray s -&gt; Int -&gt; Elem -&gt; ST s ()
forall s. IntArray s -&gt; Int -&gt; Elem -&gt; ST s ()
</span><a href="Data.HashTable.Internal.IntArray.html#writeArray"><span class="hs-identifier hs-var">U.writeArray</span></a></span><span> </span><span class="annot"><span class="annottext">IntArray s
</span><a href="#local-6989586621679080537"><span class="hs-identifier hs-var">hashes</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080534"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="#local-6989586621679080533"><span class="hs-identifier hs-var">he</span></a></span><span>
</span><span id="line-661"></span><span>    </span><span class="annot"><span class="annottext">MutableArray s k -&gt; Int -&gt; k -&gt; ST s ()
forall s a. MutableArray s a -&gt; Int -&gt; a -&gt; ST s ()
</span><a href="Data.HashTable.Internal.Array.html#writeArray"><span class="hs-identifier hs-var">writeArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s k
</span><a href="#local-6989586621679080536"><span class="hs-identifier hs-var">keys</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080534"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679080532"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-662"></span><span>    </span><span class="annot"><span class="annottext">MutableArray s v -&gt; Int -&gt; v -&gt; ST s ()
forall s a. MutableArray s a -&gt; Int -&gt; a -&gt; ST s ()
</span><a href="Data.HashTable.Internal.Array.html#writeArray"><span class="hs-identifier hs-var">writeArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s v
</span><a href="#local-6989586621679080535"><span class="hs-identifier hs-var">values</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080534"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679080531"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-663"></span><span>
</span><span id="line-664"></span><span>
</span><span id="line-665"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-666"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#bumpLoad"><span class="hs-pragma hs-type">bumpLoad</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-667"></span><span id="local-6989586621679080523"><span class="annot"><a href="Data.HashTable.ST.Basic.html#bumpLoad"><span class="hs-identifier hs-type">bumpLoad</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Basic.html#SizeRefs"><span class="hs-identifier hs-type">SizeRefs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080523"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679080523"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-668"></span><span id="bumpLoad"><span class="annot"><span class="annottext">bumpLoad :: SizeRefs s -&gt; Int -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#bumpLoad"><span class="hs-identifier hs-var hs-var">bumpLoad</span></a></span></span><span> </span><span id="local-6989586621679080522"><span class="annot"><span class="annottext">SizeRefs s
</span><a href="#local-6989586621679080522"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span id="local-6989586621679080521"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080521"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-669"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679080520"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080520"><span class="hs-identifier hs-var">ld</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SizeRefs s -&gt; ST s Int
forall s. SizeRefs s -&gt; ST s Int
</span><a href="Data.HashTable.ST.Basic.html#readLoad"><span class="hs-identifier hs-var">readLoad</span></a></span><span> </span><span class="annot"><span class="annottext">SizeRefs s
</span><a href="#local-6989586621679080522"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-670"></span><span>    </span><span class="annot"><span class="annottext">SizeRefs s -&gt; Int -&gt; ST s ()
forall s. SizeRefs s -&gt; Int -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#writeLoad"><span class="hs-identifier hs-var">writeLoad</span></a></span><span> </span><span class="annot"><span class="annottext">SizeRefs s
</span><a href="#local-6989586621679080522"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; ST s ()) -&gt; Int -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080520"><span class="hs-identifier hs-var">ld</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080521"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-671"></span><span>
</span><span id="line-672"></span><span>
</span><span id="line-673"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-674"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#bumpDelLoad"><span class="hs-pragma hs-type">bumpDelLoad</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-675"></span><span id="local-6989586621679080519"><span class="annot"><a href="Data.HashTable.ST.Basic.html#bumpDelLoad"><span class="hs-identifier hs-type">bumpDelLoad</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Basic.html#SizeRefs"><span class="hs-identifier hs-type">SizeRefs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080519"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679080519"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-676"></span><span id="bumpDelLoad"><span class="annot"><span class="annottext">bumpDelLoad :: SizeRefs s -&gt; Int -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#bumpDelLoad"><span class="hs-identifier hs-var hs-var">bumpDelLoad</span></a></span></span><span> </span><span id="local-6989586621679080518"><span class="annot"><span class="annottext">SizeRefs s
</span><a href="#local-6989586621679080518"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span id="local-6989586621679080517"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080517"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-677"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679080516"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080516"><span class="hs-identifier hs-var">ld</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SizeRefs s -&gt; ST s Int
forall s. SizeRefs s -&gt; ST s Int
</span><a href="Data.HashTable.ST.Basic.html#readDelLoad"><span class="hs-identifier hs-var">readDelLoad</span></a></span><span> </span><span class="annot"><span class="annottext">SizeRefs s
</span><a href="#local-6989586621679080518"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-678"></span><span>    </span><span class="annot"><span class="annottext">SizeRefs s -&gt; Int -&gt; ST s ()
forall s. SizeRefs s -&gt; Int -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#writeDelLoad"><span class="hs-identifier hs-var">writeDelLoad</span></a></span><span> </span><span class="annot"><span class="annottext">SizeRefs s
</span><a href="#local-6989586621679080518"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; ST s ()) -&gt; Int -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080516"><span class="hs-identifier hs-var">ld</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080517"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-679"></span><span>
</span><span id="line-680"></span><span>
</span><span id="line-681"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-682"></span><span class="annot"><a href="Data.HashTable.ST.Basic.html#maxLoad"><span class="hs-identifier hs-type">maxLoad</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-683"></span><span id="maxLoad"><span class="annot"><span class="annottext">maxLoad :: Double
</span><a href="Data.HashTable.ST.Basic.html#maxLoad"><span class="hs-identifier hs-var hs-var">maxLoad</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.82</span></span><span>
</span><span id="line-684"></span><span>
</span><span id="line-685"></span><span>
</span><span id="line-686"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-687"></span><span class="annot"><a href="Data.HashTable.ST.Basic.html#emptyMarker"><span class="hs-identifier hs-type">emptyMarker</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.HashTable.Internal.IntArray.html#Elem"><span class="hs-identifier hs-type">Elem</span></a></span><span>
</span><span id="line-688"></span><span id="emptyMarker"><span class="annot"><span class="annottext">emptyMarker :: Elem
</span><a href="Data.HashTable.ST.Basic.html#emptyMarker"><span class="hs-identifier hs-var hs-var">emptyMarker</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Elem
</span><span class="hs-number">0</span></span><span>
</span><span id="line-689"></span><span>
</span><span id="line-690"></span><span>
</span><span id="line-691"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-692"></span><span class="annot"><a href="Data.HashTable.ST.Basic.html#deletedMarker"><span class="hs-identifier hs-type">deletedMarker</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.HashTable.Internal.IntArray.html#Elem"><span class="hs-identifier hs-type">Elem</span></a></span><span>
</span><span id="line-693"></span><span id="deletedMarker"><span class="annot"><span class="annottext">deletedMarker :: Elem
</span><a href="Data.HashTable.ST.Basic.html#deletedMarker"><span class="hs-identifier hs-var hs-var">deletedMarker</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Elem
</span><span class="hs-number">1</span></span><span>
</span><span id="line-694"></span><span>
</span><span id="line-695"></span><span>
</span><span id="line-696"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-697"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#trueInt"><span class="hs-pragma hs-type">trueInt</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-698"></span><span class="annot"><a href="Data.HashTable.ST.Basic.html#trueInt"><span class="hs-identifier hs-type">trueInt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-699"></span><span id="trueInt"><span class="annot"><span class="annottext">trueInt :: Int -&gt; Bool
</span><a href="Data.HashTable.ST.Basic.html#trueInt"><span class="hs-identifier hs-var hs-var">trueInt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621679080515"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679080515"><span class="hs-identifier hs-var">i#</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Bool
forall a. Int# -&gt; a
</span><span class="hs-identifier hs-var">tagToEnum#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679080515"><span class="hs-identifier hs-var">i#</span></a></span><span>
</span><span id="line-700"></span><span>
</span><span id="line-701"></span><span>
</span><span id="line-702"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-703"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#recordIsEmpty"><span class="hs-pragma hs-type">recordIsEmpty</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-704"></span><span class="annot"><a href="Data.HashTable.ST.Basic.html#recordIsEmpty"><span class="hs-identifier hs-type">recordIsEmpty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.HashTable.Internal.IntArray.html#Elem"><span class="hs-identifier hs-type">Elem</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-705"></span><span id="recordIsEmpty"><span class="annot"><span class="annottext">recordIsEmpty :: Elem -&gt; Bool
</span><a href="Data.HashTable.ST.Basic.html#recordIsEmpty"><span class="hs-identifier hs-var hs-var">recordIsEmpty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Elem -&gt; Elem -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="Data.HashTable.ST.Basic.html#emptyMarker"><span class="hs-identifier hs-var">emptyMarker</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-706"></span><span>
</span><span id="line-707"></span><span>
</span><span id="line-708"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-709"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#recordIsDeleted"><span class="hs-pragma hs-type">recordIsDeleted</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-710"></span><span class="annot"><a href="Data.HashTable.ST.Basic.html#recordIsDeleted"><span class="hs-identifier hs-type">recordIsDeleted</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.HashTable.Internal.IntArray.html#Elem"><span class="hs-identifier hs-type">Elem</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-711"></span><span id="recordIsDeleted"><span class="annot"><span class="annottext">recordIsDeleted :: Elem -&gt; Bool
</span><a href="Data.HashTable.ST.Basic.html#recordIsDeleted"><span class="hs-identifier hs-var hs-var">recordIsDeleted</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Elem -&gt; Elem -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="Data.HashTable.ST.Basic.html#deletedMarker"><span class="hs-identifier hs-var">deletedMarker</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-712"></span><span>
</span><span id="line-713"></span><span>
</span><span id="line-714"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-715"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#recordIsFilled"><span class="hs-pragma hs-type">recordIsFilled</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-716"></span><span class="annot"><a href="Data.HashTable.ST.Basic.html#recordIsFilled"><span class="hs-identifier hs-type">recordIsFilled</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.HashTable.Internal.IntArray.html#Elem"><span class="hs-identifier hs-type">Elem</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-717"></span><span id="recordIsFilled"><span class="annot"><span class="annottext">recordIsFilled :: Elem -&gt; Bool
</span><a href="Data.HashTable.ST.Basic.html#recordIsFilled"><span class="hs-identifier hs-var hs-var">recordIsFilled</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080514"><span class="annot"><span class="annottext">Elem
</span><a href="#local-6989586621679080514"><span class="hs-identifier hs-var">el</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Bool
forall a. Int# -&gt; a
</span><span class="hs-identifier hs-var">tagToEnum#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679080513"><span class="hs-identifier hs-var">isFilled#</span></a></span><span>
</span><span id="line-718"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-719"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679080512"><span class="annot"><span class="annottext">el# :: Int#
</span><a href="#local-6989586621679080512"><span class="hs-identifier hs-var hs-var">el#</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Elem -&gt; Int#
</span><a href="Data.HashTable.Internal.IntArray.html#elemToInt%23"><span class="hs-identifier hs-var">U.elemToInt#</span></a></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="#local-6989586621679080514"><span class="hs-identifier hs-var">el</span></a></span><span>
</span><span id="line-720"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679080510"><span class="annot"><span class="annottext">deletedMarker# :: Int#
</span><a href="#local-6989586621679080510"><span class="hs-identifier hs-var hs-var">deletedMarker#</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Elem -&gt; Int#
</span><a href="Data.HashTable.Internal.IntArray.html#elemToInt%23"><span class="hs-identifier hs-var">U.elemToInt#</span></a></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="Data.HashTable.ST.Basic.html#deletedMarker"><span class="hs-identifier hs-var">deletedMarker</span></a></span><span>
</span><span id="line-721"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679080509"><span class="annot"><span class="annottext">emptyMarker# :: Int#
</span><a href="#local-6989586621679080509"><span class="hs-identifier hs-var hs-var">emptyMarker#</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Elem -&gt; Int#
</span><a href="Data.HashTable.Internal.IntArray.html#elemToInt%23"><span class="hs-identifier hs-var">U.elemToInt#</span></a></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="Data.HashTable.ST.Basic.html#emptyMarker"><span class="hs-identifier hs-var">emptyMarker</span></a></span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &gt;= 708
</span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679080513"><span class="annot"><span class="annottext">isFilled# :: Int#
</span><a href="#local-6989586621679080513"><span class="hs-identifier hs-var hs-var">isFilled#</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679080512"><span class="hs-identifier hs-var">el#</span></a></span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Int# -&gt; Int#
</span><span class="hs-operator hs-var">/=#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679080510"><span class="hs-identifier hs-var">deletedMarker#</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Int# -&gt; Int#
</span><span class="hs-operator hs-var">`andI#`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679080512"><span class="hs-identifier hs-var">el#</span></a></span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Int# -&gt; Int#
</span><span class="hs-operator hs-var">/=#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679080509"><span class="hs-identifier hs-var">emptyMarker#</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span>    </span><span class="hs-glyph">!</span><span class="hs-identifier">delOrEmpty#</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">mask#</span><span> </span><span class="hs-identifier">el#</span><span> </span><span class="hs-identifier">deletedMarker#</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">orI#</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">mask#</span><span> </span><span class="hs-identifier">el#</span><span> </span><span class="hs-identifier">emptyMarker#</span><span>
</span><span id="line-726"></span><span>    </span><span class="hs-glyph">!</span><span class="hs-identifier">isFilled#</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1#</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">andI#</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">notI#</span><span> </span><span class="hs-identifier">delOrEmpty#</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-729"></span><span>
</span><span id="line-730"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-731"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#hash"><span class="hs-pragma hs-type">hash</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-732"></span><span id="local-6989586621679081072"><span class="annot"><a href="Data.HashTable.ST.Basic.html#hash"><span class="hs-identifier hs-type">hash</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679081072"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679081072"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span><span>
</span><span id="line-733"></span><span id="hash"><span class="annot"><span class="annottext">hash :: k -&gt; Int
</span><a href="Data.HashTable.ST.Basic.html#hash"><span class="hs-identifier hs-var hs-var">hash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; Int
forall k. Hashable k =&gt; k -&gt; Int
</span><span class="hs-identifier hs-var">H.hash</span></span><span>
</span><span id="line-734"></span><span>
</span><span id="line-735"></span><span>
</span><span id="line-736"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-737"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#hashToElem"><span class="hs-pragma hs-type">hashToElem</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-738"></span><span class="annot"><a href="Data.HashTable.ST.Basic.html#hashToElem"><span class="hs-identifier hs-type">hashToElem</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.HashTable.Internal.IntArray.html#Elem"><span class="hs-identifier hs-type">Elem</span></a></span><span>
</span><span id="line-739"></span><span id="hashToElem"><span class="annot"><span class="annottext">hashToElem :: Int -&gt; Elem
</span><a href="Data.HashTable.ST.Basic.html#hashToElem"><span class="hs-identifier hs-var hs-var">hashToElem</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080507"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080507"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="#local-6989586621679080506"><span class="hs-identifier hs-var">out</span></a></span><span>
</span><span id="line-740"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-741"></span><span>    </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621679080505"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679080505"><span class="hs-identifier hs-var">lo#</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080507"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Data.HashTable.Internal.IntArray.html#elemMask"><span class="hs-identifier hs-var">U.elemMask</span></a></span><span>
</span><span id="line-742"></span><span>
</span><span id="line-743"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679080503"><span class="annot"><span class="annottext">m# :: Word#
</span><a href="#local-6989586621679080503"><span class="hs-identifier hs-var hs-var">m#</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Int# -&gt; Word#
</span><a href="Data.HashTable.Internal.CacheLine.html#maskw%23"><span class="hs-identifier hs-var">maskw#</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679080505"><span class="hs-identifier hs-var">lo#</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><span class="hs-number">0#</span></span><span> </span><span class="annot"><span class="annottext">Word# -&gt; Word# -&gt; Word#
</span><span class="hs-operator hs-var">`or#`</span></span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Int# -&gt; Word#
</span><a href="Data.HashTable.Internal.CacheLine.html#maskw%23"><span class="hs-identifier hs-var">maskw#</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679080505"><span class="hs-identifier hs-var">lo#</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><span class="hs-number">1#</span></span><span>
</span><span id="line-744"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679080501"><span class="annot"><span class="annottext">nm# :: Word#
</span><a href="#local-6989586621679080501"><span class="hs-identifier hs-var hs-var">nm#</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word# -&gt; Word#
</span><span class="hs-identifier hs-var">not#</span></span><span> </span><span class="annot"><span class="annottext">Word#
</span><a href="#local-6989586621679080503"><span class="hs-identifier hs-var">m#</span></a></span><span>
</span><span id="line-745"></span><span>
</span><span id="line-746"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679080500"><span class="annot"><span class="annottext">r# :: Word#
</span><a href="#local-6989586621679080500"><span class="hs-identifier hs-var hs-var">r#</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int# -&gt; Word#
</span><span class="hs-identifier hs-var">int2Word#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><span class="hs-number">2#</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word# -&gt; Word# -&gt; Word#
</span><span class="hs-operator hs-var">`and#`</span></span><span> </span><span class="annot"><span class="annottext">Word#
</span><a href="#local-6989586621679080503"><span class="hs-identifier hs-var">m#</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word# -&gt; Word# -&gt; Word#
</span><span class="hs-operator hs-var">`or#`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int# -&gt; Word#
</span><span class="hs-identifier hs-var">int2Word#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679080505"><span class="hs-identifier hs-var">lo#</span></a></span><span> </span><span class="annot"><span class="annottext">Word# -&gt; Word# -&gt; Word#
</span><span class="hs-operator hs-var">`and#`</span></span><span> </span><span class="annot"><span class="annottext">Word#
</span><a href="#local-6989586621679080501"><span class="hs-identifier hs-var">nm#</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-747"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679080506"><span class="annot"><span class="annottext">out :: Elem
</span><a href="#local-6989586621679080506"><span class="hs-identifier hs-var hs-var">out</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word# -&gt; Elem
</span><a href="Data.HashTable.Internal.IntArray.html#primWordToElem"><span class="hs-identifier hs-var">U.primWordToElem</span></a></span><span> </span><span class="annot"><span class="annottext">Word#
</span><a href="#local-6989586621679080500"><span class="hs-identifier hs-var">r#</span></a></span><span>
</span><span id="line-748"></span><span>
</span><span id="line-749"></span><span>
</span><span id="line-750"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-751"></span><span id="local-6989586621679081100"><span id="local-6989586621679081101"><span id="local-6989586621679081102"><span class="annot"><a href="Data.HashTable.ST.Basic.html#newRef"><span class="hs-identifier hs-type">newRef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable_"><span class="hs-identifier hs-type">HashTable_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081102"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081101"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081100"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679081102"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081102"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081101"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081100"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-752"></span><span id="newRef"><span class="annot"><span class="annottext">newRef :: HashTable_ s k v -&gt; ST s (HashTable s k v)
</span><a href="Data.HashTable.ST.Basic.html#newRef"><span class="hs-identifier hs-var hs-var">newRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(STRef s (HashTable_ s k v) -&gt; HashTable s k v)
-&gt; ST s (STRef s (HashTable_ s k v)) -&gt; ST s (HashTable s k v)
forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><span class="hs-identifier hs-var">liftM</span></span><span> </span><span class="annot"><span class="annottext">STRef s (HashTable_ s k v) -&gt; HashTable s k v
forall s k v. STRef s (HashTable_ s k v) -&gt; HashTable s k v
</span><a href="Data.HashTable.ST.Basic.html#HT"><span class="hs-identifier hs-var">HT</span></a></span><span> </span><span class="annot"><span class="annottext">(ST s (STRef s (HashTable_ s k v)) -&gt; ST s (HashTable s k v))
-&gt; (HashTable_ s k v -&gt; ST s (STRef s (HashTable_ s k v)))
-&gt; HashTable_ s k v
-&gt; ST s (HashTable s k v)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; ST s (STRef s (HashTable_ s k v))
forall a s. a -&gt; ST s (STRef s a)
</span><span class="hs-identifier hs-var">newSTRef</span></span><span>
</span><span id="line-753"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#newRef"><span class="hs-pragma hs-type">newRef</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-754"></span><span>
</span><span id="line-755"></span><span id="local-6989586621679081045"><span id="local-6989586621679081046"><span id="local-6989586621679081047"><span class="annot"><a href="Data.HashTable.ST.Basic.html#writeRef"><span class="hs-identifier hs-type">writeRef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081047"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081046"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081045"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable_"><span class="hs-identifier hs-type">HashTable_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081047"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081046"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081045"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679081047"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-756"></span><span id="writeRef"><span class="annot"><span class="annottext">writeRef :: HashTable s k v -&gt; HashTable_ s k v -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#writeRef"><span class="hs-identifier hs-var hs-var">writeRef</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HT"><span class="hs-identifier hs-type">HT</span></a></span><span> </span><span id="local-6989586621679080496"><span class="annot"><span class="annottext">STRef s (HashTable_ s k v)
</span><a href="#local-6989586621679080496"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679080495"><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679080495"><span class="hs-identifier hs-var">ht</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STRef s (HashTable_ s k v) -&gt; HashTable_ s k v -&gt; ST s ()
forall s a. STRef s a -&gt; a -&gt; ST s ()
</span><span class="hs-identifier hs-var">writeSTRef</span></span><span> </span><span class="annot"><span class="annottext">STRef s (HashTable_ s k v)
</span><a href="#local-6989586621679080496"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679080495"><span class="hs-identifier hs-var">ht</span></a></span><span>
</span><span id="line-757"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#writeRef"><span class="hs-pragma hs-type">writeRef</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-758"></span><span>
</span><span id="line-759"></span><span id="local-6989586621679081081"><span id="local-6989586621679081082"><span id="local-6989586621679081083"><span class="annot"><a href="Data.HashTable.ST.Basic.html#readRef"><span class="hs-identifier hs-type">readRef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081083"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081082"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081081"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679081083"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable_"><span class="hs-identifier hs-type">HashTable_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081083"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081082"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679081081"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-760"></span><span id="readRef"><span class="annot"><span class="annottext">readRef :: HashTable s k v -&gt; ST s (HashTable_ s k v)
</span><a href="Data.HashTable.ST.Basic.html#readRef"><span class="hs-identifier hs-var hs-var">readRef</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HT"><span class="hs-identifier hs-type">HT</span></a></span><span> </span><span id="local-6989586621679080493"><span class="annot"><span class="annottext">STRef s (HashTable_ s k v)
</span><a href="#local-6989586621679080493"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STRef s (HashTable_ s k v) -&gt; ST s (HashTable_ s k v)
forall s a. STRef s a -&gt; ST s a
</span><span class="hs-identifier hs-var">readSTRef</span></span><span> </span><span class="annot"><span class="annottext">STRef s (HashTable_ s k v)
</span><a href="#local-6989586621679080493"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-761"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#readRef"><span class="hs-pragma hs-type">readRef</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-762"></span><span>
</span><span id="line-763"></span><span>
</span><span id="line-764"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-765"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-pragma hs-type">debug</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-766"></span><span id="local-6989586621679081115"><span class="annot"><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-type">debug</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679081115"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span class="hs-cpp">
#ifdef DEBUG
</span><span class="hs-identifier">debug</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">unsafeIOToST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">putStrLn</span><span> </span><span class="hs-identifier">s</span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span id="debug"><span class="annot"><span class="annottext">debug :: String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var hs-var">debug</span></a></span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; ST s ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-773"></span><span id="local-6989586621679080489"><span id="local-6989586621679080490"><span id="local-6989586621679080491"><span class="annot"><a href="Data.HashTable.ST.Basic.html#lookupIndex"><span class="hs-identifier hs-type">lookupIndex</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679080491"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679080491"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080490"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080491"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080489"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679080491"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679080490"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-774"></span><span id="lookupIndex"><span class="annot"><span class="annottext">lookupIndex :: HashTable s k v -&gt; k -&gt; ST s (Maybe Word)
</span><a href="Data.HashTable.ST.Basic.html#lookupIndex"><span class="hs-identifier hs-var hs-var">lookupIndex</span></a></span></span><span> </span><span id="local-6989586621679080488"><span class="annot"><span class="annottext">HashTable s k v
</span><a href="#local-6989586621679080488"><span class="hs-identifier hs-var">htRef</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080487"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679080487"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-775"></span><span>    </span><span id="local-6989586621679080486"><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679080486"><span class="hs-identifier hs-var">ht</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashTable s k v -&gt; ST s (HashTable_ s k v)
forall s k v. HashTable s k v -&gt; ST s (HashTable_ s k v)
</span><a href="Data.HashTable.ST.Basic.html#readRef"><span class="hs-identifier hs-var">readRef</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable s k v
</span><a href="#local-6989586621679080488"><span class="hs-identifier hs-var">htRef</span></a></span><span>
</span><span id="line-776"></span><span>    </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; ST s (Maybe Word)
forall a s v. Num a =&gt; HashTable_ s k v -&gt; ST s (Maybe a)
</span><a href="#local-6989586621679080485"><span class="hs-identifier hs-var">lookup'</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v
</span><a href="#local-6989586621679080486"><span class="hs-identifier hs-var">ht</span></a></span><span>
</span><span id="line-777"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-778"></span><span>    </span><span id="local-6989586621679080485"><span class="annot"><span class="annottext">lookup' :: HashTable_ s k v -&gt; ST s (Maybe a)
</span><a href="#local-6989586621679080485"><span class="hs-identifier hs-var hs-var">lookup'</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span id="local-6989586621679080484"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080484"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span class="annot"><span class="annottext">SizeRefs s
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679080483"><span class="annot"><span class="annottext">IntArray s
</span><a href="#local-6989586621679080483"><span class="hs-identifier hs-var">hashes</span></a></span></span><span> </span><span id="local-6989586621679080482"><span class="annot"><span class="annottext">MutableArray s k
</span><a href="#local-6989586621679080482"><span class="hs-identifier hs-var">keys</span></a></span></span><span> </span><span id="local-6989586621679080481"><span class="annot"><span class="annottext">MutableArray s v
</span><a href="#local-6989586621679080481"><span class="hs-identifier hs-var">_values</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-779"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080480"><span class="annot"><span class="annottext">b :: Int
</span><a href="#local-6989586621679080480"><span class="hs-identifier hs-var hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
</span><a href="Data.HashTable.Internal.Utils.html#whichBucket"><span class="hs-identifier hs-var">whichBucket</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080479"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080484"><span class="hs-identifier hs-var">sz</span></a></span><span>
</span><span id="line-780"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;lookup h=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080479"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; sz=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080484"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; b=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080480"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-781"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; ST s (Maybe a)
forall a. Num a =&gt; Int -&gt; Int -&gt; Int -&gt; ST s (Maybe a)
</span><a href="#local-6989586621679080478"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080480"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080484"><span class="hs-identifier hs-var">sz</span></a></span><span>
</span><span id="line-782"></span><span>
</span><span id="line-783"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-784"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621679080479"><span class="annot"><span class="annottext">h :: Int
</span><a href="#local-6989586621679080479"><span class="hs-identifier hs-var hs-var">h</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; Int
forall k. Hashable k =&gt; k -&gt; Int
</span><a href="Data.HashTable.ST.Basic.html#hash"><span class="hs-identifier hs-var">hash</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679080487"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-785"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621679080477"><span class="annot"><span class="annottext">he :: Elem
</span><a href="#local-6989586621679080477"><span class="hs-identifier hs-var hs-var">he</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Elem
</span><a href="Data.HashTable.ST.Basic.html#hashToElem"><span class="hs-identifier hs-var">hashToElem</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080479"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-786"></span><span>
</span><span id="line-787"></span><span>        </span><span id="local-6989586621679080478"><span class="annot"><span class="annottext">go :: Int -&gt; Int -&gt; Int -&gt; ST s (Maybe a)
</span><a href="#local-6989586621679080478"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080476"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080476"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080475"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080475"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080474"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080474"><span class="hs-identifier hs-var">end</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;lookupIndex/go&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-788"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;lookupIndex/go: &quot;</span></span><span>
</span><span id="line-789"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080476"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-790"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;/&quot;</span></span><span>
</span><span id="line-791"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080475"><span class="hs-identifier hs-var">start</span></a></span><span>
</span><span id="line-792"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;/&quot;</span></span><span>
</span><span id="line-793"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080474"><span class="hs-identifier hs-var">end</span></a></span><span>
</span><span id="line-794"></span><span>                           </span><span class="hs-special">]</span><span>
</span><span id="line-795"></span><span>            </span><span id="local-6989586621679080473"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080473"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IntArray s -&gt; Int -&gt; Int -&gt; Elem -&gt; Elem -&gt; ST s Int
forall s. IntArray s -&gt; Int -&gt; Int -&gt; Elem -&gt; Elem -&gt; ST s Int
</span><a href="Data.HashTable.Internal.CacheLine.html#forwardSearch2"><span class="hs-identifier hs-var">forwardSearch2</span></a></span><span> </span><span class="annot"><span class="annottext">IntArray s
</span><a href="#local-6989586621679080483"><span class="hs-identifier hs-var">hashes</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080476"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080474"><span class="hs-identifier hs-var">end</span></a></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="#local-6989586621679080477"><span class="hs-identifier hs-var">he</span></a></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="Data.HashTable.ST.Basic.html#emptyMarker"><span class="hs-identifier hs-var">emptyMarker</span></a></span><span>
</span><span id="line-796"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;forwardSearch2 returned &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080473"><span class="hs-identifier hs-var">idx</span></a></span><span>
</span><span id="line-797"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080473"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080473"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080475"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080473"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080474"><span class="hs-identifier hs-var">end</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-798"></span><span>               </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe a -&gt; ST s (Maybe a)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-799"></span><span>               </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-800"></span><span>                 </span><span id="local-6989586621679080472"><span class="annot"><span class="annottext">Elem
</span><a href="#local-6989586621679080472"><span class="hs-identifier hs-var">h0</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IntArray s -&gt; Int -&gt; ST s Elem
forall s. IntArray s -&gt; Int -&gt; ST s Elem
</span><a href="Data.HashTable.Internal.IntArray.html#readArray"><span class="hs-identifier hs-var">U.readArray</span></a></span><span> </span><span class="annot"><span class="annottext">IntArray s
</span><a href="#local-6989586621679080483"><span class="hs-identifier hs-var">hashes</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080473"><span class="hs-identifier hs-var">idx</span></a></span><span>
</span><span id="line-801"></span><span>                 </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;h0 was &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Elem -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="#local-6989586621679080472"><span class="hs-identifier hs-var">h0</span></a></span><span>
</span><span id="line-802"></span><span>
</span><span id="line-803"></span><span>                 </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Elem -&gt; Bool
</span><a href="Data.HashTable.ST.Basic.html#recordIsEmpty"><span class="hs-identifier hs-var">recordIsEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="#local-6989586621679080472"><span class="hs-identifier hs-var">h0</span></a></span><span>
</span><span id="line-804"></span><span>                   </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-805"></span><span>                       </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;record empty, returning Nothing&quot;</span></span><span>
</span><span id="line-806"></span><span>                       </span><span class="annot"><span class="annottext">Maybe a -&gt; ST s (Maybe a)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-807"></span><span>                   </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-808"></span><span>                     </span><span id="local-6989586621679080471"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679080471"><span class="hs-identifier hs-var">k'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutableArray s k -&gt; Int -&gt; ST s k
forall s a. MutableArray s a -&gt; Int -&gt; ST s a
</span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s k
</span><a href="#local-6989586621679080482"><span class="hs-identifier hs-var">keys</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080473"><span class="hs-identifier hs-var">idx</span></a></span><span>
</span><span id="line-809"></span><span>                     </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679080487"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">k -&gt; k -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679080471"><span class="hs-identifier hs-var">k'</span></a></span><span>
</span><span id="line-810"></span><span>                       </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-811"></span><span>                         </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;value found at &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080473"><span class="hs-identifier hs-var">idx</span></a></span><span>
</span><span id="line-812"></span><span>                         </span><span class="annot"><span class="annottext">Maybe a -&gt; ST s (Maybe a)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe a -&gt; ST s (Maybe a)) -&gt; Maybe a -&gt; ST s (Maybe a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; Maybe a) -&gt; a -&gt; Maybe a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; a
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080473"><span class="hs-identifier hs-var">idx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-813"></span><span>                       </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-814"></span><span>                         </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall s. String -&gt; ST s ()
</span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s ()) -&gt; String -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;value not found, recursing&quot;</span></span><span>
</span><span id="line-815"></span><span>                         </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080473"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080476"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-816"></span><span>                           </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; ST s (Maybe a)
</span><a href="#local-6989586621679080478"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080473"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080473"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080476"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-817"></span><span>                           </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; ST s (Maybe a)
</span><a href="#local-6989586621679080478"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080473"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080475"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080474"><span class="hs-identifier hs-var">end</span></a></span><span>
</span><span id="line-818"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#lookupIndex"><span class="hs-pragma hs-type">lookupIndex</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-819"></span><span>
</span><span id="line-820"></span><span id="local-6989586621679080468"><span id="local-6989586621679080469"><span id="local-6989586621679080470"><span class="annot"><a href="Data.HashTable.ST.Basic.html#nextByIndex"><span class="hs-identifier hs-type">nextByIndex</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080470"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080469"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080468"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679080470"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679080469"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679080468"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-821"></span><span id="nextByIndex"><span class="annot"><span class="annottext">nextByIndex :: HashTable s k v -&gt; Word -&gt; ST s (Maybe (Word, k, v))
</span><a href="Data.HashTable.ST.Basic.html#nextByIndex"><span class="hs-identifier hs-var hs-var">nextByIndex</span></a></span></span><span> </span><span id="local-6989586621679080467"><span class="annot"><span class="annottext">HashTable s k v
</span><a href="#local-6989586621679080467"><span class="hs-identifier hs-var">htRef</span></a></span></span><span> </span><span id="local-6989586621679080466"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679080466"><span class="hs-identifier hs-var">i0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashTable s k v -&gt; ST s (HashTable_ s k v)
forall s k v. HashTable s k v -&gt; ST s (HashTable_ s k v)
</span><a href="Data.HashTable.ST.Basic.html#readRef"><span class="hs-identifier hs-var">readRef</span></a></span><span> </span><span class="annot"><span class="annottext">HashTable s k v
</span><a href="#local-6989586621679080467"><span class="hs-identifier hs-var">htRef</span></a></span><span> </span><span class="annot"><span class="annottext">ST s (HashTable_ s k v)
-&gt; (HashTable_ s k v -&gt; ST s (Maybe (Word, k, v)))
-&gt; ST s (Maybe (Word, k, v))
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">HashTable_ s k v -&gt; ST s (Maybe (Word, k, v))
forall a s k v. Num a =&gt; HashTable_ s k v -&gt; ST s (Maybe (a, k, v))
</span><a href="#local-6989586621679080465"><span class="hs-identifier hs-var">work</span></a></span><span>
</span><span id="line-822"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-823"></span><span>    </span><span id="local-6989586621679080465"><span class="annot"><span class="annottext">work :: HashTable_ s k v -&gt; ST s (Maybe (a, k, v))
</span><a href="#local-6989586621679080465"><span class="hs-identifier hs-var hs-var">work</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a></span><span> </span><span id="local-6989586621679080464"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080464"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span class="annot"><span class="annottext">SizeRefs s
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679080463"><span class="annot"><span class="annottext">IntArray s
</span><a href="#local-6989586621679080463"><span class="hs-identifier hs-var">hashes</span></a></span></span><span> </span><span id="local-6989586621679080462"><span class="annot"><span class="annottext">MutableArray s k
</span><a href="#local-6989586621679080462"><span class="hs-identifier hs-var">keys</span></a></span></span><span> </span><span id="local-6989586621679080461"><span class="annot"><span class="annottext">MutableArray s v
</span><a href="#local-6989586621679080461"><span class="hs-identifier hs-var">values</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s (Maybe (a, k, v))
forall a. Num a =&gt; Int -&gt; ST s (Maybe (a, k, v))
</span><a href="#local-6989586621679080460"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679080466"><span class="hs-identifier hs-var">i0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-824"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-825"></span><span>        </span><span id="local-6989586621679080460"><span class="annot"><span class="annottext">go :: Int -&gt; ST s (Maybe (a, k, v))
</span><a href="#local-6989586621679080460"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679080459"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080459"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080459"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080464"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (a, k, v) -&gt; ST s (Maybe (a, k, v))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (a, k, v)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-826"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-827"></span><span>            </span><span id="local-6989586621679080458"><span class="annot"><span class="annottext">Elem
</span><a href="#local-6989586621679080458"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IntArray s -&gt; Int -&gt; ST s Elem
forall s. IntArray s -&gt; Int -&gt; ST s Elem
</span><a href="Data.HashTable.Internal.IntArray.html#readArray"><span class="hs-identifier hs-var">U.readArray</span></a></span><span> </span><span class="annot"><span class="annottext">IntArray s
</span><a href="#local-6989586621679080463"><span class="hs-identifier hs-var">hashes</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080459"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-828"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Elem -&gt; Bool
</span><a href="Data.HashTable.ST.Basic.html#recordIsEmpty"><span class="hs-identifier hs-var">recordIsEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="#local-6989586621679080458"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Elem -&gt; Bool
</span><a href="Data.HashTable.ST.Basic.html#recordIsDeleted"><span class="hs-identifier hs-var">recordIsDeleted</span></a></span><span> </span><span class="annot"><span class="annottext">Elem
</span><a href="#local-6989586621679080458"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-829"></span><span>              </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s (Maybe (a, k, v))
</span><a href="#local-6989586621679080460"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080459"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-830"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-831"></span><span>                </span><span id="local-6989586621679080457"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679080457"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutableArray s k -&gt; Int -&gt; ST s k
forall s a. MutableArray s a -&gt; Int -&gt; ST s a
</span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s k
</span><a href="#local-6989586621679080462"><span class="hs-identifier hs-var">keys</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080459"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-832"></span><span>                </span><span id="local-6989586621679080456"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679080456"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutableArray s v -&gt; Int -&gt; ST s v
forall s a. MutableArray s a -&gt; Int -&gt; ST s a
</span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray s v
</span><a href="#local-6989586621679080461"><span class="hs-identifier hs-var">values</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080459"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-833"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679080455"><span class="annot"><span class="annottext">i' :: a
</span><a href="#local-6989586621679080455"><span class="hs-identifier hs-var hs-var">i'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; a
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080459"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-834"></span><span>                </span><span class="annot"><span class="annottext">Maybe (a, k, v) -&gt; ST s (Maybe (a, k, v))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a, k, v) -&gt; Maybe (a, k, v)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679080455"><span class="hs-identifier hs-var">i'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679080457"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679080456"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-835"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.HashTable.ST.Basic.html#nextByIndex"><span class="hs-pragma hs-type">nextByIndex</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-836"></span></pre></body></html>