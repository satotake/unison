<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span id="%24con2tag_Byw5QoB6NOQFZMF9Ngyyuc"><span id="%24con2tag_1VF6kvW6HEx6bkhd3Vx3r5"></span></span><span class="hs-pragma">{-# LANGUAGE AllowAmbiguousTypes #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE ViewPatterns #-}</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Unison.Server.Backend</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_2</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">over</span></span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Error.Util</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(??)</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">hush</span></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span>
</span><span id="line-14"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">ExceptT</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><span class="hs-identifier">throwError</span></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bifunctor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">first</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">bimap</span></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List.Extra</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">nubOrd</span></span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Containers.ListUtils</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">nubOrdOn</span></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Text</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Tuple.Extra</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">dupe</span></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Text.FuzzyFind</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">FZF</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.ABT</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ABT</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Builtin.html"><span class="hs-identifier">Unison.Builtin</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">B</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Builtin.Decls.html"><span class="hs-identifier">Unison.Builtin.Decls</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Decls</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Codebase.Runtime.html"><span class="hs-identifier">Unison.Codebase.Runtime</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Rt</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Runtime.IOSource.html"><span class="hs-identifier">Unison.Runtime.IOSource</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DD</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Codebase.html"><span class="hs-identifier">Unison.Codebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Type.html#Codebase"><span class="hs-identifier">Codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Codebase.html"><span class="hs-identifier">Unison.Codebase</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Codebase</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Codebase.Branch.html"><span class="hs-identifier">Unison.Codebase.Branch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Branch.html#Branch"><span class="hs-identifier">Branch</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Codebase.Branch.html#Branch0"><span class="hs-identifier">Branch0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Codebase.Branch.html"><span class="hs-identifier">Unison.Codebase.Branch</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Branch</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Codebase.Branch.Names.html"><span class="hs-identifier">Unison.Codebase.Branch.Names</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Branch</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Codebase.Causal.html"><span class="hs-identifier">Unison.Codebase.Causal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Causal.html#RawHash"><span class="hs-identifier">RawHash</span></a></span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Causal.html#RawHash"><span class="hs-identifier">RawHash</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.DisplayObject.html"><span class="hs-identifier">Unison.Codebase.Editor.DisplayObject</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Codebase.Metadata.html"><span class="hs-identifier">Unison.Codebase.Metadata</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Metadata</span></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Codebase.Path.html"><span class="hs-identifier">Unison.Codebase.Path</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Path.html#Path"><span class="hs-identifier">Path</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Codebase.Path.html"><span class="hs-identifier">Unison.Codebase.Path</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Path</span></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Codebase.ShortBranchHash.html"><span class="hs-identifier">Unison.Codebase.ShortBranchHash</span></a></span><span>
</span><span id="line-42"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Unison.Codebase.ShortBranchHash.html#ShortBranchHash"><span class="hs-identifier">ShortBranchHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Codebase.ShortBranchHash.html"><span class="hs-identifier">Unison.Codebase.ShortBranchHash</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SBH</span></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.DataDeclaration</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DD</span></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.DeclPrinter.html"><span class="hs-identifier">Unison.DeclPrinter</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DeclPrinter</span></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.HashQualified</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HQ</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.HashQualified'</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HQ'</span></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Name</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Name</span></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Name</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Name</span></span><span>
</span><span id="line-51"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">unsafeFromText</span></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Name</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Name</span></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.NamePrinter.html"><span class="hs-identifier">Unison.NamePrinter</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NP</span></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.NameSegment</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NameSegment</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.NameSegment</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NameSegment</span></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Names</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Names</span></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.NamesWithHistory</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">NamesWithHistory</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.NamesWithHistory</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NamesWithHistory</span></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Names</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Names</span></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Parser.Ann.html"><span class="hs-identifier">Unison.Parser.Ann</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Parser.Ann.html#Ann"><span class="hs-identifier">Ann</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Prelude</span></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.PrettyPrintEnv.html"><span class="hs-identifier">Unison.PrettyPrintEnv</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PPE</span></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.PrettyPrintEnvDecl.html"><span class="hs-identifier">Unison.PrettyPrintEnvDecl</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PPE</span></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.PrettyPrintEnvDecl.Names.html"><span class="hs-identifier">Unison.PrettyPrintEnvDecl.Names</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PPE</span></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Reference</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Reference</span></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Reference</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Reference</span></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Referent</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Referent</span></span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Referent</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Referent</span></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.QueryResult.html"><span class="hs-identifier">Unison.Server.QueryResult</span></a></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Server.SearchResult.html"><span class="hs-identifier">Unison.Server.SearchResult</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SR</span></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Server.SearchResult'.html"><span class="hs-identifier">Unison.Server.SearchResult'</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SR'</span></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Server.Syntax.html"><span class="hs-identifier">Unison.Server.Syntax</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Syntax</span></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Types.html"><span class="hs-identifier">Unison.Server.Types</span></a></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.ShortHash</span></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Term</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Term</span></span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Term</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Term</span></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.TermPrinter.html"><span class="hs-identifier">Unison.TermPrinter</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TermPrinter</span></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Type</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Type</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Type</span></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.TypePrinter.html"><span class="hs-identifier">Unison.TypePrinter</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TypePrinter</span></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Typechecker.html"><span class="hs-identifier">Unison.Typechecker</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Typechecker</span></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">uniqueBy</span></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Util.Pretty.html"><span class="hs-identifier">Unison.Util.Pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Util.Pretty.html#Width"><span class="hs-identifier">Width</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Util.Pretty.html"><span class="hs-identifier">Unison.Util.Pretty</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Pretty</span></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Relation</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">R</span></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Util.Star3.html"><span class="hs-identifier">Unison.Util.Star3</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Star3</span></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Util.SyntaxText.html"><span class="hs-identifier">Unison.Util.SyntaxText</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UST</span></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Var</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Var</span></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Server.Doc.html"><span class="hs-identifier">Unison.Server.Doc</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Doc</span></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.DisplayObject.html"><span class="hs-identifier">Unison.Codebase.Editor.DisplayObject</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DisplayObject</span></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.WatchKind</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">WK</span></span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.PrettyPrintEnv.Util.html"><span class="hs-identifier">Unison.PrettyPrintEnv.Util</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PPE</span></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Hashing.V2.Convert.html"><span class="hs-identifier">Unison.Hashing.V2.Convert</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Hashing</span></span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span class="hs-keyword">type</span><span> </span><span id="SyntaxText"><span class="annot"><a href="Unison.Server.Backend.html#SyntaxText"><span class="hs-identifier hs-var">SyntaxText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Unison.Util.SyntaxText.html#SyntaxText%27"><span class="hs-identifier hs-type">UST.SyntaxText'</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span id="local-6989586621682022785"><span id="local-6989586621682022786"></span></span><span class="hs-keyword">data</span><span> </span><span id="ShallowListEntry"><span class="annot"><a href="Unison.Server.Backend.html#ShallowListEntry"><span class="hs-identifier hs-var">ShallowListEntry</span></a></span></span><span> </span><span id="local-6989586621682023110"><span class="annot"><a href="#local-6989586621682023110"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span id="local-6989586621682023109"><span class="annot"><a href="#local-6989586621682023109"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-99"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="ShallowTermEntry"><span class="annot"><a href="Unison.Server.Backend.html#ShallowTermEntry"><span class="hs-identifier hs-var">ShallowTermEntry</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Backend.html#TermEntry"><span class="hs-identifier hs-type">TermEntry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682023110"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682023109"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="ShallowTypeEntry"><span class="annot"><a href="Unison.Server.Backend.html#ShallowTypeEntry"><span class="hs-identifier hs-var">ShallowTypeEntry</span></a></span></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#TypeEntry"><span class="hs-identifier hs-type">TypeEntry</span></a></span><span>
</span><span id="line-101"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- The integer here represents the number of children</span><span>
</span><span id="line-102"></span><span>    </span><span id="ShallowBranchEntry"><span class="annot"><a href="Unison.Server.Backend.html#ShallowBranchEntry"><span class="hs-identifier hs-var">ShallowBranchEntry</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span> </span><span class="annot"><a href="Unison.Codebase.ShortBranchHash.html#ShortBranchHash"><span class="hs-identifier hs-type">ShortBranchHash</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="ShallowPatchEntry"><span class="annot"><a href="Unison.Server.Backend.html#ShallowPatchEntry"><span class="hs-identifier hs-var">ShallowPatchEntry</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682022777"><span id="local-6989586621682022779"><span class="annot"><span class="annottext">ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
(ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool)
-&gt; (ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool)
-&gt; Eq (ShallowListEntry v a)
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
forall v a.
Var v =&gt;
ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
/= :: ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
$c/= :: forall v a.
Var v =&gt;
ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
== :: ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
$c== :: forall v a.
Var v =&gt;
ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682022761"><span id="local-6989586621682022763"><span id="local-6989586621682022765"><span id="local-6989586621682022767"><span id="local-6989586621682022769"><span id="local-6989586621682022771"><span id="local-6989586621682022773"><span class="annot"><span class="annottext">Eq (ShallowListEntry v a)
Eq (ShallowListEntry v a)
-&gt; (ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Ordering)
-&gt; (ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool)
-&gt; (ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool)
-&gt; (ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool)
-&gt; (ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool)
-&gt; (ShallowListEntry v a
    -&gt; ShallowListEntry v a -&gt; ShallowListEntry v a)
-&gt; (ShallowListEntry v a
    -&gt; ShallowListEntry v a -&gt; ShallowListEntry v a)
-&gt; Ord (ShallowListEntry v a)
ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Ordering
ShallowListEntry v a
-&gt; ShallowListEntry v a -&gt; ShallowListEntry v a
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
forall v a. Var v =&gt; Eq (ShallowListEntry v a)
forall v a.
Var v =&gt;
ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
forall v a.
Var v =&gt;
ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Ordering
forall v a.
Var v =&gt;
ShallowListEntry v a
-&gt; ShallowListEntry v a -&gt; ShallowListEntry v a
min :: ShallowListEntry v a
-&gt; ShallowListEntry v a -&gt; ShallowListEntry v a
$cmin :: forall v a.
Var v =&gt;
ShallowListEntry v a
-&gt; ShallowListEntry v a -&gt; ShallowListEntry v a
max :: ShallowListEntry v a
-&gt; ShallowListEntry v a -&gt; ShallowListEntry v a
$cmax :: forall v a.
Var v =&gt;
ShallowListEntry v a
-&gt; ShallowListEntry v a -&gt; ShallowListEntry v a
&gt;= :: ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
$c&gt;= :: forall v a.
Var v =&gt;
ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
&gt; :: ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
$c&gt; :: forall v a.
Var v =&gt;
ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
&lt;= :: ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
$c&lt;= :: forall v a.
Var v =&gt;
ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
&lt; :: ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
$c&lt; :: forall v a.
Var v =&gt;
ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Bool
compare :: ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Ordering
$ccompare :: forall v a.
Var v =&gt;
ShallowListEntry v a -&gt; ShallowListEntry v a -&gt; Ordering
$cp1Ord :: forall v a. Var v =&gt; Eq (ShallowListEntry v a)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682022754"><span id="local-6989586621682022756"><span id="local-6989586621682022758"><span class="annot"><span class="annottext">Int -&gt; ShallowListEntry v a -&gt; ShowS
[ShallowListEntry v a] -&gt; ShowS
ShallowListEntry v a -&gt; String
(Int -&gt; ShallowListEntry v a -&gt; ShowS)
-&gt; (ShallowListEntry v a -&gt; String)
-&gt; ([ShallowListEntry v a] -&gt; ShowS)
-&gt; Show (ShallowListEntry v a)
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall v a. Show v =&gt; Int -&gt; ShallowListEntry v a -&gt; ShowS
forall v a. Show v =&gt; [ShallowListEntry v a] -&gt; ShowS
forall v a. Show v =&gt; ShallowListEntry v a -&gt; String
showList :: [ShallowListEntry v a] -&gt; ShowS
$cshowList :: forall v a. Show v =&gt; [ShallowListEntry v a] -&gt; ShowS
show :: ShallowListEntry v a -&gt; String
$cshow :: forall v a. Show v =&gt; ShallowListEntry v a -&gt; String
showsPrec :: Int -&gt; ShallowListEntry v a -&gt; ShowS
$cshowsPrec :: forall v a. Show v =&gt; Int -&gt; ShallowListEntry v a -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. ShallowListEntry v a -&gt; Rep (ShallowListEntry v a) x)
-&gt; (forall x. Rep (ShallowListEntry v a) x -&gt; ShallowListEntry v a)
-&gt; Generic (ShallowListEntry v a)
forall x. Rep (ShallowListEntry v a) x -&gt; ShallowListEntry v a
forall x. ShallowListEntry v a -&gt; Rep (ShallowListEntry v a) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall v a x. Rep (ShallowListEntry v a) x -&gt; ShallowListEntry v a
forall v a x. ShallowListEntry v a -&gt; Rep (ShallowListEntry v a) x
$cto :: forall v a x. Rep (ShallowListEntry v a) x -&gt; ShallowListEntry v a
$cfrom :: forall v a x. ShallowListEntry v a -&gt; Rep (ShallowListEntry v a) x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span id="local-6989586621682023091"><span id="local-6989586621682023092"><span class="annot"><a href="Unison.Server.Backend.html#listEntryName"><span class="hs-identifier hs-type">listEntryName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#ShallowListEntry"><span class="hs-identifier hs-type">ShallowListEntry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682023092"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682023091"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span></span></span><span>
</span><span id="line-107"></span><span id="listEntryName"><span class="annot"><span class="annottext">listEntryName :: ShallowListEntry v a -&gt; Text
</span><a href="Unison.Server.Backend.html#listEntryName"><span class="hs-identifier hs-var hs-var">listEntryName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-108"></span><span>  </span><span class="annot"><a href="Unison.Server.Backend.html#ShallowTermEntry"><span class="hs-identifier hs-type">ShallowTermEntry</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Backend.html#TermEntry"><span class="hs-identifier hs-type">TermEntry</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682022747"><span class="annot"><span class="annottext">HQSegment
</span><a href="#local-6989586621682022747"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (Type v a)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe TermTag
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HQSegment -&gt; Text
forall n. Show n =&gt; HashQualified n -&gt; Text
</span><span class="hs-identifier hs-var">HQ'.toText</span></span><span> </span><span class="annot"><span class="annottext">HQSegment
</span><a href="#local-6989586621682022747"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-109"></span><span>  </span><span class="annot"><a href="Unison.Server.Backend.html#ShallowTypeEntry"><span class="hs-identifier hs-type">ShallowTypeEntry</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Backend.html#TypeEntry"><span class="hs-identifier hs-type">TypeEntry</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682022744"><span class="annot"><span class="annottext">HQSegment
</span><a href="#local-6989586621682022744"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="annot"><span class="annottext">TypeTag
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HQSegment -&gt; Text
forall n. Show n =&gt; HashQualified n -&gt; Text
</span><span class="hs-identifier hs-var">HQ'.toText</span></span><span> </span><span class="annot"><span class="annottext">HQSegment
</span><a href="#local-6989586621682022744"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-110"></span><span>  </span><span class="annot"><a href="Unison.Server.Backend.html#ShallowBranchEntry"><span class="hs-identifier hs-type">ShallowBranchEntry</span></a></span><span> </span><span id="local-6989586621682022743"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621682022743"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">ShortBranchHash
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NameSegment -&gt; Text
</span><span class="hs-identifier hs-var hs-var">NameSegment.toText</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621682022743"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-111"></span><span>  </span><span class="annot"><a href="Unison.Server.Backend.html#ShallowPatchEntry"><span class="hs-identifier hs-type">ShallowPatchEntry</span></a></span><span> </span><span id="local-6989586621682022741"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621682022741"><span class="hs-identifier hs-var">n</span></a></span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NameSegment -&gt; Text
</span><span class="hs-identifier hs-var hs-var">NameSegment.toText</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621682022741"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span class="hs-keyword">data</span><span> </span><span id="BackendError"><span class="annot"><a href="Unison.Server.Backend.html#BackendError"><span class="hs-identifier hs-var">BackendError</span></a></span></span><span>
</span><span id="line-114"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="NoSuchNamespace"><span class="annot"><a href="Unison.Server.Backend.html#NoSuchNamespace"><span class="hs-identifier hs-var">NoSuchNamespace</span></a></span></span><span> </span><span class="annot"><a href="Unison.Codebase.Path.html#Absolute"><span class="hs-identifier hs-type">Path.Absolute</span></a></span><span>
</span><span id="line-115"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="BadRootBranch"><span class="annot"><a href="Unison.Server.Backend.html#BadRootBranch"><span class="hs-identifier hs-var">BadRootBranch</span></a></span></span><span> </span><span class="annot"><a href="Unison.Codebase.Type.html#GetRootBranchError"><span class="hs-identifier hs-type">Codebase.GetRootBranchError</span></a></span><span>
</span><span id="line-116"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="CouldntExpandBranchHash"><span class="annot"><a href="Unison.Server.Backend.html#CouldntExpandBranchHash"><span class="hs-identifier hs-var">CouldntExpandBranchHash</span></a></span></span><span> </span><span class="annot"><a href="Unison.Codebase.ShortBranchHash.html#ShortBranchHash"><span class="hs-identifier hs-type">ShortBranchHash</span></a></span><span>
</span><span id="line-117"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="AmbiguousBranchHash"><span class="annot"><a href="Unison.Server.Backend.html#AmbiguousBranchHash"><span class="hs-identifier hs-var">AmbiguousBranchHash</span></a></span></span><span> </span><span class="annot"><a href="Unison.Codebase.ShortBranchHash.html#ShortBranchHash"><span class="hs-identifier hs-type">ShortBranchHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Unison.Codebase.ShortBranchHash.html#ShortBranchHash"><span class="hs-identifier hs-type">ShortBranchHash</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="NoBranchForHash"><span class="annot"><a href="Unison.Server.Backend.html#NoBranchForHash"><span class="hs-identifier hs-var">NoBranchForHash</span></a></span></span><span> </span><span class="annot"><a href="Unison.Codebase.Branch.html#Hash"><span class="hs-identifier hs-type">Branch.Hash</span></a></span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="CouldntLoadBranch"><span class="annot"><a href="Unison.Server.Backend.html#CouldntLoadBranch"><span class="hs-identifier hs-var">CouldntLoadBranch</span></a></span></span><span> </span><span class="annot"><a href="Unison.Codebase.Branch.html#Hash"><span class="hs-identifier hs-type">Branch.Hash</span></a></span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="MissingSignatureForTerm"><span class="annot"><a href="Unison.Server.Backend.html#MissingSignatureForTerm"><span class="hs-identifier hs-var">MissingSignatureForTerm</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span class="hs-keyword">type</span><span> </span><span id="Backend"><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-var">Backend</span></a></span></span><span> </span><span id="local-6989586621682022733"><span class="annot"><a href="#local-6989586621682022733"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621682022732"><span class="annot"><a href="#local-6989586621682022732"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#BackendError"><span class="hs-identifier hs-type">BackendError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022733"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022732"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="hs-comment">-- implementation detail of basicParseNames and basicPrettyPrintNames</span><span>
</span><span id="line-125"></span><span id="local-6989586621682023310"><span class="annot"><a href="Unison.Server.Backend.html#basicNames%27"><span class="hs-identifier hs-type">basicNames'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Branch.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682023310"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Path.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-126"></span><span id="basicNames%27"><span class="annot"><span class="annottext">basicNames' :: Branch m -&gt; Path -&gt; (Names, Names)
</span><a href="Unison.Server.Backend.html#basicNames%27"><span class="hs-identifier hs-var hs-var">basicNames'</span></a></span></span><span> </span><span id="local-6989586621682022730"><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621682022730"><span class="hs-identifier hs-var">root</span></a></span></span><span> </span><span id="local-6989586621682022729"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621682022729"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621682022728"><span class="hs-identifier hs-var">parseNames0</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621682022727"><span class="hs-identifier hs-var">prettyPrintNames0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-128"></span><span>    </span><span id="local-6989586621682022726"><span class="annot"><span class="annottext">root0 :: Branch0 m
</span><a href="#local-6989586621682022726"><span class="hs-identifier hs-var hs-var">root0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Branch m -&gt; Branch0 m
forall (m :: * -&gt; *). Branch m -&gt; Branch0 m
</span><a href="Unison.Codebase.Branch.html#head"><span class="hs-identifier hs-var">Branch.head</span></a></span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621682022730"><span class="hs-identifier hs-var">root</span></a></span><span>
</span><span id="line-129"></span><span>    </span><span id="local-6989586621682022724"><span class="annot"><span class="annottext">currentBranch :: Branch m
</span><a href="#local-6989586621682022724"><span class="hs-identifier hs-var hs-var">currentBranch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Branch m -&gt; Maybe (Branch m) -&gt; Branch m
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Branch m
forall (m :: * -&gt; *). Branch m
</span><a href="Unison.Codebase.Branch.html#empty"><span class="hs-identifier hs-var">Branch.empty</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (Branch m) -&gt; Branch m) -&gt; Maybe (Branch m) -&gt; Branch m
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Path -&gt; Branch m -&gt; Maybe (Branch m)
forall (m :: * -&gt; *). Path -&gt; Branch m -&gt; Maybe (Branch m)
</span><a href="Unison.Codebase.Branch.html#getAt"><span class="hs-identifier hs-var">Branch.getAt</span></a></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621682022729"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621682022730"><span class="hs-identifier hs-var">root</span></a></span><span>
</span><span id="line-130"></span><span>    </span><span id="local-6989586621682022720"><span class="annot"><span class="annottext">absoluteRootNames :: Names
</span><a href="#local-6989586621682022720"><span class="hs-identifier hs-var hs-var">absoluteRootNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names
</span><span class="hs-identifier hs-var">Names.makeAbsolute</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch0 m -&gt; Names
forall (m :: * -&gt; *). Branch0 m -&gt; Names
</span><a href="Unison.Codebase.Branch.Names.html#toNames"><span class="hs-identifier hs-var">Branch.toNames</span></a></span><span> </span><span class="annot"><span class="annottext">Branch0 m
</span><a href="#local-6989586621682022726"><span class="hs-identifier hs-var">root0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>    </span><span id="local-6989586621682022717"><span class="annot"><span class="annottext">currentBranch0 :: Branch0 m
</span><a href="#local-6989586621682022717"><span class="hs-identifier hs-var hs-var">currentBranch0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Branch m -&gt; Branch0 m
forall (m :: * -&gt; *). Branch m -&gt; Branch0 m
</span><a href="Unison.Codebase.Branch.html#head"><span class="hs-identifier hs-var">Branch.head</span></a></span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621682022724"><span class="hs-identifier hs-var">currentBranch</span></a></span><span>
</span><span id="line-132"></span><span>    </span><span id="local-6989586621682022716"><span class="annot"><span class="annottext">currentPathNames :: Names
</span><a href="#local-6989586621682022716"><span class="hs-identifier hs-var hs-var">currentPathNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Branch0 m -&gt; Names
forall (m :: * -&gt; *). Branch0 m -&gt; Names
</span><a href="Unison.Codebase.Branch.Names.html#toNames"><span class="hs-identifier hs-var">Branch.toNames</span></a></span><span> </span><span class="annot"><span class="annottext">Branch0 m
</span><a href="#local-6989586621682022717"><span class="hs-identifier hs-var">currentBranch0</span></a></span><span>
</span><span id="line-133"></span><span>    </span><span class="hs-comment">-- all names, but with local names in their relative form only, rather</span><span>
</span><span id="line-134"></span><span>    </span><span class="hs-comment">-- than absolute; external names appear as absolute</span><span>
</span><span id="line-135"></span><span>    </span><span id="local-6989586621682022715"><span class="annot"><span class="annottext">currentAndExternalNames :: Names
</span><a href="#local-6989586621682022715"><span class="hs-identifier hs-var hs-var">currentAndExternalNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-136"></span><span>      </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621682022716"><span class="hs-identifier hs-var">currentPathNames</span></a></span><span>
</span><span id="line-137"></span><span>        </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
</span><span class="hs-operator hs-var">`Names.unionLeft`</span></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names
</span><a href="#local-6989586621682022713"><span class="hs-identifier hs-var">absDot</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621682022712"><span class="hs-identifier hs-var">externalNames</span></a></span><span>
</span><span id="line-138"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-139"></span><span>        </span><span id="local-6989586621682022713"><span class="annot"><span class="annottext">absDot :: Names -&gt; Names
</span><a href="#local-6989586621682022713"><span class="hs-identifier hs-var hs-var">absDot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Names -&gt; Names
</span><span class="hs-identifier hs-var">Names.prefix0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Name
</span><span class="hs-identifier hs-var">Name.unsafeFromText</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>        </span><span id="local-6989586621682022712"><span class="annot"><span class="annottext">externalNames :: Names
</span><a href="#local-6989586621682022712"><span class="hs-identifier hs-var hs-var">externalNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621682022710"><span class="hs-identifier hs-var">rootNames</span></a></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
</span><span class="hs-operator hs-var">`Names.difference`</span></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names
</span><a href="#local-6989586621682022708"><span class="hs-identifier hs-var">pathPrefixed</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621682022716"><span class="hs-identifier hs-var">currentPathNames</span></a></span><span>
</span><span id="line-141"></span><span>        </span><span id="local-6989586621682022710"><span class="annot"><span class="annottext">rootNames :: Names
</span><a href="#local-6989586621682022710"><span class="hs-identifier hs-var hs-var">rootNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Branch0 m -&gt; Names
forall (m :: * -&gt; *). Branch0 m -&gt; Names
</span><a href="Unison.Codebase.Branch.Names.html#toNames"><span class="hs-identifier hs-var">Branch.toNames</span></a></span><span> </span><span class="annot"><span class="annottext">Branch0 m
</span><a href="#local-6989586621682022726"><span class="hs-identifier hs-var">root0</span></a></span><span>
</span><span id="line-142"></span><span>        </span><span id="local-6989586621682022708"><span class="annot"><span class="annottext">pathPrefixed :: Names -&gt; Names
</span><a href="#local-6989586621682022708"><span class="hs-identifier hs-var hs-var">pathPrefixed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621682022729"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-143"></span><span>          </span><span class="annot"><a href="Unison.Codebase.Path.html#Path"><span class="hs-identifier hs-type">Path.Path</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Seq NameSegment -&gt; [NameSegment]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Names
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-144"></span><span>          </span><span id="local-6989586621682022704"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621682022704"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Names -&gt; Names
</span><span class="hs-identifier hs-var">Names.prefix0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path -&gt; Name
</span><a href="Unison.Codebase.Path.html#toName"><span class="hs-identifier hs-var">Path.toName</span></a></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621682022704"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>    </span><span class="hs-comment">-- parsing should respond to local and absolute names</span><span>
</span><span id="line-146"></span><span>    </span><span id="local-6989586621682022728"><span class="annot"><span class="annottext">parseNames0 :: Names
</span><a href="#local-6989586621682022728"><span class="hs-identifier hs-var hs-var">parseNames0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621682022716"><span class="hs-identifier hs-var">currentPathNames</span></a></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621682022720"><span class="hs-identifier hs-var">absoluteRootNames</span></a></span><span>
</span><span id="line-147"></span><span>    </span><span class="hs-comment">-- pretty-printing should use local names where available</span><span>
</span><span id="line-148"></span><span>    </span><span id="local-6989586621682022727"><span class="annot"><span class="annottext">prettyPrintNames0 :: Names
</span><a href="#local-6989586621682022727"><span class="hs-identifier hs-var hs-var">prettyPrintNames0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621682022715"><span class="hs-identifier hs-var">currentAndExternalNames</span></a></span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span id="local-6989586621682022702"><span class="annot"><a href="Unison.Server.Backend.html#basicSuffixifiedNames"><span class="hs-identifier hs-type">basicSuffixifiedNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Branch.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022702"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Path.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.PrettyPrintEnv.html#PrettyPrintEnv"><span class="hs-identifier hs-type">PPE.PrettyPrintEnv</span></a></span></span><span>
</span><span id="line-151"></span><span id="basicSuffixifiedNames"><span class="annot"><span class="annottext">basicSuffixifiedNames :: Int -&gt; Branch m -&gt; Path -&gt; PrettyPrintEnv
</span><a href="Unison.Server.Backend.html#basicSuffixifiedNames"><span class="hs-identifier hs-var hs-var">basicSuffixifiedNames</span></a></span></span><span> </span><span id="local-6989586621682022700"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682022700"><span class="hs-identifier hs-var">hashLength</span></a></span></span><span> </span><span id="local-6989586621682022699"><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621682022699"><span class="hs-identifier hs-var">root</span></a></span></span><span> </span><span id="local-6989586621682022698"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621682022698"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-152"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682022697"><span class="annot"><span class="annottext">names0 :: Names
</span><a href="#local-6989586621682022697"><span class="hs-identifier hs-var hs-var">names0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Branch m -&gt; Path -&gt; Names
forall (m :: * -&gt; *). Branch m -&gt; Path -&gt; Names
</span><a href="Unison.Server.Backend.html#basicPrettyPrintNames"><span class="hs-identifier hs-var">basicPrettyPrintNames</span></a></span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621682022699"><span class="hs-identifier hs-var">root</span></a></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621682022698"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-153"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><a href="Unison.PrettyPrintEnvDecl.html#suffixifiedPPE"><span class="hs-identifier hs-var hs-var">PPE.suffixifiedPPE</span></a></span><span> </span><span class="annot"><span class="annottext">(PrettyPrintEnvDecl -&gt; PrettyPrintEnv)
-&gt; (NamesWithHistory -&gt; PrettyPrintEnvDecl)
-&gt; NamesWithHistory
-&gt; PrettyPrintEnv
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; NamesWithHistory -&gt; PrettyPrintEnvDecl
</span><a href="Unison.PrettyPrintEnvDecl.Names.html#fromNamesDecl"><span class="hs-identifier hs-var">PPE.fromNamesDecl</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682022700"><span class="hs-identifier hs-var">hashLength</span></a></span><span> </span><span class="annot"><span class="annottext">(NamesWithHistory -&gt; PrettyPrintEnv)
-&gt; NamesWithHistory -&gt; PrettyPrintEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; NamesWithHistory
</span><span class="hs-identifier hs-var">NamesWithHistory</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621682022697"><span class="hs-identifier hs-var">names0</span></a></span><span> </span><span class="annot"><span class="annottext">Names
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span id="local-6989586621682023319"><span class="annot"><a href="Unison.Server.Backend.html#basicPrettyPrintNames"><span class="hs-identifier hs-type">basicPrettyPrintNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Branch.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682023319"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Path.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span></span><span>
</span><span id="line-156"></span><span id="basicPrettyPrintNames"><span class="annot"><span class="annottext">basicPrettyPrintNames :: Branch m -&gt; Path -&gt; Names
</span><a href="Unison.Server.Backend.html#basicPrettyPrintNames"><span class="hs-identifier hs-var hs-var">basicPrettyPrintNames</span></a></span></span><span> </span><span id="local-6989586621682022691"><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621682022691"><span class="hs-identifier hs-var">root</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Names, Names) -&gt; Names
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((Names, Names) -&gt; Names)
-&gt; (Path -&gt; (Names, Names)) -&gt; Path -&gt; Names
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Branch m -&gt; Path -&gt; (Names, Names)
forall (m :: * -&gt; *). Branch m -&gt; Path -&gt; (Names, Names)
</span><a href="Unison.Server.Backend.html#basicNames%27"><span class="hs-identifier hs-var">basicNames'</span></a></span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621682022691"><span class="hs-identifier hs-var">root</span></a></span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span id="local-6989586621682022690"><span class="annot"><a href="Unison.Server.Backend.html#basicParseNames"><span class="hs-identifier hs-type">basicParseNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Branch.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022690"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Path.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span></span><span>
</span><span id="line-159"></span><span id="basicParseNames"><span class="annot"><span class="annottext">basicParseNames :: Branch m -&gt; Path -&gt; Names
</span><a href="Unison.Server.Backend.html#basicParseNames"><span class="hs-identifier hs-var hs-var">basicParseNames</span></a></span></span><span> </span><span id="local-6989586621682022688"><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621682022688"><span class="hs-identifier hs-var">root</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Names, Names) -&gt; Names
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((Names, Names) -&gt; Names)
-&gt; (Path -&gt; (Names, Names)) -&gt; Path -&gt; Names
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Branch m -&gt; Path -&gt; (Names, Names)
forall (m :: * -&gt; *). Branch m -&gt; Path -&gt; (Names, Names)
</span><a href="Unison.Server.Backend.html#basicNames%27"><span class="hs-identifier hs-var">basicNames'</span></a></span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621682022688"><span class="hs-identifier hs-var">root</span></a></span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span id="local-6989586621682023171"><span id="local-6989586621682023172"><span class="annot"><a href="Unison.Server.Backend.html#loadReferentType"><span class="hs-identifier hs-type">loadReferentType</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-162"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Applicative</span></span><span> </span><span class="annot"><a href="#local-6989586621682023172"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621682023171"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-163"></span><span>  </span><span class="annot"><a href="Unison.Codebase.Type.html#Codebase"><span class="hs-identifier hs-type">Codebase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682023172"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682023171"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="Unison.Parser.Ann.html#Ann"><span class="hs-identifier hs-type">Ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-164"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-165"></span><span>  </span><span class="annot"><a href="#local-6989586621682023172"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621682023171"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="Unison.Parser.Ann.html#Ann"><span class="hs-identifier hs-type">Ann</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-166"></span><span id="loadReferentType"><span class="annot"><span class="annottext">loadReferentType :: Codebase m v Ann -&gt; Referent -&gt; m (Maybe (Type v Ann))
</span><a href="Unison.Server.Backend.html#loadReferentType"><span class="hs-identifier hs-var hs-var">loadReferentType</span></a></span></span><span> </span><span id="local-6989586621682022686"><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621682022686"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-167"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Referent.Ref</span></span><span> </span><span id="local-6989586621682022684"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022684"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann -&gt; Reference -&gt; m (Maybe (Type v Ann))
forall (m :: * -&gt; *) v a.
(Applicative m, Var v, BuiltinAnnotation a) =&gt;
Codebase m v a -&gt; Reference -&gt; m (Maybe (Type v a))
</span><a href="Unison.Codebase.html#getTypeOfTerm"><span class="hs-identifier hs-var">Codebase.getTypeOfTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621682022686"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022684"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-168"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Referent.Con</span></span><span> </span><span id="local-6989586621682022681"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022681"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682022680"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682022680"><span class="hs-identifier hs-var">cid</span></a></span></span><span> </span><span class="annot"><span class="annottext">ConstructorType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Int -&gt; m (Maybe (Type v Ann))
</span><a href="#local-6989586621682022679"><span class="hs-identifier hs-var">getTypeOfConstructor</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022681"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682022680"><span class="hs-identifier hs-var">cid</span></a></span><span>
</span><span id="line-169"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-170"></span><span>    </span><span id="local-6989586621682022679"><span class="annot"><span class="annottext">getTypeOfConstructor :: Reference -&gt; Int -&gt; m (Maybe (Type v Ann))
</span><a href="#local-6989586621682022679"><span class="hs-identifier hs-var hs-var">getTypeOfConstructor</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reference.DerivedId</span></span><span> </span><span id="local-6989586621682022677"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682022677"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682022676"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682022676"><span class="hs-identifier hs-var">cid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-171"></span><span>      </span><span id="local-6989586621682022675"><span class="annot"><span class="annottext">Maybe (Decl v Ann)
</span><a href="#local-6989586621682022675"><span class="hs-identifier hs-var">maybeDecl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann -&gt; Id -&gt; m (Maybe (Decl v Ann))
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; Id -&gt; m (Maybe (Decl v a))
</span><a href="Unison.Codebase.Type.html#getTypeDeclaration"><span class="hs-identifier hs-var hs-var">Codebase.getTypeDeclaration</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621682022686"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682022677"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-172"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Decl v Ann)
</span><a href="#local-6989586621682022675"><span class="hs-identifier hs-var">maybeDecl</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-173"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Decl v Ann)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Type v Ann)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-174"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682022673"><span class="annot"><span class="annottext">Decl v Ann
</span><a href="#local-6989586621682022673"><span class="hs-identifier hs-var">decl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DataDeclaration v Ann -&gt; Int -&gt; Maybe (Type v Ann)
forall v a. DataDeclaration v a -&gt; Int -&gt; Maybe (Type v a)
</span><span class="hs-identifier hs-var">DD.typeOfConstructor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(EffectDeclaration v Ann -&gt; DataDeclaration v Ann)
-&gt; (DataDeclaration v Ann -&gt; DataDeclaration v Ann)
-&gt; Decl v Ann
-&gt; DataDeclaration v Ann
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="annot"><span class="annottext">EffectDeclaration v Ann -&gt; DataDeclaration v Ann
forall v a. EffectDeclaration v a -&gt; DataDeclaration v a
</span><span class="hs-identifier hs-var hs-var">DD.toDataDecl</span></span><span> </span><span class="annot"><span class="annottext">DataDeclaration v Ann -&gt; DataDeclaration v Ann
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">Decl v Ann
</span><a href="#local-6989586621682022673"><span class="hs-identifier hs-var">decl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682022676"><span class="hs-identifier hs-var">cid</span></a></span><span>
</span><span id="line-175"></span><span>    </span><span class="annot"><a href="#local-6989586621682022679"><span class="hs-identifier hs-var">getTypeOfConstructor</span></a></span><span> </span><span id="local-6989586621682022668"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022668"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682022667"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682022667"><span class="hs-identifier hs-var">cid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-176"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; m (Maybe (Type v Ann))
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; m (Maybe (Type v Ann)))
-&gt; String -&gt; m (Maybe (Type v Ann))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-177"></span><span>        </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Don't know how to getTypeOfConstructor &quot;</span></span><span>
</span><span id="line-178"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022668"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-179"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; &quot;</span></span><span>
</span><span id="line-180"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682022667"><span class="hs-identifier hs-var">cid</span></a></span><span>
</span><span id="line-181"></span><span>
</span><span id="line-182"></span><span id="local-6989586621682023210"><span id="local-6989586621682023211"><span class="annot"><a href="Unison.Server.Backend.html#getRootBranch"><span class="hs-identifier hs-type">getRootBranch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="annot"><a href="#local-6989586621682023211"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Type.html#Codebase"><span class="hs-identifier hs-type">Codebase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682023211"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682023210"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="Unison.Parser.Ann.html#Ann"><span class="hs-identifier hs-type">Ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682023211"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Branch.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682023211"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-183"></span><span id="getRootBranch"><span class="annot"><span class="annottext">getRootBranch :: Codebase m v Ann -&gt; Backend m (Branch m)
</span><a href="Unison.Server.Backend.html#getRootBranch"><span class="hs-identifier hs-var hs-var">getRootBranch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-184"></span><span>  </span><span class="annot"><span class="annottext">m (Either BackendError (Branch m)) -&gt; Backend m (Branch m)
forall e (m :: * -&gt; *) a. m (Either e a) -&gt; ExceptT e m a
</span><span class="hs-identifier hs-var">ExceptT</span></span><span> </span><span class="annot"><span class="annottext">(m (Either BackendError (Branch m)) -&gt; Backend m (Branch m))
-&gt; (Codebase m v Ann -&gt; m (Either BackendError (Branch m)))
-&gt; Codebase m v Ann
-&gt; Backend m (Branch m)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GetRootBranchError -&gt; BackendError)
-&gt; Either GetRootBranchError (Branch m)
-&gt; Either BackendError (Branch m)
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="annot"><span class="annottext">GetRootBranchError -&gt; BackendError
</span><a href="Unison.Server.Backend.html#BadRootBranch"><span class="hs-identifier hs-var">BadRootBranch</span></a></span><span> </span><span class="annot"><span class="annottext">(Either GetRootBranchError (Branch m)
 -&gt; Either BackendError (Branch m))
-&gt; m (Either GetRootBranchError (Branch m))
-&gt; m (Either BackendError (Branch m))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m (Either GetRootBranchError (Branch m))
 -&gt; m (Either BackendError (Branch m)))
-&gt; (Codebase m v Ann -&gt; m (Either GetRootBranchError (Branch m)))
-&gt; Codebase m v Ann
-&gt; m (Either BackendError (Branch m))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann -&gt; m (Either GetRootBranchError (Branch m))
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; m (Either GetRootBranchError (Branch m))
</span><a href="Unison.Codebase.Type.html#getRootBranch"><span class="hs-identifier hs-var hs-var">Codebase.getRootBranch</span></a></span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span id="local-6989586621682022659"><span id="local-6989586621682022660"></span></span><span class="hs-keyword">data</span><span> </span><span id="TermEntry"><span class="annot"><a href="Unison.Server.Backend.html#TermEntry"><span class="hs-identifier hs-var">TermEntry</span></a></span></span><span> </span><span id="local-6989586621682023163"><span class="annot"><a href="#local-6989586621682023163"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span id="local-6989586621682023162"><span class="annot"><a href="#local-6989586621682023162"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TermEntry"><span class="annot"><a href="Unison.Server.Backend.html#TermEntry"><span class="hs-identifier hs-var">TermEntry</span></a></span></span><span>
</span><span id="line-187"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="termEntryReferent"><span class="annot"><span class="annottext">TermEntry v a -&gt; Referent
</span><a href="Unison.Server.Backend.html#termEntryReferent"><span class="hs-identifier hs-var hs-var">termEntryReferent</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span class="hs-special">,</span><span>
</span><span id="line-188"></span><span>    </span><span id="termEntryName"><span class="annot"><span class="annottext">TermEntry v a -&gt; HQSegment
</span><a href="Unison.Server.Backend.html#termEntryName"><span class="hs-identifier hs-var hs-var">termEntryName</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HQ'.HQSegment</span></span><span class="hs-special">,</span><span>
</span><span id="line-189"></span><span>    </span><span id="termEntryType"><span class="annot"><span class="annottext">TermEntry v a -&gt; Maybe (Type v a)
</span><a href="Unison.Server.Backend.html#termEntryType"><span class="hs-identifier hs-var hs-var">termEntryType</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621682023163"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682023162"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-190"></span><span>    </span><span id="termEntryTag"><span class="annot"><span class="annottext">TermEntry v a -&gt; Maybe TermTag
</span><a href="Unison.Server.Backend.html#termEntryTag"><span class="hs-identifier hs-var hs-var">termEntryTag</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Unison.Server.Types.html#TermTag"><span class="hs-identifier hs-type">TermTag</span></a></span><span>
</span><span id="line-191"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-192"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682022651"><span id="local-6989586621682022653"><span class="annot"><span class="annottext">TermEntry v a -&gt; TermEntry v a -&gt; Bool
(TermEntry v a -&gt; TermEntry v a -&gt; Bool)
-&gt; (TermEntry v a -&gt; TermEntry v a -&gt; Bool) -&gt; Eq (TermEntry v a)
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
forall v a. Var v =&gt; TermEntry v a -&gt; TermEntry v a -&gt; Bool
/= :: TermEntry v a -&gt; TermEntry v a -&gt; Bool
$c/= :: forall v a. Var v =&gt; TermEntry v a -&gt; TermEntry v a -&gt; Bool
== :: TermEntry v a -&gt; TermEntry v a -&gt; Bool
$c== :: forall v a. Var v =&gt; TermEntry v a -&gt; TermEntry v a -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682022636"><span id="local-6989586621682022638"><span id="local-6989586621682022640"><span id="local-6989586621682022642"><span id="local-6989586621682022644"><span id="local-6989586621682022646"><span id="local-6989586621682022648"><span class="annot"><span class="annottext">Eq (TermEntry v a)
Eq (TermEntry v a)
-&gt; (TermEntry v a -&gt; TermEntry v a -&gt; Ordering)
-&gt; (TermEntry v a -&gt; TermEntry v a -&gt; Bool)
-&gt; (TermEntry v a -&gt; TermEntry v a -&gt; Bool)
-&gt; (TermEntry v a -&gt; TermEntry v a -&gt; Bool)
-&gt; (TermEntry v a -&gt; TermEntry v a -&gt; Bool)
-&gt; (TermEntry v a -&gt; TermEntry v a -&gt; TermEntry v a)
-&gt; (TermEntry v a -&gt; TermEntry v a -&gt; TermEntry v a)
-&gt; Ord (TermEntry v a)
TermEntry v a -&gt; TermEntry v a -&gt; Bool
TermEntry v a -&gt; TermEntry v a -&gt; Ordering
TermEntry v a -&gt; TermEntry v a -&gt; TermEntry v a
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
forall v a. Var v =&gt; Eq (TermEntry v a)
forall v a. Var v =&gt; TermEntry v a -&gt; TermEntry v a -&gt; Bool
forall v a. Var v =&gt; TermEntry v a -&gt; TermEntry v a -&gt; Ordering
forall v a.
Var v =&gt;
TermEntry v a -&gt; TermEntry v a -&gt; TermEntry v a
min :: TermEntry v a -&gt; TermEntry v a -&gt; TermEntry v a
$cmin :: forall v a.
Var v =&gt;
TermEntry v a -&gt; TermEntry v a -&gt; TermEntry v a
max :: TermEntry v a -&gt; TermEntry v a -&gt; TermEntry v a
$cmax :: forall v a.
Var v =&gt;
TermEntry v a -&gt; TermEntry v a -&gt; TermEntry v a
&gt;= :: TermEntry v a -&gt; TermEntry v a -&gt; Bool
$c&gt;= :: forall v a. Var v =&gt; TermEntry v a -&gt; TermEntry v a -&gt; Bool
&gt; :: TermEntry v a -&gt; TermEntry v a -&gt; Bool
$c&gt; :: forall v a. Var v =&gt; TermEntry v a -&gt; TermEntry v a -&gt; Bool
&lt;= :: TermEntry v a -&gt; TermEntry v a -&gt; Bool
$c&lt;= :: forall v a. Var v =&gt; TermEntry v a -&gt; TermEntry v a -&gt; Bool
&lt; :: TermEntry v a -&gt; TermEntry v a -&gt; Bool
$c&lt; :: forall v a. Var v =&gt; TermEntry v a -&gt; TermEntry v a -&gt; Bool
compare :: TermEntry v a -&gt; TermEntry v a -&gt; Ordering
$ccompare :: forall v a. Var v =&gt; TermEntry v a -&gt; TermEntry v a -&gt; Ordering
$cp1Ord :: forall v a. Var v =&gt; Eq (TermEntry v a)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682022630"><span id="local-6989586621682022632"><span id="local-6989586621682022634"><span class="annot"><span class="annottext">Int -&gt; TermEntry v a -&gt; ShowS
[TermEntry v a] -&gt; ShowS
TermEntry v a -&gt; String
(Int -&gt; TermEntry v a -&gt; ShowS)
-&gt; (TermEntry v a -&gt; String)
-&gt; ([TermEntry v a] -&gt; ShowS)
-&gt; Show (TermEntry v a)
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall v a. Show v =&gt; Int -&gt; TermEntry v a -&gt; ShowS
forall v a. Show v =&gt; [TermEntry v a] -&gt; ShowS
forall v a. Show v =&gt; TermEntry v a -&gt; String
showList :: [TermEntry v a] -&gt; ShowS
$cshowList :: forall v a. Show v =&gt; [TermEntry v a] -&gt; ShowS
show :: TermEntry v a -&gt; String
$cshow :: forall v a. Show v =&gt; TermEntry v a -&gt; String
showsPrec :: Int -&gt; TermEntry v a -&gt; ShowS
$cshowsPrec :: forall v a. Show v =&gt; Int -&gt; TermEntry v a -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. TermEntry v a -&gt; Rep (TermEntry v a) x)
-&gt; (forall x. Rep (TermEntry v a) x -&gt; TermEntry v a)
-&gt; Generic (TermEntry v a)
forall x. Rep (TermEntry v a) x -&gt; TermEntry v a
forall x. TermEntry v a -&gt; Rep (TermEntry v a) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall v a x. Rep (TermEntry v a) x -&gt; TermEntry v a
forall v a x. TermEntry v a -&gt; Rep (TermEntry v a) x
$cto :: forall v a x. Rep (TermEntry v a) x -&gt; TermEntry v a
$cfrom :: forall v a x. TermEntry v a -&gt; Rep (TermEntry v a) x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span id="local-6989586621682022626"><span id="local-6989586621682022627"></span></span><span class="hs-keyword">data</span><span> </span><span id="TypeEntry"><span class="annot"><a href="Unison.Server.Backend.html#TypeEntry"><span class="hs-identifier hs-var">TypeEntry</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TypeEntry"><span class="annot"><a href="Unison.Server.Backend.html#TypeEntry"><span class="hs-identifier hs-var">TypeEntry</span></a></span></span><span>
</span><span id="line-195"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="typeEntryReference"><span class="annot"><span class="annottext">TypeEntry -&gt; Reference
</span><a href="Unison.Server.Backend.html#typeEntryReference"><span class="hs-identifier hs-var hs-var">typeEntryReference</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">,</span><span>
</span><span id="line-196"></span><span>    </span><span id="typeEntryName"><span class="annot"><span class="annottext">TypeEntry -&gt; HQSegment
</span><a href="Unison.Server.Backend.html#typeEntryName"><span class="hs-identifier hs-var hs-var">typeEntryName</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HQ'.HQSegment</span></span><span class="hs-special">,</span><span>
</span><span id="line-197"></span><span>    </span><span id="typeEntryTag"><span class="annot"><span class="annottext">TypeEntry -&gt; TypeTag
</span><a href="Unison.Server.Backend.html#typeEntryTag"><span class="hs-identifier hs-var hs-var">typeEntryTag</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Server.Types.html#TypeTag"><span class="hs-identifier hs-type">TypeTag</span></a></span><span>
</span><span id="line-198"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-199"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682022619"><span id="local-6989586621682022621"><span class="annot"><span class="annottext">TypeEntry -&gt; TypeEntry -&gt; Bool
(TypeEntry -&gt; TypeEntry -&gt; Bool)
-&gt; (TypeEntry -&gt; TypeEntry -&gt; Bool) -&gt; Eq TypeEntry
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: TypeEntry -&gt; TypeEntry -&gt; Bool
$c/= :: TypeEntry -&gt; TypeEntry -&gt; Bool
== :: TypeEntry -&gt; TypeEntry -&gt; Bool
$c== :: TypeEntry -&gt; TypeEntry -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682022604"><span id="local-6989586621682022606"><span id="local-6989586621682022608"><span id="local-6989586621682022610"><span id="local-6989586621682022612"><span id="local-6989586621682022614"><span id="local-6989586621682022616"><span class="annot"><span class="annottext">Eq TypeEntry
Eq TypeEntry
-&gt; (TypeEntry -&gt; TypeEntry -&gt; Ordering)
-&gt; (TypeEntry -&gt; TypeEntry -&gt; Bool)
-&gt; (TypeEntry -&gt; TypeEntry -&gt; Bool)
-&gt; (TypeEntry -&gt; TypeEntry -&gt; Bool)
-&gt; (TypeEntry -&gt; TypeEntry -&gt; Bool)
-&gt; (TypeEntry -&gt; TypeEntry -&gt; TypeEntry)
-&gt; (TypeEntry -&gt; TypeEntry -&gt; TypeEntry)
-&gt; Ord TypeEntry
TypeEntry -&gt; TypeEntry -&gt; Bool
TypeEntry -&gt; TypeEntry -&gt; Ordering
TypeEntry -&gt; TypeEntry -&gt; TypeEntry
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
min :: TypeEntry -&gt; TypeEntry -&gt; TypeEntry
$cmin :: TypeEntry -&gt; TypeEntry -&gt; TypeEntry
max :: TypeEntry -&gt; TypeEntry -&gt; TypeEntry
$cmax :: TypeEntry -&gt; TypeEntry -&gt; TypeEntry
&gt;= :: TypeEntry -&gt; TypeEntry -&gt; Bool
$c&gt;= :: TypeEntry -&gt; TypeEntry -&gt; Bool
&gt; :: TypeEntry -&gt; TypeEntry -&gt; Bool
$c&gt; :: TypeEntry -&gt; TypeEntry -&gt; Bool
&lt;= :: TypeEntry -&gt; TypeEntry -&gt; Bool
$c&lt;= :: TypeEntry -&gt; TypeEntry -&gt; Bool
&lt; :: TypeEntry -&gt; TypeEntry -&gt; Bool
$c&lt; :: TypeEntry -&gt; TypeEntry -&gt; Bool
compare :: TypeEntry -&gt; TypeEntry -&gt; Ordering
$ccompare :: TypeEntry -&gt; TypeEntry -&gt; Ordering
$cp1Ord :: Eq TypeEntry
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682022598"><span id="local-6989586621682022600"><span id="local-6989586621682022602"><span class="annot"><span class="annottext">Int -&gt; TypeEntry -&gt; ShowS
[TypeEntry] -&gt; ShowS
TypeEntry -&gt; String
(Int -&gt; TypeEntry -&gt; ShowS)
-&gt; (TypeEntry -&gt; String)
-&gt; ([TypeEntry] -&gt; ShowS)
-&gt; Show TypeEntry
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [TypeEntry] -&gt; ShowS
$cshowList :: [TypeEntry] -&gt; ShowS
show :: TypeEntry -&gt; String
$cshow :: TypeEntry -&gt; String
showsPrec :: Int -&gt; TypeEntry -&gt; ShowS
$cshowsPrec :: Int -&gt; TypeEntry -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. TypeEntry -&gt; Rep TypeEntry x)
-&gt; (forall x. Rep TypeEntry x -&gt; TypeEntry) -&gt; Generic TypeEntry
forall x. Rep TypeEntry x -&gt; TypeEntry
forall x. TypeEntry -&gt; Rep TypeEntry x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep TypeEntry x -&gt; TypeEntry
$cfrom :: forall x. TypeEntry -&gt; Rep TypeEntry x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span id="local-6989586621682022594"><span id="local-6989586621682022595"></span></span><span class="hs-keyword">data</span><span> </span><span id="FoundRef"><span class="annot"><a href="Unison.Server.Backend.html#FoundRef"><span class="hs-identifier hs-var">FoundRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="FoundTermRef"><span class="annot"><a href="Unison.Server.Backend.html#FoundTermRef"><span class="hs-identifier hs-var">FoundTermRef</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span>
</span><span id="line-202"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span id="FoundTypeRef"><span class="annot"><a href="Unison.Server.Backend.html#FoundTypeRef"><span class="hs-identifier hs-var">FoundTypeRef</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span>
</span><span id="line-203"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682022588"><span id="local-6989586621682022590"><span class="annot"><span class="annottext">FoundRef -&gt; FoundRef -&gt; Bool
(FoundRef -&gt; FoundRef -&gt; Bool)
-&gt; (FoundRef -&gt; FoundRef -&gt; Bool) -&gt; Eq FoundRef
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: FoundRef -&gt; FoundRef -&gt; Bool
$c/= :: FoundRef -&gt; FoundRef -&gt; Bool
== :: FoundRef -&gt; FoundRef -&gt; Bool
$c== :: FoundRef -&gt; FoundRef -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682022573"><span id="local-6989586621682022575"><span id="local-6989586621682022577"><span id="local-6989586621682022579"><span id="local-6989586621682022581"><span id="local-6989586621682022583"><span id="local-6989586621682022585"><span class="annot"><span class="annottext">Eq FoundRef
Eq FoundRef
-&gt; (FoundRef -&gt; FoundRef -&gt; Ordering)
-&gt; (FoundRef -&gt; FoundRef -&gt; Bool)
-&gt; (FoundRef -&gt; FoundRef -&gt; Bool)
-&gt; (FoundRef -&gt; FoundRef -&gt; Bool)
-&gt; (FoundRef -&gt; FoundRef -&gt; Bool)
-&gt; (FoundRef -&gt; FoundRef -&gt; FoundRef)
-&gt; (FoundRef -&gt; FoundRef -&gt; FoundRef)
-&gt; Ord FoundRef
FoundRef -&gt; FoundRef -&gt; Bool
FoundRef -&gt; FoundRef -&gt; Ordering
FoundRef -&gt; FoundRef -&gt; FoundRef
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
min :: FoundRef -&gt; FoundRef -&gt; FoundRef
$cmin :: FoundRef -&gt; FoundRef -&gt; FoundRef
max :: FoundRef -&gt; FoundRef -&gt; FoundRef
$cmax :: FoundRef -&gt; FoundRef -&gt; FoundRef
&gt;= :: FoundRef -&gt; FoundRef -&gt; Bool
$c&gt;= :: FoundRef -&gt; FoundRef -&gt; Bool
&gt; :: FoundRef -&gt; FoundRef -&gt; Bool
$c&gt; :: FoundRef -&gt; FoundRef -&gt; Bool
&lt;= :: FoundRef -&gt; FoundRef -&gt; Bool
$c&lt;= :: FoundRef -&gt; FoundRef -&gt; Bool
&lt; :: FoundRef -&gt; FoundRef -&gt; Bool
$c&lt; :: FoundRef -&gt; FoundRef -&gt; Bool
compare :: FoundRef -&gt; FoundRef -&gt; Ordering
$ccompare :: FoundRef -&gt; FoundRef -&gt; Ordering
$cp1Ord :: Eq FoundRef
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682022567"><span id="local-6989586621682022569"><span id="local-6989586621682022571"><span class="annot"><span class="annottext">Int -&gt; FoundRef -&gt; ShowS
[FoundRef] -&gt; ShowS
FoundRef -&gt; String
(Int -&gt; FoundRef -&gt; ShowS)
-&gt; (FoundRef -&gt; String) -&gt; ([FoundRef] -&gt; ShowS) -&gt; Show FoundRef
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [FoundRef] -&gt; ShowS
$cshowList :: [FoundRef] -&gt; ShowS
show :: FoundRef -&gt; String
$cshow :: FoundRef -&gt; String
showsPrec :: Int -&gt; FoundRef -&gt; ShowS
$cshowsPrec :: Int -&gt; FoundRef -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. FoundRef -&gt; Rep FoundRef x)
-&gt; (forall x. Rep FoundRef x -&gt; FoundRef) -&gt; Generic FoundRef
forall x. Rep FoundRef x -&gt; FoundRef
forall x. FoundRef -&gt; Rep FoundRef x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep FoundRef x -&gt; FoundRef
$cfrom :: forall x. FoundRef -&gt; Rep FoundRef x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span class="hs-comment">-- After finding a search results with fuzzy find we do some post processing to</span><span>
</span><span id="line-206"></span><span class="hs-comment">-- refine the result:</span><span>
</span><span id="line-207"></span><span class="hs-comment">--  * Sort:</span><span>
</span><span id="line-208"></span><span class="hs-comment">--      we sort both on the FZF score and the number of segments in the FQN</span><span>
</span><span id="line-209"></span><span class="hs-comment">--      preferring shorter FQNs over longer. This helps with things like forks</span><span>
</span><span id="line-210"></span><span class="hs-comment">--      of base.</span><span>
</span><span id="line-211"></span><span class="hs-comment">--  * Dedupe:</span><span>
</span><span id="line-212"></span><span class="hs-comment">--      we dedupe on the found refs to avoid having several rows of a</span><span>
</span><span id="line-213"></span><span class="hs-comment">--      definition with different names in the result set.</span><span>
</span><span id="line-214"></span><span id="local-6989586621682022564"><span class="annot"><a href="Unison.Server.Backend.html#fuzzyFind"><span class="hs-identifier hs-type">fuzzyFind</span></a></span><span>
</span><span id="line-215"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621682022564"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-216"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Path.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span>
</span><span id="line-217"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Branch.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022564"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-218"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-219"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">FZF.Alignment</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Types.html#UnisonName"><span class="hs-identifier hs-type">UnisonName</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Unison.Server.Backend.html#FoundRef"><span class="hs-identifier hs-type">FoundRef</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span></span><span>
</span><span id="line-220"></span><span id="fuzzyFind"><span class="annot"><span class="annottext">fuzzyFind :: Path -&gt; Branch m -&gt; String -&gt; [(Alignment, Text, [FoundRef])]
</span><a href="Unison.Server.Backend.html#fuzzyFind"><span class="hs-identifier hs-var hs-var">fuzzyFind</span></a></span></span><span> </span><span id="local-6989586621682022561"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621682022561"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span id="local-6989586621682022560"><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621682022560"><span class="hs-identifier hs-var">branch</span></a></span></span><span> </span><span id="local-6989586621682022559"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682022559"><span class="hs-identifier hs-var">query</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-221"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-222"></span><span>    </span><span id="local-6989586621682022558"><span class="annot"><span class="annottext">printNames :: Names
</span><a href="#local-6989586621682022558"><span class="hs-identifier hs-var hs-var">printNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-223"></span><span>      </span><span class="annot"><span class="annottext">Branch m -&gt; Path -&gt; Names
forall (m :: * -&gt; *). Branch m -&gt; Path -&gt; Names
</span><a href="Unison.Server.Backend.html#basicPrettyPrintNames"><span class="hs-identifier hs-var">basicPrettyPrintNames</span></a></span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621682022560"><span class="hs-identifier hs-var">branch</span></a></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621682022561"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span>    </span><span id="local-6989586621682022557"><span class="annot"><span class="annottext">fzfNames :: [(Alignment, Name, Set (Either Referent Reference))]
</span><a href="#local-6989586621682022557"><span class="hs-identifier hs-var hs-var">fzfNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-226"></span><span>      </span><span class="annot"><span class="annottext">[String]
-&gt; Names -&gt; [(Alignment, Name, Set (Either Referent Reference))]
</span><span class="hs-identifier hs-var">Names.fuzzyFind</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; [String]
</span><span class="hs-identifier hs-var">words</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682022559"><span class="hs-identifier hs-var">query</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621682022558"><span class="hs-identifier hs-var">printNames</span></a></span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span>    </span><span id="local-6989586621682022554"><span class="annot"><span class="annottext">toFoundRef :: (Alignment, Text, Set (Either Referent Reference))
-&gt; (Alignment, Text, [FoundRef])
</span><a href="#local-6989586621682022554"><span class="hs-identifier hs-var hs-var">toFoundRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-229"></span><span>      </span><span class="annot"><span class="annottext">(Set (Either Referent Reference) -&gt; [FoundRef])
-&gt; (Alignment, Text, Set (Either Referent Reference))
-&gt; (Alignment, Text, [FoundRef])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Either Referent Reference -&gt; FoundRef)
-&gt; [Either Referent Reference] -&gt; [FoundRef]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Referent -&gt; FoundRef)
-&gt; (Reference -&gt; FoundRef) -&gt; Either Referent Reference -&gt; FoundRef
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; FoundRef
</span><a href="Unison.Server.Backend.html#FoundTermRef"><span class="hs-identifier hs-var">FoundTermRef</span></a></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; FoundRef
</span><a href="Unison.Server.Backend.html#FoundTypeRef"><span class="hs-identifier hs-var">FoundTypeRef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Either Referent Reference] -&gt; [FoundRef])
-&gt; (Set (Either Referent Reference) -&gt; [Either Referent Reference])
-&gt; Set (Either Referent Reference)
-&gt; [FoundRef]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Set (Either Referent Reference) -&gt; [Either Referent Reference]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span class="hs-special">)</span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span>    </span><span class="hs-comment">-- Remove dupes based on refs</span><span>
</span><span id="line-232"></span><span>    </span><span id="local-6989586621682022553"><span class="annot"><span class="annottext">dedupe :: [(a, b, [FoundRef])] -&gt; [(a, b, [FoundRef])]
</span><a href="#local-6989586621682022553"><span class="hs-identifier hs-var hs-var">dedupe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-233"></span><span>      </span><span class="annot"><span class="annottext">((a, b, [FoundRef]) -&gt; [FoundRef])
-&gt; [(a, b, [FoundRef])] -&gt; [(a, b, [FoundRef])]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">nubOrdOn</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682022552"><span class="annot"><span class="annottext">[FoundRef]
</span><a href="#local-6989586621682022552"><span class="hs-identifier hs-var">refs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[FoundRef]
</span><a href="#local-6989586621682022552"><span class="hs-identifier hs-var">refs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span>    </span><span class="hs-comment">-- Prefer shorter FQNs</span><span>
</span><span id="line-236"></span><span>    </span><span id="local-6989586621682022551"><span class="annot"><span class="annottext">rank :: (Alignment, Text, c) -&gt; (Int, Int)
</span><a href="#local-6989586621682022551"><span class="hs-identifier hs-var hs-var">rank</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682022550"><span class="annot"><span class="annottext">Alignment
</span><a href="#local-6989586621682022550"><span class="hs-identifier hs-var">alignment</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682022549"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682022549"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-237"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Int
</span><span class="hs-identifier hs-var">Name.countSegments</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Name
</span><span class="hs-identifier hs-var">Name.unsafeFromText</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682022549"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. Num a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">negate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Alignment -&gt; Int
</span><span class="hs-identifier hs-var hs-var">FZF.score</span></span><span> </span><span class="annot"><span class="annottext">Alignment
</span><a href="#local-6989586621682022550"><span class="hs-identifier hs-var">alignment</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span>
</span><span id="line-241"></span><span>    </span><span id="local-6989586621682022546"><span class="annot"><span class="annottext">refine :: [(Alignment, Text, [FoundRef])] -&gt; [(Alignment, Text, [FoundRef])]
</span><a href="#local-6989586621682022546"><span class="hs-identifier hs-var hs-var">refine</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-242"></span><span>      </span><span class="annot"><span class="annottext">[(Alignment, Text, [FoundRef])] -&gt; [(Alignment, Text, [FoundRef])]
forall a b. [(a, b, [FoundRef])] -&gt; [(a, b, [FoundRef])]
</span><a href="#local-6989586621682022553"><span class="hs-identifier hs-var">dedupe</span></a></span><span> </span><span class="annot"><span class="annottext">([(Alignment, Text, [FoundRef])]
 -&gt; [(Alignment, Text, [FoundRef])])
-&gt; ([(Alignment, Text, [FoundRef])]
    -&gt; [(Alignment, Text, [FoundRef])])
-&gt; [(Alignment, Text, [FoundRef])]
-&gt; [(Alignment, Text, [FoundRef])]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((Alignment, Text, [FoundRef]) -&gt; (Int, Int))
-&gt; [(Alignment, Text, [FoundRef])]
-&gt; [(Alignment, Text, [FoundRef])]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sortOn</span></span><span> </span><span class="annot"><span class="annottext">(Alignment, Text, [FoundRef]) -&gt; (Int, Int)
forall c. (Alignment, Text, c) -&gt; (Int, Int)
</span><a href="#local-6989586621682022551"><span class="hs-identifier hs-var">rank</span></a></span><span>
</span><span id="line-243"></span><span>  </span><span class="hs-keyword">in</span><span>
</span><span id="line-244"></span><span>  </span><span class="annot"><span class="annottext">[(Alignment, Text, [FoundRef])] -&gt; [(Alignment, Text, [FoundRef])]
</span><a href="#local-6989586621682022546"><span class="hs-identifier hs-var">refine</span></a></span><span> </span><span class="annot"><span class="annottext">([(Alignment, Text, [FoundRef])]
 -&gt; [(Alignment, Text, [FoundRef])])
-&gt; [(Alignment, Text, [FoundRef])]
-&gt; [(Alignment, Text, [FoundRef])]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Alignment, Text, Set (Either Referent Reference))
-&gt; (Alignment, Text, [FoundRef])
</span><a href="#local-6989586621682022554"><span class="hs-identifier hs-var">toFoundRef</span></a></span><span> </span><span class="annot"><span class="annottext">((Alignment, Text, Set (Either Referent Reference))
 -&gt; (Alignment, Text, [FoundRef]))
-&gt; ((Alignment, Name, Set (Either Referent Reference))
    -&gt; (Alignment, Text, Set (Either Referent Reference)))
-&gt; (Alignment, Name, Set (Either Referent Reference))
-&gt; (Alignment, Text, [FoundRef])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ASetter
  (Alignment, Name, Set (Either Referent Reference))
  (Alignment, Text, Set (Either Referent Reference))
  Name
  Text
-&gt; (Name -&gt; Text)
-&gt; (Alignment, Name, Set (Either Referent Reference))
-&gt; (Alignment, Text, Set (Either Referent Reference))
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">over</span></span><span> </span><span class="annot"><span class="annottext">ASetter
  (Alignment, Name, Set (Either Referent Reference))
  (Alignment, Text, Set (Either Referent Reference))
  Name
  Text
forall s t a b. Field2 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_2</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Text
</span><span class="hs-identifier hs-var hs-var">Name.toText</span></span><span> </span><span class="annot"><span class="annottext">((Alignment, Name, Set (Either Referent Reference))
 -&gt; (Alignment, Text, [FoundRef]))
-&gt; [(Alignment, Name, Set (Either Referent Reference))]
-&gt; [(Alignment, Text, [FoundRef])]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(Alignment, Name, Set (Either Referent Reference))]
</span><a href="#local-6989586621682022557"><span class="hs-identifier hs-var">fzfNames</span></a></span><span>
</span><span id="line-245"></span><span>
</span><span id="line-246"></span><span class="hs-comment">-- List the immediate children of a namespace</span><span>
</span><span id="line-247"></span><span id="local-6989586621682022542"><span id="local-6989586621682022543"><span class="annot"><a href="Unison.Server.Backend.html#findShallow"><span class="hs-identifier hs-type">findShallow</span></a></span><span>
</span><span id="line-248"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621682022543"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621682022542"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Type.html#Codebase"><span class="hs-identifier hs-type">Codebase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022543"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022542"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="Unison.Parser.Ann.html#Ann"><span class="hs-identifier hs-type">Ann</span></a></span><span>
</span><span id="line-250"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Path.html#Absolute"><span class="hs-identifier hs-type">Path.Absolute</span></a></span><span>
</span><span id="line-251"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022543"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Unison.Server.Backend.html#ShallowListEntry"><span class="hs-identifier hs-type">ShallowListEntry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022542"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="Unison.Parser.Ann.html#Ann"><span class="hs-identifier hs-type">Ann</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-252"></span><span id="findShallow"><span class="annot"><span class="annottext">findShallow :: Codebase m v Ann -&gt; Absolute -&gt; Backend m [ShallowListEntry v Ann]
</span><a href="Unison.Server.Backend.html#findShallow"><span class="hs-identifier hs-var hs-var">findShallow</span></a></span></span><span> </span><span id="local-6989586621682022540"><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621682022540"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621682022539"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621682022539"><span class="hs-identifier hs-var">path'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-253"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682022538"><span class="annot"><span class="annottext">path :: Path
</span><a href="#local-6989586621682022538"><span class="hs-identifier hs-var hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Path
</span><a href="Unison.Codebase.Path.html#unabsolute"><span class="hs-identifier hs-var hs-var">Path.unabsolute</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621682022539"><span class="hs-identifier hs-var">path'</span></a></span><span>
</span><span id="line-254"></span><span>  </span><span id="local-6989586621682022536"><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621682022536"><span class="hs-identifier hs-var">root</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann -&gt; Backend m (Branch m)
forall (m :: * -&gt; *) v.
Functor m =&gt;
Codebase m v Ann -&gt; Backend m (Branch m)
</span><a href="Unison.Server.Backend.html#getRootBranch"><span class="hs-identifier hs-var">getRootBranch</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621682022540"><span class="hs-identifier hs-var">codebase</span></a></span><span>
</span><span id="line-255"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682022535"><span class="annot"><span class="annottext">mayb :: Maybe (Branch m)
</span><a href="#local-6989586621682022535"><span class="hs-identifier hs-var hs-var">mayb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Path -&gt; Branch m -&gt; Maybe (Branch m)
forall (m :: * -&gt; *). Path -&gt; Branch m -&gt; Maybe (Branch m)
</span><a href="Unison.Codebase.Branch.html#getAt"><span class="hs-identifier hs-var">Branch.getAt</span></a></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621682022538"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621682022536"><span class="hs-identifier hs-var">root</span></a></span><span>
</span><span id="line-256"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Branch m)
</span><a href="#local-6989586621682022535"><span class="hs-identifier hs-var">mayb</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-257"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Branch m)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[ShallowListEntry v Ann] -&gt; Backend m [ShallowListEntry v Ann]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-258"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682022534"><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621682022534"><span class="hs-identifier hs-var">b</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann -&gt; Branch m -&gt; Backend m [ShallowListEntry v Ann]
forall (m :: * -&gt; *) v.
(Monad m, Var v) =&gt;
Codebase m v Ann -&gt; Branch m -&gt; Backend m [ShallowListEntry v Ann]
</span><a href="Unison.Server.Backend.html#findShallowInBranch"><span class="hs-identifier hs-var">findShallowInBranch</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621682022540"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621682022534"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-259"></span><span>
</span><span id="line-260"></span><span id="local-6989586621682022532"><span class="annot"><a href="Unison.Server.Backend.html#findShallowReadmeInBranchAndRender"><span class="hs-identifier hs-type">findShallowReadmeInBranchAndRender</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-261"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621682022532"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-262"></span><span>  </span><span class="annot"><a href="Unison.Util.Pretty.html#Width"><span class="hs-identifier hs-type">Width</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-263"></span><span>  </span><span class="annot"><a href="Unison.Codebase.Runtime.html#Runtime"><span class="hs-identifier hs-type">Rt.Runtime</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022532"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-264"></span><span>  </span><span class="annot"><a href="Unison.Codebase.Type.html#Codebase"><span class="hs-identifier hs-type">Codebase</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621682022532"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="Unison.Parser.Ann.html#Ann"><span class="hs-identifier hs-type">Ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-265"></span><span>  </span><span class="annot"><a href="Unison.Codebase.Branch.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-266"></span><span>  </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Unison.Server.Doc.html#Doc"><span class="hs-identifier hs-type">Doc.Doc</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-267"></span><span id="findShallowReadmeInBranchAndRender"><span class="annot"><span class="annottext">findShallowReadmeInBranchAndRender :: Width
-&gt; Runtime v
-&gt; Codebase IO v Ann
-&gt; Branch IO
-&gt; Backend IO (Maybe Doc)
</span><a href="Unison.Server.Backend.html#findShallowReadmeInBranchAndRender"><span class="hs-identifier hs-var hs-var">findShallowReadmeInBranchAndRender</span></a></span></span><span> </span><span id="local-6989586621682022530"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682022530"><span class="hs-identifier hs-var">width</span></a></span></span><span> </span><span id="local-6989586621682022529"><span class="annot"><span class="annottext">Runtime v
</span><a href="#local-6989586621682022529"><span class="hs-identifier hs-var">runtime</span></a></span></span><span> </span><span id="local-6989586621682022528"><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621682022528"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621682022527"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621682022527"><span class="hs-identifier hs-var">branch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-268"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682022526"><span class="annot"><span class="annottext">ppe :: Int -&gt; PrettyPrintEnvDecl
</span><a href="#local-6989586621682022526"><span class="hs-identifier hs-var hs-var">ppe</span></a></span></span><span> </span><span id="local-6989586621682022525"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682022525"><span class="hs-identifier hs-var">hqLen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; NamesWithHistory -&gt; PrettyPrintEnvDecl
</span><a href="Unison.PrettyPrintEnvDecl.Names.html#fromNamesDecl"><span class="hs-identifier hs-var">PPE.fromNamesDecl</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682022525"><span class="hs-identifier hs-var">hqLen</span></a></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621682022524"><span class="hs-identifier hs-var">printNames</span></a></span><span>
</span><span id="line-269"></span><span>
</span><span id="line-270"></span><span>      </span><span id="local-6989586621682022524"><span class="annot"><span class="annottext">printNames :: NamesWithHistory
</span><a href="#local-6989586621682022524"><span class="hs-identifier hs-var hs-var">printNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Path -&gt; Branch IO -&gt; NamesWithHistory
forall (m :: * -&gt; *). Path -&gt; Branch m -&gt; NamesWithHistory
</span><a href="Unison.Server.Backend.html#getCurrentPrettyNames"><span class="hs-identifier hs-var">getCurrentPrettyNames</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[NameSegment] -&gt; Path
</span><a href="Unison.Codebase.Path.html#fromList"><span class="hs-identifier hs-var">Path.fromList</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621682022527"><span class="hs-identifier hs-var">branch</span></a></span><span>
</span><span id="line-271"></span><span>
</span><span id="line-272"></span><span>      </span><span id="local-6989586621682022521"><span class="annot"><span class="annottext">renderReadme :: PrettyPrintEnvDecl -&gt; Referent -&gt; Backend IO (Maybe Doc)
</span><a href="#local-6989586621682022521"><span class="hs-identifier hs-var hs-var">renderReadme</span></a></span></span><span> </span><span id="local-6989586621682022520"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621682022520"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span id="local-6989586621682022519"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621682022519"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-273"></span><span>        </span><span id="local-6989586621682022518"><span class="annot"><span class="annottext">[(Text, Text, Doc)]
</span><a href="#local-6989586621682022518"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
-&gt; Width
-&gt; Runtime v
-&gt; Codebase IO v Ann
-&gt; Reference
-&gt; Backend IO [(Text, Text, Doc)]
forall v.
Var v =&gt;
PrettyPrintEnvDecl
-&gt; Width
-&gt; Runtime v
-&gt; Codebase IO v Ann
-&gt; Reference
-&gt; Backend IO [(Text, Text, Doc)]
</span><a href="Unison.Server.Backend.html#renderDoc"><span class="hs-identifier hs-var">renderDoc</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621682022520"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682022530"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime v
</span><a href="#local-6989586621682022529"><span class="hs-identifier hs-var">runtime</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621682022528"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Referent -&gt; Reference
</span><span class="hs-identifier hs-var">Referent.toReference</span></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621682022519"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-274"></span><span>        </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[(Text, Text, Doc)]
</span><a href="#local-6989586621682022518"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-275"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682022515"><span class="annot"><span class="annottext">Doc
</span><a href="#local-6989586621682022515"><span class="hs-identifier hs-var">doc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[(Text, Text, Doc)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Doc -&gt; Maybe Doc
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Doc
</span><a href="#local-6989586621682022515"><span class="hs-identifier hs-var">doc</span></a></span><span>
</span><span id="line-276"></span><span>          </span><span class="annot"><span class="annottext">[(Text, Text, Doc)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Doc
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-277"></span><span>
</span><span id="line-278"></span><span>      </span><span class="hs-comment">-- allow any of these capitalizations</span><span>
</span><span id="line-279"></span><span>      </span><span id="local-6989586621682022514"><span class="annot"><span class="annottext">toCheck :: [NameSegment]
</span><a href="#local-6989586621682022514"><span class="hs-identifier hs-var hs-var">toCheck</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; NameSegment
</span><span class="hs-identifier hs-var">NameSegment</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; NameSegment) -&gt; [Text] -&gt; [NameSegment]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;README&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Readme&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;ReadMe&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;readme&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-280"></span><span>      </span><span class="annot"><a href="#local-6989586621682022512"><span class="hs-identifier hs-type">readmes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span>
</span><span id="line-281"></span><span>      </span><span id="local-6989586621682022512"><span class="annot"><span class="annottext">readmes :: Set Referent
</span><a href="#local-6989586621682022512"><span class="hs-identifier hs-var hs-var">readmes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(NameSegment -&gt; Set Referent) -&gt; [NameSegment] -&gt; Set Referent
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">NameSegment -&gt; Set Referent
</span><a href="#local-6989586621682022510"><span class="hs-identifier hs-var">lookup</span></a></span><span> </span><span class="annot"><span class="annottext">[NameSegment]
</span><a href="#local-6989586621682022514"><span class="hs-identifier hs-var">toCheck</span></a></span><span>
</span><span id="line-282"></span><span>        </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682022510"><span class="annot"><span class="annottext">lookup :: NameSegment -&gt; Set Referent
</span><a href="#local-6989586621682022510"><span class="hs-identifier hs-var hs-var">lookup</span></a></span></span><span> </span><span id="local-6989586621682022509"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621682022509"><span class="hs-identifier hs-var">seg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NameSegment -&gt; Relation Referent NameSegment -&gt; Set Referent
forall b a. Ord b =&gt; b -&gt; Relation a b -&gt; Set a
</span><span class="hs-identifier hs-var">R.lookupRan</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621682022509"><span class="hs-identifier hs-var">seg</span></a></span><span> </span><span class="annot"><span class="annottext">Relation Referent NameSegment
</span><a href="#local-6989586621682022507"><span class="hs-identifier hs-var">rel</span></a></span><span>
</span><span id="line-283"></span><span>              </span><span id="local-6989586621682022507"><span class="annot"><span class="annottext">rel :: Relation Referent NameSegment
</span><a href="#local-6989586621682022507"><span class="hs-identifier hs-var hs-var">rel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Star3 Referent NameSegment Reference (Reference, Reference)
-&gt; Relation Referent NameSegment
forall fact d1 d2 d3. Star3 fact d1 d2 d3 -&gt; Relation fact d1
</span><a href="Unison.Util.Star3.html#d1"><span class="hs-identifier hs-var hs-var">Star3.d1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch0 IO
-&gt; Star3 Referent NameSegment Reference (Reference, Reference)
forall (m :: * -&gt; *).
Branch0 m
-&gt; Star3 Referent NameSegment Reference (Reference, Reference)
</span><a href="Unison.Codebase.Branch.html#_terms"><span class="hs-identifier hs-var hs-var">Branch._terms</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch IO -&gt; Branch0 IO
forall (m :: * -&gt; *). Branch m -&gt; Branch0 m
</span><a href="Unison.Codebase.Branch.html#head"><span class="hs-identifier hs-var">Branch.head</span></a></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621682022527"><span class="hs-identifier hs-var">branch</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-284"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-285"></span><span>        </span><span id="local-6989586621682022504"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682022504"><span class="hs-identifier hs-var">hqLen</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Int -&gt; ExceptT BackendError IO Int
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Int -&gt; ExceptT BackendError IO Int)
-&gt; IO Int -&gt; ExceptT BackendError IO Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann -&gt; IO Int
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; m Int
</span><a href="Unison.Codebase.Type.html#hashLength"><span class="hs-identifier hs-var hs-var">Codebase.hashLength</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621682022528"><span class="hs-identifier hs-var">codebase</span></a></span><span>
</span><span id="line-286"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Maybe Doc) -&gt; Maybe Doc
forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><span class="hs-identifier hs-var">join</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (Maybe Doc) -&gt; Maybe Doc)
-&gt; ExceptT BackendError IO (Maybe (Maybe Doc))
-&gt; Backend IO (Maybe Doc)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Referent -&gt; Backend IO (Maybe Doc))
-&gt; Maybe Referent -&gt; ExceptT BackendError IO (Maybe (Maybe Doc))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; Referent -&gt; Backend IO (Maybe Doc)
</span><a href="#local-6989586621682022521"><span class="hs-identifier hs-var">renderReadme</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; PrettyPrintEnvDecl
</span><a href="#local-6989586621682022526"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682022504"><span class="hs-identifier hs-var">hqLen</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Referent -&gt; Maybe Referent
forall a. Set a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Set.lookupMin</span></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621682022512"><span class="hs-identifier hs-var">readmes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-287"></span><span>
</span><span id="line-288"></span><span>
</span><span id="line-289"></span><span id="local-6989586621682023107"><span id="local-6989586621682023108"><span class="annot"><a href="Unison.Server.Backend.html#termListEntry"><span class="hs-identifier hs-type">termListEntry</span></a></span><span>
</span><span id="line-290"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621682023108"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-291"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621682023107"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-292"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Type.html#Codebase"><span class="hs-identifier hs-type">Codebase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682023108"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682023107"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="Unison.Parser.Ann.html#Ann"><span class="hs-identifier hs-type">Ann</span></a></span><span>
</span><span id="line-293"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Branch.html#Branch0"><span class="hs-identifier hs-type">Branch0</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682023108"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-294"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span>
</span><span id="line-295"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HQ'.HQSegment</span></span><span>
</span><span id="line-296"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682023108"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Backend.html#TermEntry"><span class="hs-identifier hs-type">TermEntry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682023107"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="Unison.Parser.Ann.html#Ann"><span class="hs-identifier hs-type">Ann</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-297"></span><span id="termListEntry"><span class="annot"><span class="annottext">termListEntry :: Codebase m v Ann
-&gt; Branch0 m
-&gt; Referent
-&gt; HQSegment
-&gt; Backend m (TermEntry v Ann)
</span><a href="Unison.Server.Backend.html#termListEntry"><span class="hs-identifier hs-var hs-var">termListEntry</span></a></span></span><span> </span><span id="local-6989586621682022498"><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621682022498"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621682022497"><span class="annot"><span class="annottext">Branch0 m
</span><a href="#local-6989586621682022497"><span class="hs-identifier hs-var">b0</span></a></span></span><span> </span><span id="local-6989586621682022496"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621682022496"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682022495"><span class="annot"><span class="annottext">HQSegment
</span><a href="#local-6989586621682022495"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-298"></span><span>  </span><span id="local-6989586621682022494"><span class="annot"><span class="annottext">Maybe (Type v Ann)
</span><a href="#local-6989586621682022494"><span class="hs-identifier hs-var">ot</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (Maybe (Type v Ann))
-&gt; ExceptT BackendError m (Maybe (Type v Ann))
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Maybe (Type v Ann))
 -&gt; ExceptT BackendError m (Maybe (Type v Ann)))
-&gt; m (Maybe (Type v Ann))
-&gt; ExceptT BackendError m (Maybe (Type v Ann))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann -&gt; Referent -&gt; m (Maybe (Type v Ann))
forall (m :: * -&gt; *) v.
(Applicative m, Var v) =&gt;
Codebase m v Ann -&gt; Referent -&gt; m (Maybe (Type v Ann))
</span><a href="Unison.Server.Backend.html#loadReferentType"><span class="hs-identifier hs-var">loadReferentType</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621682022498"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621682022496"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-299"></span><span>  </span><span class="hs-comment">-- A term is a doc if its type conforms to the `Doc` type.</span><span>
</span><span id="line-300"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682022492"><span class="annot"><span class="annottext">isDoc :: Bool
</span><a href="#local-6989586621682022492"><span class="hs-identifier hs-var hs-var">isDoc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Type v Ann)
</span><a href="#local-6989586621682022494"><span class="hs-identifier hs-var">ot</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-301"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682022491"><span class="annot"><span class="annottext">Type v Ann
</span><a href="#local-6989586621682022491"><span class="hs-identifier hs-var">t</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type v Ann -&gt; Type v Ann -&gt; Bool
forall v loc. Var v =&gt; Type v loc -&gt; Type v loc -&gt; Bool
</span><a href="Unison.Typechecker.html#isSubtype"><span class="hs-identifier hs-var">Typechecker.isSubtype</span></a></span><span> </span><span class="annot"><span class="annottext">Type v Ann
</span><a href="#local-6989586621682022491"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ann -&gt; Reference -&gt; Type v Ann
forall v a. Ord v =&gt; a -&gt; Reference -&gt; Type v a
</span><span class="hs-identifier hs-var">Type.ref</span></span><span> </span><span class="annot"><span class="annottext">Ann
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="Unison.Builtin.Decls.html#docRef"><span class="hs-identifier hs-var">Decls.docRef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span>
</span><span id="line-302"></span><span>                   </span><span class="annot"><span class="annottext">Type v Ann -&gt; Type v Ann -&gt; Bool
forall v loc. Var v =&gt; Type v loc -&gt; Type v loc -&gt; Bool
</span><a href="Unison.Typechecker.html#isSubtype"><span class="hs-identifier hs-var">Typechecker.isSubtype</span></a></span><span> </span><span class="annot"><span class="annottext">Type v Ann
</span><a href="#local-6989586621682022491"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ann -&gt; Reference -&gt; Type v Ann
forall v a. Ord v =&gt; a -&gt; Reference -&gt; Type v a
</span><span class="hs-identifier hs-var">Type.ref</span></span><span> </span><span class="annot"><span class="annottext">Ann
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="Unison.Runtime.IOSource.html#doc2Ref"><span class="hs-identifier hs-var">DD.doc2Ref</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Type v Ann)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-304"></span><span>      </span><span class="hs-comment">-- A term is a test if it has a link of type `IsTest`.</span><span>
</span><span id="line-305"></span><span>      </span><span id="local-6989586621682022485"><span class="annot"><span class="annottext">isTest :: Bool
</span><a href="#local-6989586621682022485"><span class="hs-identifier hs-var hs-var">isTest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-306"></span><span>        </span><span class="annot"><span class="annottext">Referent -&gt; Reference -&gt; R4 Referent Name -&gt; Bool
forall a n. Ord a =&gt; a -&gt; Reference -&gt; R4 a n -&gt; Bool
</span><a href="Unison.Codebase.Metadata.html#hasMetadataWithType%27"><span class="hs-identifier hs-var">Metadata.hasMetadataWithType'</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621682022496"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference
</span><a href="Unison.Builtin.Decls.html#isTestRef"><span class="hs-identifier hs-var">Decls.isTestRef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(R4 Referent Name -&gt; Bool) -&gt; R4 Referent Name -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Branch0 m -&gt; R4 Referent Name
forall (m :: * -&gt; *). Branch0 m -&gt; R4 Referent Name
</span><a href="Unison.Codebase.Branch.html#deepTermMetadata"><span class="hs-identifier hs-var hs-var">Branch.deepTermMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">Branch0 m
</span><a href="#local-6989586621682022497"><span class="hs-identifier hs-var">b0</span></a></span><span>
</span><span id="line-307"></span><span>      </span><span id="local-6989586621682022481"><span class="annot"><span class="annottext">tag :: Maybe TermTag
</span><a href="#local-6989586621682022481"><span class="hs-identifier hs-var hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682022492"><span class="hs-identifier hs-var">isDoc</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">TermTag -&gt; Maybe TermTag
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">TermTag
</span><a href="Unison.Server.Types.html#Doc"><span class="hs-identifier hs-var">Doc</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682022485"><span class="hs-identifier hs-var">isTest</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">TermTag -&gt; Maybe TermTag
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">TermTag
</span><a href="Unison.Server.Types.html#Test"><span class="hs-identifier hs-var">Test</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe TermTag
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-308"></span><span>  </span><span class="annot"><span class="annottext">TermEntry v Ann -&gt; Backend m (TermEntry v Ann)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(TermEntry v Ann -&gt; Backend m (TermEntry v Ann))
-&gt; TermEntry v Ann -&gt; Backend m (TermEntry v Ann)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Referent
-&gt; HQSegment
-&gt; Maybe (Type v Ann)
-&gt; Maybe TermTag
-&gt; TermEntry v Ann
forall v a.
Referent
-&gt; HQSegment -&gt; Maybe (Type v a) -&gt; Maybe TermTag -&gt; TermEntry v a
</span><a href="Unison.Server.Backend.html#TermEntry"><span class="hs-identifier hs-var">TermEntry</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621682022496"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">HQSegment
</span><a href="#local-6989586621682022495"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Type v Ann)
</span><a href="#local-6989586621682022494"><span class="hs-identifier hs-var">ot</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TermTag
</span><a href="#local-6989586621682022481"><span class="hs-identifier hs-var">tag</span></a></span><span>
</span><span id="line-309"></span><span>
</span><span id="line-310"></span><span id="local-6989586621682023105"><span id="local-6989586621682023106"><span class="annot"><a href="Unison.Server.Backend.html#typeListEntry"><span class="hs-identifier hs-type">typeListEntry</span></a></span><span>
</span><span id="line-311"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621682023106"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-312"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621682023105"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-313"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Type.html#Codebase"><span class="hs-identifier hs-type">Codebase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682023106"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682023105"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="Unison.Parser.Ann.html#Ann"><span class="hs-identifier hs-type">Ann</span></a></span><span>
</span><span id="line-314"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span>
</span><span id="line-315"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HQ'.HQSegment</span></span><span>
</span><span id="line-316"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682023106"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#TypeEntry"><span class="hs-identifier hs-type">TypeEntry</span></a></span></span></span><span>
</span><span id="line-317"></span><span id="typeListEntry"><span class="annot"><span class="annottext">typeListEntry :: Codebase m v Ann -&gt; Reference -&gt; HQSegment -&gt; Backend m TypeEntry
</span><a href="Unison.Server.Backend.html#typeListEntry"><span class="hs-identifier hs-var hs-var">typeListEntry</span></a></span></span><span> </span><span id="local-6989586621682022477"><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621682022477"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621682022476"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022476"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682022475"><span class="annot"><span class="annottext">HQSegment
</span><a href="#local-6989586621682022475"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-318"></span><span>  </span><span class="hs-comment">-- The tag indicates whether the type is a data declaration or an ability.</span><span>
</span><span id="line-319"></span><span>  </span><span id="local-6989586621682022474"><span class="annot"><span class="annottext">TypeTag
</span><a href="#local-6989586621682022474"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Maybe Id
</span><span class="hs-identifier hs-var">Reference.toId</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022476"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-320"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682022472"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682022472"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-321"></span><span>      </span><span id="local-6989586621682022471"><span class="annot"><span class="annottext">Maybe (Decl v Ann)
</span><a href="#local-6989586621682022471"><span class="hs-identifier hs-var">decl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (Maybe (Decl v Ann))
-&gt; ExceptT BackendError m (Maybe (Decl v Ann))
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Maybe (Decl v Ann))
 -&gt; ExceptT BackendError m (Maybe (Decl v Ann)))
-&gt; m (Maybe (Decl v Ann))
-&gt; ExceptT BackendError m (Maybe (Decl v Ann))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann -&gt; Id -&gt; m (Maybe (Decl v Ann))
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; Id -&gt; m (Maybe (Decl v a))
</span><a href="Unison.Codebase.Type.html#getTypeDeclaration"><span class="hs-identifier hs-var hs-var">Codebase.getTypeDeclaration</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621682022477"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682022472"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-322"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Decl v Ann)
</span><a href="#local-6989586621682022471"><span class="hs-identifier hs-var">decl</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-323"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">EffectDeclaration v Ann
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeTag
</span><a href="Unison.Server.Types.html#Ability"><span class="hs-identifier hs-var">Ability</span></a></span><span>
</span><span id="line-324"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Decl v Ann)
</span><span class="hs-identifier">_</span></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeTag
</span><a href="Unison.Server.Types.html#Data"><span class="hs-identifier hs-var">Data</span></a></span><span>
</span><span id="line-325"></span><span>    </span><span class="annot"><span class="annottext">Maybe Id
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeTag -&gt; ExceptT BackendError m TypeTag
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Set Reference -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.member</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022476"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><span class="hs-identifier hs-var">Type.builtinAbilities</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">TypeTag
</span><a href="Unison.Server.Types.html#Ability"><span class="hs-identifier hs-var">Ability</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">TypeTag
</span><a href="Unison.Server.Types.html#Data"><span class="hs-identifier hs-var">Data</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="annot"><span class="annottext">Reference -&gt; HQSegment -&gt; TypeTag -&gt; TypeEntry
</span><a href="Unison.Server.Backend.html#TypeEntry"><span class="hs-identifier hs-var">TypeEntry</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022476"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">HQSegment
</span><a href="#local-6989586621682022475"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">TypeTag
</span><a href="#local-6989586621682022474"><span class="hs-identifier hs-var">tag</span></a></span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span class="annot"><a href="Unison.Server.Backend.html#typeDeclHeader"><span class="hs-identifier hs-type">typeDeclHeader</span></a></span><span>
</span><span id="line-329"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682022465"><span class="annot"><a href="#local-6989586621682022465"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span id="local-6989586621682022464"><span class="annot"><a href="#local-6989586621682022464"><span class="hs-identifier hs-type">m</span></a></span></span><span>
</span><span id="line-330"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621682022464"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-331"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621682022465"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-332"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Type.html#Codebase"><span class="hs-identifier hs-type">Codebase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022464"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022465"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="Unison.Parser.Ann.html#Ann"><span class="hs-identifier hs-type">Ann</span></a></span><span>
</span><span id="line-333"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.PrettyPrintEnv.html#PrettyPrintEnv"><span class="hs-identifier hs-type">PPE.PrettyPrintEnv</span></a></span><span>
</span><span id="line-334"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span>
</span><span id="line-335"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022464"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Editor.DisplayObject.html#DisplayObject"><span class="hs-identifier hs-type">DisplayObject</span></a></span><span> </span><span class="annot"><a href="Unison.Server.Syntax.html#SyntaxText"><span class="hs-identifier hs-type">Syntax.SyntaxText</span></a></span><span> </span><span class="annot"><a href="Unison.Server.Syntax.html#SyntaxText"><span class="hs-identifier hs-type">Syntax.SyntaxText</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-336"></span><span id="typeDeclHeader"><span class="annot"><span class="annottext">typeDeclHeader :: Codebase m v Ann
-&gt; PrettyPrintEnv
-&gt; Reference
-&gt; Backend m (DisplayObject SyntaxText SyntaxText)
</span><a href="Unison.Server.Backend.html#typeDeclHeader"><span class="hs-identifier hs-var hs-var">typeDeclHeader</span></a></span></span><span> </span><span id="local-6989586621682022463"><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621682022463"><span class="hs-identifier hs-var">code</span></a></span></span><span> </span><span id="local-6989586621682022462"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621682022462"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span id="local-6989586621682022461"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022461"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Maybe Id
</span><span class="hs-identifier hs-var">Reference.toId</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022461"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-337"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682022460"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682022460"><span class="hs-identifier hs-var">rid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-338"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">m (Maybe (Decl v Ann))
-&gt; ExceptT BackendError m (Maybe (Decl v Ann))
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Maybe (Decl v Ann))
 -&gt; ExceptT BackendError m (Maybe (Decl v Ann)))
-&gt; m (Maybe (Decl v Ann))
-&gt; ExceptT BackendError m (Maybe (Decl v Ann))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann -&gt; Id -&gt; m (Maybe (Decl v Ann))
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; Id -&gt; m (Maybe (Decl v a))
</span><a href="Unison.Codebase.Type.html#getTypeDeclaration"><span class="hs-identifier hs-var hs-var">Codebase.getTypeDeclaration</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621682022463"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682022460"><span class="hs-identifier hs-var">rid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ExceptT BackendError m (Maybe (Decl v Ann))
-&gt; (Maybe (Decl v Ann) -&gt; DisplayObject SyntaxText SyntaxText)
-&gt; Backend m (DisplayObject SyntaxText SyntaxText)
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-339"></span><span>      </span><span class="annot"><span class="annottext">Maybe (Decl v Ann)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ShortHash -&gt; DisplayObject SyntaxText SyntaxText
forall b a. ShortHash -&gt; DisplayObject b a
</span><a href="Unison.Codebase.Editor.DisplayObject.html#MissingObject"><span class="hs-identifier hs-var">DisplayObject.MissingObject</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference -&gt; ShortHash
</span><span class="hs-identifier hs-var">Reference.toShortHash</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022461"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-340"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682022456"><span class="annot"><span class="annottext">Decl v Ann
</span><a href="#local-6989586621682022456"><span class="hs-identifier hs-var">decl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-341"></span><span>        </span><span class="annot"><span class="annottext">SyntaxText -&gt; DisplayObject SyntaxText SyntaxText
forall b a. a -&gt; DisplayObject b a
</span><a href="Unison.Codebase.Editor.DisplayObject.html#UserObject"><span class="hs-identifier hs-var">DisplayObject.UserObject</span></a></span><span> </span><span class="annot"><span class="annottext">(SyntaxText -&gt; DisplayObject SyntaxText SyntaxText)
-&gt; SyntaxText -&gt; DisplayObject SyntaxText SyntaxText
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-342"></span><span>          </span><span class="annot"><span class="annottext">Element Reference -&gt; Element
</span><a href="Unison.Server.Syntax.html#convertElement"><span class="hs-identifier hs-var">Syntax.convertElement</span></a></span><span> </span><span class="annot"><span class="annottext">(Element Reference -&gt; Element)
-&gt; AnnotatedText (Element Reference) -&gt; SyntaxText
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span>
</span><span id="line-343"></span><span>            </span><span class="annot"><span class="annottext">Width
-&gt; Pretty (AnnotatedText (Element Reference))
-&gt; AnnotatedText (Element Reference)
forall s. (Monoid s, IsString s) =&gt; Width -&gt; Pretty s -&gt; s
</span><a href="Unison.Util.Pretty.html#render"><span class="hs-identifier hs-var">Pretty.render</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="Unison.Server.Types.html#defaultWidth"><span class="hs-identifier hs-var">defaultWidth</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashQualified Name
-&gt; Decl v Ann -&gt; Pretty (AnnotatedText (Element Reference))
forall v a.
Var v =&gt;
HashQualified Name
-&gt; Either (EffectDeclaration v a) (DataDeclaration v a)
-&gt; Pretty (AnnotatedText (Element Reference))
</span><a href="Unison.DeclPrinter.html#prettyDeclHeader"><span class="hs-identifier hs-var">DeclPrinter.prettyDeclHeader</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621682022450"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Decl v Ann
</span><a href="#local-6989586621682022456"><span class="hs-identifier hs-var">decl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span>  </span><span class="annot"><span class="annottext">Maybe Id
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-345"></span><span>    </span><span class="annot"><span class="annottext">DisplayObject SyntaxText SyntaxText
-&gt; Backend m (DisplayObject SyntaxText SyntaxText)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SyntaxText -&gt; DisplayObject SyntaxText SyntaxText
forall b a. b -&gt; DisplayObject b a
</span><a href="Unison.Codebase.Editor.DisplayObject.html#BuiltinObject"><span class="hs-identifier hs-var">DisplayObject.BuiltinObject</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; Reference -&gt; SyntaxText
</span><a href="Unison.Server.Backend.html#formatTypeName"><span class="hs-identifier hs-var">formatTypeName</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621682022462"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022461"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-346"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-347"></span><span>    </span><span id="local-6989586621682022450"><span class="annot"><span class="annottext">name :: HashQualified Name
</span><a href="#local-6989586621682022450"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; Reference -&gt; HashQualified Name
</span><a href="Unison.PrettyPrintEnv.html#typeName"><span class="hs-identifier hs-var">PPE.typeName</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621682022462"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022461"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-348"></span><span>
</span><span id="line-349"></span><span class="annot"><a href="Unison.Server.Backend.html#formatTypeName"><span class="hs-identifier hs-type">formatTypeName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.PrettyPrintEnv.html#PrettyPrintEnv"><span class="hs-identifier hs-type">PPE.PrettyPrintEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Syntax.html#SyntaxText"><span class="hs-identifier hs-type">Syntax.SyntaxText</span></a></span><span>
</span><span id="line-350"></span><span id="formatTypeName"><span class="annot"><span class="annottext">formatTypeName :: PrettyPrintEnv -&gt; Reference -&gt; SyntaxText
</span><a href="Unison.Server.Backend.html#formatTypeName"><span class="hs-identifier hs-var hs-var">formatTypeName</span></a></span></span><span> </span><span id="local-6989586621682022446"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621682022446"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-351"></span><span>  </span><span class="annot"><span class="annottext">(Element Reference -&gt; Element)
-&gt; AnnotatedText (Element Reference) -&gt; SyntaxText
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Element Reference -&gt; Element
</span><a href="Unison.Server.Syntax.html#convertElement"><span class="hs-identifier hs-var">Syntax.convertElement</span></a></span><span> </span><span class="annot"><span class="annottext">(AnnotatedText (Element Reference) -&gt; SyntaxText)
-&gt; (Reference -&gt; AnnotatedText (Element Reference))
-&gt; Reference
-&gt; SyntaxText
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; Reference -&gt; AnnotatedText (Element Reference)
</span><a href="Unison.Server.Backend.html#formatTypeName%27"><span class="hs-identifier hs-var">formatTypeName'</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621682022446"><span class="hs-identifier hs-var">ppe</span></a></span><span>
</span><span id="line-352"></span><span>
</span><span id="line-353"></span><span class="annot"><a href="Unison.Server.Backend.html#formatTypeName%27"><span class="hs-identifier hs-type">formatTypeName'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.PrettyPrintEnv.html#PrettyPrintEnv"><span class="hs-identifier hs-type">PPE.PrettyPrintEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#SyntaxText"><span class="hs-identifier hs-type">SyntaxText</span></a></span><span>
</span><span id="line-354"></span><span id="formatTypeName%27"><span class="annot"><span class="annottext">formatTypeName' :: PrettyPrintEnv -&gt; Reference -&gt; AnnotatedText (Element Reference)
</span><a href="Unison.Server.Backend.html#formatTypeName%27"><span class="hs-identifier hs-var hs-var">formatTypeName'</span></a></span></span><span> </span><span id="local-6989586621682022444"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621682022444"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span id="local-6989586621682022443"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022443"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-355"></span><span>  </span><span class="annot"><span class="annottext">Pretty (AnnotatedText (Element Reference))
-&gt; AnnotatedText (Element Reference)
forall s. (Monoid s, IsString s) =&gt; Pretty s -&gt; s
</span><a href="Unison.Util.Pretty.html#renderUnbroken"><span class="hs-identifier hs-var">Pretty.renderUnbroken</span></a></span><span> </span><span class="annot"><span class="annottext">(Pretty (AnnotatedText (Element Reference))
 -&gt; AnnotatedText (Element Reference))
-&gt; (HashQualified Name
    -&gt; Pretty (AnnotatedText (Element Reference)))
-&gt; HashQualified Name
-&gt; AnnotatedText (Element Reference)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span>
</span><span id="line-356"></span><span>  </span><span class="annot"><span class="annottext">(Pretty (AnnotatedText (Element Reference))
 -&gt; Pretty (AnnotatedText (Element Reference)))
-&gt; HashQualified Name -&gt; Pretty (AnnotatedText (Element Reference))
forall s.
IsString s =&gt;
(Pretty s -&gt; Pretty s) -&gt; HashQualified Name -&gt; Pretty s
</span><a href="Unison.NamePrinter.html#styleHashQualified"><span class="hs-identifier hs-var">NP.styleHashQualified</span></a></span><span> </span><span class="annot"><span class="annottext">Pretty (AnnotatedText (Element Reference))
-&gt; Pretty (AnnotatedText (Element Reference))
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">(HashQualified Name -&gt; AnnotatedText (Element Reference))
-&gt; HashQualified Name -&gt; AnnotatedText (Element Reference)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-357"></span><span>  </span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; Reference -&gt; HashQualified Name
</span><a href="Unison.PrettyPrintEnv.html#typeName"><span class="hs-identifier hs-var">PPE.typeName</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621682022444"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022443"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-358"></span><span>
</span><span id="line-359"></span><span id="local-6989586621682022439"><span id="local-6989586621682022440"><span class="annot"><a href="Unison.Server.Backend.html#termEntryToNamedTerm"><span class="hs-identifier hs-type">termEntryToNamedTerm</span></a></span><span>
</span><span id="line-360"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621682022440"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.PrettyPrintEnv.html#PrettyPrintEnv"><span class="hs-identifier hs-type">PPE.PrettyPrintEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Unison.Util.Pretty.html#Width"><span class="hs-identifier hs-type">Width</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#TermEntry"><span class="hs-identifier hs-type">TermEntry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022440"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022439"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Types.html#NamedTerm"><span class="hs-identifier hs-type">NamedTerm</span></a></span></span></span><span>
</span><span id="line-361"></span><span id="termEntryToNamedTerm"><span class="annot"><span class="annottext">termEntryToNamedTerm :: PrettyPrintEnv -&gt; Maybe Width -&gt; TermEntry v a -&gt; NamedTerm
</span><a href="Unison.Server.Backend.html#termEntryToNamedTerm"><span class="hs-identifier hs-var hs-var">termEntryToNamedTerm</span></a></span></span><span> </span><span id="local-6989586621682022437"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621682022437"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span id="local-6989586621682022436"><span class="annot"><span class="annottext">Maybe Width
</span><a href="#local-6989586621682022436"><span class="hs-identifier hs-var">typeWidth</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Backend.html#TermEntry"><span class="hs-identifier hs-type">TermEntry</span></a></span><span> </span><span id="local-6989586621682022435"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621682022435"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682022434"><span class="annot"><span class="annottext">HQSegment
</span><a href="#local-6989586621682022434"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621682022433"><span class="annot"><span class="annottext">Maybe (Type v a)
</span><a href="#local-6989586621682022433"><span class="hs-identifier hs-var">mayType</span></a></span></span><span> </span><span id="local-6989586621682022432"><span class="annot"><span class="annottext">Maybe TermTag
</span><a href="#local-6989586621682022432"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NamedTerm :: Text -&gt; Text -&gt; Maybe SyntaxText -&gt; Maybe TermTag -&gt; NamedTerm
</span><a href="Unison.Server.Types.html#NamedTerm"><span class="hs-identifier hs-type">NamedTerm</span></a></span><span>
</span><span id="line-362"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">termName :: Text
</span><a href="Unison.Server.Types.html#termName"><span class="hs-identifier hs-var">termName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HQSegment -&gt; Text
forall n. Show n =&gt; HashQualified n -&gt; Text
</span><span class="hs-identifier hs-var">HQ'.toText</span></span><span> </span><span class="annot"><span class="annottext">HQSegment
</span><a href="#local-6989586621682022434"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-363"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">termHash :: Text
</span><a href="Unison.Server.Types.html#termHash"><span class="hs-identifier hs-var">termHash</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Referent -&gt; Text
</span><span class="hs-identifier hs-var">Referent.toText</span></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621682022435"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-364"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">termType :: Maybe SyntaxText
</span><a href="Unison.Server.Types.html#termType"><span class="hs-identifier hs-var">termType</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; Width -&gt; Type v a -&gt; SyntaxText
forall v a.
Var v =&gt;
PrettyPrintEnv -&gt; Width -&gt; Type v a -&gt; SyntaxText
</span><a href="Unison.Server.Backend.html#formatType"><span class="hs-identifier hs-var">formatType</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621682022437"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Width -&gt; Width
</span><a href="Unison.Server.Types.html#mayDefaultWidth"><span class="hs-identifier hs-var">mayDefaultWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Width
</span><a href="#local-6989586621682022436"><span class="hs-identifier hs-var">typeWidth</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Type v a -&gt; SyntaxText) -&gt; Maybe (Type v a) -&gt; Maybe SyntaxText
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Type v a)
</span><a href="#local-6989586621682022433"><span class="hs-identifier hs-var">mayType</span></a></span><span>
</span><span id="line-365"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">termTag :: Maybe TermTag
</span><a href="Unison.Server.Types.html#termTag"><span class="hs-identifier hs-var">termTag</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe TermTag
</span><a href="#local-6989586621682022432"><span class="hs-identifier hs-var">tag</span></a></span><span>
</span><span id="line-366"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-367"></span><span>
</span><span id="line-368"></span><span class="annot"><a href="Unison.Server.Backend.html#typeEntryToNamedType"><span class="hs-identifier hs-type">typeEntryToNamedType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#TypeEntry"><span class="hs-identifier hs-type">TypeEntry</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Types.html#NamedType"><span class="hs-identifier hs-type">NamedType</span></a></span><span>
</span><span id="line-369"></span><span id="typeEntryToNamedType"><span class="annot"><span class="annottext">typeEntryToNamedType :: TypeEntry -&gt; NamedType
</span><a href="Unison.Server.Backend.html#typeEntryToNamedType"><span class="hs-identifier hs-var hs-var">typeEntryToNamedType</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Backend.html#TypeEntry"><span class="hs-identifier hs-type">TypeEntry</span></a></span><span> </span><span id="local-6989586621682022422"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022422"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682022421"><span class="annot"><span class="annottext">HQSegment
</span><a href="#local-6989586621682022421"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621682022420"><span class="annot"><span class="annottext">TypeTag
</span><a href="#local-6989586621682022420"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NamedType :: Text -&gt; Text -&gt; TypeTag -&gt; NamedType
</span><a href="Unison.Server.Types.html#NamedType"><span class="hs-identifier hs-type">NamedType</span></a></span><span>
</span><span id="line-370"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">typeName :: Text
</span><a href="Unison.Server.Types.html#typeName"><span class="hs-identifier hs-var">typeName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HQSegment -&gt; Text
forall n. Show n =&gt; HashQualified n -&gt; Text
</span><span class="hs-identifier hs-var">HQ'.toText</span></span><span> </span><span class="annot"><span class="annottext">HQSegment
</span><a href="#local-6989586621682022421"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-371"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">typeHash :: Text
</span><a href="Unison.Server.Types.html#typeHash"><span class="hs-identifier hs-var">typeHash</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Text
</span><span class="hs-identifier hs-var">Reference.toText</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022422"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-372"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">typeTag :: TypeTag
</span><a href="Unison.Server.Types.html#typeTag"><span class="hs-identifier hs-var">typeTag</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeTag
</span><a href="#local-6989586621682022420"><span class="hs-identifier hs-var">tag</span></a></span><span>
</span><span id="line-373"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-374"></span><span>
</span><span id="line-375"></span><span id="local-6989586621682023206"><span id="local-6989586621682023207"><span class="annot"><a href="Unison.Server.Backend.html#findShallowInBranch"><span class="hs-identifier hs-type">findShallowInBranch</span></a></span><span>
</span><span id="line-376"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621682023207"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621682023206"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-377"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Type.html#Codebase"><span class="hs-identifier hs-type">Codebase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682023207"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682023206"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="Unison.Parser.Ann.html#Ann"><span class="hs-identifier hs-type">Ann</span></a></span><span>
</span><span id="line-378"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Branch.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682023207"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-379"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682023207"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Unison.Server.Backend.html#ShallowListEntry"><span class="hs-identifier hs-type">ShallowListEntry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682023206"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="Unison.Parser.Ann.html#Ann"><span class="hs-identifier hs-type">Ann</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-380"></span><span id="findShallowInBranch"><span class="annot"><span class="annottext">findShallowInBranch :: Codebase m v Ann -&gt; Branch m -&gt; Backend m [ShallowListEntry v Ann]
</span><a href="Unison.Server.Backend.html#findShallowInBranch"><span class="hs-identifier hs-var hs-var">findShallowInBranch</span></a></span></span><span> </span><span id="local-6989586621682022414"><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621682022414"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621682022413"><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621682022413"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-381"></span><span>  </span><span id="local-6989586621682022412"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682022412"><span class="hs-identifier hs-var">hashLength</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Int -&gt; ExceptT BackendError m Int
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m Int -&gt; ExceptT BackendError m Int)
-&gt; m Int -&gt; ExceptT BackendError m Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann -&gt; m Int
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; m Int
</span><a href="Unison.Codebase.Type.html#hashLength"><span class="hs-identifier hs-var hs-var">Codebase.hashLength</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621682022414"><span class="hs-identifier hs-var">codebase</span></a></span><span>
</span><span id="line-382"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682022411"><span class="annot"><span class="annottext">hqTerm :: Branch0 m -&gt; NameSegment -&gt; Referent -&gt; HQSegment
</span><a href="#local-6989586621682022411"><span class="hs-identifier hs-var hs-var">hqTerm</span></a></span></span><span> </span><span id="local-6989586621682022410"><span class="annot"><span class="annottext">Branch0 m
</span><a href="#local-6989586621682022410"><span class="hs-identifier hs-var">b0</span></a></span></span><span> </span><span id="local-6989586621682022409"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621682022409"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span id="local-6989586621682022408"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621682022408"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-383"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682022407"><span class="annot"><span class="annottext">refs :: Set Referent
</span><a href="#local-6989586621682022407"><span class="hs-identifier hs-var hs-var">refs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NameSegment
-&gt; Star3 Referent NameSegment Reference (Reference, Reference)
-&gt; Set Referent
forall fact d1 d2 d3.
(Ord fact, Ord d1) =&gt;
d1 -&gt; Star3 fact d1 d2 d3 -&gt; Set fact
</span><a href="Unison.Util.Star3.html#lookupD1"><span class="hs-identifier hs-var">Star3.lookupD1</span></a></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621682022409"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="annot"><span class="annottext">(Star3 Referent NameSegment Reference (Reference, Reference)
 -&gt; Set Referent)
-&gt; (Branch0 m
    -&gt; Star3 Referent NameSegment Reference (Reference, Reference))
-&gt; Branch0 m
-&gt; Set Referent
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Branch0 m
-&gt; Star3 Referent NameSegment Reference (Reference, Reference)
forall (m :: * -&gt; *).
Branch0 m
-&gt; Star3 Referent NameSegment Reference (Reference, Reference)
</span><a href="Unison.Codebase.Branch.html#_terms"><span class="hs-identifier hs-var hs-var">Branch._terms</span></a></span><span> </span><span class="annot"><span class="annottext">(Branch0 m -&gt; Set Referent) -&gt; Branch0 m -&gt; Set Referent
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Branch0 m
</span><a href="#local-6989586621682022410"><span class="hs-identifier hs-var">b0</span></a></span><span>
</span><span id="line-384"></span><span>        </span><span class="hs-keyword">in</span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Set Referent -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621682022407"><span class="hs-identifier hs-var">refs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-385"></span><span>              </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NameSegment -&gt; HQSegment
forall n. n -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ'.fromName</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621682022409"><span class="hs-identifier hs-var">ns</span></a></span><span>
</span><span id="line-386"></span><span>              </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; HQSegment -&gt; HQSegment
forall n. Int -&gt; HashQualified n -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ'.take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682022412"><span class="hs-identifier hs-var">hashLength</span></a></span><span> </span><span class="annot"><span class="annottext">(HQSegment -&gt; HQSegment) -&gt; HQSegment -&gt; HQSegment
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NameSegment -&gt; Referent -&gt; HQSegment
forall n. n -&gt; Referent -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ'.fromNamedReferent</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621682022409"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621682022408"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-387"></span><span>      </span><span id="local-6989586621682022401"><span class="annot"><span class="annottext">hqType :: Branch0 m -&gt; NameSegment -&gt; Reference -&gt; HQSegment
</span><a href="#local-6989586621682022401"><span class="hs-identifier hs-var hs-var">hqType</span></a></span></span><span> </span><span id="local-6989586621682022400"><span class="annot"><span class="annottext">Branch0 m
</span><a href="#local-6989586621682022400"><span class="hs-identifier hs-var">b0</span></a></span></span><span> </span><span id="local-6989586621682022399"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621682022399"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span id="local-6989586621682022398"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022398"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-388"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682022397"><span class="annot"><span class="annottext">refs :: Set Reference
</span><a href="#local-6989586621682022397"><span class="hs-identifier hs-var hs-var">refs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NameSegment
-&gt; Star3 Reference NameSegment Reference (Reference, Reference)
-&gt; Set Reference
forall fact d1 d2 d3.
(Ord fact, Ord d1) =&gt;
d1 -&gt; Star3 fact d1 d2 d3 -&gt; Set fact
</span><a href="Unison.Util.Star3.html#lookupD1"><span class="hs-identifier hs-var">Star3.lookupD1</span></a></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621682022399"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="annot"><span class="annottext">(Star3 Reference NameSegment Reference (Reference, Reference)
 -&gt; Set Reference)
-&gt; (Branch0 m
    -&gt; Star3 Reference NameSegment Reference (Reference, Reference))
-&gt; Branch0 m
-&gt; Set Reference
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Branch0 m
-&gt; Star3 Reference NameSegment Reference (Reference, Reference)
forall (m :: * -&gt; *).
Branch0 m
-&gt; Star3 Reference NameSegment Reference (Reference, Reference)
</span><a href="Unison.Codebase.Branch.html#_types"><span class="hs-identifier hs-var hs-var">Branch._types</span></a></span><span> </span><span class="annot"><span class="annottext">(Branch0 m -&gt; Set Reference) -&gt; Branch0 m -&gt; Set Reference
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Branch0 m
</span><a href="#local-6989586621682022400"><span class="hs-identifier hs-var">b0</span></a></span><span>
</span><span id="line-389"></span><span>        </span><span class="hs-keyword">in</span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Set Reference -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621682022397"><span class="hs-identifier hs-var">refs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-390"></span><span>              </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NameSegment -&gt; HQSegment
forall n. n -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ'.fromName</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621682022399"><span class="hs-identifier hs-var">ns</span></a></span><span>
</span><span id="line-391"></span><span>              </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; HQSegment -&gt; HQSegment
forall n. Int -&gt; HashQualified n -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ'.take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682022412"><span class="hs-identifier hs-var">hashLength</span></a></span><span> </span><span class="annot"><span class="annottext">(HQSegment -&gt; HQSegment) -&gt; HQSegment -&gt; HQSegment
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NameSegment -&gt; Reference -&gt; HQSegment
forall n. n -&gt; Reference -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ'.fromNamedReference</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621682022399"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022398"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-392"></span><span>      </span><span id="local-6989586621682022394"><span class="annot"><span class="annottext">defnCount :: Branch m -&gt; Int
</span><a href="#local-6989586621682022394"><span class="hs-identifier hs-var hs-var">defnCount</span></a></span></span><span> </span><span id="local-6989586621682022393"><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621682022393"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-393"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Relation Referent Name -&gt; Int
forall a b. Relation a b -&gt; Int
</span><span class="hs-identifier hs-var">R.size</span></span><span> </span><span class="annot"><span class="annottext">(Relation Referent Name -&gt; Int)
-&gt; (Branch0 m -&gt; Relation Referent Name) -&gt; Branch0 m -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Branch0 m -&gt; Relation Referent Name
forall (m :: * -&gt; *). Branch0 m -&gt; Relation Referent Name
</span><a href="Unison.Codebase.Branch.html#deepTerms"><span class="hs-identifier hs-var hs-var">Branch.deepTerms</span></a></span><span> </span><span class="annot"><span class="annottext">(Branch0 m -&gt; Int) -&gt; Branch0 m -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Branch m -&gt; Branch0 m
forall (m :: * -&gt; *). Branch m -&gt; Branch0 m
</span><a href="Unison.Codebase.Branch.html#head"><span class="hs-identifier hs-var">Branch.head</span></a></span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621682022393"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-394"></span><span>          </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Relation Reference Name -&gt; Int
forall a b. Relation a b -&gt; Int
</span><span class="hs-identifier hs-var">R.size</span></span><span> </span><span class="annot"><span class="annottext">(Relation Reference Name -&gt; Int)
-&gt; (Branch0 m -&gt; Relation Reference Name) -&gt; Branch0 m -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Branch0 m -&gt; Relation Reference Name
forall (m :: * -&gt; *). Branch0 m -&gt; Relation Reference Name
</span><a href="Unison.Codebase.Branch.html#deepTypes"><span class="hs-identifier hs-var hs-var">Branch.deepTypes</span></a></span><span> </span><span class="annot"><span class="annottext">(Branch0 m -&gt; Int) -&gt; Branch0 m -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Branch m -&gt; Branch0 m
forall (m :: * -&gt; *). Branch m -&gt; Branch0 m
</span><a href="Unison.Codebase.Branch.html#head"><span class="hs-identifier hs-var">Branch.head</span></a></span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621682022393"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-395"></span><span>      </span><span id="local-6989586621682022388"><span class="annot"><span class="annottext">b0 :: Branch0 m
</span><a href="#local-6989586621682022388"><span class="hs-identifier hs-var hs-var">b0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Branch m -&gt; Branch0 m
forall (m :: * -&gt; *). Branch m -&gt; Branch0 m
</span><a href="Unison.Codebase.Branch.html#head"><span class="hs-identifier hs-var">Branch.head</span></a></span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621682022413"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-396"></span><span>  </span><span id="local-6989586621682022387"><span class="annot"><span class="annottext">[ShallowListEntry v Ann]
</span><a href="#local-6989586621682022387"><span class="hs-identifier hs-var">termEntries</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Referent, NameSegment)]
-&gt; ((Referent, NameSegment)
    -&gt; ExceptT BackendError m (ShallowListEntry v Ann))
-&gt; Backend m [ShallowListEntry v Ann]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Relation Referent NameSegment -&gt; [(Referent, NameSegment)]
forall a b. Relation a b -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">R.toList</span></span><span> </span><span class="annot"><span class="annottext">(Relation Referent NameSegment -&gt; [(Referent, NameSegment)])
-&gt; (Star3 Referent NameSegment Reference (Reference, Reference)
    -&gt; Relation Referent NameSegment)
-&gt; Star3 Referent NameSegment Reference (Reference, Reference)
-&gt; [(Referent, NameSegment)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Star3 Referent NameSegment Reference (Reference, Reference)
-&gt; Relation Referent NameSegment
forall fact d1 d2 d3. Star3 fact d1 d2 d3 -&gt; Relation fact d1
</span><a href="Unison.Util.Star3.html#d1"><span class="hs-identifier hs-var hs-var">Star3.d1</span></a></span><span> </span><span class="annot"><span class="annottext">(Star3 Referent NameSegment Reference (Reference, Reference)
 -&gt; [(Referent, NameSegment)])
-&gt; Star3 Referent NameSegment Reference (Reference, Reference)
-&gt; [(Referent, NameSegment)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Branch0 m
-&gt; Star3 Referent NameSegment Reference (Reference, Reference)
forall (m :: * -&gt; *).
Branch0 m
-&gt; Star3 Referent NameSegment Reference (Reference, Reference)
</span><a href="Unison.Codebase.Branch.html#_terms"><span class="hs-identifier hs-var hs-var">Branch._terms</span></a></span><span> </span><span class="annot"><span class="annottext">Branch0 m
</span><a href="#local-6989586621682022388"><span class="hs-identifier hs-var">b0</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(((Referent, NameSegment)
  -&gt; ExceptT BackendError m (ShallowListEntry v Ann))
 -&gt; Backend m [ShallowListEntry v Ann])
-&gt; ((Referent, NameSegment)
    -&gt; ExceptT BackendError m (ShallowListEntry v Ann))
-&gt; Backend m [ShallowListEntry v Ann]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682022384"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621682022384"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682022383"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621682022383"><span class="hs-identifier hs-var">ns</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-397"></span><span>    </span><span class="annot"><span class="annottext">TermEntry v Ann -&gt; ShallowListEntry v Ann
forall v a. TermEntry v a -&gt; ShallowListEntry v a
</span><a href="Unison.Server.Backend.html#ShallowTermEntry"><span class="hs-identifier hs-var">ShallowTermEntry</span></a></span><span> </span><span class="annot"><span class="annottext">(TermEntry v Ann -&gt; ShallowListEntry v Ann)
-&gt; ExceptT BackendError m (TermEntry v Ann)
-&gt; ExceptT BackendError m (ShallowListEntry v Ann)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann
-&gt; Branch0 m
-&gt; Referent
-&gt; HQSegment
-&gt; ExceptT BackendError m (TermEntry v Ann)
forall (m :: * -&gt; *) v.
(Monad m, Var v) =&gt;
Codebase m v Ann
-&gt; Branch0 m
-&gt; Referent
-&gt; HQSegment
-&gt; Backend m (TermEntry v Ann)
</span><a href="Unison.Server.Backend.html#termListEntry"><span class="hs-identifier hs-var">termListEntry</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621682022414"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Branch0 m
</span><a href="#local-6989586621682022388"><span class="hs-identifier hs-var">b0</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621682022384"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch0 m -&gt; NameSegment -&gt; Referent -&gt; HQSegment
forall (m :: * -&gt; *).
Branch0 m -&gt; NameSegment -&gt; Referent -&gt; HQSegment
</span><a href="#local-6989586621682022411"><span class="hs-identifier hs-var">hqTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Branch0 m
</span><a href="#local-6989586621682022388"><span class="hs-identifier hs-var">b0</span></a></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621682022383"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621682022384"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-398"></span><span>  </span><span id="local-6989586621682022382"><span class="annot"><span class="annottext">[ShallowListEntry v Ann]
</span><a href="#local-6989586621682022382"><span class="hs-identifier hs-var">typeEntries</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Reference, NameSegment)]
-&gt; ((Reference, NameSegment)
    -&gt; ExceptT BackendError m (ShallowListEntry v Ann))
-&gt; Backend m [ShallowListEntry v Ann]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Relation Reference NameSegment -&gt; [(Reference, NameSegment)]
forall a b. Relation a b -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">R.toList</span></span><span> </span><span class="annot"><span class="annottext">(Relation Reference NameSegment -&gt; [(Reference, NameSegment)])
-&gt; (Star3 Reference NameSegment Reference (Reference, Reference)
    -&gt; Relation Reference NameSegment)
-&gt; Star3 Reference NameSegment Reference (Reference, Reference)
-&gt; [(Reference, NameSegment)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Star3 Reference NameSegment Reference (Reference, Reference)
-&gt; Relation Reference NameSegment
forall fact d1 d2 d3. Star3 fact d1 d2 d3 -&gt; Relation fact d1
</span><a href="Unison.Util.Star3.html#d1"><span class="hs-identifier hs-var hs-var">Star3.d1</span></a></span><span> </span><span class="annot"><span class="annottext">(Star3 Reference NameSegment Reference (Reference, Reference)
 -&gt; [(Reference, NameSegment)])
-&gt; Star3 Reference NameSegment Reference (Reference, Reference)
-&gt; [(Reference, NameSegment)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Branch0 m
-&gt; Star3 Reference NameSegment Reference (Reference, Reference)
forall (m :: * -&gt; *).
Branch0 m
-&gt; Star3 Reference NameSegment Reference (Reference, Reference)
</span><a href="Unison.Codebase.Branch.html#_types"><span class="hs-identifier hs-var hs-var">Branch._types</span></a></span><span> </span><span class="annot"><span class="annottext">Branch0 m
</span><a href="#local-6989586621682022388"><span class="hs-identifier hs-var">b0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-399"></span><span>    </span><span class="annot"><span class="annottext">(((Reference, NameSegment)
  -&gt; ExceptT BackendError m (ShallowListEntry v Ann))
 -&gt; Backend m [ShallowListEntry v Ann])
-&gt; ((Reference, NameSegment)
    -&gt; ExceptT BackendError m (ShallowListEntry v Ann))
-&gt; Backend m [ShallowListEntry v Ann]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682022381"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022381"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682022380"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621682022380"><span class="hs-identifier hs-var">ns</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeEntry -&gt; ShallowListEntry v Ann
forall v a. TypeEntry -&gt; ShallowListEntry v a
</span><a href="Unison.Server.Backend.html#ShallowTypeEntry"><span class="hs-identifier hs-var">ShallowTypeEntry</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeEntry -&gt; ShallowListEntry v Ann)
-&gt; ExceptT BackendError m TypeEntry
-&gt; ExceptT BackendError m (ShallowListEntry v Ann)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann
-&gt; Reference -&gt; HQSegment -&gt; ExceptT BackendError m TypeEntry
forall (m :: * -&gt; *) v.
(Monad m, Var v) =&gt;
Codebase m v Ann -&gt; Reference -&gt; HQSegment -&gt; Backend m TypeEntry
</span><a href="Unison.Server.Backend.html#typeListEntry"><span class="hs-identifier hs-var">typeListEntry</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621682022414"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022381"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch0 m -&gt; NameSegment -&gt; Reference -&gt; HQSegment
forall (m :: * -&gt; *).
Branch0 m -&gt; NameSegment -&gt; Reference -&gt; HQSegment
</span><a href="#local-6989586621682022401"><span class="hs-identifier hs-var">hqType</span></a></span><span> </span><span class="annot"><span class="annottext">Branch0 m
</span><a href="#local-6989586621682022388"><span class="hs-identifier hs-var">b0</span></a></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621682022380"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022381"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-400"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-401"></span><span>    </span><span id="local-6989586621682022379"><span class="annot"><span class="annottext">branchEntries :: [ShallowListEntry v a]
</span><a href="#local-6989586621682022379"><span class="hs-identifier hs-var hs-var">branchEntries</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-402"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">NameSegment -&gt; ShortBranchHash -&gt; Int -&gt; ShallowListEntry v a
forall v a.
NameSegment -&gt; ShortBranchHash -&gt; Int -&gt; ShallowListEntry v a
</span><a href="Unison.Server.Backend.html#ShallowBranchEntry"><span class="hs-identifier hs-var">ShallowBranchEntry</span></a></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621682022378"><span class="hs-identifier hs-var">ns</span></a></span><span>
</span><span id="line-403"></span><span>                           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hash -&gt; ShortBranchHash
forall h. Coercible h Hash =&gt; h -&gt; ShortBranchHash
</span><a href="Unison.Codebase.ShortBranchHash.html#fullFromHash"><span class="hs-identifier hs-var">SBH.fullFromHash</span></a></span><span> </span><span class="annot"><span class="annottext">(Hash -&gt; ShortBranchHash) -&gt; Hash -&gt; ShortBranchHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Branch m -&gt; Hash
forall (m :: * -&gt; *). Branch m -&gt; Hash
</span><a href="Unison.Codebase.Branch.html#headHash"><span class="hs-identifier hs-var">Branch.headHash</span></a></span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621682022375"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-404"></span><span>                           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch m -&gt; Int
forall (m :: * -&gt; *). Branch m -&gt; Int
</span><a href="#local-6989586621682022394"><span class="hs-identifier hs-var">defnCount</span></a></span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621682022375"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-405"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682022378"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621682022378"><span class="hs-identifier hs-var">ns</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682022375"><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621682022375"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map NameSegment (Branch m) -&gt; [(NameSegment, Branch m)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">(Map NameSegment (Branch m) -&gt; [(NameSegment, Branch m)])
-&gt; Map NameSegment (Branch m) -&gt; [(NameSegment, Branch m)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Branch0 m -&gt; Map NameSegment (Branch m)
forall (m :: * -&gt; *). Branch0 m -&gt; Map NameSegment (Branch m)
</span><a href="Unison.Codebase.Branch.html#_children"><span class="hs-identifier hs-var hs-var">Branch._children</span></a></span><span> </span><span class="annot"><span class="annottext">Branch0 m
</span><a href="#local-6989586621682022388"><span class="hs-identifier hs-var">b0</span></a></span><span>
</span><span id="line-406"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-407"></span><span>    </span><span id="local-6989586621682022372"><span class="annot"><span class="annottext">patchEntries :: [ShallowListEntry v a]
</span><a href="#local-6989586621682022372"><span class="hs-identifier hs-var hs-var">patchEntries</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-408"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">NameSegment -&gt; ShallowListEntry v a
forall v a. NameSegment -&gt; ShallowListEntry v a
</span><a href="Unison.Server.Backend.html#ShallowPatchEntry"><span class="hs-identifier hs-var">ShallowPatchEntry</span></a></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621682022371"><span class="hs-identifier hs-var">ns</span></a></span><span>
</span><span id="line-409"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682022371"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621682022371"><span class="hs-identifier hs-var">ns</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682022370"><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621682022370"><span class="hs-identifier hs-var">_h</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682022369"><span class="annot"><span class="annottext">m Patch
</span><a href="#local-6989586621682022369"><span class="hs-identifier hs-var">_mp</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map NameSegment (Hash, m Patch) -&gt; [(NameSegment, (Hash, m Patch))]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">(Map NameSegment (Hash, m Patch)
 -&gt; [(NameSegment, (Hash, m Patch))])
-&gt; Map NameSegment (Hash, m Patch)
-&gt; [(NameSegment, (Hash, m Patch))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Branch0 m -&gt; Map NameSegment (Hash, m Patch)
forall (m :: * -&gt; *). Branch0 m -&gt; Map NameSegment (Hash, m Patch)
</span><a href="Unison.Codebase.Branch.html#_edits"><span class="hs-identifier hs-var hs-var">Branch._edits</span></a></span><span> </span><span class="annot"><span class="annottext">Branch0 m
</span><a href="#local-6989586621682022388"><span class="hs-identifier hs-var">b0</span></a></span><span>
</span><span id="line-410"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-411"></span><span>  </span><span class="annot"><span class="annottext">[ShallowListEntry v Ann] -&gt; Backend m [ShallowListEntry v Ann]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-412"></span><span>    </span><span class="annot"><span class="annottext">([ShallowListEntry v Ann] -&gt; Backend m [ShallowListEntry v Ann])
-&gt; ([ShallowListEntry v Ann] -&gt; [ShallowListEntry v Ann])
-&gt; [ShallowListEntry v Ann]
-&gt; Backend m [ShallowListEntry v Ann]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span>  </span><span class="annot"><span class="annottext">(ShallowListEntry v Ann -&gt; Text)
-&gt; [ShallowListEntry v Ann] -&gt; [ShallowListEntry v Ann]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">List.sortOn</span></span><span> </span><span class="annot"><span class="annottext">ShallowListEntry v Ann -&gt; Text
forall v a. ShallowListEntry v a -&gt; Text
</span><a href="Unison.Server.Backend.html#listEntryName"><span class="hs-identifier hs-var">listEntryName</span></a></span><span>
</span><span id="line-413"></span><span>    </span><span class="annot"><span class="annottext">([ShallowListEntry v Ann] -&gt; Backend m [ShallowListEntry v Ann])
-&gt; [ShallowListEntry v Ann] -&gt; Backend m [ShallowListEntry v Ann]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>  </span><span class="annot"><span class="annottext">[ShallowListEntry v Ann]
</span><a href="#local-6989586621682022387"><span class="hs-identifier hs-var">termEntries</span></a></span><span>
</span><span id="line-414"></span><span>    </span><span class="annot"><span class="annottext">[ShallowListEntry v Ann]
-&gt; [ShallowListEntry v Ann] -&gt; [ShallowListEntry v Ann]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[ShallowListEntry v Ann]
</span><a href="#local-6989586621682022382"><span class="hs-identifier hs-var">typeEntries</span></a></span><span>
</span><span id="line-415"></span><span>    </span><span class="annot"><span class="annottext">[ShallowListEntry v Ann]
-&gt; [ShallowListEntry v Ann] -&gt; [ShallowListEntry v Ann]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[ShallowListEntry v Ann]
forall v a. [ShallowListEntry v a]
</span><a href="#local-6989586621682022379"><span class="hs-identifier hs-var">branchEntries</span></a></span><span>
</span><span id="line-416"></span><span>    </span><span class="annot"><span class="annottext">[ShallowListEntry v Ann]
-&gt; [ShallowListEntry v Ann] -&gt; [ShallowListEntry v Ann]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[ShallowListEntry v Ann]
forall v a. [ShallowListEntry v a]
</span><a href="#local-6989586621682022372"><span class="hs-identifier hs-var">patchEntries</span></a></span><span>
</span><span id="line-417"></span><span>
</span><span id="line-418"></span><span id="local-6989586621682022365"><span id="local-6989586621682022366"><span id="local-6989586621682022367"><span class="annot"><a href="Unison.Server.Backend.html#termReferencesByShortHash"><span class="hs-identifier hs-type">termReferencesByShortHash</span></a></span><span>
</span><span id="line-419"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621682022367"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Type.html#Codebase"><span class="hs-identifier hs-type">Codebase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022367"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022366"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022365"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ShortHash</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682022367"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-420"></span><span id="typeReferencesByShortHash"><span class="annot"><span class="annottext">typeReferencesByShortHash :: Codebase m v a -&gt; ShortHash -&gt; m (Set Reference)
</span><a href="Unison.Server.Backend.html#typeReferencesByShortHash"><span class="hs-identifier hs-var hs-var">typeReferencesByShortHash</span></a></span></span><span> </span><span id="local-6989586621682022362"><span class="annot"><span class="annottext">Codebase m v a
</span><a href="#local-6989586621682022362"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621682022361"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621682022361"><span class="hs-identifier hs-var">sh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-421"></span><span>  </span><span id="local-6989586621682022360"><span class="annot"><span class="annottext">Set Id
</span><a href="#local-6989586621682022360"><span class="hs-identifier hs-var">fromCodebase</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase m v a -&gt; ShortHash -&gt; m (Set Id)
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; ShortHash -&gt; m (Set Id)
</span><a href="Unison.Codebase.Type.html#typeReferencesByPrefix"><span class="hs-identifier hs-var hs-var">Codebase.typeReferencesByPrefix</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m v a
</span><a href="#local-6989586621682022362"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621682022361"><span class="hs-identifier hs-var">sh</span></a></span><span>
</span><span id="line-422"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682022358"><span class="annot"><span class="annottext">fromBuiltins :: Set Reference
</span><a href="#local-6989586621682022358"><span class="hs-identifier hs-var hs-var">fromBuiltins</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; Bool) -&gt; Set Reference -&gt; Set Reference
forall a. (a -&gt; Bool) -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682022356"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022356"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621682022361"><span class="hs-identifier hs-var">sh</span></a></span><span> </span><span class="annot"><span class="annottext">ShortHash -&gt; ShortHash -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; ShortHash
</span><span class="hs-identifier hs-var">Reference.toShortHash</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022356"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-423"></span><span>                                </span><span class="annot"><span class="annottext">Set Reference
</span><a href="Unison.Builtin.html#intrinsicTypeReferences"><span class="hs-identifier hs-var">B.intrinsicTypeReferences</span></a></span><span>
</span><span id="line-424"></span><span>  </span><span class="annot"><span class="annottext">Set Reference -&gt; m (Set Reference)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621682022358"><span class="hs-identifier hs-var">fromBuiltins</span></a></span><span> </span><span class="annot"><span class="annottext">Set Reference -&gt; Set Reference -&gt; Set Reference
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Reference) -&gt; Set Id -&gt; Set Reference
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Reference
</span><span class="hs-identifier hs-var">Reference.DerivedId</span></span><span> </span><span class="annot"><span class="annottext">Set Id
</span><a href="#local-6989586621682022360"><span class="hs-identifier hs-var">fromCodebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-425"></span><span>
</span><span id="line-426"></span><span id="local-6989586621682023037"><span id="local-6989586621682023038"><span id="local-6989586621682023039"><span class="annot"><a href="Unison.Server.Backend.html#typeReferencesByShortHash"><span class="hs-identifier hs-type">typeReferencesByShortHash</span></a></span><span>
</span><span id="line-427"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621682023039"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Type.html#Codebase"><span class="hs-identifier hs-type">Codebase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682023039"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682023038"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682023037"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ShortHash</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682023039"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-428"></span><span id="termReferencesByShortHash"><span class="annot"><span class="annottext">termReferencesByShortHash :: Codebase m v a -&gt; ShortHash -&gt; m (Set Reference)
</span><a href="Unison.Server.Backend.html#termReferencesByShortHash"><span class="hs-identifier hs-var hs-var">termReferencesByShortHash</span></a></span></span><span> </span><span id="local-6989586621682022353"><span class="annot"><span class="annottext">Codebase m v a
</span><a href="#local-6989586621682022353"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621682022352"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621682022352"><span class="hs-identifier hs-var">sh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-429"></span><span>  </span><span id="local-6989586621682022351"><span class="annot"><span class="annottext">Set Id
</span><a href="#local-6989586621682022351"><span class="hs-identifier hs-var">fromCodebase</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase m v a -&gt; ShortHash -&gt; m (Set Id)
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; ShortHash -&gt; m (Set Id)
</span><a href="Unison.Codebase.Type.html#termReferencesByPrefix"><span class="hs-identifier hs-var hs-var">Codebase.termReferencesByPrefix</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m v a
</span><a href="#local-6989586621682022353"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621682022352"><span class="hs-identifier hs-var">sh</span></a></span><span>
</span><span id="line-430"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682022349"><span class="annot"><span class="annottext">fromBuiltins :: Set Reference
</span><a href="#local-6989586621682022349"><span class="hs-identifier hs-var hs-var">fromBuiltins</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; Bool) -&gt; Set Reference -&gt; Set Reference
forall a. (a -&gt; Bool) -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682022348"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022348"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621682022352"><span class="hs-identifier hs-var">sh</span></a></span><span> </span><span class="annot"><span class="annottext">ShortHash -&gt; ShortHash -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; ShortHash
</span><span class="hs-identifier hs-var">Reference.toShortHash</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022348"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-431"></span><span>                                </span><span class="annot"><span class="annottext">Set Reference
</span><a href="Unison.Builtin.html#intrinsicTermReferences"><span class="hs-identifier hs-var">B.intrinsicTermReferences</span></a></span><span>
</span><span id="line-432"></span><span>  </span><span class="annot"><span class="annottext">Set Reference -&gt; m (Set Reference)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621682022349"><span class="hs-identifier hs-var">fromBuiltins</span></a></span><span> </span><span class="annot"><span class="annottext">Set Reference -&gt; Set Reference -&gt; Set Reference
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Reference) -&gt; Set Id -&gt; Set Reference
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Reference
</span><span class="hs-identifier hs-var">Reference.DerivedId</span></span><span> </span><span class="annot"><span class="annottext">Set Id
</span><a href="#local-6989586621682022351"><span class="hs-identifier hs-var">fromCodebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-433"></span><span>
</span><span id="line-434"></span><span id="local-6989586621682023040"><span id="local-6989586621682023041"><span id="local-6989586621682023042"><span class="annot"><a href="Unison.Server.Backend.html#termReferentsByShortHash"><span class="hs-identifier hs-type">termReferentsByShortHash</span></a></span><span>
</span><span id="line-435"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621682023042"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Type.html#Codebase"><span class="hs-identifier hs-type">Codebase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682023042"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682023041"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682023040"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ShortHash</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682023042"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-436"></span><span id="termReferentsByShortHash"><span class="annot"><span class="annottext">termReferentsByShortHash :: Codebase m v a -&gt; ShortHash -&gt; m (Set Referent)
</span><a href="Unison.Server.Backend.html#termReferentsByShortHash"><span class="hs-identifier hs-var hs-var">termReferentsByShortHash</span></a></span></span><span> </span><span id="local-6989586621682022345"><span class="annot"><span class="annottext">Codebase m v a
</span><a href="#local-6989586621682022345"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621682022344"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621682022344"><span class="hs-identifier hs-var">sh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-437"></span><span>  </span><span id="local-6989586621682022343"><span class="annot"><span class="annottext">Set Id
</span><a href="#local-6989586621682022343"><span class="hs-identifier hs-var">fromCodebase</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase m v a -&gt; ShortHash -&gt; m (Set Id)
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; ShortHash -&gt; m (Set Id)
</span><a href="Unison.Codebase.Type.html#termReferentsByPrefix"><span class="hs-identifier hs-var hs-var">Codebase.termReferentsByPrefix</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m v a
</span><a href="#local-6989586621682022345"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621682022344"><span class="hs-identifier hs-var">sh</span></a></span><span>
</span><span id="line-438"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682022341"><span class="annot"><span class="annottext">fromBuiltins :: Set Referent
</span><a href="#local-6989586621682022341"><span class="hs-identifier hs-var hs-var">fromBuiltins</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; Referent) -&gt; Set Reference -&gt; Set Referent
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Referent
</span><span class="hs-identifier hs-var">Referent.Ref</span></span><span> </span><span class="annot"><span class="annottext">(Set Reference -&gt; Set Referent) -&gt; Set Reference -&gt; Set Referent
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; Bool) -&gt; Set Reference -&gt; Set Reference
forall a. (a -&gt; Bool) -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.filter</span></span><span>
</span><span id="line-439"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682022340"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022340"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621682022344"><span class="hs-identifier hs-var">sh</span></a></span><span> </span><span class="annot"><span class="annottext">ShortHash -&gt; ShortHash -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; ShortHash
</span><span class="hs-identifier hs-var">Reference.toShortHash</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022340"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-440"></span><span>        </span><span class="annot"><span class="annottext">Set Reference
</span><a href="Unison.Builtin.html#intrinsicTermReferences"><span class="hs-identifier hs-var">B.intrinsicTermReferences</span></a></span><span>
</span><span id="line-441"></span><span>  </span><span class="annot"><span class="annottext">Set Referent -&gt; m (Set Referent)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621682022341"><span class="hs-identifier hs-var">fromBuiltins</span></a></span><span> </span><span class="annot"><span class="annottext">Set Referent -&gt; Set Referent -&gt; Set Referent
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Referent) -&gt; Set Id -&gt; Set Referent
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Id -&gt; Reference) -&gt; Id -&gt; Referent
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Reference
</span><span class="hs-identifier hs-var">Reference.DerivedId</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set Id
</span><a href="#local-6989586621682022343"><span class="hs-identifier hs-var">fromCodebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-442"></span><span>
</span><span id="line-443"></span><span class="hs-comment">-- currentPathNames :: Path -&gt; Names</span><span>
</span><span id="line-444"></span><span class="hs-comment">-- currentPathNames = Branch.toNames . Branch.head . Branch.getAt</span><span>
</span><span id="line-445"></span><span>
</span><span id="line-446"></span><span id="local-6989586621682023201"><span class="annot"><a href="Unison.Server.Backend.html#getCurrentPrettyNames"><span class="hs-identifier hs-type">getCurrentPrettyNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Path.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Branch.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682023201"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NamesWithHistory</span></span></span><span>
</span><span id="line-447"></span><span id="getCurrentPrettyNames"><span class="annot"><span class="annottext">getCurrentPrettyNames :: Path -&gt; Branch m -&gt; NamesWithHistory
</span><a href="Unison.Server.Backend.html#getCurrentPrettyNames"><span class="hs-identifier hs-var hs-var">getCurrentPrettyNames</span></a></span></span><span> </span><span id="local-6989586621682022339"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621682022339"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span id="local-6989586621682022338"><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621682022338"><span class="hs-identifier hs-var">root</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-448"></span><span>  </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; NamesWithHistory
</span><span class="hs-identifier hs-var">NamesWithHistory</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch m -&gt; Path -&gt; Names
forall (m :: * -&gt; *). Branch m -&gt; Path -&gt; Names
</span><a href="Unison.Server.Backend.html#basicPrettyPrintNames"><span class="hs-identifier hs-var">basicPrettyPrintNames</span></a></span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621682022338"><span class="hs-identifier hs-var">root</span></a></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621682022339"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Names
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-449"></span><span>
</span><span id="line-450"></span><span id="local-6989586621682022337"><span class="annot"><a href="Unison.Server.Backend.html#getCurrentParseNames"><span class="hs-identifier hs-type">getCurrentParseNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Path.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Branch.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022337"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NamesWithHistory</span></span></span><span>
</span><span id="line-451"></span><span id="getCurrentParseNames"><span class="annot"><span class="annottext">getCurrentParseNames :: Path -&gt; Branch m -&gt; NamesWithHistory
</span><a href="Unison.Server.Backend.html#getCurrentParseNames"><span class="hs-identifier hs-var hs-var">getCurrentParseNames</span></a></span></span><span> </span><span id="local-6989586621682022335"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621682022335"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span id="local-6989586621682022334"><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621682022334"><span class="hs-identifier hs-var">root</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; NamesWithHistory
</span><span class="hs-identifier hs-var">NamesWithHistory</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch m -&gt; Path -&gt; Names
forall (m :: * -&gt; *). Branch m -&gt; Path -&gt; Names
</span><a href="Unison.Server.Backend.html#basicParseNames"><span class="hs-identifier hs-var">basicParseNames</span></a></span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621682022334"><span class="hs-identifier hs-var">root</span></a></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621682022335"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Names
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-452"></span><span>
</span><span id="line-453"></span><span class="hs-comment">-- Any absolute names in the input which have `root` as a prefix</span><span>
</span><span id="line-454"></span><span class="hs-comment">-- are converted to names relative to current path. All other names are</span><span>
</span><span id="line-455"></span><span class="hs-comment">-- converted to absolute names. For example:</span><span>
</span><span id="line-456"></span><span class="hs-comment">--</span><span>
</span><span id="line-457"></span><span class="hs-comment">-- e.g. if currentPath = .foo.bar</span><span>
</span><span id="line-458"></span><span class="hs-comment">--      then name foo.bar.baz becomes baz</span><span>
</span><span id="line-459"></span><span class="hs-comment">--           name cat.dog     becomes .cat.dog</span><span>
</span><span id="line-460"></span><span class="annot"><a href="Unison.Server.Backend.html#fixupNamesRelative"><span class="hs-identifier hs-type">fixupNamesRelative</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Path.html#Absolute"><span class="hs-identifier hs-type">Path.Absolute</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span>
</span><span id="line-461"></span><span id="fixupNamesRelative"><span class="annot"><span class="annottext">fixupNamesRelative :: Absolute -&gt; Names -&gt; Names
</span><a href="Unison.Server.Backend.html#fixupNamesRelative"><span class="hs-identifier hs-var hs-var">fixupNamesRelative</span></a></span></span><span> </span><span id="local-6989586621682022332"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621682022332"><span class="hs-identifier hs-var">root</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Name) -&gt; Names -&gt; Names
</span><span class="hs-identifier hs-var">Names.map</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name
</span><a href="#local-6989586621682022330"><span class="hs-identifier hs-var">fixName</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-462"></span><span>  </span><span id="local-6989586621682022329"><span class="annot"><span class="annottext">prefix :: Name
</span><a href="#local-6989586621682022329"><span class="hs-identifier hs-var hs-var">prefix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Path -&gt; Name
</span><a href="Unison.Codebase.Path.html#toName"><span class="hs-identifier hs-var">Path.toName</span></a></span><span> </span><span class="annot"><span class="annottext">(Path -&gt; Name) -&gt; Path -&gt; Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Path
</span><a href="Unison.Codebase.Path.html#unabsolute"><span class="hs-identifier hs-var hs-var">Path.unabsolute</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621682022332"><span class="hs-identifier hs-var">root</span></a></span><span>
</span><span id="line-463"></span><span>  </span><span id="local-6989586621682022330"><span class="annot"><span class="annottext">fixName :: Name -&gt; Name
</span><a href="#local-6989586621682022330"><span class="hs-identifier hs-var hs-var">fixName</span></a></span></span><span> </span><span id="local-6989586621682022328"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682022328"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621682022332"><span class="hs-identifier hs-var">root</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Absolute -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="Unison.Codebase.Path.html#absoluteEmpty"><span class="hs-identifier hs-var">Path.absoluteEmpty</span></a></span><span>
</span><span id="line-464"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682022328"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-465"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Maybe Name -&gt; Name
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name
</span><span class="hs-identifier hs-var">Name.makeAbsolute</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682022328"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Maybe Name
</span><span class="hs-identifier hs-var">Name.stripNamePrefix</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682022329"><span class="hs-identifier hs-var">prefix</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682022328"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-466"></span><span>
</span><span id="line-467"></span><span class="hs-comment">-- | A @Search r@ is a small bag of functions that is used to power a search for @r@s.</span><span>
</span><span id="line-468"></span><span class="hs-comment">--</span><span>
</span><span id="line-469"></span><span class="hs-comment">-- Construct a 'Search' with 'makeTypeSearch' or 'makeTermSearch', and eliminate it with 'applySearch'.</span><span>
</span><span id="line-470"></span><span class="hs-keyword">data</span><span> </span><span id="Search"><span class="annot"><a href="Unison.Server.Backend.html#Search"><span class="hs-identifier hs-var">Search</span></a></span></span><span> </span><span id="local-6989586621682023069"><span class="annot"><a href="#local-6989586621682023069"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Search"><span class="annot"><a href="Unison.Server.Backend.html#Search"><span class="hs-identifier hs-var">Search</span></a></span></span><span>
</span><span id="line-471"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="lookupNames"><span class="annot"><span class="annottext">Search r -&gt; r -&gt; Set (HashQualified Name)
</span><a href="Unison.Server.Backend.html#lookupNames"><span class="hs-identifier hs-var hs-var">lookupNames</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621682023069"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HQ'.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-472"></span><span>    </span><span id="lookupRelativeHQRefs%27"><span class="annot"><span class="annottext">Search r -&gt; HashQualified Name -&gt; Set r
</span><a href="Unison.Server.Backend.html#lookupRelativeHQRefs%27"><span class="hs-identifier hs-var hs-var">lookupRelativeHQRefs'</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HQ'.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621682023069"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-473"></span><span>    </span><span id="makeResult"><span class="annot"><span class="annottext">Search r
-&gt; HashQualified Name
-&gt; r
-&gt; Set (HashQualified Name)
-&gt; SearchResult
</span><a href="Unison.Server.Backend.html#makeResult"><span class="hs-identifier hs-var hs-var">makeResult</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682023069"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HQ'.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.SearchResult.html#SearchResult"><span class="hs-identifier hs-type">SR.SearchResult</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-474"></span><span>    </span><span id="matchesNamedRef"><span class="annot"><span class="annottext">Search r -&gt; Name -&gt; r -&gt; HashQualified Name -&gt; Bool
</span><a href="Unison.Server.Backend.html#matchesNamedRef"><span class="hs-identifier hs-var hs-var">matchesNamedRef</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682023069"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HQ'.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-475"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-476"></span><span>
</span><span id="line-477"></span><span class="hs-comment">-- | Make a type search, given a short hash length and names to search in.</span><span>
</span><span id="line-478"></span><span class="annot"><a href="Unison.Server.Backend.html#makeTypeSearch"><span class="hs-identifier hs-type">makeTypeSearch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NamesWithHistory</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#Search"><span class="hs-identifier hs-type">Search</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span>
</span><span id="line-479"></span><span id="makeTypeSearch"><span class="annot"><span class="annottext">makeTypeSearch :: Int -&gt; NamesWithHistory -&gt; Search Reference
</span><a href="Unison.Server.Backend.html#makeTypeSearch"><span class="hs-identifier hs-var hs-var">makeTypeSearch</span></a></span></span><span> </span><span id="local-6989586621682022318"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682022318"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span id="local-6989586621682022317"><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621682022317"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-480"></span><span>  </span><span class="annot"><span class="annottext">Search :: forall r.
(r -&gt; Set (HashQualified Name))
-&gt; (HashQualified Name -&gt; Set r)
-&gt; (HashQualified Name
    -&gt; r -&gt; Set (HashQualified Name) -&gt; SearchResult)
-&gt; (Name -&gt; r -&gt; HashQualified Name -&gt; Bool)
-&gt; Search r
</span><a href="Unison.Server.Backend.html#Search"><span class="hs-identifier hs-type">Search</span></a></span><span>
</span><span id="line-481"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">lookupNames :: Reference -&gt; Set (HashQualified Name)
</span><a href="Unison.Server.Backend.html#lookupNames"><span class="hs-identifier hs-var">lookupNames</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682022316"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022316"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Reference -&gt; NamesWithHistory -&gt; Set (HashQualified Name)
</span><span class="hs-identifier hs-var">NamesWithHistory.typeName</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682022318"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022316"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621682022317"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-482"></span><span>      </span><span class="annot"><span class="annottext">lookupRelativeHQRefs' :: HashQualified Name -&gt; Set Reference
</span><a href="Unison.Server.Backend.html#lookupRelativeHQRefs%27"><span class="hs-identifier hs-var">lookupRelativeHQRefs'</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682022314"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621682022314"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; NamesWithHistory -&gt; Set Reference
</span><span class="hs-identifier hs-var">NamesWithHistory.lookupRelativeHQType'</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621682022314"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621682022317"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-483"></span><span>      </span><span class="annot"><span class="annottext">matchesNamedRef :: Name -&gt; Reference -&gt; HashQualified Name -&gt; Bool
</span><a href="Unison.Server.Backend.html#matchesNamedRef"><span class="hs-identifier hs-var">matchesNamedRef</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Reference -&gt; HashQualified Name -&gt; Bool
forall n. Eq n =&gt; n -&gt; Reference -&gt; HashQualified n -&gt; Bool
</span><span class="hs-identifier hs-var">HQ'.matchesNamedReference</span></span><span class="hs-special">,</span><span>
</span><span id="line-484"></span><span>      </span><span class="annot"><span class="annottext">makeResult :: HashQualified Name
-&gt; Reference -&gt; Set (HashQualified Name) -&gt; SearchResult
</span><a href="Unison.Server.Backend.html#makeResult"><span class="hs-identifier hs-var">makeResult</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashQualified Name
-&gt; Reference -&gt; Set (HashQualified Name) -&gt; SearchResult
</span><a href="Unison.Server.SearchResult.html#typeResult"><span class="hs-identifier hs-var">SR.typeResult</span></a></span><span>
</span><span id="line-485"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-486"></span><span>
</span><span id="line-487"></span><span class="hs-comment">-- | Make a term search, given a short hash length and names to search in.</span><span>
</span><span id="line-488"></span><span class="annot"><a href="Unison.Server.Backend.html#makeTermSearch"><span class="hs-identifier hs-type">makeTermSearch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NamesWithHistory</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#Search"><span class="hs-identifier hs-type">Search</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span>
</span><span id="line-489"></span><span id="makeTermSearch"><span class="annot"><span class="annottext">makeTermSearch :: Int -&gt; NamesWithHistory -&gt; Search Referent
</span><a href="Unison.Server.Backend.html#makeTermSearch"><span class="hs-identifier hs-var hs-var">makeTermSearch</span></a></span></span><span> </span><span id="local-6989586621682022309"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682022309"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span id="local-6989586621682022308"><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621682022308"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-490"></span><span>  </span><span class="annot"><span class="annottext">Search :: forall r.
(r -&gt; Set (HashQualified Name))
-&gt; (HashQualified Name -&gt; Set r)
-&gt; (HashQualified Name
    -&gt; r -&gt; Set (HashQualified Name) -&gt; SearchResult)
-&gt; (Name -&gt; r -&gt; HashQualified Name -&gt; Bool)
-&gt; Search r
</span><a href="Unison.Server.Backend.html#Search"><span class="hs-identifier hs-type">Search</span></a></span><span>
</span><span id="line-491"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">lookupNames :: Referent -&gt; Set (HashQualified Name)
</span><a href="Unison.Server.Backend.html#lookupNames"><span class="hs-identifier hs-var">lookupNames</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682022307"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621682022307"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Referent -&gt; NamesWithHistory -&gt; Set (HashQualified Name)
</span><span class="hs-identifier hs-var">NamesWithHistory.termName</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682022309"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621682022307"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621682022308"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-492"></span><span>      </span><span class="annot"><span class="annottext">lookupRelativeHQRefs' :: HashQualified Name -&gt; Set Referent
</span><a href="Unison.Server.Backend.html#lookupRelativeHQRefs%27"><span class="hs-identifier hs-var">lookupRelativeHQRefs'</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682022305"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621682022305"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; NamesWithHistory -&gt; Set Referent
</span><span class="hs-identifier hs-var">NamesWithHistory.lookupRelativeHQTerm'</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621682022305"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621682022308"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-493"></span><span>      </span><span class="annot"><span class="annottext">matchesNamedRef :: Name -&gt; Referent -&gt; HashQualified Name -&gt; Bool
</span><a href="Unison.Server.Backend.html#matchesNamedRef"><span class="hs-identifier hs-var">matchesNamedRef</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Referent -&gt; HashQualified Name -&gt; Bool
forall n. Eq n =&gt; n -&gt; Referent -&gt; HashQualified n -&gt; Bool
</span><span class="hs-identifier hs-var">HQ'.matchesNamedReferent</span></span><span class="hs-special">,</span><span>
</span><span id="line-494"></span><span>      </span><span class="annot"><span class="annottext">makeResult :: HashQualified Name
-&gt; Referent -&gt; Set (HashQualified Name) -&gt; SearchResult
</span><a href="Unison.Server.Backend.html#makeResult"><span class="hs-identifier hs-var">makeResult</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashQualified Name
-&gt; Referent -&gt; Set (HashQualified Name) -&gt; SearchResult
</span><a href="Unison.Server.SearchResult.html#termResult"><span class="hs-identifier hs-var">SR.termResult</span></a></span><span>
</span><span id="line-495"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-496"></span><span>
</span><span id="line-497"></span><span class="hs-comment">-- | Interpret a 'Search' as a function from name to search results.</span><span>
</span><span id="line-498"></span><span id="local-6989586621682023034"><span class="annot"><a href="Unison.Server.Backend.html#applySearch"><span class="hs-identifier hs-type">applySearch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621682023034"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#Search"><span class="hs-identifier hs-type">Search</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682023034"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HQ'.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Unison.Server.SearchResult.html#SearchResult"><span class="hs-identifier hs-type">SR.SearchResult</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-499"></span><span id="applySearch"><span class="annot"><span class="annottext">applySearch :: Search r -&gt; HashQualified Name -&gt; [SearchResult]
</span><a href="Unison.Server.Backend.html#applySearch"><span class="hs-identifier hs-var hs-var">applySearch</span></a></span></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#Search"><span class="hs-identifier hs-type">Search</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621682022300"><span class="annot"><span class="annottext">r -&gt; Set (HashQualified Name)
lookupNames :: r -&gt; Set (HashQualified Name)
lookupNames :: forall r. Search r -&gt; r -&gt; Set (HashQualified Name)
</span><a href="#local-6989586621682022300"><span class="hs-identifier hs-var hs-var">lookupNames</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682022299"><span class="annot"><span class="annottext">HashQualified Name -&gt; Set r
lookupRelativeHQRefs' :: HashQualified Name -&gt; Set r
lookupRelativeHQRefs' :: forall r. Search r -&gt; HashQualified Name -&gt; Set r
</span><a href="#local-6989586621682022299"><span class="hs-identifier hs-var hs-var">lookupRelativeHQRefs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682022298"><span class="annot"><span class="annottext">HashQualified Name -&gt; r -&gt; Set (HashQualified Name) -&gt; SearchResult
makeResult :: HashQualified Name -&gt; r -&gt; Set (HashQualified Name) -&gt; SearchResult
makeResult :: forall r.
Search r
-&gt; HashQualified Name
-&gt; r
-&gt; Set (HashQualified Name)
-&gt; SearchResult
</span><a href="#local-6989586621682022298"><span class="hs-identifier hs-var hs-var">makeResult</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682022297"><span class="annot"><span class="annottext">Name -&gt; r -&gt; HashQualified Name -&gt; Bool
matchesNamedRef :: Name -&gt; r -&gt; HashQualified Name -&gt; Bool
matchesNamedRef :: forall r. Search r -&gt; Name -&gt; r -&gt; HashQualified Name -&gt; Bool
</span><a href="#local-6989586621682022297"><span class="hs-identifier hs-var hs-var">matchesNamedRef</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621682022296"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621682022296"><span class="hs-identifier hs-var">query</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-500"></span><span>  </span><span class="hs-comment">-- a bunch of references will match a HQ ref.</span><span>
</span><span id="line-501"></span><span>  </span><span class="annot"><span class="annottext">Set r -&gt; [r]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashQualified Name -&gt; Set r
</span><a href="#local-6989586621682022299"><span class="hs-identifier hs-var">lookupRelativeHQRefs'</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621682022296"><span class="hs-identifier hs-var">query</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[r] -&gt; (r -&gt; SearchResult) -&gt; [SearchResult]
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682022295"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621682022295"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-502"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- Precondition: the input set is non-empty</span><span>
</span><span id="line-503"></span><span>        </span><span class="annot"><a href="#local-6989586621682022294"><span class="hs-identifier hs-type">prioritize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HQ'.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HQ'.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HQ'.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-504"></span><span>        </span><span id="local-6989586621682022294"><span class="annot"><span class="annottext">prioritize :: Set (HashQualified Name)
-&gt; (HashQualified Name, Set (HashQualified Name))
</span><a href="#local-6989586621682022294"><span class="hs-identifier hs-var hs-var">prioritize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-505"></span><span>          </span><span class="annot"><span class="annottext">Set (HashQualified Name) -&gt; [HashQualified Name]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span>
</span><span id="line-506"></span><span>            </span><span class="annot"><span class="annottext">(Set (HashQualified Name) -&gt; [HashQualified Name])
-&gt; ([HashQualified Name]
    -&gt; (HashQualified Name, Set (HashQualified Name)))
-&gt; Set (HashQualified Name)
-&gt; (HashQualified Name, Set (HashQualified Name))
forall k (cat :: k -&gt; k -&gt; *) (a :: k) (b :: k) (c :: k).
Category cat =&gt;
cat a b -&gt; cat b c -&gt; cat a c
</span><span class="hs-operator hs-var">&gt;&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">(HashQualified Name -&gt; Bool)
-&gt; [HashQualified Name] -&gt; [HashQualified Name]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sortOn</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682022291"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621682022291"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; r -&gt; HashQualified Name -&gt; Bool
</span><a href="#local-6989586621682022297"><span class="hs-identifier hs-var">matchesNamedRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashQualified Name -&gt; Name
forall n. HashQualified n -&gt; n
</span><span class="hs-identifier hs-var">HQ'.toName</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621682022291"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621682022295"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621682022296"><span class="hs-identifier hs-var">query</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-507"></span><span>            </span><span class="annot"><span class="annottext">([HashQualified Name] -&gt; [HashQualified Name])
-&gt; ([HashQualified Name]
    -&gt; (HashQualified Name, Set (HashQualified Name)))
-&gt; [HashQualified Name]
-&gt; (HashQualified Name, Set (HashQualified Name))
forall k (cat :: k -&gt; k -&gt; *) (a :: k) (b :: k) (c :: k).
Category cat =&gt;
cat a b -&gt; cat b c -&gt; cat a c
</span><span class="hs-operator hs-var">&gt;&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
-&gt; Maybe (HashQualified Name, [HashQualified Name])
forall a. [a] -&gt; Maybe (a, [a])
</span><span class="hs-identifier hs-var">List.uncons</span></span><span>
</span><span id="line-508"></span><span>            </span><span class="annot"><span class="annottext">([HashQualified Name]
 -&gt; Maybe (HashQualified Name, [HashQualified Name]))
-&gt; (Maybe (HashQualified Name, [HashQualified Name])
    -&gt; (HashQualified Name, Set (HashQualified Name)))
-&gt; [HashQualified Name]
-&gt; (HashQualified Name, Set (HashQualified Name))
forall k (cat :: k -&gt; k -&gt; *) (a :: k) (b :: k) (c :: k).
Category cat =&gt;
cat a b -&gt; cat b c -&gt; cat a c
</span><span class="hs-operator hs-var">&gt;&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">(HashQualified Name, [HashQualified Name])
-&gt; Maybe (HashQualified Name, [HashQualified Name])
-&gt; (HashQualified Name, [HashQualified Name])
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; (HashQualified Name, [HashQualified Name])
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-identifier hs-var">reportBug</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;E839404&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;query = &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621682022296"><span class="hs-identifier hs-var">query</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;, ref = &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">r -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621682022295"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-509"></span><span>            </span><span class="annot"><span class="annottext">(Maybe (HashQualified Name, [HashQualified Name])
 -&gt; (HashQualified Name, [HashQualified Name]))
-&gt; ((HashQualified Name, [HashQualified Name])
    -&gt; (HashQualified Name, Set (HashQualified Name)))
-&gt; Maybe (HashQualified Name, [HashQualified Name])
-&gt; (HashQualified Name, Set (HashQualified Name))
forall k (cat :: k -&gt; k -&gt; *) (a :: k) (b :: k) (c :: k).
Category cat =&gt;
cat a b -&gt; cat b c -&gt; cat a c
</span><span class="hs-operator hs-var">&gt;&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ASetter
  (HashQualified Name, [HashQualified Name])
  (HashQualified Name, Set (HashQualified Name))
  [HashQualified Name]
  (Set (HashQualified Name))
-&gt; ([HashQualified Name] -&gt; Set (HashQualified Name))
-&gt; (HashQualified Name, [HashQualified Name])
-&gt; (HashQualified Name, Set (HashQualified Name))
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">over</span></span><span> </span><span class="annot"><span class="annottext">ASetter
  (HashQualified Name, [HashQualified Name])
  (HashQualified Name, Set (HashQualified Name))
  [HashQualified Name]
  (Set (HashQualified Name))
forall s t a b. Field2 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_2</span></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name] -&gt; Set (HashQualified Name)
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span>
</span><span id="line-510"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682022286"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621682022286"><span class="hs-identifier hs-var">primaryName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682022285"><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><a href="#local-6989586621682022285"><span class="hs-identifier hs-var">aliases</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-511"></span><span>          </span><span class="hs-comment">-- The precondition of `prioritize` should hold here because we are passing in the set of names that are</span><span>
</span><span id="line-512"></span><span>          </span><span class="hs-comment">-- related to this ref, which is itself one of the refs that the query name was related to! (Hence it should</span><span>
</span><span id="line-513"></span><span>          </span><span class="hs-comment">-- be non-empty).</span><span>
</span><span id="line-514"></span><span>          </span><span class="annot"><span class="annottext">Set (HashQualified Name)
-&gt; (HashQualified Name, Set (HashQualified Name))
</span><a href="#local-6989586621682022294"><span class="hs-identifier hs-var">prioritize</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">r -&gt; Set (HashQualified Name)
</span><a href="#local-6989586621682022300"><span class="hs-identifier hs-var">lookupNames</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621682022295"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-515"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; r -&gt; Set (HashQualified Name) -&gt; SearchResult
</span><a href="#local-6989586621682022298"><span class="hs-identifier hs-var">makeResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashQualified Name -&gt; HashQualified Name
forall n. HashQualified n -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ'.toHQ</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621682022286"><span class="hs-identifier hs-var">primaryName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621682022295"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><a href="#local-6989586621682022285"><span class="hs-identifier hs-var">aliases</span></a></span><span>
</span><span id="line-516"></span><span>
</span><span id="line-517"></span><span id="local-6989586621682022867"><span id="local-6989586621682022868"><span class="annot"><a href="Unison.Server.Backend.html#hqNameQuery"><span class="hs-identifier hs-type">hqNameQuery</span></a></span><span>
</span><span id="line-518"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621682022868"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-519"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Unison.Codebase.Path.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span>
</span><span id="line-520"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Branch.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022868"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-521"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Type.html#Codebase"><span class="hs-identifier hs-type">Codebase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022868"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022867"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="Unison.Parser.Ann.html#Ann"><span class="hs-identifier hs-type">Ann</span></a></span><span>
</span><span id="line-522"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">]</span><span>
</span><span id="line-523"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682022868"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Unison.Server.QueryResult.html#QueryResult"><span class="hs-identifier hs-type">QueryResult</span></a></span></span></span><span>
</span><span id="line-524"></span><span id="hqNameQuery"><span class="annot"><span class="annottext">hqNameQuery :: Maybe Path
-&gt; Branch m
-&gt; Codebase m v Ann
-&gt; [HashQualified Name]
-&gt; m QueryResult
</span><a href="Unison.Server.Backend.html#hqNameQuery"><span class="hs-identifier hs-var hs-var">hqNameQuery</span></a></span></span><span> </span><span id="local-6989586621682022282"><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621682022282"><span class="hs-identifier hs-var">relativeTo</span></a></span></span><span> </span><span id="local-6989586621682022281"><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621682022281"><span class="hs-identifier hs-var">root</span></a></span></span><span> </span><span id="local-6989586621682022280"><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621682022280"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621682022279"><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621682022279"><span class="hs-identifier hs-var">hqs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-525"></span><span>  </span><span class="hs-comment">-- Split the query into hash-only and hash-qualified-name queries.</span><span>
</span><span id="line-526"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682022278"><span class="annot"><span class="annottext">[ShortHash]
</span><a href="#local-6989586621682022278"><span class="hs-identifier hs-var">hashes</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682022277"><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621682022277"><span class="hs-identifier hs-var">hqnames</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Either ShortHash (HashQualified Name)]
-&gt; ([ShortHash], [HashQualified Name])
forall a b. [Either a b] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">partitionEithers</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(HashQualified Name -&gt; Either ShortHash (HashQualified Name))
-&gt; [HashQualified Name] -&gt; [Either ShortHash (HashQualified Name)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; Either ShortHash (HashQualified Name)
forall n. HashQualified n -&gt; Either ShortHash (HashQualified n)
</span><span class="hs-identifier hs-var">HQ'.fromHQ2</span></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621682022279"><span class="hs-identifier hs-var">hqs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-527"></span><span>  </span><span class="hs-comment">-- Find the terms with those hashes.</span><span>
</span><span id="line-528"></span><span>  </span><span id="local-6989586621682022274"><span class="annot"><span class="annottext">[(ShortHash, Set Referent)]
</span><a href="#local-6989586621682022274"><span class="hs-identifier hs-var">termRefs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((ShortHash, Set Referent) -&gt; Bool)
-&gt; [(ShortHash, Set Referent)] -&gt; [(ShortHash, Set Referent)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ((ShortHash, Set Referent) -&gt; Bool)
-&gt; (ShortHash, Set Referent)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Set Referent -&gt; Bool
forall a. Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.null</span></span><span> </span><span class="annot"><span class="annottext">(Set Referent -&gt; Bool)
-&gt; ((ShortHash, Set Referent) -&gt; Set Referent)
-&gt; (ShortHash, Set Referent)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ShortHash, Set Referent) -&gt; Set Referent
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(ShortHash, Set Referent)] -&gt; [(ShortHash, Set Referent)])
-&gt; ([Set Referent] -&gt; [(ShortHash, Set Referent)])
-&gt; [Set Referent]
-&gt; [(ShortHash, Set Referent)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[ShortHash] -&gt; [Set Referent] -&gt; [(ShortHash, Set Referent)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[ShortHash]
</span><a href="#local-6989586621682022278"><span class="hs-identifier hs-var">hashes</span></a></span><span> </span><span class="annot"><span class="annottext">([Set Referent] -&gt; [(ShortHash, Set Referent)])
-&gt; m [Set Referent] -&gt; m [(ShortHash, Set Referent)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(ShortHash -&gt; m (Set Referent)) -&gt; [ShortHash] -&gt; m [Set Referent]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span>
</span><span id="line-529"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase m v Ann -&gt; ShortHash -&gt; m (Set Referent)
forall (m :: * -&gt; *) v a.
Monad m =&gt;
Codebase m v a -&gt; ShortHash -&gt; m (Set Referent)
</span><a href="Unison.Server.Backend.html#termReferentsByShortHash"><span class="hs-identifier hs-var">termReferentsByShortHash</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621682022280"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-530"></span><span>    </span><span class="annot"><span class="annottext">[ShortHash]
</span><a href="#local-6989586621682022278"><span class="hs-identifier hs-var">hashes</span></a></span><span>
</span><span id="line-531"></span><span>  </span><span class="hs-comment">-- Find types with those hashes.</span><span>
</span><span id="line-532"></span><span>  </span><span id="local-6989586621682022271"><span class="annot"><span class="annottext">[(ShortHash, Set Reference)]
</span><a href="#local-6989586621682022271"><span class="hs-identifier hs-var">typeRefs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((ShortHash, Set Reference) -&gt; Bool)
-&gt; [(ShortHash, Set Reference)] -&gt; [(ShortHash, Set Reference)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ((ShortHash, Set Reference) -&gt; Bool)
-&gt; (ShortHash, Set Reference)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Set Reference -&gt; Bool
forall a. Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.null</span></span><span> </span><span class="annot"><span class="annottext">(Set Reference -&gt; Bool)
-&gt; ((ShortHash, Set Reference) -&gt; Set Reference)
-&gt; (ShortHash, Set Reference)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ShortHash, Set Reference) -&gt; Set Reference
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(ShortHash, Set Reference)] -&gt; [(ShortHash, Set Reference)])
-&gt; ([Set Reference] -&gt; [(ShortHash, Set Reference)])
-&gt; [Set Reference]
-&gt; [(ShortHash, Set Reference)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[ShortHash] -&gt; [Set Reference] -&gt; [(ShortHash, Set Reference)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[ShortHash]
</span><a href="#local-6989586621682022278"><span class="hs-identifier hs-var">hashes</span></a></span><span> </span><span class="annot"><span class="annottext">([Set Reference] -&gt; [(ShortHash, Set Reference)])
-&gt; m [Set Reference] -&gt; m [(ShortHash, Set Reference)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(ShortHash -&gt; m (Set Reference))
-&gt; [ShortHash] -&gt; m [Set Reference]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span>
</span><span id="line-533"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase m v Ann -&gt; ShortHash -&gt; m (Set Reference)
forall (m :: * -&gt; *) v a.
Monad m =&gt;
Codebase m v a -&gt; ShortHash -&gt; m (Set Reference)
</span><a href="Unison.Server.Backend.html#typeReferencesByShortHash"><span class="hs-identifier hs-var">typeReferencesByShortHash</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621682022280"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-534"></span><span>    </span><span class="annot"><span class="annottext">[ShortHash]
</span><a href="#local-6989586621682022278"><span class="hs-identifier hs-var">hashes</span></a></span><span>
</span><span id="line-535"></span><span>  </span><span class="hs-comment">-- Now do the name queries.</span><span>
</span><span id="line-536"></span><span>  </span><span class="hs-comment">-- The hq-name search needs a hash-qualifier length</span><span>
</span><span id="line-537"></span><span>  </span><span id="local-6989586621682022270"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682022270"><span class="hs-identifier hs-var">hqLength</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann -&gt; m Int
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; m Int
</span><a href="Unison.Codebase.Type.html#hashLength"><span class="hs-identifier hs-var hs-var">Codebase.hashLength</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621682022280"><span class="hs-identifier hs-var">codebase</span></a></span><span>
</span><span id="line-538"></span><span>  </span><span class="hs-comment">-- We need to construct the names that we want to use / search by.</span><span>
</span><span id="line-539"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682022269"><span class="annot"><span class="annottext">currentPath :: Path
</span><a href="#local-6989586621682022269"><span class="hs-identifier hs-var hs-var">currentPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Path -&gt; Maybe Path -&gt; Path
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="Unison.Codebase.Path.html#empty"><span class="hs-identifier hs-var">Path.empty</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621682022282"><span class="hs-identifier hs-var">relativeTo</span></a></span><span>
</span><span id="line-540"></span><span>      </span><span id="local-6989586621682022267"><span class="annot"><span class="annottext">parseNames :: NamesWithHistory
</span><a href="#local-6989586621682022267"><span class="hs-identifier hs-var hs-var">parseNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Path -&gt; Branch m -&gt; NamesWithHistory
forall (m :: * -&gt; *). Path -&gt; Branch m -&gt; NamesWithHistory
</span><a href="Unison.Server.Backend.html#getCurrentParseNames"><span class="hs-identifier hs-var">getCurrentParseNames</span></a></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621682022269"><span class="hs-identifier hs-var">currentPath</span></a></span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621682022281"><span class="hs-identifier hs-var">root</span></a></span><span>
</span><span id="line-541"></span><span>      </span><span id="local-6989586621682022266"><span class="annot"><span class="annottext">mkTermResult :: ShortHash -&gt; Referent -&gt; SearchResult
</span><a href="#local-6989586621682022266"><span class="hs-identifier hs-var hs-var">mkTermResult</span></a></span></span><span> </span><span id="local-6989586621682022265"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621682022265"><span class="hs-identifier hs-var">sh</span></a></span></span><span> </span><span id="local-6989586621682022264"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621682022264"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashQualified Name
-&gt; Referent -&gt; Set (HashQualified Name) -&gt; SearchResult
</span><a href="Unison.Server.SearchResult.html#termResult"><span class="hs-identifier hs-var">SR.termResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortHash -&gt; HashQualified Name
forall n. ShortHash -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ.HashOnly</span></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621682022265"><span class="hs-identifier hs-var">sh</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621682022264"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Set (HashQualified Name)
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span>
</span><span id="line-542"></span><span>      </span><span id="local-6989586621682022261"><span class="annot"><span class="annottext">mkTypeResult :: ShortHash -&gt; Reference -&gt; SearchResult
</span><a href="#local-6989586621682022261"><span class="hs-identifier hs-var hs-var">mkTypeResult</span></a></span></span><span> </span><span id="local-6989586621682022260"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621682022260"><span class="hs-identifier hs-var">sh</span></a></span></span><span> </span><span id="local-6989586621682022259"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022259"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashQualified Name
-&gt; Reference -&gt; Set (HashQualified Name) -&gt; SearchResult
</span><a href="Unison.Server.SearchResult.html#typeResult"><span class="hs-identifier hs-var">SR.typeResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortHash -&gt; HashQualified Name
forall n. ShortHash -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ.HashOnly</span></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621682022260"><span class="hs-identifier hs-var">sh</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022259"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Set (HashQualified Name)
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span>
</span><span id="line-543"></span><span>      </span><span class="hs-comment">-- Transform the hash results a bit</span><span>
</span><span id="line-544"></span><span>      </span><span id="local-6989586621682022258"><span class="annot"><span class="annottext">termResults :: [[SearchResult]]
</span><a href="#local-6989586621682022258"><span class="hs-identifier hs-var hs-var">termResults</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-545"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682022257"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621682022257"><span class="hs-identifier hs-var">sh</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682022256"><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621682022256"><span class="hs-identifier hs-var">tms</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ShortHash -&gt; Referent -&gt; SearchResult
</span><a href="#local-6989586621682022266"><span class="hs-identifier hs-var">mkTermResult</span></a></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621682022257"><span class="hs-identifier hs-var">sh</span></a></span><span> </span><span class="annot"><span class="annottext">(Referent -&gt; SearchResult) -&gt; [Referent] -&gt; [SearchResult]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Set Referent -&gt; [Referent]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621682022256"><span class="hs-identifier hs-var">tms</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((ShortHash, Set Referent) -&gt; [SearchResult])
-&gt; [(ShortHash, Set Referent)] -&gt; [[SearchResult]]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(ShortHash, Set Referent)]
</span><a href="#local-6989586621682022274"><span class="hs-identifier hs-var">termRefs</span></a></span><span>
</span><span id="line-546"></span><span>      </span><span id="local-6989586621682022255"><span class="annot"><span class="annottext">typeResults :: [[SearchResult]]
</span><a href="#local-6989586621682022255"><span class="hs-identifier hs-var hs-var">typeResults</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-547"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682022254"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621682022254"><span class="hs-identifier hs-var">sh</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682022253"><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621682022253"><span class="hs-identifier hs-var">tps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ShortHash -&gt; Reference -&gt; SearchResult
</span><a href="#local-6989586621682022261"><span class="hs-identifier hs-var">mkTypeResult</span></a></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621682022254"><span class="hs-identifier hs-var">sh</span></a></span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; SearchResult) -&gt; [Reference] -&gt; [SearchResult]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Set Reference -&gt; [Reference]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621682022253"><span class="hs-identifier hs-var">tps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((ShortHash, Set Reference) -&gt; [SearchResult])
-&gt; [(ShortHash, Set Reference)] -&gt; [[SearchResult]]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(ShortHash, Set Reference)]
</span><a href="#local-6989586621682022271"><span class="hs-identifier hs-var">typeRefs</span></a></span><span>
</span><span id="line-548"></span><span>      </span><span class="hs-comment">-- Now do the actual name query</span><span>
</span><span id="line-549"></span><span>      </span><span id="local-6989586621682022252"><span class="annot"><span class="annottext">resultss :: [[SearchResult]]
</span><a href="#local-6989586621682022252"><span class="hs-identifier hs-var hs-var">resultss</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-550"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621682022251"><span class="hs-identifier hs-type">typeSearch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#Search"><span class="hs-identifier hs-type">Search</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span>
</span><span id="line-551"></span><span>            </span><span id="local-6989586621682022251"><span class="annot"><span class="annottext">typeSearch :: Search Reference
</span><a href="#local-6989586621682022251"><span class="hs-identifier hs-var hs-var">typeSearch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; NamesWithHistory -&gt; Search Reference
</span><a href="Unison.Server.Backend.html#makeTypeSearch"><span class="hs-identifier hs-var">makeTypeSearch</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682022270"><span class="hs-identifier hs-var">hqLength</span></a></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621682022267"><span class="hs-identifier hs-var">parseNames</span></a></span><span>
</span><span id="line-552"></span><span>            </span><span class="annot"><a href="#local-6989586621682022250"><span class="hs-identifier hs-type">termSearch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#Search"><span class="hs-identifier hs-type">Search</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span>
</span><span id="line-553"></span><span>            </span><span id="local-6989586621682022250"><span class="annot"><span class="annottext">termSearch :: Search Referent
</span><a href="#local-6989586621682022250"><span class="hs-identifier hs-var hs-var">termSearch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; NamesWithHistory -&gt; Search Referent
</span><a href="Unison.Server.Backend.html#makeTermSearch"><span class="hs-identifier hs-var">makeTermSearch</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682022270"><span class="hs-identifier hs-var">hqLength</span></a></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621682022267"><span class="hs-identifier hs-var">parseNames</span></a></span><span>
</span><span id="line-554"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(HashQualified Name -&gt; [SearchResult])
-&gt; [HashQualified Name] -&gt; [[SearchResult]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682022249"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621682022249"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Search Reference -&gt; HashQualified Name -&gt; [SearchResult]
forall r.
Show r =&gt;
Search r -&gt; HashQualified Name -&gt; [SearchResult]
</span><a href="Unison.Server.Backend.html#applySearch"><span class="hs-identifier hs-var">applySearch</span></a></span><span> </span><span class="annot"><span class="annottext">Search Reference
</span><a href="#local-6989586621682022251"><span class="hs-identifier hs-var">typeSearch</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621682022249"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">[SearchResult] -&gt; [SearchResult] -&gt; [SearchResult]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Search Referent -&gt; HashQualified Name -&gt; [SearchResult]
forall r.
Show r =&gt;
Search r -&gt; HashQualified Name -&gt; [SearchResult]
</span><a href="Unison.Server.Backend.html#applySearch"><span class="hs-identifier hs-var">applySearch</span></a></span><span> </span><span class="annot"><span class="annottext">Search Referent
</span><a href="#local-6989586621682022250"><span class="hs-identifier hs-var">termSearch</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621682022249"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621682022277"><span class="hs-identifier hs-var">hqnames</span></a></span><span>
</span><span id="line-555"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682022248"><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621682022248"><span class="hs-identifier hs-var">misses</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682022247"><span class="annot"><span class="annottext">[[SearchResult]]
</span><a href="#local-6989586621682022247"><span class="hs-identifier hs-var">hits</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-556"></span><span>        </span><span class="annot"><span class="annottext">[HashQualified Name]
-&gt; [[SearchResult]] -&gt; [(HashQualified Name, [SearchResult])]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621682022277"><span class="hs-identifier hs-var">hqnames</span></a></span><span> </span><span class="annot"><span class="annottext">[[SearchResult]]
</span><a href="#local-6989586621682022252"><span class="hs-identifier hs-var">resultss</span></a></span><span>
</span><span id="line-557"></span><span>          </span><span class="annot"><span class="annottext">[(HashQualified Name, [SearchResult])]
-&gt; ([(HashQualified Name, [SearchResult])]
    -&gt; [Either (HashQualified Name) [SearchResult]])
-&gt; [Either (HashQualified Name) [SearchResult]]
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">((HashQualified Name, [SearchResult])
 -&gt; Either (HashQualified Name) [SearchResult])
-&gt; [(HashQualified Name, [SearchResult])]
-&gt; [Either (HashQualified Name) [SearchResult]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682022245"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621682022245"><span class="hs-identifier hs-var">hqname</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682022244"><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621682022244"><span class="hs-identifier hs-var">results</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[SearchResult] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621682022244"><span class="hs-identifier hs-var">results</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; Either (HashQualified Name) [SearchResult]
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621682022245"><span class="hs-identifier hs-var">hqname</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[SearchResult] -&gt; Either (HashQualified Name) [SearchResult]
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621682022244"><span class="hs-identifier hs-var">results</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-558"></span><span>          </span><span class="annot"><span class="annottext">[Either (HashQualified Name) [SearchResult]]
-&gt; ([Either (HashQualified Name) [SearchResult]]
    -&gt; ([HashQualified Name], [[SearchResult]]))
-&gt; ([HashQualified Name], [[SearchResult]])
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">[Either (HashQualified Name) [SearchResult]]
-&gt; ([HashQualified Name], [[SearchResult]])
forall a b. [Either a b] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">partitionEithers</span></span><span>
</span><span id="line-559"></span><span>      </span><span class="hs-comment">-- Handle query misses correctly</span><span>
</span><span id="line-560"></span><span>      </span><span id="local-6989586621682022242"><span class="annot"><span class="annottext">missingRefs :: [HashQualified n]
</span><a href="#local-6989586621682022242"><span class="hs-identifier hs-var hs-var">missingRefs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-561"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ShortHash -&gt; HashQualified n
forall n. ShortHash -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ.HashOnly</span></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621682022241"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-562"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682022241"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621682022241"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ShortHash]
</span><a href="#local-6989586621682022278"><span class="hs-identifier hs-var">hashes</span></a></span><span>
</span><span id="line-563"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (Set Referent) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortHash -&gt; [(ShortHash, Set Referent)] -&gt; Maybe (Set Referent)
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621682022241"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">[(ShortHash, Set Referent)]
</span><a href="#local-6989586621682022274"><span class="hs-identifier hs-var">termRefs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Set Reference) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortHash -&gt; [(ShortHash, Set Reference)] -&gt; Maybe (Set Reference)
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621682022241"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">[(ShortHash, Set Reference)]
</span><a href="#local-6989586621682022271"><span class="hs-identifier hs-var">typeRefs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-564"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-565"></span><span>      </span><span class="hs-comment">-- Gather the results</span><span>
</span><span id="line-566"></span><span>      </span><span id="local-6989586621682022237"><span class="annot"><span class="annottext">results :: [SearchResult]
</span><a href="#local-6989586621682022237"><span class="hs-identifier hs-var hs-var">results</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-567"></span><span>        </span><span class="annot"><span class="annottext">[SearchResult] -&gt; [SearchResult]
forall a. Ord a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">List.sort</span></span><span>
</span><span id="line-568"></span><span>          </span><span class="annot"><span class="annottext">([SearchResult] -&gt; [SearchResult])
-&gt; ([[SearchResult]] -&gt; [SearchResult])
-&gt; [[SearchResult]]
-&gt; [SearchResult]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span>   </span><span class="annot"><span class="annottext">(SearchResult -&gt; Referent) -&gt; [SearchResult] -&gt; [SearchResult]
forall (f :: * -&gt; *) b a.
(Foldable f, Ord b) =&gt;
(a -&gt; b) -&gt; f a -&gt; [a]
</span><span class="hs-identifier hs-var">uniqueBy</span></span><span> </span><span class="annot"><span class="annottext">SearchResult -&gt; Referent
</span><a href="Unison.Server.SearchResult.html#toReferent"><span class="hs-identifier hs-var">SR.toReferent</span></a></span><span>
</span><span id="line-569"></span><span>          </span><span class="annot"><span class="annottext">([SearchResult] -&gt; [SearchResult])
-&gt; ([[SearchResult]] -&gt; [SearchResult])
-&gt; [[SearchResult]]
-&gt; [SearchResult]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span>   </span><span class="annot"><span class="annottext">[[SearchResult]] -&gt; [SearchResult]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span>
</span><span id="line-570"></span><span>          </span><span class="annot"><span class="annottext">([[SearchResult]] -&gt; [SearchResult])
-&gt; [[SearchResult]] -&gt; [SearchResult]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[SearchResult]]
</span><a href="#local-6989586621682022247"><span class="hs-identifier hs-var">hits</span></a></span><span> </span><span class="annot"><span class="annottext">[[SearchResult]] -&gt; [[SearchResult]] -&gt; [[SearchResult]]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[[SearchResult]]
</span><a href="#local-6989586621682022258"><span class="hs-identifier hs-var">termResults</span></a></span><span> </span><span class="annot"><span class="annottext">[[SearchResult]] -&gt; [[SearchResult]] -&gt; [[SearchResult]]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[[SearchResult]]
</span><a href="#local-6989586621682022255"><span class="hs-identifier hs-var">typeResults</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-571"></span><span>  </span><span class="annot"><span class="annottext">QueryResult -&gt; m QueryResult
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">QueryResult :: [HashQualified Name] -&gt; [SearchResult] -&gt; QueryResult
</span><a href="Unison.Server.QueryResult.html#QueryResult"><span class="hs-identifier hs-type">QueryResult</span></a></span><span>
</span><span id="line-572"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">misses :: [HashQualified Name]
</span><a href="Unison.Server.QueryResult.html#misses"><span class="hs-identifier hs-var">misses</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
forall n. [HashQualified n]
</span><a href="#local-6989586621682022242"><span class="hs-identifier hs-var">missingRefs</span></a></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
-&gt; [HashQualified Name] -&gt; [HashQualified Name]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(HashQualified Name -&gt; HashQualified Name)
-&gt; [HashQualified Name] -&gt; [HashQualified Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; HashQualified Name
forall n. HashQualified n -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ'.toHQ</span></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621682022248"><span class="hs-identifier hs-var">misses</span></a></span><span>
</span><span id="line-573"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hits :: [SearchResult]
</span><a href="Unison.Server.QueryResult.html#hits"><span class="hs-identifier hs-var">hits</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621682022237"><span class="hs-identifier hs-var">results</span></a></span><span>
</span><span id="line-574"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-575"></span><span>
</span><span id="line-576"></span><span class="hs-comment">-- TODO: Move this to its own module</span><span>
</span><span id="line-577"></span><span class="hs-keyword">data</span><span> </span><span id="DefinitionResults"><span class="annot"><a href="Unison.Server.Backend.html#DefinitionResults"><span class="hs-identifier hs-var">DefinitionResults</span></a></span></span><span> </span><span id="local-6989586621682022836"><span class="annot"><a href="#local-6989586621682022836"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-578"></span><span>  </span><span id="DefinitionResults"><span class="annot"><a href="Unison.Server.Backend.html#DefinitionResults"><span class="hs-identifier hs-var">DefinitionResults</span></a></span></span><span>
</span><span id="line-579"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="termResults"><span class="annot"><span class="annottext">DefinitionResults v
-&gt; Map Reference (DisplayObject (Type v Ann) (Term v Ann))
</span><a href="Unison.Server.Backend.html#termResults"><span class="hs-identifier hs-var hs-var">termResults</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Editor.DisplayObject.html#DisplayObject"><span class="hs-identifier hs-type">DisplayObject</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621682022836"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="Unison.Parser.Ann.html#Ann"><span class="hs-identifier hs-type">Ann</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><a href="#local-6989586621682022836"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="Unison.Parser.Ann.html#Ann"><span class="hs-identifier hs-type">Ann</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-580"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="typeResults"><span class="annot"><span class="annottext">DefinitionResults v
-&gt; Map Reference (DisplayObject () (Decl v Ann))
</span><a href="Unison.Server.Backend.html#typeResults"><span class="hs-identifier hs-var hs-var">typeResults</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Editor.DisplayObject.html#DisplayObject"><span class="hs-identifier hs-type">DisplayObject</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DD.Decl</span></span><span> </span><span class="annot"><a href="#local-6989586621682022836"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="Unison.Parser.Ann.html#Ann"><span class="hs-identifier hs-type">Ann</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-581"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="noResults"><span class="annot"><span class="annottext">DefinitionResults v -&gt; [HashQualified Name]
</span><a href="Unison.Server.Backend.html#noResults"><span class="hs-identifier hs-var hs-var">noResults</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">]</span><span>
</span><span id="line-582"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-583"></span><span>
</span><span id="line-584"></span><span class="hs-comment">-- Separates type references from term references and returns types and terms,</span><span>
</span><span id="line-585"></span><span class="hs-comment">-- respectively. For terms that are constructors, turns them into their data</span><span>
</span><span id="line-586"></span><span class="hs-comment">-- types.</span><span>
</span><span id="line-587"></span><span id="local-6989586621682022860"><span id="local-6989586621682022861"><span class="annot"><a href="Unison.Server.Backend.html#collateReferences"><span class="hs-identifier hs-type">collateReferences</span></a></span><span>
</span><span id="line-588"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621682022861"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-589"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621682022860"><span class="hs-identifier hs-type">g</span></a></span><span>
</span><span id="line-590"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682022861"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-comment">-- types requested</span><span>
</span><span id="line-591"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682022860"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="hs-comment">-- terms requested, including ctors</span><span>
</span><span id="line-592"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-593"></span><span id="collateReferences"><span class="annot"><span class="annottext">collateReferences :: f Reference -&gt; g Referent -&gt; (Set Reference, Set Reference)
</span><a href="Unison.Server.Backend.html#collateReferences"><span class="hs-identifier hs-var hs-var">collateReferences</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f Reference -&gt; [Reference]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621682022225"><span class="annot"><span class="annottext">[Reference]
</span><a href="#local-6989586621682022225"><span class="hs-identifier hs-var">types</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">g Referent -&gt; [Referent]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621682022224"><span class="annot"><span class="annottext">[Referent]
</span><a href="#local-6989586621682022224"><span class="hs-identifier hs-var">terms</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-594"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682022223"><span class="annot"><span class="annottext">terms' :: [Reference]
</span><a href="#local-6989586621682022223"><span class="hs-identifier hs-var hs-var">terms'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022222"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent.Ref</span></span><span> </span><span id="local-6989586621682022222"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022222"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Referent]
</span><a href="#local-6989586621682022224"><span class="hs-identifier hs-var">terms</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-595"></span><span>      </span><span id="local-6989586621682022221"><span class="annot"><span class="annottext">types' :: [Reference]
</span><a href="#local-6989586621682022221"><span class="hs-identifier hs-var hs-var">types'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022220"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent.Con</span></span><span> </span><span id="local-6989586621682022220"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022220"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ConstructorType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Referent]
</span><a href="#local-6989586621682022224"><span class="hs-identifier hs-var">terms</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-596"></span><span>  </span><span class="hs-keyword">in</span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Reference] -&gt; Set Reference
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">[Reference]
</span><a href="#local-6989586621682022221"><span class="hs-identifier hs-var">types'</span></a></span><span> </span><span class="annot"><span class="annottext">Set Reference -&gt; Set Reference -&gt; Set Reference
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Reference] -&gt; Set Reference
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">[Reference]
</span><a href="#local-6989586621682022225"><span class="hs-identifier hs-var">types</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Reference] -&gt; Set Reference
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">[Reference]
</span><a href="#local-6989586621682022223"><span class="hs-identifier hs-var">terms'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-597"></span><span>
</span><span id="line-598"></span><span id="local-6989586621682022871"><span id="local-6989586621682022872"><span id="local-6989586621682022873"><span class="annot"><a href="Unison.Server.Backend.html#expandShortBranchHash"><span class="hs-identifier hs-type">expandShortBranchHash</span></a></span><span>
</span><span id="line-599"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621682022873"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Type.html#Codebase"><span class="hs-identifier hs-type">Codebase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022873"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022872"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022871"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.ShortBranchHash.html#ShortBranchHash"><span class="hs-identifier hs-type">ShortBranchHash</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022873"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Unison.Codebase.Branch.html#Hash"><span class="hs-identifier hs-type">Branch.Hash</span></a></span></span></span></span><span>
</span><span id="line-600"></span><span id="expandShortBranchHash"><span class="annot"><span class="annottext">expandShortBranchHash :: Codebase m v a -&gt; ShortBranchHash -&gt; Backend m Hash
</span><a href="Unison.Server.Backend.html#expandShortBranchHash"><span class="hs-identifier hs-var hs-var">expandShortBranchHash</span></a></span></span><span> </span><span id="local-6989586621682022218"><span class="annot"><span class="annottext">Codebase m v a
</span><a href="#local-6989586621682022218"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621682022217"><span class="annot"><span class="annottext">ShortBranchHash
</span><a href="#local-6989586621682022217"><span class="hs-identifier hs-var">hash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-601"></span><span>  </span><span id="local-6989586621682022216"><span class="annot"><span class="annottext">Set Hash
</span><a href="#local-6989586621682022216"><span class="hs-identifier hs-var">hashSet</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (Set Hash) -&gt; ExceptT BackendError m (Set Hash)
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Set Hash) -&gt; ExceptT BackendError m (Set Hash))
-&gt; m (Set Hash) -&gt; ExceptT BackendError m (Set Hash)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v a -&gt; ShortBranchHash -&gt; m (Set Hash)
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; ShortBranchHash -&gt; m (Set Hash)
</span><a href="Unison.Codebase.Type.html#branchHashesByPrefix"><span class="hs-identifier hs-var hs-var">Codebase.branchHashesByPrefix</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m v a
</span><a href="#local-6989586621682022218"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">ShortBranchHash
</span><a href="#local-6989586621682022217"><span class="hs-identifier hs-var">hash</span></a></span><span>
</span><span id="line-602"></span><span>  </span><span id="local-6989586621682022214"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682022214"><span class="hs-identifier hs-var">len</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Int -&gt; ExceptT BackendError m Int
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m Int -&gt; ExceptT BackendError m Int)
-&gt; m Int -&gt; ExceptT BackendError m Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v a -&gt; m Int
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; m Int
</span><a href="Unison.Codebase.Type.html#branchHashLength"><span class="hs-identifier hs-var hs-var">Codebase.branchHashLength</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m v a
</span><a href="#local-6989586621682022218"><span class="hs-identifier hs-var">codebase</span></a></span><span>
</span><span id="line-603"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Set Hash -&gt; [Hash]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">Set Hash
</span><a href="#local-6989586621682022216"><span class="hs-identifier hs-var">hashSet</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-604"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BackendError -&gt; Backend m Hash
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(BackendError -&gt; Backend m Hash) -&gt; BackendError -&gt; Backend m Hash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ShortBranchHash -&gt; BackendError
</span><a href="Unison.Server.Backend.html#CouldntExpandBranchHash"><span class="hs-identifier hs-var">CouldntExpandBranchHash</span></a></span><span> </span><span class="annot"><span class="annottext">ShortBranchHash
</span><a href="#local-6989586621682022217"><span class="hs-identifier hs-var">hash</span></a></span><span>
</span><span id="line-605"></span><span>    </span><span class="hs-special">[</span><span id="local-6989586621682022212"><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621682022212"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Hash -&gt; Backend m Hash
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621682022212"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-606"></span><span>    </span><span class="annot"><span class="annottext">[Hash]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-607"></span><span>      </span><span class="annot"><span class="annottext">BackendError -&gt; Backend m Hash
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(BackendError -&gt; Backend m Hash)
-&gt; (Set ShortBranchHash -&gt; BackendError)
-&gt; Set ShortBranchHash
-&gt; Backend m Hash
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ShortBranchHash -&gt; Set ShortBranchHash -&gt; BackendError
</span><a href="Unison.Server.Backend.html#AmbiguousBranchHash"><span class="hs-identifier hs-var">AmbiguousBranchHash</span></a></span><span> </span><span class="annot"><span class="annottext">ShortBranchHash
</span><a href="#local-6989586621682022217"><span class="hs-identifier hs-var">hash</span></a></span><span> </span><span class="annot"><span class="annottext">(Set ShortBranchHash -&gt; Backend m Hash)
-&gt; Set ShortBranchHash -&gt; Backend m Hash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Hash -&gt; ShortBranchHash) -&gt; Set Hash -&gt; Set ShortBranchHash
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Hash -&gt; ShortBranchHash
forall h. Coercible h Hash =&gt; Int -&gt; h -&gt; ShortBranchHash
</span><a href="Unison.Codebase.ShortBranchHash.html#fromHash"><span class="hs-identifier hs-var">SBH.fromHash</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682022214"><span class="hs-identifier hs-var">len</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set Hash
</span><a href="#local-6989586621682022216"><span class="hs-identifier hs-var">hashSet</span></a></span><span>
</span><span id="line-608"></span><span>
</span><span id="line-609"></span><span id="local-6989586621682022994"><span id="local-6989586621682022995"><span class="annot"><a href="Unison.Server.Backend.html#formatType%27"><span class="hs-identifier hs-type">formatType'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621682022995"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.PrettyPrintEnv.html#PrettyPrintEnv"><span class="hs-identifier hs-type">PPE.PrettyPrintEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Util.Pretty.html#Width"><span class="hs-identifier hs-type">Width</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621682022995"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022994"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#SyntaxText"><span class="hs-identifier hs-type">SyntaxText</span></a></span></span></span><span>
</span><span id="line-610"></span><span id="formatType%27"><span class="annot"><span class="annottext">formatType' :: PrettyPrintEnv
-&gt; Width -&gt; Type v a -&gt; AnnotatedText (Element Reference)
</span><a href="Unison.Server.Backend.html#formatType%27"><span class="hs-identifier hs-var hs-var">formatType'</span></a></span></span><span> </span><span id="local-6989586621682022209"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621682022209"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span id="local-6989586621682022208"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682022208"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-611"></span><span>  </span><span class="annot"><span class="annottext">Width
-&gt; Pretty (AnnotatedText (Element Reference))
-&gt; AnnotatedText (Element Reference)
forall s. (Monoid s, IsString s) =&gt; Width -&gt; Pretty s -&gt; s
</span><a href="Unison.Util.Pretty.html#render"><span class="hs-identifier hs-var">Pretty.render</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682022208"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">(Pretty (AnnotatedText (Element Reference))
 -&gt; AnnotatedText (Element Reference))
-&gt; (Type v a -&gt; Pretty (AnnotatedText (Element Reference)))
-&gt; Type v a
-&gt; AnnotatedText (Element Reference)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
-&gt; Imports
-&gt; Int
-&gt; Type v a
-&gt; Pretty (AnnotatedText (Element Reference))
forall v a.
Var v =&gt;
PrettyPrintEnv
-&gt; Imports
-&gt; Int
-&gt; Type v a
-&gt; Pretty (AnnotatedText (Element Reference))
</span><a href="Unison.TypePrinter.html#pretty0"><span class="hs-identifier hs-var">TypePrinter.pretty0</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621682022209"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">Imports
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-612"></span><span>
</span><span id="line-613"></span><span id="local-6989586621682023134"><span id="local-6989586621682023135"><span class="annot"><a href="Unison.Server.Backend.html#formatType"><span class="hs-identifier hs-type">formatType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621682023135"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.PrettyPrintEnv.html#PrettyPrintEnv"><span class="hs-identifier hs-type">PPE.PrettyPrintEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Util.Pretty.html#Width"><span class="hs-identifier hs-type">Width</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621682023135"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682023134"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Syntax.html#SyntaxText"><span class="hs-identifier hs-type">Syntax.SyntaxText</span></a></span></span></span><span>
</span><span id="line-614"></span><span id="formatType"><span class="annot"><span class="annottext">formatType :: PrettyPrintEnv -&gt; Width -&gt; Type v a -&gt; SyntaxText
</span><a href="Unison.Server.Backend.html#formatType"><span class="hs-identifier hs-var hs-var">formatType</span></a></span></span><span> </span><span id="local-6989586621682022206"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621682022206"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span id="local-6989586621682022205"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682022205"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnnotatedText (Element Reference) -&gt; SyntaxText
forall (g :: * -&gt; *).
Functor g =&gt;
g (Element Reference) -&gt; g Element
</span><a href="Unison.Server.Backend.html#mungeSyntaxText"><span class="hs-identifier hs-var">mungeSyntaxText</span></a></span><span> </span><span class="annot"><span class="annottext">(AnnotatedText (Element Reference) -&gt; SyntaxText)
-&gt; (Type v a -&gt; AnnotatedText (Element Reference))
-&gt; Type v a
-&gt; SyntaxText
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
-&gt; Width -&gt; Type v a -&gt; AnnotatedText (Element Reference)
forall v a.
Var v =&gt;
PrettyPrintEnv
-&gt; Width -&gt; Type v a -&gt; AnnotatedText (Element Reference)
</span><a href="Unison.Server.Backend.html#formatType%27"><span class="hs-identifier hs-var">formatType'</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621682022206"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682022205"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-615"></span><span>
</span><span id="line-616"></span><span id="local-6989586621682022964"><span class="annot"><a href="Unison.Server.Backend.html#formatSuffixedType"><span class="hs-identifier hs-type">formatSuffixedType</span></a></span><span>
</span><span id="line-617"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621682022964"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-618"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.PrettyPrintEnvDecl.html#PrettyPrintEnvDecl"><span class="hs-identifier hs-type">PPE.PrettyPrintEnvDecl</span></a></span><span>
</span><span id="line-619"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Util.Pretty.html#Width"><span class="hs-identifier hs-type">Width</span></a></span><span>
</span><span id="line-620"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621682022964"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="Unison.Parser.Ann.html#Ann"><span class="hs-identifier hs-type">Ann</span></a></span><span>
</span><span id="line-621"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Syntax.html#SyntaxText"><span class="hs-identifier hs-type">Syntax.SyntaxText</span></a></span></span><span>
</span><span id="line-622"></span><span id="formatSuffixedType"><span class="annot"><span class="annottext">formatSuffixedType :: PrettyPrintEnvDecl -&gt; Width -&gt; Type v Ann -&gt; SyntaxText
</span><a href="Unison.Server.Backend.html#formatSuffixedType"><span class="hs-identifier hs-var hs-var">formatSuffixedType</span></a></span></span><span> </span><span id="local-6989586621682022202"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621682022202"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; Width -&gt; Type v Ann -&gt; SyntaxText
forall v a.
Var v =&gt;
PrettyPrintEnv -&gt; Width -&gt; Type v a -&gt; SyntaxText
</span><a href="Unison.Server.Backend.html#formatType"><span class="hs-identifier hs-var">formatType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><a href="Unison.PrettyPrintEnvDecl.html#suffixifiedPPE"><span class="hs-identifier hs-var hs-var">PPE.suffixifiedPPE</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621682022202"><span class="hs-identifier hs-var">ppe</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-623"></span><span>
</span><span id="line-624"></span><span id="local-6989586621682022996"><span class="annot"><a href="Unison.Server.Backend.html#mungeSyntaxText"><span class="hs-identifier hs-type">mungeSyntaxText</span></a></span><span>
</span><span id="line-625"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="annot"><a href="#local-6989586621682022996"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682022996"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Util.SyntaxText.html#Element"><span class="hs-identifier hs-type">UST.Element</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682022996"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="Unison.Server.Syntax.html#Element"><span class="hs-identifier hs-type">Syntax.Element</span></a></span></span><span>
</span><span id="line-626"></span><span id="mungeSyntaxText"><span class="annot"><span class="annottext">mungeSyntaxText :: g (Element Reference) -&gt; g Element
</span><a href="Unison.Server.Backend.html#mungeSyntaxText"><span class="hs-identifier hs-var hs-var">mungeSyntaxText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Element Reference -&gt; Element)
-&gt; g (Element Reference) -&gt; g Element
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Element Reference -&gt; Element
</span><a href="Unison.Server.Syntax.html#convertElement"><span class="hs-identifier hs-var">Syntax.convertElement</span></a></span><span>
</span><span id="line-627"></span><span>
</span><span id="line-628"></span><span class="annot"><a href="Unison.Server.Backend.html#prettyDefinitionsBySuffixes"><span class="hs-identifier hs-type">prettyDefinitionsBySuffixes</span></a></span><span>
</span><span id="line-629"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682022200"><span class="annot"><a href="#local-6989586621682022200"><span class="hs-identifier hs-type">v</span></a></span></span><span>
</span><span id="line-630"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621682022200"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-631"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Unison.Codebase.Path.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span>
</span><span id="line-632"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Unison.Codebase.Branch.html#Hash"><span class="hs-identifier hs-type">Branch.Hash</span></a></span><span>
</span><span id="line-633"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Unison.Util.Pretty.html#Width"><span class="hs-identifier hs-type">Width</span></a></span><span>
</span><span id="line-634"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Types.html#Suffixify"><span class="hs-identifier hs-type">Suffixify</span></a></span><span>
</span><span id="line-635"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Runtime.html#Runtime"><span class="hs-identifier hs-type">Rt.Runtime</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022200"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-636"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Type.html#Codebase"><span class="hs-identifier hs-type">Codebase</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621682022200"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="Unison.Parser.Ann.html#Ann"><span class="hs-identifier hs-type">Ann</span></a></span><span>
</span><span id="line-637"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">]</span><span>
</span><span id="line-638"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Unison.Server.Types.html#DefinitionDisplayResults"><span class="hs-identifier hs-type">DefinitionDisplayResults</span></a></span><span>
</span><span id="line-639"></span><span id="prettyDefinitionsBySuffixes"><span class="annot"><span class="annottext">prettyDefinitionsBySuffixes :: Maybe Path
-&gt; Maybe Hash
-&gt; Maybe Width
-&gt; Suffixify
-&gt; Runtime v
-&gt; Codebase IO v Ann
-&gt; [HashQualified Name]
-&gt; Backend IO DefinitionDisplayResults
</span><a href="Unison.Server.Backend.html#prettyDefinitionsBySuffixes"><span class="hs-identifier hs-var hs-var">prettyDefinitionsBySuffixes</span></a></span></span><span> </span><span id="local-6989586621682022199"><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621682022199"><span class="hs-identifier hs-var">relativeTo</span></a></span></span><span> </span><span id="local-6989586621682022198"><span class="annot"><span class="annottext">Maybe Hash
</span><a href="#local-6989586621682022198"><span class="hs-identifier hs-var">root</span></a></span></span><span> </span><span id="local-6989586621682022197"><span class="annot"><span class="annottext">Maybe Width
</span><a href="#local-6989586621682022197"><span class="hs-identifier hs-var">renderWidth</span></a></span></span><span> </span><span id="local-6989586621682022196"><span class="annot"><span class="annottext">Suffixify
</span><a href="#local-6989586621682022196"><span class="hs-identifier hs-var">suffixifyBindings</span></a></span></span><span> </span><span id="local-6989586621682022195"><span class="annot"><span class="annottext">Runtime v
</span><a href="#local-6989586621682022195"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span id="local-6989586621682022194"><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621682022194"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621682022193"><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621682022193"><span class="hs-identifier hs-var">query</span></a></span></span><span>
</span><span id="line-640"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-641"></span><span>    </span><span id="local-6989586621682022192"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621682022192"><span class="hs-identifier hs-var">branch</span></a></span></span><span>                               </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Hash -&gt; Codebase IO v Ann -&gt; Backend IO (Branch IO)
forall (m :: * -&gt; *) v.
Monad m =&gt;
Maybe Hash -&gt; Codebase m v Ann -&gt; Backend m (Branch m)
</span><a href="Unison.Server.Backend.html#resolveBranchHash"><span class="hs-identifier hs-var">resolveBranchHash</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Hash
</span><a href="#local-6989586621682022198"><span class="hs-identifier hs-var">root</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621682022194"><span class="hs-identifier hs-var">codebase</span></a></span><span>
</span><span id="line-642"></span><span>    </span><span class="annot"><a href="Unison.Server.Backend.html#DefinitionResults"><span class="hs-identifier hs-type">DefinitionResults</span></a></span><span> </span><span id="local-6989586621682022190"><span class="annot"><span class="annottext">Map Reference (DisplayObject (Type v Ann) (Term v Ann))
</span><a href="#local-6989586621682022190"><span class="hs-identifier hs-var">terms</span></a></span></span><span> </span><span id="local-6989586621682022189"><span class="annot"><span class="annottext">Map Reference (DisplayObject () (Decl v Ann))
</span><a href="#local-6989586621682022189"><span class="hs-identifier hs-var">types</span></a></span></span><span> </span><span id="local-6989586621682022188"><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621682022188"><span class="hs-identifier hs-var">misses</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Path
-&gt; Branch IO
-&gt; Codebase IO v Ann
-&gt; [HashQualified Name]
-&gt; Backend IO (DefinitionResults v)
forall (m :: * -&gt; *) v.
(MonadIO m, Var v) =&gt;
Maybe Path
-&gt; Branch m
-&gt; Codebase m v Ann
-&gt; [HashQualified Name]
-&gt; Backend m (DefinitionResults v)
</span><a href="Unison.Server.Backend.html#definitionsBySuffixes"><span class="hs-identifier hs-var">definitionsBySuffixes</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621682022199"><span class="hs-identifier hs-var">relativeTo</span></a></span><span>
</span><span id="line-643"></span><span>                                                                  </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621682022192"><span class="hs-identifier hs-var">branch</span></a></span><span>
</span><span id="line-644"></span><span>                                                                  </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621682022194"><span class="hs-identifier hs-var">codebase</span></a></span><span>
</span><span id="line-645"></span><span>                                                                  </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621682022193"><span class="hs-identifier hs-var">query</span></a></span><span>
</span><span id="line-646"></span><span>    </span><span id="local-6989586621682022186"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682022186"><span class="hs-identifier hs-var">hqLength</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Int -&gt; ExceptT BackendError IO Int
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO Int -&gt; ExceptT BackendError IO Int)
-&gt; IO Int -&gt; ExceptT BackendError IO Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann -&gt; IO Int
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; m Int
</span><a href="Unison.Codebase.Type.html#hashLength"><span class="hs-identifier hs-var hs-var">Codebase.hashLength</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621682022194"><span class="hs-identifier hs-var">codebase</span></a></span><span>
</span><span id="line-647"></span><span>    </span><span class="hs-comment">-- We might like to make sure that the user search terms get used as</span><span>
</span><span id="line-648"></span><span>    </span><span class="hs-comment">-- the names in the pretty-printer, but the current implementation</span><span>
</span><span id="line-649"></span><span>    </span><span class="hs-comment">-- doesn't.</span><span>
</span><span id="line-650"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-651"></span><span>      </span><span id="local-6989586621682022185"><span class="annot"><span class="annottext">printNames :: NamesWithHistory
</span><a href="#local-6989586621682022185"><span class="hs-identifier hs-var hs-var">printNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-652"></span><span>        </span><span class="annot"><span class="annottext">Path -&gt; Branch IO -&gt; NamesWithHistory
forall (m :: * -&gt; *). Path -&gt; Branch m -&gt; NamesWithHistory
</span><a href="Unison.Server.Backend.html#getCurrentPrettyNames"><span class="hs-identifier hs-var">getCurrentPrettyNames</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path -&gt; Maybe Path -&gt; Path
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="Unison.Codebase.Path.html#empty"><span class="hs-identifier hs-var">Path.empty</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621682022199"><span class="hs-identifier hs-var">relativeTo</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621682022192"><span class="hs-identifier hs-var">branch</span></a></span><span>
</span><span id="line-653"></span><span>      </span><span id="local-6989586621682022184"><span class="annot"><span class="annottext">parseNames :: NamesWithHistory
</span><a href="#local-6989586621682022184"><span class="hs-identifier hs-var hs-var">parseNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-654"></span><span>        </span><span class="annot"><span class="annottext">Path -&gt; Branch IO -&gt; NamesWithHistory
forall (m :: * -&gt; *). Path -&gt; Branch m -&gt; NamesWithHistory
</span><a href="Unison.Server.Backend.html#getCurrentParseNames"><span class="hs-identifier hs-var">getCurrentParseNames</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path -&gt; Maybe Path -&gt; Path
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="Unison.Codebase.Path.html#empty"><span class="hs-identifier hs-var">Path.empty</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621682022199"><span class="hs-identifier hs-var">relativeTo</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621682022192"><span class="hs-identifier hs-var">branch</span></a></span><span>
</span><span id="line-655"></span><span>      </span><span id="local-6989586621682022183"><span class="annot"><span class="annottext">ppe :: PrettyPrintEnvDecl
</span><a href="#local-6989586621682022183"><span class="hs-identifier hs-var hs-var">ppe</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; NamesWithHistory -&gt; PrettyPrintEnvDecl
</span><a href="Unison.PrettyPrintEnvDecl.Names.html#fromNamesDecl"><span class="hs-identifier hs-var">PPE.fromNamesDecl</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682022186"><span class="hs-identifier hs-var">hqLength</span></a></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621682022185"><span class="hs-identifier hs-var">printNames</span></a></span><span>
</span><span id="line-656"></span><span>      </span><span id="local-6989586621682022182"><span class="annot"><span class="annottext">width :: Width
</span><a href="#local-6989586621682022182"><span class="hs-identifier hs-var hs-var">width</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Width -&gt; Width
</span><a href="Unison.Server.Types.html#mayDefaultWidth"><span class="hs-identifier hs-var">mayDefaultWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Width
</span><a href="#local-6989586621682022197"><span class="hs-identifier hs-var">renderWidth</span></a></span><span>
</span><span id="line-657"></span><span>      </span><span id="local-6989586621682022181"><span class="annot"><span class="annottext">isAbsolute :: Name -&gt; Bool
</span><a href="#local-6989586621682022181"><span class="hs-identifier hs-var hs-var">isAbsolute</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Text
</span><span class="hs-identifier hs-var hs-var">Name.toText</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621682022180"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682022180"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
</span><span class="hs-operator hs-var">`Text.isPrefixOf`</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682022180"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682022180"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-658"></span><span>      </span><span class="annot"><a href="#local-6989586621682022177"><span class="hs-identifier hs-type">termFqns</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-659"></span><span>      </span><span id="local-6989586621682022177"><span class="annot"><span class="annottext">termFqns :: Map Reference (Set Text)
</span><a href="#local-6989586621682022177"><span class="hs-identifier hs-var hs-var">termFqns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; DisplayObject (Type v Ann) (Term v Ann) -&gt; Set Text)
-&gt; Map Reference (DisplayObject (Type v Ann) (Term v Ann))
-&gt; Map Reference (Set Text)
forall k a b. (k -&gt; a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">Map.mapWithKey</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; DisplayObject (Type v Ann) (Term v Ann) -&gt; Set Text
forall p. Reference -&gt; p -&gt; Set Text
</span><a href="#local-6989586621682022175"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Map Reference (DisplayObject (Type v Ann) (Term v Ann))
</span><a href="#local-6989586621682022190"><span class="hs-identifier hs-var">terms</span></a></span><span>
</span><span id="line-660"></span><span>       </span><span class="hs-keyword">where</span><span>
</span><span id="line-661"></span><span>        </span><span id="local-6989586621682022174"><span class="annot"><span class="annottext">rel :: Relation Name Referent
</span><a href="#local-6989586621682022174"><span class="hs-identifier hs-var hs-var">rel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Names -&gt; Relation Name Referent
</span><span class="hs-identifier hs-var hs-var">Names.terms</span></span><span> </span><span class="annot"><span class="annottext">(Names -&gt; Relation Name Referent)
-&gt; Names -&gt; Relation Name Referent
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory -&gt; Names
</span><span class="hs-identifier hs-var hs-var">currentNames</span></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621682022184"><span class="hs-identifier hs-var">parseNames</span></a></span><span>
</span><span id="line-662"></span><span>        </span><span id="local-6989586621682022175"><span class="annot"><span class="annottext">f :: Reference -&gt; p -&gt; Set Text
</span><a href="#local-6989586621682022175"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682022171"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022171"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Set Text
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Set Text)
-&gt; (Set Name -&gt; [Text]) -&gt; Set Name -&gt; Set Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Text) -&gt; [Name] -&gt; [Text]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Text
</span><span class="hs-identifier hs-var hs-var">Name.toText</span></span><span> </span><span class="annot"><span class="annottext">([Name] -&gt; [Text]) -&gt; (Set Name -&gt; [Name]) -&gt; Set Name -&gt; [Text]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; [Name] -&gt; [Name]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="#local-6989586621682022181"><span class="hs-identifier hs-var">isAbsolute</span></a></span><span> </span><span class="annot"><span class="annottext">([Name] -&gt; [Name]) -&gt; (Set Name -&gt; [Name]) -&gt; Set Name -&gt; [Name]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Set Name -&gt; [Name]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span>
</span><span id="line-663"></span><span>              </span><span class="annot"><span class="annottext">(Set Name -&gt; Set Text) -&gt; Set Name -&gt; Set Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; Relation Name Referent -&gt; Set Name
forall b a. Ord b =&gt; b -&gt; Relation a b -&gt; Set a
</span><span class="hs-identifier hs-var">R.lookupRan</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference -&gt; Referent
</span><span class="hs-identifier hs-var">Referent.Ref</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022171"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Relation Name Referent
</span><a href="#local-6989586621682022174"><span class="hs-identifier hs-var">rel</span></a></span><span>
</span><span id="line-664"></span><span>      </span><span class="annot"><a href="#local-6989586621682022170"><span class="hs-identifier hs-type">typeFqns</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-665"></span><span>      </span><span id="local-6989586621682022170"><span class="annot"><span class="annottext">typeFqns :: Map Reference (Set Text)
</span><a href="#local-6989586621682022170"><span class="hs-identifier hs-var hs-var">typeFqns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; DisplayObject () (Decl v Ann) -&gt; Set Text)
-&gt; Map Reference (DisplayObject () (Decl v Ann))
-&gt; Map Reference (Set Text)
forall k a b. (k -&gt; a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">Map.mapWithKey</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; DisplayObject () (Decl v Ann) -&gt; Set Text
forall p. Reference -&gt; p -&gt; Set Text
</span><a href="#local-6989586621682022169"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Map Reference (DisplayObject () (Decl v Ann))
</span><a href="#local-6989586621682022189"><span class="hs-identifier hs-var">types</span></a></span><span>
</span><span id="line-666"></span><span>       </span><span class="hs-keyword">where</span><span>
</span><span id="line-667"></span><span>        </span><span id="local-6989586621682022168"><span class="annot"><span class="annottext">rel :: Relation Name Reference
</span><a href="#local-6989586621682022168"><span class="hs-identifier hs-var hs-var">rel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Names -&gt; Relation Name Reference
</span><span class="hs-identifier hs-var hs-var">Names.types</span></span><span> </span><span class="annot"><span class="annottext">(Names -&gt; Relation Name Reference)
-&gt; Names -&gt; Relation Name Reference
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory -&gt; Names
</span><span class="hs-identifier hs-var hs-var">currentNames</span></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621682022184"><span class="hs-identifier hs-var">parseNames</span></a></span><span>
</span><span id="line-668"></span><span>        </span><span id="local-6989586621682022169"><span class="annot"><span class="annottext">f :: Reference -&gt; p -&gt; Set Text
</span><a href="#local-6989586621682022169"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682022166"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022166"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Set Text
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Set Text)
-&gt; (Set Name -&gt; [Text]) -&gt; Set Name -&gt; Set Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Text) -&gt; [Name] -&gt; [Text]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Text
</span><span class="hs-identifier hs-var hs-var">Name.toText</span></span><span> </span><span class="annot"><span class="annottext">([Name] -&gt; [Text]) -&gt; (Set Name -&gt; [Name]) -&gt; Set Name -&gt; [Text]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; [Name] -&gt; [Name]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="#local-6989586621682022181"><span class="hs-identifier hs-var">isAbsolute</span></a></span><span> </span><span class="annot"><span class="annottext">([Name] -&gt; [Name]) -&gt; (Set Name -&gt; [Name]) -&gt; Set Name -&gt; [Name]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Set Name -&gt; [Name]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span>
</span><span id="line-669"></span><span>              </span><span class="annot"><span class="annottext">(Set Name -&gt; Set Text) -&gt; Set Name -&gt; Set Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Relation Name Reference -&gt; Set Name
forall b a. Ord b =&gt; b -&gt; Relation a b -&gt; Set a
</span><span class="hs-identifier hs-var">R.lookupRan</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022166"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Relation Name Reference
</span><a href="#local-6989586621682022168"><span class="hs-identifier hs-var">rel</span></a></span><span>
</span><span id="line-670"></span><span>      </span><span id="local-6989586621682022165"><span class="annot"><span class="annottext">flatten :: Maybe (Set a) -&gt; [a]
</span><a href="#local-6989586621682022165"><span class="hs-identifier hs-var hs-var">flatten</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set a -&gt; [a]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">(Set a -&gt; [a]) -&gt; (Maybe (Set a) -&gt; Set a) -&gt; Maybe (Set a) -&gt; [a]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Set a -&gt; Maybe (Set a) -&gt; Set a
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Set a
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span>
</span><span id="line-671"></span><span>
</span><span id="line-672"></span><span>      </span><span class="annot"><a href="#local-6989586621682022164"><span class="hs-identifier hs-type">docNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HQ'.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">]</span><span>
</span><span id="line-673"></span><span>      </span><span id="local-6989586621682022164"><span class="annot"><span class="annottext">docNames :: Set (HashQualified Name) -&gt; [Name]
</span><a href="#local-6989586621682022164"><span class="hs-identifier hs-var hs-var">docNames</span></a></span></span><span> </span><span id="local-6989586621682022163"><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><a href="#local-6989586621682022163"><span class="hs-identifier hs-var">hqs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Name) -&gt; [Name] -&gt; [Name]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name
</span><a href="#local-6989586621682022162"><span class="hs-identifier hs-var">docify</span></a></span><span> </span><span class="annot"><span class="annottext">([Name] -&gt; [Name])
-&gt; (Set (HashQualified Name) -&gt; [Name])
-&gt; Set (HashQualified Name)
-&gt; [Name]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [Name]
forall a. Ord a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">nubOrd</span></span><span> </span><span class="annot"><span class="annottext">([Name] -&gt; [Name])
-&gt; (Set (HashQualified Name) -&gt; [Name])
-&gt; Set (HashQualified Name)
-&gt; [Name]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[[Name]] -&gt; [Name]
forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><span class="hs-identifier hs-var">join</span></span><span> </span><span class="annot"><span class="annottext">([[Name]] -&gt; [Name])
-&gt; (Set (HashQualified Name) -&gt; [[Name]])
-&gt; Set (HashQualified Name)
-&gt; [Name]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(HashQualified Name -&gt; [Name]) -&gt; [HashQualified Name] -&gt; [[Name]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; [Name]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">([HashQualified Name] -&gt; [[Name]])
-&gt; (Set (HashQualified Name) -&gt; [HashQualified Name])
-&gt; Set (HashQualified Name)
-&gt; [[Name]]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Set (HashQualified Name) -&gt; [HashQualified Name]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">(Set (HashQualified Name) -&gt; [Name])
-&gt; Set (HashQualified Name) -&gt; [Name]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><a href="#local-6989586621682022163"><span class="hs-identifier hs-var">hqs</span></a></span><span>
</span><span id="line-674"></span><span>        </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682022162"><span class="annot"><span class="annottext">docify :: Name -&gt; Name
</span><a href="#local-6989586621682022162"><span class="hs-identifier hs-var hs-var">docify</span></a></span></span><span> </span><span id="local-6989586621682022161"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682022161"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Name
</span><span class="hs-identifier hs-var">Name.joinDot</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682022161"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-string">&quot;doc&quot;</span></span><span>
</span><span id="line-675"></span><span>
</span><span id="line-676"></span><span>      </span><span class="annot"><a href="#local-6989586621682022159"><span class="hs-identifier hs-type">selectDocs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">]</span><span>
</span><span id="line-677"></span><span>      </span><span id="local-6989586621682022159"><span class="annot"><span class="annottext">selectDocs :: [Referent] -&gt; Backend IO [Reference]
</span><a href="#local-6989586621682022159"><span class="hs-identifier hs-var hs-var">selectDocs</span></a></span></span><span> </span><span id="local-6989586621682022158"><span class="annot"><span class="annottext">[Referent]
</span><a href="#local-6989586621682022158"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-678"></span><span>        </span><span id="local-6989586621682022157"><span class="annot"><span class="annottext">[(Reference, Type v Ann)]
</span><a href="#local-6989586621682022157"><span class="hs-identifier hs-var">rts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">([[(Reference, Type v Ann)]] -&gt; [(Reference, Type v Ann)])
-&gt; ExceptT BackendError IO [[(Reference, Type v Ann)]]
-&gt; ExceptT BackendError IO [(Reference, Type v Ann)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">[[(Reference, Type v Ann)]] -&gt; [(Reference, Type v Ann)]
forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><span class="hs-identifier hs-var">join</span></span><span> </span><span class="annot"><span class="annottext">(ExceptT BackendError IO [[(Reference, Type v Ann)]]
 -&gt; ExceptT BackendError IO [(Reference, Type v Ann)])
-&gt; ((Referent -&gt; ExceptT BackendError IO [(Reference, Type v Ann)])
    -&gt; ExceptT BackendError IO [[(Reference, Type v Ann)]])
-&gt; (Referent -&gt; ExceptT BackendError IO [(Reference, Type v Ann)])
-&gt; ExceptT BackendError IO [(Reference, Type v Ann)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Referent]
-&gt; (Referent -&gt; ExceptT BackendError IO [(Reference, Type v Ann)])
-&gt; ExceptT BackendError IO [[(Reference, Type v Ann)]]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="annot"><span class="annottext">[Referent]
</span><a href="#local-6989586621682022158"><span class="hs-identifier hs-var">rs</span></a></span><span> </span><span class="annot"><span class="annottext">((Referent -&gt; ExceptT BackendError IO [(Reference, Type v Ann)])
 -&gt; ExceptT BackendError IO [(Reference, Type v Ann)])
-&gt; (Referent -&gt; ExceptT BackendError IO [(Reference, Type v Ann)])
-&gt; ExceptT BackendError IO [(Reference, Type v Ann)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-679"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Referent.Ref</span></span><span> </span><span id="local-6989586621682022156"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022156"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-680"></span><span>            </span><span class="annot"><span class="annottext">[(Reference, Type v Ann)]
-&gt; (Type v Ann -&gt; [(Reference, Type v Ann)])
-&gt; Maybe (Type v Ann)
-&gt; [(Reference, Type v Ann)]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Reference, Type v Ann) -&gt; [(Reference, Type v Ann)]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">((Reference, Type v Ann) -&gt; [(Reference, Type v Ann)])
-&gt; (Type v Ann -&gt; (Reference, Type v Ann))
-&gt; Type v Ann
-&gt; [(Reference, Type v Ann)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022156"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (Type v Ann) -&gt; [(Reference, Type v Ann)])
-&gt; ExceptT BackendError IO (Maybe (Type v Ann))
-&gt; ExceptT BackendError IO [(Reference, Type v Ann)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">IO (Maybe (Type v Ann))
-&gt; ExceptT BackendError IO (Maybe (Type v Ann))
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO v Ann -&gt; Reference -&gt; IO (Maybe (Type v Ann))
forall (m :: * -&gt; *) v a.
(Applicative m, Var v, BuiltinAnnotation a) =&gt;
Codebase m v a -&gt; Reference -&gt; m (Maybe (Type v a))
</span><a href="Unison.Codebase.html#getTypeOfTerm"><span class="hs-identifier hs-var">Codebase.getTypeOfTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621682022194"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022156"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-681"></span><span>          </span><span class="annot"><span class="annottext">Referent
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(Reference, Type v Ann)]
-&gt; ExceptT BackendError IO [(Reference, Type v Ann)]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-682"></span><span>        </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022154"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682022154"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022154"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682022153"><span class="annot"><span class="annottext">Type v Ann
</span><a href="#local-6989586621682022153"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Reference, Type v Ann)]
</span><a href="#local-6989586621682022157"><span class="hs-identifier hs-var">rts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type v Ann -&gt; Type v Ann -&gt; Bool
forall v loc. Var v =&gt; Type v loc -&gt; Type v loc -&gt; Bool
</span><a href="Unison.Typechecker.html#isSubtype"><span class="hs-identifier hs-var">Typechecker.isSubtype</span></a></span><span> </span><span class="annot"><span class="annottext">Type v Ann
</span><a href="#local-6989586621682022153"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ann -&gt; Reference -&gt; Type v Ann
forall v a. Ord v =&gt; a -&gt; Reference -&gt; Type v a
</span><span class="hs-identifier hs-var">Type.ref</span></span><span> </span><span class="annot"><span class="annottext">Ann
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="Unison.Runtime.IOSource.html#doc2Ref"><span class="hs-identifier hs-var">DD.doc2Ref</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-683"></span><span>
</span><span id="line-684"></span><span>      </span><span class="hs-comment">-- rs0 can be empty or the term fetched, so when viewing a doc term</span><span>
</span><span id="line-685"></span><span>      </span><span class="hs-comment">-- you get both its source and its rendered form</span><span>
</span><span id="line-686"></span><span>      </span><span class="annot"><a href="#local-6989586621682022152"><span class="hs-identifier hs-type">docResults</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Types.html#HashQualifiedName"><span class="hs-identifier hs-type">HashQualifiedName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Types.html#UnisonHash"><span class="hs-identifier hs-type">UnisonHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Doc.html#Doc"><span class="hs-identifier hs-type">Doc.Doc</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-687"></span><span>      </span><span id="local-6989586621682022152"><span class="annot"><span class="annottext">docResults :: [Reference] -&gt; [Name] -&gt; Backend IO [(Text, Text, Doc)]
</span><a href="#local-6989586621682022152"><span class="hs-identifier hs-var hs-var">docResults</span></a></span></span><span> </span><span id="local-6989586621682022149"><span class="annot"><span class="annottext">[Reference]
</span><a href="#local-6989586621682022149"><span class="hs-identifier hs-var">rs0</span></a></span></span><span> </span><span id="local-6989586621682022148"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682022148"><span class="hs-identifier hs-var">docs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-688"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682022147"><span class="annot"><span class="annottext">refsFor :: Name -&gt; Set Referent
</span><a href="#local-6989586621682022147"><span class="hs-identifier hs-var hs-var">refsFor</span></a></span></span><span> </span><span id="local-6989586621682022146"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682022146"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; NamesWithHistory -&gt; Set Referent
</span><span class="hs-identifier hs-var">NamesWithHistory.lookupHQTerm</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; HashQualified Name
forall n. n -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ.NameOnly</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682022146"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621682022184"><span class="hs-identifier hs-var">parseNames</span></a></span><span>
</span><span id="line-689"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682022143"><span class="annot"><span class="annottext">rs :: Set Referent
</span><a href="#local-6989586621682022143"><span class="hs-identifier hs-var hs-var">rs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Set Referent] -&gt; Set Referent
forall (f :: * -&gt; *) a. (Foldable f, Ord a) =&gt; f (Set a) -&gt; Set a
</span><span class="hs-identifier hs-var">Set.unions</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Set Referent
</span><a href="#local-6989586621682022147"><span class="hs-identifier hs-var">refsFor</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Set Referent) -&gt; [Name] -&gt; [Set Referent]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682022148"><span class="hs-identifier hs-var">docs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set Referent -&gt; Set Referent -&gt; Set Referent
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Referent] -&gt; Set Referent
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference -&gt; Referent
</span><span class="hs-identifier hs-var">Referent.Ref</span></span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; Referent) -&gt; [Reference] -&gt; [Referent]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Reference]
</span><a href="#local-6989586621682022149"><span class="hs-identifier hs-var">rs0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-690"></span><span>        </span><span class="hs-comment">-- lookup the type of each, make sure it's a doc</span><span>
</span><span id="line-691"></span><span>        </span><span id="local-6989586621682022141"><span class="annot"><span class="annottext">[Reference]
</span><a href="#local-6989586621682022141"><span class="hs-identifier hs-var">docs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Referent] -&gt; Backend IO [Reference]
</span><a href="#local-6989586621682022159"><span class="hs-identifier hs-var">selectDocs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Referent -&gt; [Referent]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621682022143"><span class="hs-identifier hs-var">rs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-692"></span><span>        </span><span class="hs-comment">-- render all the docs</span><span>
</span><span id="line-693"></span><span>        </span><span class="annot"><span class="annottext">[[(Text, Text, Doc)]] -&gt; [(Text, Text, Doc)]
forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><span class="hs-identifier hs-var">join</span></span><span> </span><span class="annot"><span class="annottext">([[(Text, Text, Doc)]] -&gt; [(Text, Text, Doc)])
-&gt; ExceptT BackendError IO [[(Text, Text, Doc)]]
-&gt; Backend IO [(Text, Text, Doc)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; Backend IO [(Text, Text, Doc)])
-&gt; [Reference] -&gt; ExceptT BackendError IO [[(Text, Text, Doc)]]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
-&gt; Width
-&gt; Runtime v
-&gt; Codebase IO v Ann
-&gt; Reference
-&gt; Backend IO [(Text, Text, Doc)]
forall v.
Var v =&gt;
PrettyPrintEnvDecl
-&gt; Width
-&gt; Runtime v
-&gt; Codebase IO v Ann
-&gt; Reference
-&gt; Backend IO [(Text, Text, Doc)]
</span><a href="Unison.Server.Backend.html#renderDoc"><span class="hs-identifier hs-var">renderDoc</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621682022183"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682022182"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime v
</span><a href="#local-6989586621682022195"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621682022194"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Reference]
</span><a href="#local-6989586621682022141"><span class="hs-identifier hs-var">docs</span></a></span><span>
</span><span id="line-694"></span><span>
</span><span id="line-695"></span><span>      </span><span id="local-6989586621682022140"><span class="annot"><span class="annottext">mkTermDefinition :: Reference
-&gt; DisplayObject
     (AnnotatedText (Element Reference))
     (AnnotatedText (Element Reference))
-&gt; ExceptT BackendError IO TermDefinition
</span><a href="#local-6989586621682022140"><span class="hs-identifier hs-var hs-var">mkTermDefinition</span></a></span></span><span> </span><span id="local-6989586621682022139"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022139"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682022138"><span class="annot"><span class="annottext">DisplayObject
  (AnnotatedText (Element Reference))
  (AnnotatedText (Element Reference))
</span><a href="#local-6989586621682022138"><span class="hs-identifier hs-var">tm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-696"></span><span>        </span><span id="local-6989586621682022137"><span class="annot"><span class="annottext">Maybe (Type v Ann)
</span><a href="#local-6989586621682022137"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Maybe (Type v Ann))
-&gt; ExceptT BackendError IO (Maybe (Type v Ann))
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO v Ann -&gt; Reference -&gt; IO (Maybe (Type v Ann))
forall (m :: * -&gt; *) v a.
(Applicative m, Var v, BuiltinAnnotation a) =&gt;
Codebase m v a -&gt; Reference -&gt; m (Maybe (Type v a))
</span><a href="Unison.Codebase.html#getTypeOfTerm"><span class="hs-identifier hs-var">Codebase.getTypeOfTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621682022194"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022139"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-697"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682022136"><span class="annot"><span class="annottext">bn :: Text
</span><a href="#local-6989586621682022136"><span class="hs-identifier hs-var hs-var">bn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; Width -&gt; Referent -&gt; Text
forall v. Var v =&gt; PrettyPrintEnv -&gt; Width -&gt; Referent -&gt; Text
</span><a href="Unison.Server.Backend.html#bestNameForTerm"><span class="hs-identifier hs-var">bestNameForTerm</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682022200"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><a href="Unison.PrettyPrintEnvDecl.html#suffixifiedPPE"><span class="hs-identifier hs-var hs-var">PPE.suffixifiedPPE</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621682022183"><span class="hs-identifier hs-var">ppe</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682022182"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference -&gt; Referent
</span><span class="hs-identifier hs-var">Referent.Ref</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022139"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-698"></span><span>        </span><span id="local-6989586621682022134"><span class="annot"><span class="annottext">Maybe TermTag
</span><a href="#local-6989586621682022134"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TermEntry v Ann -&gt; Maybe TermTag
forall v a. TermEntry v a -&gt; Maybe TermTag
</span><a href="Unison.Server.Backend.html#termEntryTag"><span class="hs-identifier hs-var hs-var">termEntryTag</span></a></span><span> </span><span class="annot"><span class="annottext">(TermEntry v Ann -&gt; Maybe TermTag)
-&gt; ExceptT BackendError IO (TermEntry v Ann)
-&gt; ExceptT BackendError IO (Maybe TermTag)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
-&gt; Branch0 IO
-&gt; Referent
-&gt; HQSegment
-&gt; ExceptT BackendError IO (TermEntry v Ann)
forall (m :: * -&gt; *) v.
(Monad m, Var v) =&gt;
Codebase m v Ann
-&gt; Branch0 m
-&gt; Referent
-&gt; HQSegment
-&gt; Backend m (TermEntry v Ann)
</span><a href="Unison.Server.Backend.html#termListEntry"><span class="hs-identifier hs-var">termListEntry</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621682022194"><span class="hs-identifier hs-var">codebase</span></a></span><span>
</span><span id="line-699"></span><span>                                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch IO -&gt; Branch0 IO
forall (m :: * -&gt; *). Branch m -&gt; Branch0 m
</span><a href="Unison.Codebase.Branch.html#head"><span class="hs-identifier hs-var">Branch.head</span></a></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621682022192"><span class="hs-identifier hs-var">branch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-700"></span><span>                                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference -&gt; Referent
</span><span class="hs-identifier hs-var">Referent.Ref</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022139"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-701"></span><span>                                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NameSegment -&gt; HQSegment
forall n. n -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ'.NameOnly</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; NameSegment
</span><span class="hs-identifier hs-var">NameSegment</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682022136"><span class="hs-identifier hs-var">bn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-702"></span><span>        </span><span id="local-6989586621682022132"><span class="annot"><span class="annottext">[(Text, Text, Doc)]
</span><a href="#local-6989586621682022132"><span class="hs-identifier hs-var">docs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Reference] -&gt; [Name] -&gt; Backend IO [(Text, Text, Doc)]
</span><a href="#local-6989586621682022152"><span class="hs-identifier hs-var">docResults</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022139"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">([Name] -&gt; Backend IO [(Text, Text, Doc)])
-&gt; [Name] -&gt; Backend IO [(Text, Text, Doc)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set (HashQualified Name) -&gt; [Name]
</span><a href="#local-6989586621682022164"><span class="hs-identifier hs-var">docNames</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Referent -&gt; NamesWithHistory -&gt; Set (HashQualified Name)
</span><span class="hs-identifier hs-var">NamesWithHistory.termName</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682022186"><span class="hs-identifier hs-var">hqLength</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference -&gt; Referent
</span><span class="hs-identifier hs-var">Referent.Ref</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022139"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621682022185"><span class="hs-identifier hs-var">printNames</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-703"></span><span>        </span><span class="annot"><span class="annottext">[(Text, Text, Doc)]
-&gt; Maybe (Type v Ann)
-&gt; Text
-&gt; Maybe TermTag
-&gt; ExceptT BackendError IO TermDefinition
forall (m :: * -&gt; *) v.
(MonadError BackendError m, Var v) =&gt;
[(Text, Text, Doc)]
-&gt; Maybe (Type v Ann) -&gt; Text -&gt; Maybe TermTag -&gt; m TermDefinition
</span><a href="#local-6989586621682022131"><span class="hs-identifier hs-var">mk</span></a></span><span> </span><span class="annot"><span class="annottext">[(Text, Text, Doc)]
</span><a href="#local-6989586621682022132"><span class="hs-identifier hs-var">docs</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Type v Ann)
</span><a href="#local-6989586621682022137"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682022136"><span class="hs-identifier hs-var">bn</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TermTag
</span><a href="#local-6989586621682022134"><span class="hs-identifier hs-var">tag</span></a></span><span>
</span><span id="line-704"></span><span>       </span><span class="hs-keyword">where</span><span>
</span><span id="line-705"></span><span>        </span><span id="local-6989586621682022131"><span class="annot"><span class="annottext">mk :: [(Text, Text, Doc)]
-&gt; Maybe (Type v Ann) -&gt; Text -&gt; Maybe TermTag -&gt; m TermDefinition
</span><a href="#local-6989586621682022131"><span class="hs-identifier hs-var hs-var">mk</span></a></span></span><span> </span><span class="annot"><span class="annottext">[(Text, Text, Doc)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Type v Ann)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe TermTag
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BackendError -&gt; m TermDefinition
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(BackendError -&gt; m TermDefinition)
-&gt; BackendError -&gt; m TermDefinition
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; BackendError
</span><a href="Unison.Server.Backend.html#MissingSignatureForTerm"><span class="hs-identifier hs-var">MissingSignatureForTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022139"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-706"></span><span>        </span><span class="annot"><a href="#local-6989586621682022131"><span class="hs-identifier hs-var">mk</span></a></span><span> </span><span id="local-6989586621682022130"><span class="annot"><span class="annottext">[(Text, Text, Doc)]
</span><a href="#local-6989586621682022130"><span class="hs-identifier hs-var">docs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682022129"><span class="annot"><span class="annottext">Type v Ann
</span><a href="#local-6989586621682022129"><span class="hs-identifier hs-var">typeSig</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682022128"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682022128"><span class="hs-identifier hs-var">bn</span></a></span></span><span> </span><span id="local-6989586621682022127"><span class="annot"><span class="annottext">Maybe TermTag
</span><a href="#local-6989586621682022127"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-707"></span><span>          </span><span class="annot"><span class="annottext">TermDefinition -&gt; m TermDefinition
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(TermDefinition -&gt; m TermDefinition)
-&gt; TermDefinition -&gt; m TermDefinition
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-708"></span><span>            </span><span class="annot"><span class="annottext">[Text]
-&gt; Text
-&gt; Maybe TermTag
-&gt; DisplayObject SyntaxText SyntaxText
-&gt; SyntaxText
-&gt; [(Text, Text, Doc)]
-&gt; TermDefinition
</span><a href="Unison.Server.Types.html#TermDefinition"><span class="hs-identifier hs-var">TermDefinition</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (Set Text) -&gt; [Text]
forall a. Maybe (Set a) -&gt; [a]
</span><a href="#local-6989586621682022165"><span class="hs-identifier hs-var">flatten</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (Set Text) -&gt; [Text]) -&gt; Maybe (Set Text) -&gt; [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Map Reference (Set Text) -&gt; Maybe (Set Text)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022139"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Map Reference (Set Text)
</span><a href="#local-6989586621682022177"><span class="hs-identifier hs-var">termFqns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-709"></span><span>                             </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682022128"><span class="hs-identifier hs-var">bn</span></a></span><span>
</span><span id="line-710"></span><span>                             </span><span class="annot"><span class="annottext">Maybe TermTag
</span><a href="#local-6989586621682022127"><span class="hs-identifier hs-var">tag</span></a></span><span>
</span><span id="line-711"></span><span>                             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(AnnotatedText (Element Reference) -&gt; SyntaxText)
-&gt; (AnnotatedText (Element Reference) -&gt; SyntaxText)
-&gt; DisplayObject
     (AnnotatedText (Element Reference))
     (AnnotatedText (Element Reference))
-&gt; DisplayObject SyntaxText SyntaxText
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="annot"><span class="annottext">AnnotatedText (Element Reference) -&gt; SyntaxText
forall (g :: * -&gt; *).
Functor g =&gt;
g (Element Reference) -&gt; g Element
</span><a href="Unison.Server.Backend.html#mungeSyntaxText"><span class="hs-identifier hs-var">mungeSyntaxText</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedText (Element Reference) -&gt; SyntaxText
forall (g :: * -&gt; *).
Functor g =&gt;
g (Element Reference) -&gt; g Element
</span><a href="Unison.Server.Backend.html#mungeSyntaxText"><span class="hs-identifier hs-var">mungeSyntaxText</span></a></span><span> </span><span class="annot"><span class="annottext">DisplayObject
  (AnnotatedText (Element Reference))
  (AnnotatedText (Element Reference))
</span><a href="#local-6989586621682022138"><span class="hs-identifier hs-var">tm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-712"></span><span>                             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; Width -&gt; Type v Ann -&gt; SyntaxText
forall v.
Var v =&gt;
PrettyPrintEnvDecl -&gt; Width -&gt; Type v Ann -&gt; SyntaxText
</span><a href="Unison.Server.Backend.html#formatSuffixedType"><span class="hs-identifier hs-var">formatSuffixedType</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621682022183"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682022182"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Type v Ann
</span><a href="#local-6989586621682022129"><span class="hs-identifier hs-var">typeSig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-713"></span><span>                             </span><span class="annot"><span class="annottext">[(Text, Text, Doc)]
</span><a href="#local-6989586621682022130"><span class="hs-identifier hs-var">docs</span></a></span><span>
</span><span id="line-714"></span><span>      </span><span id="local-6989586621682022124"><span class="annot"><span class="annottext">mkTypeDefinition :: Reference
-&gt; DisplayObject
     (AnnotatedText (Element Reference))
     (AnnotatedText (Element Reference))
-&gt; ExceptT BackendError IO TypeDefinition
</span><a href="#local-6989586621682022124"><span class="hs-identifier hs-var hs-var">mkTypeDefinition</span></a></span></span><span> </span><span id="local-6989586621682022123"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022123"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682022122"><span class="annot"><span class="annottext">DisplayObject
  (AnnotatedText (Element Reference))
  (AnnotatedText (Element Reference))
</span><a href="#local-6989586621682022122"><span class="hs-identifier hs-var">tp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-715"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682022121"><span class="annot"><span class="annottext">bn :: Text
</span><a href="#local-6989586621682022121"><span class="hs-identifier hs-var hs-var">bn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; Width -&gt; Reference -&gt; Text
forall v. Var v =&gt; PrettyPrintEnv -&gt; Width -&gt; Reference -&gt; Text
</span><a href="Unison.Server.Backend.html#bestNameForType"><span class="hs-identifier hs-var">bestNameForType</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682022200"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><a href="Unison.PrettyPrintEnvDecl.html#suffixifiedPPE"><span class="hs-identifier hs-var hs-var">PPE.suffixifiedPPE</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621682022183"><span class="hs-identifier hs-var">ppe</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682022182"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022123"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-716"></span><span>        </span><span id="local-6989586621682022119"><span class="annot"><span class="annottext">Maybe TypeTag
</span><a href="#local-6989586621682022119"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeTag -&gt; Maybe TypeTag
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(TypeTag -&gt; Maybe TypeTag)
-&gt; (TypeEntry -&gt; TypeTag) -&gt; TypeEntry -&gt; Maybe TypeTag
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TypeEntry -&gt; TypeTag
</span><a href="Unison.Server.Backend.html#typeEntryTag"><span class="hs-identifier hs-var hs-var">typeEntryTag</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeEntry -&gt; Maybe TypeTag)
-&gt; ExceptT BackendError IO TypeEntry
-&gt; ExceptT BackendError IO (Maybe TypeTag)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
-&gt; Reference -&gt; HQSegment -&gt; ExceptT BackendError IO TypeEntry
forall (m :: * -&gt; *) v.
(Monad m, Var v) =&gt;
Codebase m v Ann -&gt; Reference -&gt; HQSegment -&gt; Backend m TypeEntry
</span><a href="Unison.Server.Backend.html#typeListEntry"><span class="hs-identifier hs-var">typeListEntry</span></a></span><span>
</span><span id="line-717"></span><span>          </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621682022194"><span class="hs-identifier hs-var">codebase</span></a></span><span>
</span><span id="line-718"></span><span>          </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022123"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-719"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NameSegment -&gt; HQSegment
forall n. n -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ'.NameOnly</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; NameSegment
</span><span class="hs-identifier hs-var">NameSegment</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682022121"><span class="hs-identifier hs-var">bn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-720"></span><span>        </span><span id="local-6989586621682022118"><span class="annot"><span class="annottext">[(Text, Text, Doc)]
</span><a href="#local-6989586621682022118"><span class="hs-identifier hs-var">docs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Reference] -&gt; [Name] -&gt; Backend IO [(Text, Text, Doc)]
</span><a href="#local-6989586621682022152"><span class="hs-identifier hs-var">docResults</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">([Name] -&gt; Backend IO [(Text, Text, Doc)])
-&gt; [Name] -&gt; Backend IO [(Text, Text, Doc)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set (HashQualified Name) -&gt; [Name]
</span><a href="#local-6989586621682022164"><span class="hs-identifier hs-var">docNames</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Reference -&gt; NamesWithHistory -&gt; Set (HashQualified Name)
</span><span class="hs-identifier hs-var">NamesWithHistory.typeName</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682022186"><span class="hs-identifier hs-var">hqLength</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022123"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621682022185"><span class="hs-identifier hs-var">printNames</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-721"></span><span>        </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="annot"><span class="annottext">[Text]
-&gt; Text
-&gt; Maybe TypeTag
-&gt; DisplayObject SyntaxText SyntaxText
-&gt; [(Text, Text, Doc)]
-&gt; TypeDefinition
</span><a href="Unison.Server.Types.html#TypeDefinition"><span class="hs-identifier hs-var">TypeDefinition</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (Set Text) -&gt; [Text]
forall a. Maybe (Set a) -&gt; [a]
</span><a href="#local-6989586621682022165"><span class="hs-identifier hs-var">flatten</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (Set Text) -&gt; [Text]) -&gt; Maybe (Set Text) -&gt; [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Map Reference (Set Text) -&gt; Maybe (Set Text)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022123"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Map Reference (Set Text)
</span><a href="#local-6989586621682022170"><span class="hs-identifier hs-var">typeFqns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-722"></span><span>                              </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682022121"><span class="hs-identifier hs-var">bn</span></a></span><span>
</span><span id="line-723"></span><span>                              </span><span class="annot"><span class="annottext">Maybe TypeTag
</span><a href="#local-6989586621682022119"><span class="hs-identifier hs-var">tag</span></a></span><span>
</span><span id="line-724"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(AnnotatedText (Element Reference) -&gt; SyntaxText)
-&gt; (AnnotatedText (Element Reference) -&gt; SyntaxText)
-&gt; DisplayObject
     (AnnotatedText (Element Reference))
     (AnnotatedText (Element Reference))
-&gt; DisplayObject SyntaxText SyntaxText
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="annot"><span class="annottext">AnnotatedText (Element Reference) -&gt; SyntaxText
forall (g :: * -&gt; *).
Functor g =&gt;
g (Element Reference) -&gt; g Element
</span><a href="Unison.Server.Backend.html#mungeSyntaxText"><span class="hs-identifier hs-var">mungeSyntaxText</span></a></span><span> </span><span class="annot"><span class="annottext">AnnotatedText (Element Reference) -&gt; SyntaxText
forall (g :: * -&gt; *).
Functor g =&gt;
g (Element Reference) -&gt; g Element
</span><a href="Unison.Server.Backend.html#mungeSyntaxText"><span class="hs-identifier hs-var">mungeSyntaxText</span></a></span><span> </span><span class="annot"><span class="annottext">DisplayObject
  (AnnotatedText (Element Reference))
  (AnnotatedText (Element Reference))
</span><a href="#local-6989586621682022122"><span class="hs-identifier hs-var">tp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-725"></span><span>                              </span><span class="annot"><span class="annottext">[(Text, Text, Doc)]
</span><a href="#local-6989586621682022118"><span class="hs-identifier hs-var">docs</span></a></span><span>
</span><span id="line-726"></span><span>    </span><span id="local-6989586621682022116"><span class="annot"><span class="annottext">Map Reference TypeDefinition
</span><a href="#local-6989586621682022116"><span class="hs-identifier hs-var">typeDefinitions</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Reference
 -&gt; DisplayObject
      (AnnotatedText (Element Reference))
      (AnnotatedText (Element Reference))
 -&gt; ExceptT BackendError IO TypeDefinition)
-&gt; Map
     Reference
     (DisplayObject
        (AnnotatedText (Element Reference))
        (AnnotatedText (Element Reference)))
-&gt; ExceptT BackendError IO (Map Reference TypeDefinition)
forall (t :: * -&gt; *) k a b.
Applicative t =&gt;
(k -&gt; a -&gt; t b) -&gt; Map k a -&gt; t (Map k b)
</span><span class="hs-identifier hs-var">Map.traverseWithKey</span></span><span> </span><span class="annot"><span class="annottext">Reference
-&gt; DisplayObject
     (AnnotatedText (Element Reference))
     (AnnotatedText (Element Reference))
-&gt; ExceptT BackendError IO TypeDefinition
</span><a href="#local-6989586621682022124"><span class="hs-identifier hs-var">mkTypeDefinition</span></a></span><span>
</span><span id="line-727"></span><span>      </span><span class="annot"><span class="annottext">(Map
   Reference
   (DisplayObject
      (AnnotatedText (Element Reference))
      (AnnotatedText (Element Reference)))
 -&gt; ExceptT BackendError IO (Map Reference TypeDefinition))
-&gt; Map
     Reference
     (DisplayObject
        (AnnotatedText (Element Reference))
        (AnnotatedText (Element Reference)))
-&gt; ExceptT BackendError IO (Map Reference TypeDefinition)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Suffixify
-&gt; Width
-&gt; PrettyPrintEnvDecl
-&gt; Map Reference (DisplayObject () (Decl v Ann))
-&gt; Map
     Reference
     (DisplayObject
        (AnnotatedText (Element Reference))
        (AnnotatedText (Element Reference)))
forall v a.
(Var v, Ord a) =&gt;
Suffixify
-&gt; Width
-&gt; PrettyPrintEnvDecl
-&gt; Map Reference (DisplayObject () (Decl v a))
-&gt; Map
     Reference
     (DisplayObject
        (AnnotatedText (Element Reference))
        (AnnotatedText (Element Reference)))
</span><a href="Unison.Server.Backend.html#typesToSyntax"><span class="hs-identifier hs-var">typesToSyntax</span></a></span><span> </span><span class="annot"><span class="annottext">Suffixify
</span><a href="#local-6989586621682022196"><span class="hs-identifier hs-var">suffixifyBindings</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682022182"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621682022183"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">Map Reference (DisplayObject () (Decl v Ann))
</span><a href="#local-6989586621682022189"><span class="hs-identifier hs-var">types</span></a></span><span>
</span><span id="line-728"></span><span>    </span><span id="local-6989586621682022113"><span class="annot"><span class="annottext">Map Reference TermDefinition
</span><a href="#local-6989586621682022113"><span class="hs-identifier hs-var">termDefinitions</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Reference
 -&gt; DisplayObject
      (AnnotatedText (Element Reference))
      (AnnotatedText (Element Reference))
 -&gt; ExceptT BackendError IO TermDefinition)
-&gt; Map
     Reference
     (DisplayObject
        (AnnotatedText (Element Reference))
        (AnnotatedText (Element Reference)))
-&gt; ExceptT BackendError IO (Map Reference TermDefinition)
forall (t :: * -&gt; *) k a b.
Applicative t =&gt;
(k -&gt; a -&gt; t b) -&gt; Map k a -&gt; t (Map k b)
</span><span class="hs-identifier hs-var">Map.traverseWithKey</span></span><span> </span><span class="annot"><span class="annottext">Reference
-&gt; DisplayObject
     (AnnotatedText (Element Reference))
     (AnnotatedText (Element Reference))
-&gt; ExceptT BackendError IO TermDefinition
</span><a href="#local-6989586621682022140"><span class="hs-identifier hs-var">mkTermDefinition</span></a></span><span>
</span><span id="line-729"></span><span>      </span><span class="annot"><span class="annottext">(Map
   Reference
   (DisplayObject
      (AnnotatedText (Element Reference))
      (AnnotatedText (Element Reference)))
 -&gt; ExceptT BackendError IO (Map Reference TermDefinition))
-&gt; Map
     Reference
     (DisplayObject
        (AnnotatedText (Element Reference))
        (AnnotatedText (Element Reference)))
-&gt; ExceptT BackendError IO (Map Reference TermDefinition)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Suffixify
-&gt; Width
-&gt; PrettyPrintEnvDecl
-&gt; Map Reference (DisplayObject (Type v Ann) (Term v Ann))
-&gt; Map
     Reference
     (DisplayObject
        (AnnotatedText (Element Reference))
        (AnnotatedText (Element Reference)))
forall v a.
(Var v, Ord a) =&gt;
Suffixify
-&gt; Width
-&gt; PrettyPrintEnvDecl
-&gt; Map Reference (DisplayObject (Type v a) (Term v a))
-&gt; Map
     Reference
     (DisplayObject
        (AnnotatedText (Element Reference))
        (AnnotatedText (Element Reference)))
</span><a href="Unison.Server.Backend.html#termsToSyntax"><span class="hs-identifier hs-var">termsToSyntax</span></a></span><span> </span><span class="annot"><span class="annottext">Suffixify
</span><a href="#local-6989586621682022196"><span class="hs-identifier hs-var">suffixifyBindings</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682022182"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621682022183"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">Map Reference (DisplayObject (Type v Ann) (Term v Ann))
</span><a href="#local-6989586621682022190"><span class="hs-identifier hs-var">terms</span></a></span><span>
</span><span id="line-730"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682022111"><span class="annot"><span class="annottext">renderedDisplayTerms :: Map Text TermDefinition
</span><a href="#local-6989586621682022111"><span class="hs-identifier hs-var hs-var">renderedDisplayTerms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; Text)
-&gt; Map Reference TermDefinition -&gt; Map Text TermDefinition
forall k2 k1 a. Ord k2 =&gt; (k1 -&gt; k2) -&gt; Map k1 a -&gt; Map k2 a
</span><span class="hs-identifier hs-var">Map.mapKeys</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Text
</span><span class="hs-identifier hs-var">Reference.toText</span></span><span> </span><span class="annot"><span class="annottext">Map Reference TermDefinition
</span><a href="#local-6989586621682022113"><span class="hs-identifier hs-var">termDefinitions</span></a></span><span>
</span><span id="line-731"></span><span>        </span><span id="local-6989586621682022109"><span class="annot"><span class="annottext">renderedDisplayTypes :: Map Text TypeDefinition
</span><a href="#local-6989586621682022109"><span class="hs-identifier hs-var hs-var">renderedDisplayTypes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; Text)
-&gt; Map Reference TypeDefinition -&gt; Map Text TypeDefinition
forall k2 k1 a. Ord k2 =&gt; (k1 -&gt; k2) -&gt; Map k1 a -&gt; Map k2 a
</span><span class="hs-identifier hs-var">Map.mapKeys</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Text
</span><span class="hs-identifier hs-var">Reference.toText</span></span><span> </span><span class="annot"><span class="annottext">Map Reference TypeDefinition
</span><a href="#local-6989586621682022116"><span class="hs-identifier hs-var">typeDefinitions</span></a></span><span>
</span><span id="line-732"></span><span>        </span><span id="local-6989586621682022108"><span class="annot"><span class="annottext">renderedMisses :: [Text]
</span><a href="#local-6989586621682022108"><span class="hs-identifier hs-var hs-var">renderedMisses</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HashQualified Name -&gt; Text) -&gt; [HashQualified Name] -&gt; [Text]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; Text
forall n. Show n =&gt; HashQualified n -&gt; Text
</span><span class="hs-identifier hs-var">HQ.toText</span></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621682022188"><span class="hs-identifier hs-var">misses</span></a></span><span>
</span><span id="line-733"></span><span>    </span><span class="annot"><span class="annottext">DefinitionDisplayResults -&gt; Backend IO DefinitionDisplayResults
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(DefinitionDisplayResults -&gt; Backend IO DefinitionDisplayResults)
-&gt; DefinitionDisplayResults -&gt; Backend IO DefinitionDisplayResults
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map Text TermDefinition
-&gt; Map Text TypeDefinition -&gt; [Text] -&gt; DefinitionDisplayResults
</span><a href="Unison.Server.Types.html#DefinitionDisplayResults"><span class="hs-identifier hs-var">DefinitionDisplayResults</span></a></span><span> </span><span class="annot"><span class="annottext">Map Text TermDefinition
</span><a href="#local-6989586621682022111"><span class="hs-identifier hs-var">renderedDisplayTerms</span></a></span><span>
</span><span id="line-734"></span><span>                                    </span><span class="annot"><span class="annottext">Map Text TypeDefinition
</span><a href="#local-6989586621682022109"><span class="hs-identifier hs-var">renderedDisplayTypes</span></a></span><span>
</span><span id="line-735"></span><span>                                    </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621682022108"><span class="hs-identifier hs-var">renderedMisses</span></a></span><span>
</span><span id="line-736"></span><span>
</span><span id="line-737"></span><span class="annot"><a href="Unison.Server.Backend.html#renderDoc"><span class="hs-identifier hs-type">renderDoc</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-738"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682023200"><span class="annot"><a href="#local-6989586621682023200"><span class="hs-identifier hs-type">v</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-739"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621682023200"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-740"></span><span>  </span><span class="annot"><a href="Unison.PrettyPrintEnvDecl.html#PrettyPrintEnvDecl"><span class="hs-identifier hs-type">PPE.PrettyPrintEnvDecl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-741"></span><span>  </span><span class="annot"><a href="Unison.Util.Pretty.html#Width"><span class="hs-identifier hs-type">Width</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-742"></span><span>  </span><span class="annot"><a href="Unison.Codebase.Runtime.html#Runtime"><span class="hs-identifier hs-type">Rt.Runtime</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682023200"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-743"></span><span>  </span><span class="annot"><a href="Unison.Codebase.Type.html#Codebase"><span class="hs-identifier hs-type">Codebase</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621682023200"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="Unison.Parser.Ann.html#Ann"><span class="hs-identifier hs-type">Ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-744"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-745"></span><span>  </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Types.html#HashQualifiedName"><span class="hs-identifier hs-type">HashQualifiedName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Types.html#UnisonHash"><span class="hs-identifier hs-type">UnisonHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Doc.html#Doc"><span class="hs-identifier hs-type">Doc.Doc</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-746"></span><span id="renderDoc"><span class="annot"><span class="annottext">renderDoc :: PrettyPrintEnvDecl
-&gt; Width
-&gt; Runtime v
-&gt; Codebase IO v Ann
-&gt; Reference
-&gt; Backend IO [(Text, Text, Doc)]
</span><a href="Unison.Server.Backend.html#renderDoc"><span class="hs-identifier hs-var hs-var">renderDoc</span></a></span></span><span> </span><span id="local-6989586621682022105"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621682022105"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span id="local-6989586621682022104"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682022104"><span class="hs-identifier hs-var">width</span></a></span></span><span> </span><span id="local-6989586621682022103"><span class="annot"><span class="annottext">Runtime v
</span><a href="#local-6989586621682022103"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span id="local-6989586621682022102"><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621682022102"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621682022101"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022101"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-747"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682022100"><span class="annot"><span class="annottext">name :: Text
</span><a href="#local-6989586621682022100"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; Width -&gt; Referent -&gt; Text
forall v. Var v =&gt; PrettyPrintEnv -&gt; Width -&gt; Referent -&gt; Text
</span><a href="Unison.Server.Backend.html#bestNameForTerm"><span class="hs-identifier hs-var">bestNameForTerm</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682023200"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><a href="Unison.PrettyPrintEnvDecl.html#suffixifiedPPE"><span class="hs-identifier hs-var hs-var">PPE.suffixifiedPPE</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621682022105"><span class="hs-identifier hs-var">ppe</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682022104"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference -&gt; Referent
</span><span class="hs-identifier hs-var">Referent.Ref</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022101"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-748"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682022099"><span class="annot"><span class="annottext">hash :: Text
</span><a href="#local-6989586621682022099"><span class="hs-identifier hs-var hs-var">hash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Text
</span><span class="hs-identifier hs-var">Reference.toText</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022101"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-749"></span><span>  </span><span class="annot"><span class="annottext">(Doc -&gt; (Text, Text, Doc)) -&gt; [Doc] -&gt; [(Text, Text, Doc)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682022100"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682022099"><span class="hs-identifier hs-var">hash</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Doc] -&gt; [(Text, Text, Doc)])
-&gt; (Doc -&gt; [Doc]) -&gt; Doc -&gt; [(Text, Text, Doc)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Doc -&gt; [Doc]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-750"></span><span>    </span><span class="annot"><span class="annottext">(Doc -&gt; [(Text, Text, Doc)])
-&gt; ExceptT BackendError IO Doc -&gt; Backend IO [(Text, Text, Doc)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682022098"><span class="annot"><span class="annottext">tm :: Term2 vt at ap v ()
</span><a href="#local-6989586621682022098"><span class="hs-identifier hs-var hs-var">tm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; Reference -&gt; Term2 vt at ap v ()
forall v a vt at ap. Ord v =&gt; a -&gt; Reference -&gt; Term2 vt at ap v a
</span><span class="hs-identifier hs-var">Term.ref</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022101"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-751"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
-&gt; (Reference -&gt; ExceptT BackendError IO (Maybe (Term v ())))
-&gt; (Referent -&gt; ExceptT BackendError IO (Maybe (Type v ())))
-&gt; (Term v () -&gt; ExceptT BackendError IO (Maybe (Term v ())))
-&gt; (Reference -&gt; ExceptT BackendError IO (Maybe (Decl v ())))
-&gt; Term v ()
-&gt; ExceptT BackendError IO Doc
forall v (m :: * -&gt; *).
(Var v, Monad m) =&gt;
PrettyPrintEnvDecl
-&gt; (Reference -&gt; m (Maybe (Term v ())))
-&gt; (Referent -&gt; m (Maybe (Type v ())))
-&gt; (Term v () -&gt; m (Maybe (Term v ())))
-&gt; (Reference -&gt; m (Maybe (Decl v ())))
-&gt; Term v ()
-&gt; m Doc
</span><a href="Unison.Server.Doc.html#renderDoc"><span class="hs-identifier hs-var">Doc.renderDoc</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682023200"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621682022105"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; ExceptT BackendError IO (Maybe (Term v ()))
forall (t :: (* -&gt; *) -&gt; * -&gt; *).
(Applicative (t IO), MonadTrans t) =&gt;
Reference -&gt; t IO (Maybe (Term v ()))
</span><a href="#local-6989586621682022095"><span class="hs-identifier hs-var">terms</span></a></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; ExceptT BackendError IO (Maybe (Type v ()))
forall (t :: (* -&gt; *) -&gt; * -&gt; *).
(Functor (t IO), MonadTrans t) =&gt;
Referent -&gt; t IO (Maybe (Type v ()))
</span><a href="#local-6989586621682022094"><span class="hs-identifier hs-var">typeOf</span></a></span><span> </span><span class="annot"><span class="annottext">Term v () -&gt; ExceptT BackendError IO (Maybe (Term v ()))
forall (t :: (* -&gt; *) -&gt; * -&gt; *) a2 b.
(MonadIO (t IO), MonadTrans t, Monoid a2) =&gt;
Term v b -&gt; t IO (Maybe (Term v a2))
</span><a href="#local-6989586621682022093"><span class="hs-identifier hs-var">eval</span></a></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; ExceptT BackendError IO (Maybe (Decl v ()))
forall (t :: (* -&gt; *) -&gt; * -&gt; *).
(MonadTrans t, Applicative (t IO)) =&gt;
Reference -&gt; t IO (Maybe (Decl v ()))
</span><a href="#local-6989586621682022092"><span class="hs-identifier hs-var">decls</span></a></span><span> </span><span class="annot"><span class="annottext">Term v ()
forall vt at ap. Term2 vt at ap v ()
</span><a href="#local-6989586621682022098"><span class="hs-identifier hs-var">tm</span></a></span><span>
</span><span id="line-752"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-753"></span><span>    </span><span id="local-6989586621682022095"><span class="annot"><span class="annottext">terms :: Reference -&gt; t IO (Maybe (Term v ()))
</span><a href="#local-6989586621682022095"><span class="hs-identifier hs-var hs-var">terms</span></a></span></span><span> </span><span id="local-6989586621682022091"><span class="annot"><span class="annottext">r :: Reference
</span><a href="#local-6989586621682022091"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reference.Builtin</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Term v ()) -&gt; t IO (Maybe (Term v ()))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term v () -&gt; Maybe (Term v ())
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; Reference -&gt; Term v ()
forall v a vt at ap. Ord v =&gt; a -&gt; Reference -&gt; Term2 vt at ap v a
</span><span class="hs-identifier hs-var">Term.ref</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022091"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-754"></span><span>    </span><span class="annot"><a href="#local-6989586621682022095"><span class="hs-identifier hs-var">terms</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reference.DerivedId</span></span><span> </span><span id="local-6989586621682022089"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682022089"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-755"></span><span>      </span><span class="annot"><span class="annottext">(Term2 v Ann Ann v Ann -&gt; Term v ())
-&gt; Maybe (Term2 v Ann Ann v Ann) -&gt; Maybe (Term v ())
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Term2 v Ann Ann v Ann -&gt; Term v ()
forall vt at ap v a. Ord v =&gt; Term2 vt at ap v a -&gt; Term0' vt v
</span><span class="hs-identifier hs-var">Term.unannotate</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (Term2 v Ann Ann v Ann) -&gt; Maybe (Term v ()))
-&gt; t IO (Maybe (Term2 v Ann Ann v Ann)) -&gt; t IO (Maybe (Term v ()))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">IO (Maybe (Term2 v Ann Ann v Ann))
-&gt; t IO (Maybe (Term2 v Ann Ann v Ann))
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO v Ann -&gt; Id -&gt; IO (Maybe (Term2 v Ann Ann v Ann))
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; Id -&gt; m (Maybe (Term v a))
</span><a href="Unison.Codebase.Type.html#getTerm"><span class="hs-identifier hs-var hs-var">Codebase.getTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621682022102"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682022089"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-756"></span><span>
</span><span id="line-757"></span><span>    </span><span id="local-6989586621682022094"><span class="annot"><span class="annottext">typeOf :: Referent -&gt; t IO (Maybe (Type v ()))
</span><a href="#local-6989586621682022094"><span class="hs-identifier hs-var hs-var">typeOf</span></a></span></span><span> </span><span id="local-6989586621682022086"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621682022086"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Term F v Ann -&gt; Type v ())
-&gt; Maybe (Term F v Ann) -&gt; Maybe (Type v ())
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Term F v Ann -&gt; Type v ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (Term F v Ann) -&gt; Maybe (Type v ()))
-&gt; t IO (Maybe (Term F v Ann)) -&gt; t IO (Maybe (Type v ()))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">IO (Maybe (Term F v Ann)) -&gt; t IO (Maybe (Term F v Ann))
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO v Ann -&gt; Referent -&gt; IO (Maybe (Term F v Ann))
forall a v (m :: * -&gt; *).
(BuiltinAnnotation a, Var v, Monad m) =&gt;
Codebase m v a -&gt; Referent -&gt; m (Maybe (Type v a))
</span><a href="Unison.Codebase.html#getTypeOfReferent"><span class="hs-identifier hs-var">Codebase.getTypeOfReferent</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621682022102"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621682022086"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-758"></span><span>    </span><span id="local-6989586621682022093"><span class="annot"><span class="annottext">eval :: Term v b -&gt; t IO (Maybe (Term v a2))
</span><a href="#local-6989586621682022093"><span class="hs-identifier hs-var hs-var">eval</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(b -&gt; Ann) -&gt; Term v b -&gt; Term2 v Ann Ann v Ann
forall v a a2. Ord v =&gt; (a -&gt; a2) -&gt; Term v a -&gt; Term v a2
</span><span class="hs-identifier hs-var">Term.amap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ann -&gt; b -&gt; Ann
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Ann
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621682022082"><span class="annot"><span class="annottext">Term2 v Ann Ann v Ann
</span><a href="#local-6989586621682022082"><span class="hs-identifier hs-var">tm</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-759"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682022081"><span class="annot"><span class="annottext">ppes :: PrettyPrintEnv
</span><a href="#local-6989586621682022081"><span class="hs-identifier hs-var hs-var">ppes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><a href="Unison.PrettyPrintEnvDecl.html#suffixifiedPPE"><span class="hs-identifier hs-var hs-var">PPE.suffixifiedPPE</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621682022105"><span class="hs-identifier hs-var">ppe</span></a></span><span>
</span><span id="line-760"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682022080"><span class="annot"><span class="annottext">codeLookup :: CodeLookup v IO Ann
</span><a href="#local-6989586621682022080"><span class="hs-identifier hs-var hs-var">codeLookup</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann -&gt; CodeLookup v IO Ann
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; CodeLookup v m a
</span><a href="Unison.Codebase.html#toCodeLookup"><span class="hs-identifier hs-var">Codebase.toCodeLookup</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621682022102"><span class="hs-identifier hs-var">codebase</span></a></span><span>
</span><span id="line-761"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682022078"><span class="annot"><span class="annottext">cache :: Reference -&gt; IO (Maybe (Term v ()))
</span><a href="#local-6989586621682022078"><span class="hs-identifier hs-var hs-var">cache</span></a></span></span><span> </span><span id="local-6989586621682022077"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022077"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Term2 v Ann Ann v Ann -&gt; Term v ())
-&gt; Maybe (Term2 v Ann Ann v Ann) -&gt; Maybe (Term v ())
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Term2 v Ann Ann v Ann -&gt; Term v ()
forall vt at ap v a. Ord v =&gt; Term2 vt at ap v a -&gt; Term0' vt v
</span><span class="hs-identifier hs-var">Term.unannotate</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (Term2 v Ann Ann v Ann) -&gt; Maybe (Term v ()))
-&gt; IO (Maybe (Term2 v Ann Ann v Ann)) -&gt; IO (Maybe (Term v ()))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
-&gt; Reference -&gt; IO (Maybe (Term2 v Ann Ann v Ann))
forall (m :: * -&gt; *) v a.
Monad m =&gt;
Codebase m v a -&gt; Reference -&gt; m (Maybe (Term v a))
</span><a href="Unison.Codebase.html#lookupWatchCache"><span class="hs-identifier hs-var">Codebase.lookupWatchCache</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621682022102"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022077"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-762"></span><span>      </span><span id="local-6989586621682022075"><span class="annot"><span class="annottext">Maybe (Term v ())
</span><a href="#local-6989586621682022075"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Either Error (Term v ()) -&gt; Maybe (Term v ()))
-&gt; t IO (Either Error (Term v ())) -&gt; t IO (Maybe (Term v ()))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Either Error (Term v ()) -&gt; Maybe (Term v ())
forall a b. Either a b -&gt; Maybe b
</span><span class="hs-identifier hs-var">hush</span></span><span> </span><span class="annot"><span class="annottext">(t IO (Either Error (Term v ())) -&gt; t IO (Maybe (Term v ())))
-&gt; (IO (Either Error (Term v ()))
    -&gt; t IO (Either Error (Term v ())))
-&gt; IO (Either Error (Term v ()))
-&gt; t IO (Maybe (Term v ()))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IO (Either Error (Term v ())) -&gt; t IO (Either Error (Term v ()))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Either Error (Term v ())) -&gt; t IO (Maybe (Term v ())))
-&gt; IO (Either Error (Term v ())) -&gt; t IO (Maybe (Term v ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CodeLookup v IO Ann
-&gt; (Reference -&gt; IO (Maybe (Term v ())))
-&gt; PrettyPrintEnv
-&gt; Runtime v
-&gt; Term2 v Ann Ann v Ann
-&gt; IO (Either Error (Term v ()))
forall v a.
(Var v, Monoid a) =&gt;
CodeLookup v IO a
-&gt; (Reference -&gt; IO (Maybe (Term v)))
-&gt; PrettyPrintEnv
-&gt; Runtime v
-&gt; Term v a
-&gt; IO (Either Error (Term v))
</span><a href="Unison.Codebase.Runtime.html#evaluateTerm%27"><span class="hs-identifier hs-var">Rt.evaluateTerm'</span></a></span><span> </span><span class="annot"><span class="annottext">CodeLookup v IO Ann
</span><a href="#local-6989586621682022080"><span class="hs-identifier hs-var">codeLookup</span></a></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; IO (Maybe (Term v ()))
</span><a href="#local-6989586621682022078"><span class="hs-identifier hs-var">cache</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621682022081"><span class="hs-identifier hs-var">ppes</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime v
</span><a href="#local-6989586621682022103"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">Term2 v Ann Ann v Ann
</span><a href="#local-6989586621682022082"><span class="hs-identifier hs-var">tm</span></a></span><span>
</span><span id="line-763"></span><span>      </span><span class="annot"><span class="annottext">IO () -&gt; t IO ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; t IO ()) -&gt; IO () -&gt; t IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Term v ())
</span><a href="#local-6989586621682022075"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-764"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682022073"><span class="annot"><span class="annottext">Term v ()
</span><a href="#local-6989586621682022073"><span class="hs-identifier hs-var">tmr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-765"></span><span>          </span><span class="annot"><span class="annottext">Codebase IO v Ann -&gt; String -&gt; Id -&gt; Term2 v Ann Ann v Ann -&gt; IO ()
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; String -&gt; Id -&gt; Term v a -&gt; m ()
</span><a href="Unison.Codebase.Type.html#putWatch"><span class="hs-identifier hs-var hs-var">Codebase.putWatch</span></a></span><span>
</span><span id="line-766"></span><span>            </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621682022102"><span class="hs-identifier hs-var">codebase</span></a></span><span>
</span><span id="line-767"></span><span>            </span><span class="annot"><span class="annottext">String
forall a. (Eq a, IsString a) =&gt; a
</span><span class="hs-identifier hs-var">WK.RegularWatch</span></span><span>
</span><span id="line-768"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term2 v Ann Ann v Ann -&gt; Id
forall v a. Var v =&gt; Term v a -&gt; Id
</span><a href="Unison.Hashing.V2.Convert.html#hashClosedTerm"><span class="hs-identifier hs-var">Hashing.hashClosedTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Term2 v Ann Ann v Ann
</span><a href="#local-6989586621682022082"><span class="hs-identifier hs-var">tm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-769"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(() -&gt; Ann) -&gt; Term v () -&gt; Term2 v Ann Ann v Ann
forall v a a2. Ord v =&gt; (a -&gt; a2) -&gt; Term v a -&gt; Term v a2
</span><span class="hs-identifier hs-var">Term.amap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ann -&gt; () -&gt; Ann
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Ann
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term v ()
</span><a href="#local-6989586621682022073"><span class="hs-identifier hs-var">tmr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-770"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Term v ())
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-771"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="annot"><span class="annottext">Maybe (Term v ())
</span><a href="#local-6989586621682022075"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Term v ()) -&gt; (Term v () -&gt; Term v a2) -&gt; Maybe (Term v a2)
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">(() -&gt; a2) -&gt; Term v () -&gt; Term v a2
forall v a a2. Ord v =&gt; (a -&gt; a2) -&gt; Term v a -&gt; Term v a2
</span><span class="hs-identifier hs-var">Term.amap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a2 -&gt; () -&gt; a2
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">a2
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span>
</span><span id="line-772"></span><span>
</span><span id="line-773"></span><span>    </span><span id="local-6989586621682022092"><span class="annot"><span class="annottext">decls :: Reference -&gt; t IO (Maybe (Decl v ()))
</span><a href="#local-6989586621682022092"><span class="hs-identifier hs-var hs-var">decls</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reference.DerivedId</span></span><span> </span><span id="local-6989586621682022069"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682022069"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Decl v Ann -&gt; Decl v ())
-&gt; Maybe (Decl v Ann) -&gt; Maybe (Decl v ())
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Ann -&gt; ()) -&gt; Decl v Ann -&gt; Decl v ()
forall a a2 v. (a -&gt; a2) -&gt; Decl v a -&gt; Decl v a2
</span><span class="hs-identifier hs-var">DD.amap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; Ann -&gt; ()
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (Decl v Ann) -&gt; Maybe (Decl v ()))
-&gt; t IO (Maybe (Decl v Ann)) -&gt; t IO (Maybe (Decl v ()))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">IO (Maybe (Decl v Ann)) -&gt; t IO (Maybe (Decl v Ann))
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO v Ann -&gt; Id -&gt; IO (Maybe (Decl v Ann))
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; Id -&gt; m (Maybe (Decl v a))
</span><a href="Unison.Codebase.Type.html#getTypeDeclaration"><span class="hs-identifier hs-var hs-var">Codebase.getTypeDeclaration</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621682022102"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682022069"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-774"></span><span>    </span><span class="annot"><a href="#local-6989586621682022092"><span class="hs-identifier hs-var">decls</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Decl v ()) -&gt; t IO (Maybe (Decl v ()))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Decl v ())
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-775"></span><span>
</span><span id="line-776"></span><span>
</span><span id="line-777"></span><span class="annot"><a href="Unison.Server.Backend.html#bestNameForTerm"><span class="hs-identifier hs-type">bestNameForTerm</span></a></span><span>
</span><span id="line-778"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682022973"><span class="annot"><a href="#local-6989586621682022973"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621682022973"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.PrettyPrintEnv.html#PrettyPrintEnv"><span class="hs-identifier hs-type">PPE.PrettyPrintEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Util.Pretty.html#Width"><span class="hs-identifier hs-type">Width</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-779"></span><span id="bestNameForTerm"><span class="annot"><span class="annottext">bestNameForTerm :: PrettyPrintEnv -&gt; Width -&gt; Referent -&gt; Text
</span><a href="Unison.Server.Backend.html#bestNameForTerm"><span class="hs-identifier hs-var hs-var">bestNameForTerm</span></a></span></span><span> </span><span id="local-6989586621682022067"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621682022067"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span id="local-6989586621682022066"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682022066"><span class="hs-identifier hs-var">width</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-780"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span>
</span><span id="line-781"></span><span>    </span><span class="annot"><span class="annottext">(String -&gt; Text) -&gt; (Referent -&gt; String) -&gt; Referent -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Pretty String -&gt; String
forall s. (Monoid s, IsString s) =&gt; Width -&gt; Pretty s -&gt; s
</span><a href="Unison.Util.Pretty.html#render"><span class="hs-identifier hs-var">Pretty.render</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682022066"><span class="hs-identifier hs-var">width</span></a></span><span>
</span><span id="line-782"></span><span>    </span><span class="annot"><span class="annottext">(Pretty String -&gt; String)
-&gt; (Referent -&gt; Pretty String) -&gt; Referent -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(AnnotatedText (Element Reference) -&gt; String)
-&gt; Pretty (AnnotatedText (Element Reference)) -&gt; Pretty String
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">AnnotatedText (Element Reference) -&gt; String
forall r. SyntaxText' r -&gt; String
</span><a href="Unison.Util.SyntaxText.html#toPlain"><span class="hs-identifier hs-var">UST.toPlain</span></a></span><span>
</span><span id="line-783"></span><span>    </span><span class="annot"><span class="annottext">(Pretty (AnnotatedText (Element Reference)) -&gt; Pretty String)
-&gt; (Referent -&gt; Pretty (AnnotatedText (Element Reference)))
-&gt; Referent
-&gt; Pretty String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
-&gt; AmbientContext
-&gt; Term3 v PrintAnnotation
-&gt; Pretty (AnnotatedText (Element Reference))
forall v.
Var v =&gt;
PrettyPrintEnv
-&gt; AmbientContext
-&gt; Term3 v PrintAnnotation
-&gt; Pretty (AnnotatedText (Element Reference))
</span><a href="Unison.TermPrinter.html#pretty0"><span class="hs-identifier hs-var">TermPrinter.pretty0</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682022973"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621682022067"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">AmbientContext
</span><a href="Unison.TermPrinter.html#emptyAc"><span class="hs-identifier hs-var">TermPrinter.emptyAc</span></a></span><span>
</span><span id="line-784"></span><span>    </span><span class="annot"><span class="annottext">(Term3 v PrintAnnotation
 -&gt; Pretty (AnnotatedText (Element Reference)))
-&gt; (Referent -&gt; Term3 v PrintAnnotation)
-&gt; Referent
-&gt; Pretty (AnnotatedText (Element Reference))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PrintAnnotation -&gt; Referent -&gt; Term3 v PrintAnnotation
forall v a vt at ap. Ord v =&gt; a -&gt; Referent -&gt; Term2 vt at ap v a
</span><span class="hs-identifier hs-var">Term.fromReferent</span></span><span> </span><span class="annot"><span class="annottext">PrintAnnotation
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-785"></span><span>
</span><span id="line-786"></span><span class="annot"><a href="Unison.Server.Backend.html#bestNameForType"><span class="hs-identifier hs-type">bestNameForType</span></a></span><span>
</span><span id="line-787"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682022962"><span class="annot"><a href="#local-6989586621682022962"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621682022962"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.PrettyPrintEnv.html#PrettyPrintEnv"><span class="hs-identifier hs-type">PPE.PrettyPrintEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Util.Pretty.html#Width"><span class="hs-identifier hs-type">Width</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-788"></span><span id="bestNameForType"><span class="annot"><span class="annottext">bestNameForType :: PrettyPrintEnv -&gt; Width -&gt; Reference -&gt; Text
</span><a href="Unison.Server.Backend.html#bestNameForType"><span class="hs-identifier hs-var hs-var">bestNameForType</span></a></span></span><span> </span><span id="local-6989586621682022060"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621682022060"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span id="local-6989586621682022059"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682022059"><span class="hs-identifier hs-var">width</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-789"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span>
</span><span id="line-790"></span><span>    </span><span class="annot"><span class="annottext">(String -&gt; Text) -&gt; (Reference -&gt; String) -&gt; Reference -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Pretty String -&gt; String
forall s. (Monoid s, IsString s) =&gt; Width -&gt; Pretty s -&gt; s
</span><a href="Unison.Util.Pretty.html#render"><span class="hs-identifier hs-var">Pretty.render</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682022059"><span class="hs-identifier hs-var">width</span></a></span><span>
</span><span id="line-791"></span><span>    </span><span class="annot"><span class="annottext">(Pretty String -&gt; String)
-&gt; (Reference -&gt; Pretty String) -&gt; Reference -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(AnnotatedText (Element Reference) -&gt; String)
-&gt; Pretty (AnnotatedText (Element Reference)) -&gt; Pretty String
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">AnnotatedText (Element Reference) -&gt; String
forall r. SyntaxText' r -&gt; String
</span><a href="Unison.Util.SyntaxText.html#toPlain"><span class="hs-identifier hs-var">UST.toPlain</span></a></span><span>
</span><span id="line-792"></span><span>    </span><span class="annot"><span class="annottext">(Pretty (AnnotatedText (Element Reference)) -&gt; Pretty String)
-&gt; (Reference -&gt; Pretty (AnnotatedText (Element Reference)))
-&gt; Reference
-&gt; Pretty String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
-&gt; Imports
-&gt; Int
-&gt; Type v ()
-&gt; Pretty (AnnotatedText (Element Reference))
forall v a.
Var v =&gt;
PrettyPrintEnv
-&gt; Imports
-&gt; Int
-&gt; Type v a
-&gt; Pretty (AnnotatedText (Element Reference))
</span><a href="Unison.TypePrinter.html#pretty0"><span class="hs-identifier hs-var">TypePrinter.pretty0</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682022962"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621682022060"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">Imports
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-793"></span><span>    </span><span class="annot"><span class="annottext">(Type v () -&gt; Pretty (AnnotatedText (Element Reference)))
-&gt; (Reference -&gt; Type v ())
-&gt; Reference
-&gt; Pretty (AnnotatedText (Element Reference))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; Reference -&gt; Type v ()
forall v a. Ord v =&gt; a -&gt; Reference -&gt; Type v a
</span><span class="hs-identifier hs-var">Type.ref</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-794"></span><span>
</span><span id="line-795"></span><span id="local-6989586621682022987"><span id="local-6989586621682022988"><span class="annot"><a href="Unison.Server.Backend.html#resolveBranchHash"><span class="hs-identifier hs-type">resolveBranchHash</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-796"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621682022988"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Unison.Codebase.Branch.html#Hash"><span class="hs-identifier hs-type">Branch.Hash</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Type.html#Codebase"><span class="hs-identifier hs-type">Codebase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022988"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022987"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="Unison.Parser.Ann.html#Ann"><span class="hs-identifier hs-type">Ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022988"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Branch.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022988"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-797"></span><span id="resolveBranchHash"><span class="annot"><span class="annottext">resolveBranchHash :: Maybe Hash -&gt; Codebase m v Ann -&gt; Backend m (Branch m)
</span><a href="Unison.Server.Backend.html#resolveBranchHash"><span class="hs-identifier hs-var hs-var">resolveBranchHash</span></a></span></span><span> </span><span id="local-6989586621682022058"><span class="annot"><span class="annottext">Maybe Hash
</span><a href="#local-6989586621682022058"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621682022057"><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621682022057"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Hash
</span><a href="#local-6989586621682022058"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-798"></span><span>  </span><span class="annot"><span class="annottext">Maybe Hash
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann -&gt; Backend m (Branch m)
forall (m :: * -&gt; *) v.
Functor m =&gt;
Codebase m v Ann -&gt; Backend m (Branch m)
</span><a href="Unison.Server.Backend.html#getRootBranch"><span class="hs-identifier hs-var">getRootBranch</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621682022057"><span class="hs-identifier hs-var">codebase</span></a></span><span>
</span><span id="line-799"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682022056"><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621682022056"><span class="hs-identifier hs-var">bhash</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-800"></span><span>    </span><span id="local-6989586621682022055"><span class="annot"><span class="annottext">Maybe (Branch m)
</span><a href="#local-6989586621682022055"><span class="hs-identifier hs-var">mayBranch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (Maybe (Branch m)) -&gt; ExceptT BackendError m (Maybe (Branch m))
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Maybe (Branch m)) -&gt; ExceptT BackendError m (Maybe (Branch m)))
-&gt; m (Maybe (Branch m))
-&gt; ExceptT BackendError m (Maybe (Branch m))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann -&gt; Hash -&gt; m (Maybe (Branch m))
forall (m :: * -&gt; *) v a.
Monad m =&gt;
Codebase m v a -&gt; Hash -&gt; m (Maybe (Branch m))
</span><a href="Unison.Codebase.html#getBranchForHash"><span class="hs-identifier hs-var">Codebase.getBranchForHash</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621682022057"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621682022056"><span class="hs-identifier hs-var">bhash</span></a></span><span>
</span><span id="line-801"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Branch m)
</span><a href="#local-6989586621682022055"><span class="hs-identifier hs-var">mayBranch</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Branch m) -&gt; BackendError -&gt; Backend m (Branch m)
forall (m :: * -&gt; *) a e.
Applicative m =&gt;
Maybe a -&gt; e -&gt; ExceptT e m a
</span><span class="hs-operator hs-var">??</span></span><span> </span><span class="annot"><span class="annottext">Hash -&gt; BackendError
</span><a href="Unison.Server.Backend.html#NoBranchForHash"><span class="hs-identifier hs-var">NoBranchForHash</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621682022056"><span class="hs-identifier hs-var">bhash</span></a></span><span>
</span><span id="line-802"></span><span>
</span><span id="line-803"></span><span>
</span><span id="line-804"></span><span id="local-6989586621682022052"><span id="local-6989586621682022053"><span class="annot"><a href="Unison.Server.Backend.html#resolveRootBranchHash"><span class="hs-identifier hs-type">resolveRootBranchHash</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-805"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621682022053"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Unison.Codebase.ShortBranchHash.html#ShortBranchHash"><span class="hs-identifier hs-type">ShortBranchHash</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Type.html#Codebase"><span class="hs-identifier hs-type">Codebase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022053"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022052"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="Unison.Parser.Ann.html#Ann"><span class="hs-identifier hs-type">Ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022053"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Branch.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022053"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-806"></span><span id="resolveRootBranchHash"><span class="annot"><span class="annottext">resolveRootBranchHash :: Maybe ShortBranchHash -&gt; Codebase m v Ann -&gt; Backend m (Branch m)
</span><a href="Unison.Server.Backend.html#resolveRootBranchHash"><span class="hs-identifier hs-var hs-var">resolveRootBranchHash</span></a></span></span><span> </span><span id="local-6989586621682022050"><span class="annot"><span class="annottext">Maybe ShortBranchHash
</span><a href="#local-6989586621682022050"><span class="hs-identifier hs-var">mayRoot</span></a></span></span><span> </span><span id="local-6989586621682022049"><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621682022049"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ShortBranchHash
</span><a href="#local-6989586621682022050"><span class="hs-identifier hs-var">mayRoot</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-807"></span><span>  </span><span class="annot"><span class="annottext">Maybe ShortBranchHash
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-808"></span><span>    </span><span class="annot"><span class="annottext">Codebase m v Ann -&gt; Backend m (Branch m)
forall (m :: * -&gt; *) v.
Functor m =&gt;
Codebase m v Ann -&gt; Backend m (Branch m)
</span><a href="Unison.Server.Backend.html#getRootBranch"><span class="hs-identifier hs-var">getRootBranch</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621682022049"><span class="hs-identifier hs-var">codebase</span></a></span><span>
</span><span id="line-809"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682022048"><span class="annot"><span class="annottext">ShortBranchHash
</span><a href="#local-6989586621682022048"><span class="hs-identifier hs-var">sbh</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-810"></span><span>    </span><span id="local-6989586621682022047"><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621682022047"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann -&gt; ShortBranchHash -&gt; Backend m Hash
forall (m :: * -&gt; *) v a.
Monad m =&gt;
Codebase m v a -&gt; ShortBranchHash -&gt; Backend m Hash
</span><a href="Unison.Server.Backend.html#expandShortBranchHash"><span class="hs-identifier hs-var">expandShortBranchHash</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621682022049"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">ShortBranchHash
</span><a href="#local-6989586621682022048"><span class="hs-identifier hs-var">sbh</span></a></span><span>
</span><span id="line-811"></span><span>    </span><span class="annot"><span class="annottext">Maybe Hash -&gt; Codebase m v Ann -&gt; Backend m (Branch m)
forall (m :: * -&gt; *) v.
Monad m =&gt;
Maybe Hash -&gt; Codebase m v Ann -&gt; Backend m (Branch m)
</span><a href="Unison.Server.Backend.html#resolveBranchHash"><span class="hs-identifier hs-var">resolveBranchHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hash -&gt; Maybe Hash
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621682022047"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621682022049"><span class="hs-identifier hs-var">codebase</span></a></span><span>
</span><span id="line-812"></span><span>
</span><span id="line-813"></span><span>
</span><span id="line-814"></span><span class="annot"><a href="Unison.Server.Backend.html#definitionsBySuffixes"><span class="hs-identifier hs-type">definitionsBySuffixes</span></a></span><span>
</span><span id="line-815"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682022986"><span class="annot"><a href="#local-6989586621682022986"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621682022985"><span class="annot"><a href="#local-6989586621682022985"><span class="hs-identifier hs-type">v</span></a></span></span><span>
</span><span id="line-816"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621682022986"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-817"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621682022985"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-818"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Unison.Codebase.Path.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span>
</span><span id="line-819"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Branch.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022986"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-820"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Type.html#Codebase"><span class="hs-identifier hs-type">Codebase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022986"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022985"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="Unison.Parser.Ann.html#Ann"><span class="hs-identifier hs-type">Ann</span></a></span><span>
</span><span id="line-821"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">]</span><span>
</span><span id="line-822"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022986"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Backend.html#DefinitionResults"><span class="hs-identifier hs-type">DefinitionResults</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022985"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-823"></span><span id="definitionsBySuffixes"><span class="annot"><span class="annottext">definitionsBySuffixes :: Maybe Path
-&gt; Branch m
-&gt; Codebase m v Ann
-&gt; [HashQualified Name]
-&gt; Backend m (DefinitionResults v)
</span><a href="Unison.Server.Backend.html#definitionsBySuffixes"><span class="hs-identifier hs-var hs-var">definitionsBySuffixes</span></a></span></span><span> </span><span id="local-6989586621682022046"><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621682022046"><span class="hs-identifier hs-var">relativeTo</span></a></span></span><span> </span><span id="local-6989586621682022045"><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621682022045"><span class="hs-identifier hs-var">branch</span></a></span></span><span> </span><span id="local-6989586621682022044"><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621682022044"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621682022043"><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621682022043"><span class="hs-identifier hs-var">query</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-824"></span><span>  </span><span class="hs-comment">-- First find the hashes by name and note any query misses.</span><span>
</span><span id="line-825"></span><span>  </span><span class="annot"><a href="Unison.Server.QueryResult.html#QueryResult"><span class="hs-identifier hs-type">QueryResult</span></a></span><span> </span><span id="local-6989586621682022042"><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621682022042"><span class="hs-identifier hs-var">misses</span></a></span></span><span> </span><span id="local-6989586621682022041"><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621682022041"><span class="hs-identifier hs-var">results</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m QueryResult -&gt; ExceptT BackendError m QueryResult
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span>
</span><span id="line-826"></span><span>    </span><span class="annot"><span class="annottext">(m QueryResult -&gt; ExceptT BackendError m QueryResult)
-&gt; m QueryResult -&gt; ExceptT BackendError m QueryResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Path
-&gt; Branch m
-&gt; Codebase m v Ann
-&gt; [HashQualified Name]
-&gt; m QueryResult
forall (m :: * -&gt; *) v.
Monad m =&gt;
Maybe Path
-&gt; Branch m
-&gt; Codebase m v Ann
-&gt; [HashQualified Name]
-&gt; m QueryResult
</span><a href="Unison.Server.Backend.html#hqNameQuery"><span class="hs-identifier hs-var">hqNameQuery</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621682022046"><span class="hs-identifier hs-var">relativeTo</span></a></span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621682022045"><span class="hs-identifier hs-var">branch</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621682022044"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621682022043"><span class="hs-identifier hs-var">query</span></a></span><span>
</span><span id="line-827"></span><span>  </span><span class="hs-comment">-- Now load the terms/types for those hashes.</span><span>
</span><span id="line-828"></span><span>  </span><span id="local-6989586621682022040"><span class="annot"><span class="annottext">[SearchResult' v Ann]
</span><a href="#local-6989586621682022040"><span class="hs-identifier hs-var">results'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m [SearchResult' v Ann]
-&gt; ExceptT BackendError m [SearchResult' v Ann]
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m [SearchResult' v Ann]
 -&gt; ExceptT BackendError m [SearchResult' v Ann])
-&gt; m [SearchResult' v Ann]
-&gt; ExceptT BackendError m [SearchResult' v Ann]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann -&gt; [SearchResult] -&gt; m [SearchResult' v Ann]
forall v (m :: * -&gt; *).
(Var v, Applicative m) =&gt;
Codebase m v Ann -&gt; [SearchResult] -&gt; m [SearchResult' v Ann]
</span><a href="Unison.Server.Backend.html#loadSearchResults"><span class="hs-identifier hs-var">loadSearchResults</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621682022044"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621682022041"><span class="hs-identifier hs-var">results</span></a></span><span>
</span><span id="line-829"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621682022038"><span class="hs-identifier hs-type">termTypes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621682022985"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="Unison.Parser.Ann.html#Ann"><span class="hs-identifier hs-type">Ann</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-830"></span><span>      </span><span id="local-6989586621682022038"><span class="annot"><span class="annottext">termTypes :: Map Reference (Type v Ann)
</span><a href="#local-6989586621682022038"><span class="hs-identifier hs-var hs-var">termTypes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Reference, Type v Ann)] -&gt; Map Reference (Type v Ann)
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span>
</span><span id="line-831"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022036"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type v Ann
</span><a href="#local-6989586621682022035"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Unison.Server.SearchResult'.html#Tm"><span class="hs-identifier hs-type">SR'.Tm</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682022035"><span class="annot"><span class="annottext">Type v Ann
</span><a href="#local-6989586621682022035"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Referent.Ref</span></span><span> </span><span id="local-6989586621682022036"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022036"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[SearchResult' v Ann]
</span><a href="#local-6989586621682022040"><span class="hs-identifier hs-var">results'</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-832"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682022033"><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621682022033"><span class="hs-identifier hs-var">collatedTypes</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682022032"><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621682022032"><span class="hs-identifier hs-var">collatedTerms</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Reference] -&gt; [Referent] -&gt; (Set Reference, Set Reference)
forall (f :: * -&gt; *) (g :: * -&gt; *).
(Foldable f, Foldable g) =&gt;
f Reference -&gt; g Referent -&gt; (Set Reference, Set Reference)
</span><a href="Unison.Server.Backend.html#collateReferences"><span class="hs-identifier hs-var">collateReferences</span></a></span><span>
</span><span id="line-833"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SearchResult' v Ann -&gt; Maybe Reference)
-&gt; [SearchResult' v Ann] -&gt; [Reference]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">SearchResult' v Ann -&gt; Maybe Reference
forall v a. SearchResult' v a -&gt; Maybe Reference
</span><a href="Unison.Server.SearchResult'.html#tpReference"><span class="hs-identifier hs-var">SR'.tpReference</span></a></span><span> </span><span class="annot"><span class="annottext">[SearchResult' v Ann]
</span><a href="#local-6989586621682022040"><span class="hs-identifier hs-var">results'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-834"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SearchResult' v Ann -&gt; Maybe Referent)
-&gt; [SearchResult' v Ann] -&gt; [Referent]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">SearchResult' v Ann -&gt; Maybe Referent
forall v a. SearchResult' v a -&gt; Maybe Referent
</span><a href="Unison.Server.SearchResult'.html#tmReferent"><span class="hs-identifier hs-var">SR'.tmReferent</span></a></span><span> </span><span class="annot"><span class="annottext">[SearchResult' v Ann]
</span><a href="#local-6989586621682022040"><span class="hs-identifier hs-var">results'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-835"></span><span>  </span><span class="hs-comment">-- load the `collatedTerms` and types into a Map Reference.Id Term/Type</span><span>
</span><span id="line-836"></span><span>  </span><span class="hs-comment">-- for later</span><span>
</span><span id="line-837"></span><span>  </span><span id="local-6989586621682022028"><span class="annot"><span class="annottext">Map Id (Term v Ann)
</span><a href="#local-6989586621682022028"><span class="hs-identifier hs-var">loadedDerivedTerms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-838"></span><span>    </span><span class="annot"><span class="annottext">m (Map Id (Term v Ann))
-&gt; ExceptT BackendError m (Map Id (Term v Ann))
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Map Id (Term v Ann))
 -&gt; ExceptT BackendError m (Map Id (Term v Ann)))
-&gt; m (Map Id (Term v Ann))
-&gt; ExceptT BackendError m (Map Id (Term v Ann))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">([Maybe (Id, Term v Ann)] -&gt; Map Id (Term v Ann))
-&gt; m [Maybe (Id, Term v Ann)] -&gt; m (Map Id (Term v Ann))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Id, Term v Ann)] -&gt; Map Id (Term v Ann)
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(Id, Term v Ann)] -&gt; Map Id (Term v Ann))
-&gt; ([Maybe (Id, Term v Ann)] -&gt; [(Id, Term v Ann)])
-&gt; [Maybe (Id, Term v Ann)]
-&gt; Map Id (Term v Ann)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Maybe (Id, Term v Ann)] -&gt; [(Id, Term v Ann)]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m [Maybe (Id, Term v Ann)] -&gt; m (Map Id (Term v Ann)))
-&gt; ((Reference -&gt; m (Maybe (Id, Term v Ann)))
    -&gt; m [Maybe (Id, Term v Ann)])
-&gt; (Reference -&gt; m (Maybe (Id, Term v Ann)))
-&gt; m (Map Id (Term v Ann))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Reference]
-&gt; (Reference -&gt; m (Maybe (Id, Term v Ann)))
-&gt; m [Maybe (Id, Term v Ann)]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Reference -&gt; [Reference]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621682022032"><span class="hs-identifier hs-var">collatedTerms</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Reference -&gt; m (Maybe (Id, Term v Ann)))
 -&gt; m (Map Id (Term v Ann)))
-&gt; (Reference -&gt; m (Maybe (Id, Term v Ann)))
-&gt; m (Map Id (Term v Ann))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-839"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Reference.DerivedId</span></span><span> </span><span id="local-6989586621682022026"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682022026"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Term v Ann -&gt; (Id, Term v Ann))
-&gt; Maybe (Term v Ann) -&gt; Maybe (Id, Term v Ann)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682022026"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (Term v Ann) -&gt; Maybe (Id, Term v Ann))
-&gt; m (Maybe (Term v Ann)) -&gt; m (Maybe (Id, Term v Ann))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann -&gt; Id -&gt; m (Maybe (Term v Ann))
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; Id -&gt; m (Maybe (Term v a))
</span><a href="Unison.Codebase.Type.html#getTerm"><span class="hs-identifier hs-var hs-var">Codebase.getTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621682022044"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682022026"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-840"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Reference.Builtin</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Id, Term v Ann) -&gt; m (Maybe (Id, Term v Ann))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Id, Term v Ann)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-841"></span><span>  </span><span id="local-6989586621682022025"><span class="annot"><span class="annottext">Map Id (Decl v Ann)
</span><a href="#local-6989586621682022025"><span class="hs-identifier hs-var">loadedDerivedTypes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-842"></span><span>    </span><span class="annot"><span class="annottext">m (Map Id (Decl v Ann))
-&gt; ExceptT BackendError m (Map Id (Decl v Ann))
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Map Id (Decl v Ann))
 -&gt; ExceptT BackendError m (Map Id (Decl v Ann)))
-&gt; m (Map Id (Decl v Ann))
-&gt; ExceptT BackendError m (Map Id (Decl v Ann))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">([Maybe (Id, Decl v Ann)] -&gt; Map Id (Decl v Ann))
-&gt; m [Maybe (Id, Decl v Ann)] -&gt; m (Map Id (Decl v Ann))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Id, Decl v Ann)] -&gt; Map Id (Decl v Ann)
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(Id, Decl v Ann)] -&gt; Map Id (Decl v Ann))
-&gt; ([Maybe (Id, Decl v Ann)] -&gt; [(Id, Decl v Ann)])
-&gt; [Maybe (Id, Decl v Ann)]
-&gt; Map Id (Decl v Ann)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Maybe (Id, Decl v Ann)] -&gt; [(Id, Decl v Ann)]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m [Maybe (Id, Decl v Ann)] -&gt; m (Map Id (Decl v Ann)))
-&gt; ((Reference -&gt; m (Maybe (Id, Decl v Ann)))
    -&gt; m [Maybe (Id, Decl v Ann)])
-&gt; (Reference -&gt; m (Maybe (Id, Decl v Ann)))
-&gt; m (Map Id (Decl v Ann))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Reference]
-&gt; (Reference -&gt; m (Maybe (Id, Decl v Ann)))
-&gt; m [Maybe (Id, Decl v Ann)]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Reference -&gt; [Reference]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621682022033"><span class="hs-identifier hs-var">collatedTypes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Reference -&gt; m (Maybe (Id, Decl v Ann)))
 -&gt; m (Map Id (Decl v Ann)))
-&gt; (Reference -&gt; m (Maybe (Id, Decl v Ann)))
-&gt; m (Map Id (Decl v Ann))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-843"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Reference.DerivedId</span></span><span> </span><span id="local-6989586621682022024"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682022024"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-844"></span><span>        </span><span class="annot"><span class="annottext">(Decl v Ann -&gt; (Id, Decl v Ann))
-&gt; Maybe (Decl v Ann) -&gt; Maybe (Id, Decl v Ann)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682022024"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (Decl v Ann) -&gt; Maybe (Id, Decl v Ann))
-&gt; m (Maybe (Decl v Ann)) -&gt; m (Maybe (Id, Decl v Ann))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann -&gt; Id -&gt; m (Maybe (Decl v Ann))
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; Id -&gt; m (Maybe (Decl v a))
</span><a href="Unison.Codebase.Type.html#getTypeDeclaration"><span class="hs-identifier hs-var hs-var">Codebase.getTypeDeclaration</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621682022044"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682022024"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-845"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Reference.Builtin</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Id, Decl v Ann) -&gt; m (Maybe (Id, Decl v Ann))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Id, Decl v Ann)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-846"></span><span>  </span><span class="hs-comment">-- Populate DisplayObjects for the search results, in anticipation of</span><span>
</span><span id="line-847"></span><span>  </span><span class="hs-comment">-- rendering the definitions.</span><span>
</span><span id="line-848"></span><span>  </span><span id="local-6989586621682022023"><span class="annot"><span class="annottext">Map Reference (DisplayObject (Type v Ann) (Term v Ann))
</span><a href="#local-6989586621682022023"><span class="hs-identifier hs-var">loadedDisplayTerms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">([(Reference, DisplayObject (Type v Ann) (Term v Ann))]
 -&gt; Map Reference (DisplayObject (Type v Ann) (Term v Ann)))
-&gt; ExceptT
     BackendError
     m
     [(Reference, DisplayObject (Type v Ann) (Term v Ann))]
-&gt; ExceptT
     BackendError
     m
     (Map Reference (DisplayObject (Type v Ann) (Term v Ann)))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">[(Reference, DisplayObject (Type v Ann) (Term v Ann))]
-&gt; Map Reference (DisplayObject (Type v Ann) (Term v Ann))
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="annot"><span class="annottext">(ExceptT
   BackendError
   m
   [(Reference, DisplayObject (Type v Ann) (Term v Ann))]
 -&gt; ExceptT
      BackendError
      m
      (Map Reference (DisplayObject (Type v Ann) (Term v Ann))))
-&gt; ((Reference
     -&gt; ExceptT
          BackendError
          m
          (Reference, DisplayObject (Type v Ann) (Term v Ann)))
    -&gt; ExceptT
         BackendError
         m
         [(Reference, DisplayObject (Type v Ann) (Term v Ann))])
-&gt; (Reference
    -&gt; ExceptT
         BackendError
         m
         (Reference, DisplayObject (Type v Ann) (Term v Ann)))
-&gt; ExceptT
     BackendError
     m
     (Map Reference (DisplayObject (Type v Ann) (Term v Ann)))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Reference]
-&gt; (Reference
    -&gt; ExceptT
         BackendError
         m
         (Reference, DisplayObject (Type v Ann) (Term v Ann)))
-&gt; ExceptT
     BackendError
     m
     [(Reference, DisplayObject (Type v Ann) (Term v Ann))]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Reference -&gt; [Reference]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621682022032"><span class="hs-identifier hs-var">collatedTerms</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Reference
  -&gt; ExceptT
       BackendError
       m
       (Reference, DisplayObject (Type v Ann) (Term v Ann)))
 -&gt; ExceptT
      BackendError
      m
      (Map Reference (DisplayObject (Type v Ann) (Term v Ann))))
-&gt; (Reference
    -&gt; ExceptT
         BackendError
         m
         (Reference, DisplayObject (Type v Ann) (Term v Ann)))
-&gt; ExceptT
     BackendError
     m
     (Map Reference (DisplayObject (Type v Ann) (Term v Ann)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-849"></span><span>    </span><span id="local-6989586621682022022"><span class="annot"><span class="annottext">r :: Reference
</span><a href="#local-6989586621682022022"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reference.DerivedId</span></span><span> </span><span id="local-6989586621682022021"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682022021"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-850"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682022020"><span class="annot"><span class="annottext">tm :: Maybe (Term v Ann)
</span><a href="#local-6989586621682022020"><span class="hs-identifier hs-var hs-var">tm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Map Id (Term v Ann) -&gt; Maybe (Term v Ann)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682022021"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id (Term v Ann)
</span><a href="#local-6989586621682022028"><span class="hs-identifier hs-var">loadedDerivedTerms</span></a></span><span>
</span><span id="line-851"></span><span>      </span><span class="hs-comment">-- We add a type annotation to the term using if it doesn't</span><span>
</span><span id="line-852"></span><span>      </span><span class="hs-comment">-- already have one that the user provided</span><span>
</span><span id="line-853"></span><span>      </span><span class="annot"><span class="annottext">(Reference, DisplayObject (Type v Ann) (Term v Ann))
-&gt; ExceptT
     BackendError m (Reference, DisplayObject (Type v Ann) (Term v Ann))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">((Reference, DisplayObject (Type v Ann) (Term v Ann))
 -&gt; ExceptT
      BackendError
      m
      (Reference, DisplayObject (Type v Ann) (Term v Ann)))
-&gt; (DisplayObject (Type v Ann) (Term v Ann)
    -&gt; (Reference, DisplayObject (Type v Ann) (Term v Ann)))
-&gt; DisplayObject (Type v Ann) (Term v Ann)
-&gt; ExceptT
     BackendError m (Reference, DisplayObject (Type v Ann) (Term v Ann))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022022"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(DisplayObject (Type v Ann) (Term v Ann)
 -&gt; ExceptT
      BackendError
      m
      (Reference, DisplayObject (Type v Ann) (Term v Ann)))
-&gt; DisplayObject (Type v Ann) (Term v Ann)
-&gt; ExceptT
     BackendError m (Reference, DisplayObject (Type v Ann) (Term v Ann))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(Term v Ann -&gt; Type v Ann -&gt; (Term v Ann, Type v Ann))
-&gt; Maybe (Term v Ann)
-&gt; Maybe (Type v Ann)
-&gt; Maybe (Term v Ann, Type v Ann)
forall (f :: * -&gt; *) a b c.
Applicative f =&gt;
(a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c
</span><span class="hs-identifier hs-var">liftA2</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (Term v Ann)
</span><a href="#local-6989586621682022020"><span class="hs-identifier hs-var">tm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference -&gt; Map Reference (Type v Ann) -&gt; Maybe (Type v Ann)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022022"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Map Reference (Type v Ann)
</span><a href="#local-6989586621682022038"><span class="hs-identifier hs-var">termTypes</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-854"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Term v Ann, Type v Ann)
</span><span class="hs-identifier hs-var">Nothing</span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ShortHash -&gt; DisplayObject (Type v Ann) (Term v Ann)
forall b a. ShortHash -&gt; DisplayObject b a
</span><a href="Unison.Codebase.Editor.DisplayObject.html#MissingObject"><span class="hs-identifier hs-var">MissingObject</span></a></span><span> </span><span class="annot"><span class="annottext">(ShortHash -&gt; DisplayObject (Type v Ann) (Term v Ann))
-&gt; ShortHash -&gt; DisplayObject (Type v Ann) (Term v Ann)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; ShortHash
</span><span class="hs-identifier hs-var">Reference.idToShortHash</span></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682022021"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-855"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682022017"><span class="annot"><span class="annottext">Term v Ann
</span><a href="#local-6989586621682022017"><span class="hs-identifier hs-var">tm</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682022016"><span class="annot"><span class="annottext">Type v Ann
</span><a href="#local-6989586621682022016"><span class="hs-identifier hs-var">typ</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Term v Ann
</span><a href="#local-6989586621682022017"><span class="hs-identifier hs-var">tm</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-856"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Term.Ann'</span></span><span> </span><span class="annot"><span class="annottext">Term v Ann
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type v Ann
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term v Ann -&gt; DisplayObject (Type v Ann) (Term v Ann)
forall b a. a -&gt; DisplayObject b a
</span><a href="Unison.Codebase.Editor.DisplayObject.html#UserObject"><span class="hs-identifier hs-var">UserObject</span></a></span><span> </span><span class="annot"><span class="annottext">Term v Ann
</span><a href="#local-6989586621682022017"><span class="hs-identifier hs-var">tm</span></a></span><span>
</span><span id="line-857"></span><span>          </span><span class="annot"><span class="annottext">Term v Ann
</span><span class="hs-identifier">_</span></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term v Ann -&gt; DisplayObject (Type v Ann) (Term v Ann)
forall b a. a -&gt; DisplayObject b a
</span><a href="Unison.Codebase.Editor.DisplayObject.html#UserObject"><span class="hs-identifier hs-var">UserObject</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ann -&gt; Term v Ann -&gt; Type v Ann -&gt; Term v Ann
forall v a vt at ap.
Ord v =&gt;
a -&gt; Term2 vt at ap v a -&gt; Type vt at -&gt; Term2 vt at ap v a
</span><span class="hs-identifier hs-var">Term.ann</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term v Ann -&gt; Ann
forall (f :: * -&gt; *) v a. Term f v a -&gt; a
</span><span class="hs-identifier hs-var hs-var">ABT.annotation</span></span><span> </span><span class="annot"><span class="annottext">Term v Ann
</span><a href="#local-6989586621682022017"><span class="hs-identifier hs-var">tm</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term v Ann
</span><a href="#local-6989586621682022017"><span class="hs-identifier hs-var">tm</span></a></span><span> </span><span class="annot"><span class="annottext">Type v Ann
</span><a href="#local-6989586621682022016"><span class="hs-identifier hs-var">typ</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-858"></span><span>    </span><span id="local-6989586621682022012"><span class="annot"><span class="annottext">r :: Reference
</span><a href="#local-6989586621682022012"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reference.Builtin</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Reference, DisplayObject (Type v Ann) (Term v Ann))
-&gt; ExceptT
     BackendError m (Reference, DisplayObject (Type v Ann) (Term v Ann))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">((Reference, DisplayObject (Type v Ann) (Term v Ann))
 -&gt; ExceptT
      BackendError
      m
      (Reference, DisplayObject (Type v Ann) (Term v Ann)))
-&gt; (Reference, DisplayObject (Type v Ann) (Term v Ann))
-&gt; ExceptT
     BackendError m (Reference, DisplayObject (Type v Ann) (Term v Ann))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022012"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(DisplayObject (Type v Ann) (Term v Ann)
 -&gt; (Reference, DisplayObject (Type v Ann) (Term v Ann)))
-&gt; DisplayObject (Type v Ann) (Term v Ann)
-&gt; (Reference, DisplayObject (Type v Ann) (Term v Ann))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Map Reference (Type v) -&gt; Maybe (Type v)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022012"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Map Reference (Type v)
forall v. Var v =&gt; Map Reference (Type v)
</span><a href="Unison.Builtin.html#termRefTypes"><span class="hs-identifier hs-var">B.termRefTypes</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-859"></span><span>      </span><span class="annot"><span class="annottext">Maybe (Type v)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ShortHash -&gt; DisplayObject (Type v Ann) (Term v Ann)
forall b a. ShortHash -&gt; DisplayObject b a
</span><a href="Unison.Codebase.Editor.DisplayObject.html#MissingObject"><span class="hs-identifier hs-var">MissingObject</span></a></span><span> </span><span class="annot"><span class="annottext">(ShortHash -&gt; DisplayObject (Type v Ann) (Term v Ann))
-&gt; ShortHash -&gt; DisplayObject (Type v Ann) (Term v Ann)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; ShortHash
</span><span class="hs-identifier hs-var">Reference.toShortHash</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022012"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-860"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682022010"><span class="annot"><span class="annottext">Type v
</span><a href="#local-6989586621682022010"><span class="hs-identifier hs-var">typ</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type v Ann -&gt; DisplayObject (Type v Ann) (Term v Ann)
forall b a. b -&gt; DisplayObject b a
</span><a href="Unison.Codebase.Editor.DisplayObject.html#BuiltinObject"><span class="hs-identifier hs-var">BuiltinObject</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ann
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Ann -&gt; Type v -&gt; Type v Ann
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">Type v
</span><a href="#local-6989586621682022010"><span class="hs-identifier hs-var">typ</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-861"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682022008"><span class="annot"><span class="annottext">loadedDisplayTypes :: Map Reference (DisplayObject () (Decl v Ann))
</span><a href="#local-6989586621682022008"><span class="hs-identifier hs-var hs-var">loadedDisplayTypes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Reference, DisplayObject () (Decl v Ann))]
-&gt; Map Reference (DisplayObject () (Decl v Ann))
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(Reference, DisplayObject () (Decl v Ann))]
 -&gt; Map Reference (DisplayObject () (Decl v Ann)))
-&gt; ((Reference -&gt; (Reference, DisplayObject () (Decl v Ann)))
    -&gt; [(Reference, DisplayObject () (Decl v Ann))])
-&gt; (Reference -&gt; (Reference, DisplayObject () (Decl v Ann)))
-&gt; Map Reference (DisplayObject () (Decl v Ann))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Reference -&gt; (Reference, DisplayObject () (Decl v Ann)))
-&gt; [Reference] -&gt; [(Reference, DisplayObject () (Decl v Ann))]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">`fmap`</span></span><span> </span><span class="annot"><span class="annottext">Set Reference -&gt; [Reference]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621682022033"><span class="hs-identifier hs-var">collatedTypes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Reference -&gt; (Reference, DisplayObject () (Decl v Ann)))
 -&gt; Map Reference (DisplayObject () (Decl v Ann)))
-&gt; (Reference -&gt; (Reference, DisplayObject () (Decl v Ann)))
-&gt; Map Reference (DisplayObject () (Decl v Ann))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-862"></span><span>        </span><span id="local-6989586621682022007"><span class="annot"><span class="annottext">r :: Reference
</span><a href="#local-6989586621682022007"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reference.DerivedId</span></span><span> </span><span id="local-6989586621682022006"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682022006"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-863"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022007"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-864"></span><span>            </span><span class="annot"><span class="annottext">(DisplayObject () (Decl v Ann)
 -&gt; (Reference, DisplayObject () (Decl v Ann)))
-&gt; (Maybe (Decl v Ann) -&gt; DisplayObject () (Decl v Ann))
-&gt; Maybe (Decl v Ann)
-&gt; (Reference, DisplayObject () (Decl v Ann))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">DisplayObject () (Decl v Ann)
-&gt; (Decl v Ann -&gt; DisplayObject () (Decl v Ann))
-&gt; Maybe (Decl v Ann)
-&gt; DisplayObject () (Decl v Ann)
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortHash -&gt; DisplayObject () (Decl v Ann)
forall b a. ShortHash -&gt; DisplayObject b a
</span><a href="Unison.Codebase.Editor.DisplayObject.html#MissingObject"><span class="hs-identifier hs-var">MissingObject</span></a></span><span> </span><span class="annot"><span class="annottext">(ShortHash -&gt; DisplayObject () (Decl v Ann))
-&gt; ShortHash -&gt; DisplayObject () (Decl v Ann)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; ShortHash
</span><span class="hs-identifier hs-var">Reference.idToShortHash</span></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682022006"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Decl v Ann -&gt; DisplayObject () (Decl v Ann)
forall b a. a -&gt; DisplayObject b a
</span><a href="Unison.Codebase.Editor.DisplayObject.html#UserObject"><span class="hs-identifier hs-var">UserObject</span></a></span><span>
</span><span id="line-865"></span><span>            </span><span class="annot"><span class="annottext">(Maybe (Decl v Ann) -&gt; (Reference, DisplayObject () (Decl v Ann)))
-&gt; Maybe (Decl v Ann) -&gt; (Reference, DisplayObject () (Decl v Ann))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Map Id (Decl v Ann) -&gt; Maybe (Decl v Ann)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682022006"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id (Decl v Ann)
</span><a href="#local-6989586621682022025"><span class="hs-identifier hs-var">loadedDerivedTypes</span></a></span><span>
</span><span id="line-866"></span><span>        </span><span id="local-6989586621682022005"><span class="annot"><span class="annottext">r :: Reference
</span><a href="#local-6989586621682022005"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reference.Builtin</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682022005"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">() -&gt; DisplayObject () (Decl v Ann)
forall b a. b -&gt; DisplayObject b a
</span><a href="Unison.Codebase.Editor.DisplayObject.html#BuiltinObject"><span class="hs-identifier hs-var">BuiltinObject</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-867"></span><span>  </span><span class="annot"><span class="annottext">DefinitionResults v -&gt; Backend m (DefinitionResults v)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(DefinitionResults v -&gt; Backend m (DefinitionResults v))
-&gt; DefinitionResults v -&gt; Backend m (DefinitionResults v)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map Reference (DisplayObject (Type v Ann) (Term v Ann))
-&gt; Map Reference (DisplayObject () (Decl v Ann))
-&gt; [HashQualified Name]
-&gt; DefinitionResults v
forall v.
Map Reference (DisplayObject (Type v Ann) (Term v Ann))
-&gt; Map Reference (DisplayObject () (Decl v Ann))
-&gt; [HashQualified Name]
-&gt; DefinitionResults v
</span><a href="Unison.Server.Backend.html#DefinitionResults"><span class="hs-identifier hs-var">DefinitionResults</span></a></span><span> </span><span class="annot"><span class="annottext">Map Reference (DisplayObject (Type v Ann) (Term v Ann))
</span><a href="#local-6989586621682022023"><span class="hs-identifier hs-var">loadedDisplayTerms</span></a></span><span> </span><span class="annot"><span class="annottext">Map Reference (DisplayObject () (Decl v Ann))
</span><a href="#local-6989586621682022008"><span class="hs-identifier hs-var">loadedDisplayTypes</span></a></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621682022042"><span class="hs-identifier hs-var">misses</span></a></span><span>
</span><span id="line-868"></span><span>
</span><span id="line-869"></span><span id="local-6989586621682022954"><span id="local-6989586621682022955"><span class="annot"><a href="Unison.Server.Backend.html#termsToSyntax"><span class="hs-identifier hs-type">termsToSyntax</span></a></span><span>
</span><span id="line-870"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621682022955"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-871"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621682022954"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-872"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Types.html#Suffixify"><span class="hs-identifier hs-type">Suffixify</span></a></span><span>
</span><span id="line-873"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Util.Pretty.html#Width"><span class="hs-identifier hs-type">Width</span></a></span><span>
</span><span id="line-874"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.PrettyPrintEnvDecl.html#PrettyPrintEnvDecl"><span class="hs-identifier hs-type">PPE.PrettyPrintEnvDecl</span></a></span><span>
</span><span id="line-875"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference.Reference</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Editor.DisplayObject.html#DisplayObject"><span class="hs-identifier hs-type">DisplayObject</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621682022955"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022954"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><a href="#local-6989586621682022955"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022954"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-876"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference.Reference</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Editor.DisplayObject.html#DisplayObject"><span class="hs-identifier hs-type">DisplayObject</span></a></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#SyntaxText"><span class="hs-identifier hs-type">SyntaxText</span></a></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#SyntaxText"><span class="hs-identifier hs-type">SyntaxText</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-877"></span><span id="termsToSyntax"><span class="annot"><span class="annottext">termsToSyntax :: Suffixify
-&gt; Width
-&gt; PrettyPrintEnvDecl
-&gt; Map Reference (DisplayObject (Type v a) (Term v a))
-&gt; Map
     Reference
     (DisplayObject
        (AnnotatedText (Element Reference))
        (AnnotatedText (Element Reference)))
</span><a href="Unison.Server.Backend.html#termsToSyntax"><span class="hs-identifier hs-var hs-var">termsToSyntax</span></a></span></span><span> </span><span id="local-6989586621682022004"><span class="annot"><span class="annottext">Suffixify
</span><a href="#local-6989586621682022004"><span class="hs-identifier hs-var">suff</span></a></span></span><span> </span><span id="local-6989586621682022003"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682022003"><span class="hs-identifier hs-var">width</span></a></span></span><span> </span><span id="local-6989586621682022002"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621682022002"><span class="hs-identifier hs-var">ppe0</span></a></span></span><span> </span><span id="local-6989586621682022001"><span class="annot"><span class="annottext">Map Reference (DisplayObject (Type v a) (Term v a))
</span><a href="#local-6989586621682022001"><span class="hs-identifier hs-var">terms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-878"></span><span>  </span><span class="annot"><span class="annottext">[(Reference,
  DisplayObject
    (AnnotatedText (Element Reference))
    (AnnotatedText (Element Reference)))]
-&gt; Map
     Reference
     (DisplayObject
        (AnnotatedText (Element Reference))
        (AnnotatedText (Element Reference)))
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(Reference,
   DisplayObject
     (AnnotatedText (Element Reference))
     (AnnotatedText (Element Reference)))]
 -&gt; Map
      Reference
      (DisplayObject
         (AnnotatedText (Element Reference))
         (AnnotatedText (Element Reference))))
-&gt; (Map
      (HashQualified Name, Reference)
      (DisplayObject (Type v a) (Term v a))
    -&gt; [(Reference,
         DisplayObject
           (AnnotatedText (Element Reference))
           (AnnotatedText (Element Reference)))])
-&gt; Map
     (HashQualified Name, Reference)
     (DisplayObject (Type v a) (Term v a))
-&gt; Map
     Reference
     (DisplayObject
        (AnnotatedText (Element Reference))
        (AnnotatedText (Element Reference)))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(((HashQualified Name, Reference),
  DisplayObject (Type v a) (Term v a))
 -&gt; (Reference,
     DisplayObject
       (AnnotatedText (Element Reference))
       (AnnotatedText (Element Reference))))
-&gt; [((HashQualified Name, Reference),
     DisplayObject (Type v a) (Term v a))]
-&gt; [(Reference,
     DisplayObject
       (AnnotatedText (Element Reference))
       (AnnotatedText (Element Reference)))]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">((HashQualified Name, Reference),
 DisplayObject (Type v a) (Term v a))
-&gt; (Reference,
    DisplayObject
      (AnnotatedText (Element Reference))
      (AnnotatedText (Element Reference)))
forall v v a at ap a.
(Var v, Var v) =&gt;
((HashQualified Name, Reference),
 DisplayObject (Type v a) (Term2 v at ap v a))
-&gt; (Reference,
    DisplayObject
      (AnnotatedText (Element Reference))
      (AnnotatedText (Element Reference)))
</span><a href="#local-6989586621682022000"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">([((HashQualified Name, Reference),
   DisplayObject (Type v a) (Term v a))]
 -&gt; [(Reference,
      DisplayObject
        (AnnotatedText (Element Reference))
        (AnnotatedText (Element Reference)))])
-&gt; (Map
      (HashQualified Name, Reference)
      (DisplayObject (Type v a) (Term v a))
    -&gt; [((HashQualified Name, Reference),
         DisplayObject (Type v a) (Term v a))])
-&gt; Map
     (HashQualified Name, Reference)
     (DisplayObject (Type v a) (Term v a))
-&gt; [(Reference,
     DisplayObject
       (AnnotatedText (Element Reference))
       (AnnotatedText (Element Reference)))]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Map
  (HashQualified Name, Reference)
  (DisplayObject (Type v a) (Term v a))
-&gt; [((HashQualified Name, Reference),
     DisplayObject (Type v a) (Term v a))]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">(Map
   (HashQualified Name, Reference)
   (DisplayObject (Type v a) (Term v a))
 -&gt; Map
      Reference
      (DisplayObject
         (AnnotatedText (Element Reference))
         (AnnotatedText (Element Reference))))
-&gt; Map
     (HashQualified Name, Reference)
     (DisplayObject (Type v a) (Term v a))
-&gt; Map
     Reference
     (DisplayObject
        (AnnotatedText (Element Reference))
        (AnnotatedText (Element Reference)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; (HashQualified Name, Reference))
-&gt; Map Reference (DisplayObject (Type v a) (Term v a))
-&gt; Map
     (HashQualified Name, Reference)
     (DisplayObject (Type v a) (Term v a))
forall k2 k1 a. Ord k2 =&gt; (k1 -&gt; k2) -&gt; Map k1 a -&gt; Map k2 a
</span><span class="hs-identifier hs-var">Map.mapKeys</span></span><span>
</span><span id="line-879"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Reference -&gt; HashQualified Name)
-&gt; (Reference, Reference) -&gt; (HashQualified Name, Reference)
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; Referent -&gt; HashQualified Name
</span><a href="Unison.PrettyPrintEnv.html#termName"><span class="hs-identifier hs-var">PPE.termName</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621682021998"><span class="hs-identifier hs-var">ppeDecl</span></a></span><span> </span><span class="annot"><span class="annottext">(Referent -&gt; HashQualified Name)
-&gt; (Reference -&gt; Referent) -&gt; Reference -&gt; HashQualified Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Referent
</span><span class="hs-identifier hs-var">Referent.Ref</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Reference, Reference) -&gt; (HashQualified Name, Reference))
-&gt; (Reference -&gt; (Reference, Reference))
-&gt; Reference
-&gt; (HashQualified Name, Reference)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; (Reference, Reference)
forall a. a -&gt; (a, a)
</span><span class="hs-identifier hs-var">dupe</span></span><span class="hs-special">)</span><span>
</span><span id="line-880"></span><span>    </span><span class="annot"><span class="annottext">Map Reference (DisplayObject (Type v a) (Term v a))
</span><a href="#local-6989586621682022001"><span class="hs-identifier hs-var">terms</span></a></span><span>
</span><span id="line-881"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-882"></span><span>  </span><span id="local-6989586621682021997"><span class="annot"><span class="annottext">ppeBody :: Reference -&gt; PrettyPrintEnv
</span><a href="#local-6989586621682021997"><span class="hs-identifier hs-var hs-var">ppeBody</span></a></span></span><span> </span><span id="local-6989586621682021996"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682021996"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Suffixify -&gt; Bool
</span><a href="Unison.Server.Types.html#suffixified"><span class="hs-identifier hs-var hs-var">suffixified</span></a></span><span> </span><span class="annot"><span class="annottext">Suffixify
</span><a href="#local-6989586621682022004"><span class="hs-identifier hs-var">suff</span></a></span><span>
</span><span id="line-883"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><a href="Unison.PrettyPrintEnvDecl.html#suffixifiedPPE"><span class="hs-identifier hs-var hs-var">PPE.suffixifiedPPE</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621682022002"><span class="hs-identifier hs-var">ppe0</span></a></span><span>
</span><span id="line-884"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; Reference -&gt; PrettyPrintEnv
</span><a href="Unison.PrettyPrintEnv.Util.html#declarationPPE"><span class="hs-identifier hs-var">PPE.declarationPPE</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621682022002"><span class="hs-identifier hs-var">ppe0</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682021996"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-885"></span><span>  </span><span id="local-6989586621682021998"><span class="annot"><span class="annottext">ppeDecl :: PrettyPrintEnv
</span><a href="#local-6989586621682021998"><span class="hs-identifier hs-var hs-var">ppeDecl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-886"></span><span>    </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Suffixify -&gt; Bool
</span><a href="Unison.Server.Types.html#suffixified"><span class="hs-identifier hs-var hs-var">suffixified</span></a></span><span> </span><span class="annot"><span class="annottext">Suffixify
</span><a href="#local-6989586621682022004"><span class="hs-identifier hs-var">suff</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><a href="Unison.PrettyPrintEnvDecl.html#suffixifiedPPE"><span class="hs-identifier hs-var hs-var">PPE.suffixifiedPPE</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><a href="Unison.PrettyPrintEnvDecl.html#unsuffixifiedPPE"><span class="hs-identifier hs-var hs-var">PPE.unsuffixifiedPPE</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621682022002"><span class="hs-identifier hs-var">ppe0</span></a></span><span>
</span><span id="line-887"></span><span>  </span><span id="local-6989586621682022000"><span class="annot"><span class="annottext">go :: ((HashQualified Name, Reference),
 DisplayObject (Type v a) (Term2 v at ap v a))
-&gt; (Reference,
    DisplayObject
      (AnnotatedText (Element Reference))
      (AnnotatedText (Element Reference)))
</span><a href="#local-6989586621682022000"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682021992"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621682021992"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682021991"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682021991"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682021990"><span class="annot"><span class="annottext">DisplayObject (Type v a) (Term2 v at ap v a)
</span><a href="#local-6989586621682021990"><span class="hs-identifier hs-var">dt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682021991"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(DisplayObject
   (AnnotatedText (Element Reference))
   (AnnotatedText (Element Reference))
 -&gt; (Reference,
     DisplayObject
       (AnnotatedText (Element Reference))
       (AnnotatedText (Element Reference))))
-&gt; DisplayObject
     (AnnotatedText (Element Reference))
     (AnnotatedText (Element Reference))
-&gt; (Reference,
    DisplayObject
      (AnnotatedText (Element Reference))
      (AnnotatedText (Element Reference)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DisplayObject (Type v a) (Term2 v at ap v a)
</span><a href="#local-6989586621682021990"><span class="hs-identifier hs-var">dt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-888"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.DisplayObject.html#BuiltinObject"><span class="hs-identifier hs-type">DisplayObject.BuiltinObject</span></a></span><span> </span><span id="local-6989586621682021989"><span class="annot"><span class="annottext">Type v a
</span><a href="#local-6989586621682021989"><span class="hs-identifier hs-var">typ</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AnnotatedText (Element Reference)
-&gt; DisplayObject
     (AnnotatedText (Element Reference))
     (AnnotatedText (Element Reference))
forall b a. b -&gt; DisplayObject b a
</span><a href="Unison.Codebase.Editor.DisplayObject.html#BuiltinObject"><span class="hs-identifier hs-var">DisplayObject.BuiltinObject</span></a></span><span> </span><span class="annot"><span class="annottext">(AnnotatedText (Element Reference)
 -&gt; DisplayObject
      (AnnotatedText (Element Reference))
      (AnnotatedText (Element Reference)))
-&gt; AnnotatedText (Element Reference)
-&gt; DisplayObject
     (AnnotatedText (Element Reference))
     (AnnotatedText (Element Reference))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-889"></span><span>      </span><span class="annot"><span class="annottext">PrettyPrintEnv
-&gt; Width -&gt; Type v a -&gt; AnnotatedText (Element Reference)
forall v a.
Var v =&gt;
PrettyPrintEnv
-&gt; Width -&gt; Type v a -&gt; AnnotatedText (Element Reference)
</span><a href="Unison.Server.Backend.html#formatType%27"><span class="hs-identifier hs-var">formatType'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference -&gt; PrettyPrintEnv
</span><a href="#local-6989586621682021997"><span class="hs-identifier hs-var">ppeBody</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682021991"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682022003"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">Type v a
</span><a href="#local-6989586621682021989"><span class="hs-identifier hs-var">typ</span></a></span><span>
</span><span id="line-890"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.DisplayObject.html#MissingObject"><span class="hs-identifier hs-type">DisplayObject.MissingObject</span></a></span><span> </span><span id="local-6989586621682021988"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621682021988"><span class="hs-identifier hs-var">sh</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ShortHash
-&gt; DisplayObject
     (AnnotatedText (Element Reference))
     (AnnotatedText (Element Reference))
forall b a. ShortHash -&gt; DisplayObject b a
</span><a href="Unison.Codebase.Editor.DisplayObject.html#MissingObject"><span class="hs-identifier hs-var">DisplayObject.MissingObject</span></a></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621682021988"><span class="hs-identifier hs-var">sh</span></a></span><span>
</span><span id="line-891"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.DisplayObject.html#UserObject"><span class="hs-identifier hs-type">DisplayObject.UserObject</span></a></span><span> </span><span id="local-6989586621682021987"><span class="annot"><span class="annottext">Term2 v at ap v a
</span><a href="#local-6989586621682021987"><span class="hs-identifier hs-var">tm</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AnnotatedText (Element Reference)
-&gt; DisplayObject
     (AnnotatedText (Element Reference))
     (AnnotatedText (Element Reference))
forall b a. a -&gt; DisplayObject b a
</span><a href="Unison.Codebase.Editor.DisplayObject.html#UserObject"><span class="hs-identifier hs-var">DisplayObject.UserObject</span></a></span><span> </span><span class="annot"><span class="annottext">(AnnotatedText (Element Reference)
 -&gt; DisplayObject
      (AnnotatedText (Element Reference))
      (AnnotatedText (Element Reference)))
-&gt; (Term2 v at ap v a -&gt; AnnotatedText (Element Reference))
-&gt; Term2 v at ap v a
-&gt; DisplayObject
     (AnnotatedText (Element Reference))
     (AnnotatedText (Element Reference))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span>
</span><span id="line-892"></span><span>      </span><span class="annot"><span class="annottext">Width
-&gt; Pretty (AnnotatedText (Element Reference))
-&gt; AnnotatedText (Element Reference)
forall s. (Monoid s, IsString s) =&gt; Width -&gt; Pretty s -&gt; s
</span><a href="Unison.Util.Pretty.html#render"><span class="hs-identifier hs-var">Pretty.render</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682022003"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">(Pretty (AnnotatedText (Element Reference))
 -&gt; AnnotatedText (Element Reference))
-&gt; (Term2 v at ap v a
    -&gt; Pretty (AnnotatedText (Element Reference)))
-&gt; Term2 v at ap v a
-&gt; AnnotatedText (Element Reference)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
-&gt; HashQualified Name
-&gt; Term2 v at ap v a
-&gt; Pretty (AnnotatedText (Element Reference))
forall v at ap a.
Var v =&gt;
PrettyPrintEnv
-&gt; HashQualified Name
-&gt; Term2 v at ap v a
-&gt; Pretty (AnnotatedText (Element Reference))
</span><a href="Unison.TermPrinter.html#prettyBinding"><span class="hs-identifier hs-var">TermPrinter.prettyBinding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference -&gt; PrettyPrintEnv
</span><a href="#local-6989586621682021997"><span class="hs-identifier hs-var">ppeBody</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682021991"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621682021992"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">(Term2 v at ap v a
 -&gt; DisplayObject
      (AnnotatedText (Element Reference))
      (AnnotatedText (Element Reference)))
-&gt; Term2 v at ap v a
-&gt; DisplayObject
     (AnnotatedText (Element Reference))
     (AnnotatedText (Element Reference))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Term2 v at ap v a
</span><a href="#local-6989586621682021987"><span class="hs-identifier hs-var">tm</span></a></span><span>
</span><span id="line-893"></span><span>
</span><span id="line-894"></span><span id="local-6989586621682022956"><span id="local-6989586621682022957"><span class="annot"><a href="Unison.Server.Backend.html#typesToSyntax"><span class="hs-identifier hs-type">typesToSyntax</span></a></span><span>
</span><span id="line-895"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621682022957"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-896"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621682022956"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-897"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Server.Types.html#Suffixify"><span class="hs-identifier hs-type">Suffixify</span></a></span><span>
</span><span id="line-898"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Util.Pretty.html#Width"><span class="hs-identifier hs-type">Width</span></a></span><span>
</span><span id="line-899"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.PrettyPrintEnvDecl.html#PrettyPrintEnvDecl"><span class="hs-identifier hs-type">PPE.PrettyPrintEnvDecl</span></a></span><span>
</span><span id="line-900"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference.Reference</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Editor.DisplayObject.html#DisplayObject"><span class="hs-identifier hs-type">DisplayObject</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DD.Decl</span></span><span> </span><span class="annot"><a href="#local-6989586621682022957"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022956"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-901"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference.Reference</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Editor.DisplayObject.html#DisplayObject"><span class="hs-identifier hs-type">DisplayObject</span></a></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#SyntaxText"><span class="hs-identifier hs-type">SyntaxText</span></a></span><span> </span><span class="annot"><a href="Unison.Server.Backend.html#SyntaxText"><span class="hs-identifier hs-type">SyntaxText</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-902"></span><span id="typesToSyntax"><span class="annot"><span class="annottext">typesToSyntax :: Suffixify
-&gt; Width
-&gt; PrettyPrintEnvDecl
-&gt; Map Reference (DisplayObject () (Decl v a))
-&gt; Map
     Reference
     (DisplayObject
        (AnnotatedText (Element Reference))
        (AnnotatedText (Element Reference)))
</span><a href="Unison.Server.Backend.html#typesToSyntax"><span class="hs-identifier hs-var hs-var">typesToSyntax</span></a></span></span><span> </span><span id="local-6989586621682021985"><span class="annot"><span class="annottext">Suffixify
</span><a href="#local-6989586621682021985"><span class="hs-identifier hs-var">suff</span></a></span></span><span> </span><span id="local-6989586621682021984"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682021984"><span class="hs-identifier hs-var">width</span></a></span></span><span> </span><span id="local-6989586621682021983"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621682021983"><span class="hs-identifier hs-var">ppe0</span></a></span></span><span> </span><span id="local-6989586621682021982"><span class="annot"><span class="annottext">Map Reference (DisplayObject () (Decl v a))
</span><a href="#local-6989586621682021982"><span class="hs-identifier hs-var">types</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-903"></span><span>  </span><span class="annot"><span class="annottext">[(Reference,
  DisplayObject
    (AnnotatedText (Element Reference))
    (AnnotatedText (Element Reference)))]
-&gt; Map
     Reference
     (DisplayObject
        (AnnotatedText (Element Reference))
        (AnnotatedText (Element Reference)))
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(Reference,
   DisplayObject
     (AnnotatedText (Element Reference))
     (AnnotatedText (Element Reference)))]
 -&gt; Map
      Reference
      (DisplayObject
         (AnnotatedText (Element Reference))
         (AnnotatedText (Element Reference))))
-&gt; [(Reference,
     DisplayObject
       (AnnotatedText (Element Reference))
       (AnnotatedText (Element Reference)))]
-&gt; Map
     Reference
     (DisplayObject
        (AnnotatedText (Element Reference))
        (AnnotatedText (Element Reference)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(((HashQualified Name, Reference), DisplayObject () (Decl v a))
 -&gt; (Reference,
     DisplayObject
       (AnnotatedText (Element Reference))
       (AnnotatedText (Element Reference))))
-&gt; [((HashQualified Name, Reference), DisplayObject () (Decl v a))]
-&gt; [(Reference,
     DisplayObject
       (AnnotatedText (Element Reference))
       (AnnotatedText (Element Reference)))]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">((HashQualified Name, Reference), DisplayObject () (Decl v a))
-&gt; (Reference,
    DisplayObject
      (AnnotatedText (Element Reference))
      (AnnotatedText (Element Reference)))
forall v b a.
Var v =&gt;
((HashQualified Name, Reference), DisplayObject b (Decl v a))
-&gt; (Reference,
    DisplayObject
      (AnnotatedText (Element Reference))
      (AnnotatedText (Element Reference)))
</span><a href="#local-6989586621682021981"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">([((HashQualified Name, Reference), DisplayObject () (Decl v a))]
 -&gt; [(Reference,
      DisplayObject
        (AnnotatedText (Element Reference))
        (AnnotatedText (Element Reference)))])
-&gt; (Map
      (HashQualified Name, Reference) (DisplayObject () (Decl v a))
    -&gt; [((HashQualified Name, Reference),
         DisplayObject () (Decl v a))])
-&gt; Map
     (HashQualified Name, Reference) (DisplayObject () (Decl v a))
-&gt; [(Reference,
     DisplayObject
       (AnnotatedText (Element Reference))
       (AnnotatedText (Element Reference)))]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Map (HashQualified Name, Reference) (DisplayObject () (Decl v a))
-&gt; [((HashQualified Name, Reference), DisplayObject () (Decl v a))]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">(Map (HashQualified Name, Reference) (DisplayObject () (Decl v a))
 -&gt; [(Reference,
      DisplayObject
        (AnnotatedText (Element Reference))
        (AnnotatedText (Element Reference)))])
-&gt; Map
     (HashQualified Name, Reference) (DisplayObject () (Decl v a))
-&gt; [(Reference,
     DisplayObject
       (AnnotatedText (Element Reference))
       (AnnotatedText (Element Reference)))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; (HashQualified Name, Reference))
-&gt; Map Reference (DisplayObject () (Decl v a))
-&gt; Map
     (HashQualified Name, Reference) (DisplayObject () (Decl v a))
forall k2 k1 a. Ord k2 =&gt; (k1 -&gt; k2) -&gt; Map k1 a -&gt; Map k2 a
</span><span class="hs-identifier hs-var">Map.mapKeys</span></span><span>
</span><span id="line-904"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Reference -&gt; HashQualified Name)
-&gt; (Reference, Reference) -&gt; (HashQualified Name, Reference)
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; Reference -&gt; HashQualified Name
</span><a href="Unison.PrettyPrintEnv.html#typeName"><span class="hs-identifier hs-var">PPE.typeName</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621682021980"><span class="hs-identifier hs-var">ppeDecl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Reference, Reference) -&gt; (HashQualified Name, Reference))
-&gt; (Reference -&gt; (Reference, Reference))
-&gt; Reference
-&gt; (HashQualified Name, Reference)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; (Reference, Reference)
forall a. a -&gt; (a, a)
</span><span class="hs-identifier hs-var">dupe</span></span><span class="hs-special">)</span><span>
</span><span id="line-905"></span><span>    </span><span class="annot"><span class="annottext">Map Reference (DisplayObject () (Decl v a))
</span><a href="#local-6989586621682021982"><span class="hs-identifier hs-var">types</span></a></span><span>
</span><span id="line-906"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-907"></span><span>  </span><span id="local-6989586621682021980"><span class="annot"><span class="annottext">ppeDecl :: PrettyPrintEnv
</span><a href="#local-6989586621682021980"><span class="hs-identifier hs-var hs-var">ppeDecl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Suffixify -&gt; Bool
</span><a href="Unison.Server.Types.html#suffixified"><span class="hs-identifier hs-var hs-var">suffixified</span></a></span><span> </span><span class="annot"><span class="annottext">Suffixify
</span><a href="#local-6989586621682021985"><span class="hs-identifier hs-var">suff</span></a></span><span>
</span><span id="line-908"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><a href="Unison.PrettyPrintEnvDecl.html#suffixifiedPPE"><span class="hs-identifier hs-var hs-var">PPE.suffixifiedPPE</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621682021983"><span class="hs-identifier hs-var">ppe0</span></a></span><span>
</span><span id="line-909"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><a href="Unison.PrettyPrintEnvDecl.html#unsuffixifiedPPE"><span class="hs-identifier hs-var hs-var">PPE.unsuffixifiedPPE</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621682021983"><span class="hs-identifier hs-var">ppe0</span></a></span><span>
</span><span id="line-910"></span><span>  </span><span id="local-6989586621682021981"><span class="annot"><span class="annottext">go :: ((HashQualified Name, Reference), DisplayObject b (Decl v a))
-&gt; (Reference,
    DisplayObject
      (AnnotatedText (Element Reference))
      (AnnotatedText (Element Reference)))
</span><a href="#local-6989586621682021981"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682021979"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621682021979"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682021978"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682021978"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682021977"><span class="annot"><span class="annottext">DisplayObject b (Decl v a)
</span><a href="#local-6989586621682021977"><span class="hs-identifier hs-var">dt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682021978"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(DisplayObject
   (AnnotatedText (Element Reference))
   (AnnotatedText (Element Reference))
 -&gt; (Reference,
     DisplayObject
       (AnnotatedText (Element Reference))
       (AnnotatedText (Element Reference))))
-&gt; DisplayObject
     (AnnotatedText (Element Reference))
     (AnnotatedText (Element Reference))
-&gt; (Reference,
    DisplayObject
      (AnnotatedText (Element Reference))
      (AnnotatedText (Element Reference)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DisplayObject b (Decl v a)
</span><a href="#local-6989586621682021977"><span class="hs-identifier hs-var">dt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-911"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.DisplayObject.html#BuiltinObject"><span class="hs-identifier hs-type">BuiltinObject</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AnnotatedText (Element Reference)
-&gt; DisplayObject
     (AnnotatedText (Element Reference))
     (AnnotatedText (Element Reference))
forall b a. b -&gt; DisplayObject b a
</span><a href="Unison.Codebase.Editor.DisplayObject.html#BuiltinObject"><span class="hs-identifier hs-var">BuiltinObject</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; Reference -&gt; AnnotatedText (Element Reference)
</span><a href="Unison.Server.Backend.html#formatTypeName%27"><span class="hs-identifier hs-var">formatTypeName'</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621682021980"><span class="hs-identifier hs-var">ppeDecl</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682021978"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-912"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.DisplayObject.html#MissingObject"><span class="hs-identifier hs-type">MissingObject</span></a></span><span> </span><span id="local-6989586621682021976"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621682021976"><span class="hs-identifier hs-var">sh</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ShortHash
-&gt; DisplayObject
     (AnnotatedText (Element Reference))
     (AnnotatedText (Element Reference))
forall b a. ShortHash -&gt; DisplayObject b a
</span><a href="Unison.Codebase.Editor.DisplayObject.html#MissingObject"><span class="hs-identifier hs-var">MissingObject</span></a></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621682021976"><span class="hs-identifier hs-var">sh</span></a></span><span>
</span><span id="line-913"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.DisplayObject.html#UserObject"><span class="hs-identifier hs-type">UserObject</span></a></span><span> </span><span id="local-6989586621682021975"><span class="annot"><span class="annottext">Decl v a
</span><a href="#local-6989586621682021975"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AnnotatedText (Element Reference)
-&gt; DisplayObject
     (AnnotatedText (Element Reference))
     (AnnotatedText (Element Reference))
forall b a. a -&gt; DisplayObject b a
</span><a href="Unison.Codebase.Editor.DisplayObject.html#UserObject"><span class="hs-identifier hs-var">UserObject</span></a></span><span> </span><span class="annot"><span class="annottext">(AnnotatedText (Element Reference)
 -&gt; DisplayObject
      (AnnotatedText (Element Reference))
      (AnnotatedText (Element Reference)))
-&gt; (Pretty (AnnotatedText (Element Reference))
    -&gt; AnnotatedText (Element Reference))
-&gt; Pretty (AnnotatedText (Element Reference))
-&gt; DisplayObject
     (AnnotatedText (Element Reference))
     (AnnotatedText (Element Reference))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Width
-&gt; Pretty (AnnotatedText (Element Reference))
-&gt; AnnotatedText (Element Reference)
forall s. (Monoid s, IsString s) =&gt; Width -&gt; Pretty s -&gt; s
</span><a href="Unison.Util.Pretty.html#render"><span class="hs-identifier hs-var">Pretty.render</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621682021984"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">(Pretty (AnnotatedText (Element Reference))
 -&gt; DisplayObject
      (AnnotatedText (Element Reference))
      (AnnotatedText (Element Reference)))
-&gt; Pretty (AnnotatedText (Element Reference))
-&gt; DisplayObject
     (AnnotatedText (Element Reference))
     (AnnotatedText (Element Reference))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-914"></span><span>      </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
-&gt; Reference
-&gt; HashQualified Name
-&gt; Decl v a
-&gt; Pretty (AnnotatedText (Element Reference))
forall v a.
Var v =&gt;
PrettyPrintEnvDecl
-&gt; Reference
-&gt; HashQualified Name
-&gt; Decl v a
-&gt; Pretty (AnnotatedText (Element Reference))
</span><a href="Unison.DeclPrinter.html#prettyDecl"><span class="hs-identifier hs-var">DeclPrinter.prettyDecl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; Reference -&gt; PrettyPrintEnvDecl
</span><a href="Unison.PrettyPrintEnv.Util.html#declarationPPEDecl"><span class="hs-identifier hs-var">PPE.declarationPPEDecl</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621682021983"><span class="hs-identifier hs-var">ppe0</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682021978"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682021978"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621682021979"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Decl v a
</span><a href="#local-6989586621682021975"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-915"></span><span>
</span><span id="line-916"></span><span id="local-6989586621682022864"><span id="local-6989586621682022865"><span class="annot"><a href="Unison.Server.Backend.html#loadSearchResults"><span class="hs-identifier hs-type">loadSearchResults</span></a></span><span>
</span><span id="line-917"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621682022865"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Applicative</span></span><span> </span><span class="annot"><a href="#local-6989586621682022864"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-918"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Type.html#Codebase"><span class="hs-identifier hs-type">Codebase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022864"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022865"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="Unison.Parser.Ann.html#Ann"><span class="hs-identifier hs-type">Ann</span></a></span><span>
</span><span id="line-919"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Unison.Server.SearchResult.html#SearchResult"><span class="hs-identifier hs-type">SR.SearchResult</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-920"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682022864"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Unison.Server.SearchResult'.html#SearchResult%27"><span class="hs-identifier hs-type">SR'.SearchResult'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022865"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="Unison.Parser.Ann.html#Ann"><span class="hs-identifier hs-type">Ann</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-921"></span><span id="loadSearchResults"><span class="annot"><span class="annottext">loadSearchResults :: Codebase m v Ann -&gt; [SearchResult] -&gt; m [SearchResult' v Ann]
</span><a href="Unison.Server.Backend.html#loadSearchResults"><span class="hs-identifier hs-var hs-var">loadSearchResults</span></a></span></span><span> </span><span id="local-6989586621682021972"><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621682021972"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SearchResult -&gt; m (SearchResult' v Ann))
-&gt; [SearchResult] -&gt; m [SearchResult' v Ann]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">SearchResult -&gt; m (SearchResult' v Ann)
</span><a href="#local-6989586621682021971"><span class="hs-identifier hs-var">loadSearchResult</span></a></span><span>
</span><span id="line-922"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-923"></span><span>  </span><span id="local-6989586621682021971"><span class="annot"><span class="annottext">loadSearchResult :: SearchResult -&gt; m (SearchResult' v Ann)
</span><a href="#local-6989586621682021971"><span class="hs-identifier hs-var hs-var">loadSearchResult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-924"></span><span>    </span><span class="annot"><a href="Unison.Server.SearchResult.html#Tm"><span class="hs-identifier hs-type">SR.Tm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.SearchResult.html#TermResult"><span class="hs-identifier hs-type">SR.TermResult</span></a></span><span> </span><span id="local-6989586621682021968"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621682021968"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621682021967"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621682021967"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682021966"><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><a href="#local-6989586621682021966"><span class="hs-identifier hs-var">aliases</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-925"></span><span>      </span><span id="local-6989586621682021965"><span class="annot"><span class="annottext">Maybe (Type v Ann)
</span><a href="#local-6989586621682021965"><span class="hs-identifier hs-var">typ</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann -&gt; Referent -&gt; m (Maybe (Type v Ann))
forall (m :: * -&gt; *) v.
(Applicative m, Var v) =&gt;
Codebase m v Ann -&gt; Referent -&gt; m (Maybe (Type v Ann))
</span><a href="Unison.Server.Backend.html#loadReferentType"><span class="hs-identifier hs-var">loadReferentType</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621682021972"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621682021967"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-926"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="annot"><span class="annottext">HashQualified Name
-&gt; Maybe (Type v Ann)
-&gt; Referent
-&gt; Set (HashQualified Name)
-&gt; SearchResult' v Ann
forall v a.
HashQualified Name
-&gt; Maybe (Type v a)
-&gt; Referent
-&gt; Set (HashQualified Name)
-&gt; SearchResult' v a
</span><a href="Unison.Server.SearchResult'.html#Tm"><span class="hs-identifier hs-var">SR'.Tm</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621682021968"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Type v Ann)
</span><a href="#local-6989586621682021965"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621682021967"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><a href="#local-6989586621682021966"><span class="hs-identifier hs-var">aliases</span></a></span><span>
</span><span id="line-927"></span><span>    </span><span class="annot"><a href="Unison.Server.SearchResult.html#Tp"><span class="hs-identifier hs-type">SR.Tp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.SearchResult.html#TypeResult"><span class="hs-identifier hs-type">SR.TypeResult</span></a></span><span> </span><span id="local-6989586621682021962"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621682021962"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621682021961"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682021961"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682021960"><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><a href="#local-6989586621682021960"><span class="hs-identifier hs-var">aliases</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-928"></span><span>      </span><span id="local-6989586621682021959"><span class="annot"><span class="annottext">DisplayObject () (Decl v Ann)
</span><a href="#local-6989586621682021959"><span class="hs-identifier hs-var">dt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann -&gt; Reference -&gt; m (DisplayObject () (Decl v Ann))
forall (m :: * -&gt; *) v.
Applicative m =&gt;
Codebase m v Ann -&gt; Reference -&gt; m (DisplayObject () (Decl v Ann))
</span><a href="Unison.Server.Backend.html#loadTypeDisplayObject"><span class="hs-identifier hs-var">loadTypeDisplayObject</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621682021972"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682021961"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-929"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="annot"><span class="annottext">HashQualified Name
-&gt; DisplayObject () (Decl v Ann)
-&gt; Reference
-&gt; Set (HashQualified Name)
-&gt; SearchResult' v Ann
forall v a.
HashQualified Name
-&gt; DisplayObject () (Decl v a)
-&gt; Reference
-&gt; Set (HashQualified Name)
-&gt; SearchResult' v a
</span><a href="Unison.Server.SearchResult'.html#Tp"><span class="hs-identifier hs-var">SR'.Tp</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621682021962"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">DisplayObject () (Decl v Ann)
</span><a href="#local-6989586621682021959"><span class="hs-identifier hs-var">dt</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621682021961"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><a href="#local-6989586621682021960"><span class="hs-identifier hs-var">aliases</span></a></span><span>
</span><span id="line-930"></span><span>
</span><span id="line-931"></span><span id="local-6989586621682022808"><span id="local-6989586621682022809"><span class="annot"><a href="Unison.Server.Backend.html#loadTypeDisplayObject"><span class="hs-identifier hs-type">loadTypeDisplayObject</span></a></span><span>
</span><span id="line-932"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Applicative</span></span><span> </span><span class="annot"><a href="#local-6989586621682022809"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-933"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Type.html#Codebase"><span class="hs-identifier hs-type">Codebase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022809"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682022808"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="Unison.Parser.Ann.html#Ann"><span class="hs-identifier hs-type">Ann</span></a></span><span>
</span><span id="line-934"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span>
</span><span id="line-935"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682022809"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Editor.DisplayObject.html#DisplayObject"><span class="hs-identifier hs-type">DisplayObject</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DD.Decl</span></span><span> </span><span class="annot"><a href="#local-6989586621682022808"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="Unison.Parser.Ann.html#Ann"><span class="hs-identifier hs-type">Ann</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-936"></span><span id="loadTypeDisplayObject"><span class="annot"><span class="annottext">loadTypeDisplayObject :: Codebase m v Ann -&gt; Reference -&gt; m (DisplayObject () (Decl v Ann))
</span><a href="Unison.Server.Backend.html#loadTypeDisplayObject"><span class="hs-identifier hs-var hs-var">loadTypeDisplayObject</span></a></span></span><span> </span><span id="local-6989586621682021956"><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621682021956"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-937"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Reference.Builtin</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DisplayObject () (Decl v Ann) -&gt; m (DisplayObject () (Decl v Ann))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; DisplayObject () (Decl v Ann)
forall b a. b -&gt; DisplayObject b a
</span><a href="Unison.Codebase.Editor.DisplayObject.html#BuiltinObject"><span class="hs-identifier hs-var">BuiltinObject</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-938"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Reference.DerivedId</span></span><span> </span><span id="local-6989586621682021955"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682021955"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-939"></span><span>    </span><span class="annot"><span class="annottext">DisplayObject () (Decl v Ann)
-&gt; (Decl v Ann -&gt; DisplayObject () (Decl v Ann))
-&gt; Maybe (Decl v Ann)
-&gt; DisplayObject () (Decl v Ann)
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortHash -&gt; DisplayObject () (Decl v Ann)
forall b a. ShortHash -&gt; DisplayObject b a
</span><a href="Unison.Codebase.Editor.DisplayObject.html#MissingObject"><span class="hs-identifier hs-var">MissingObject</span></a></span><span> </span><span class="annot"><span class="annottext">(ShortHash -&gt; DisplayObject () (Decl v Ann))
-&gt; ShortHash -&gt; DisplayObject () (Decl v Ann)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; ShortHash
</span><span class="hs-identifier hs-var">Reference.idToShortHash</span></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682021955"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Decl v Ann -&gt; DisplayObject () (Decl v Ann)
forall b a. a -&gt; DisplayObject b a
</span><a href="Unison.Codebase.Editor.DisplayObject.html#UserObject"><span class="hs-identifier hs-var">UserObject</span></a></span><span>
</span><span id="line-940"></span><span>      </span><span class="annot"><span class="annottext">(Maybe (Decl v Ann) -&gt; DisplayObject () (Decl v Ann))
-&gt; m (Maybe (Decl v Ann)) -&gt; m (DisplayObject () (Decl v Ann))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann -&gt; Id -&gt; m (Maybe (Decl v Ann))
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; Id -&gt; m (Maybe (Decl v a))
</span><a href="Unison.Codebase.Type.html#getTypeDeclaration"><span class="hs-identifier hs-var hs-var">Codebase.getTypeDeclaration</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621682021956"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682021955"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-941"></span><span>
</span><span id="line-942"></span></pre></body></html>