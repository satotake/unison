<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span id="%24con2tag_8mI4JRcIO8A0gQ7bq77jov"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Unison.ShortHash</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Prelude</span></span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Text</span></span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-comment">-- Arya created this type to be able to query the Codebase for anonymous definitions.  The parsing functions can't fail, because they only try to pull apart the syntactic elements &quot;#&quot; and &quot;.&quot;.  They don't necessarily produce a meaningful reference; you'll figure that out during base58 decoding.  We don't attempt base58 decoding here because the base58 prefix doesn't correspond to anything useful.  We'll just compare strings against the codebase or namespace later.</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- None of the punctuation is stored here.</span><span>
</span><span id="line-13"></span><span id="local-6989586621679194735"><span id="local-6989586621679194736"></span></span><span class="hs-keyword">data</span><span> </span><span id="ShortHash"><span class="annot"><a href="Unison.ShortHash.html#ShortHash"><span class="hs-identifier hs-var">ShortHash</span></a></span></span><span>
</span><span id="line-14"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="Builtin"><span class="annot"><a href="Unison.ShortHash.html#Builtin"><span class="hs-identifier hs-var">Builtin</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="ShortHash"><span class="annot"><a href="Unison.ShortHash.html#ShortHash"><span class="hs-identifier hs-var">ShortHash</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="prefix"><span class="annot"><span class="annottext">ShortHash -&gt; Text
</span><a href="Unison.ShortHash.html#prefix"><span class="hs-identifier hs-var hs-var">prefix</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">,</span><span> </span><span id="cycle"><span class="annot"><span class="annottext">ShortHash -&gt; Maybe Text
</span><a href="Unison.ShortHash.html#cycle"><span class="hs-identifier hs-var hs-var">cycle</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">,</span><span> </span><span id="cid"><span class="annot"><span class="annottext">ShortHash -&gt; Maybe Text
</span><a href="Unison.ShortHash.html#cid"><span class="hs-identifier hs-var hs-var">cid</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-16"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679194726"><span id="local-6989586621679194728"><span class="annot"><span class="annottext">ShortHash -&gt; ShortHash -&gt; Bool
(ShortHash -&gt; ShortHash -&gt; Bool)
-&gt; (ShortHash -&gt; ShortHash -&gt; Bool) -&gt; Eq ShortHash
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ShortHash -&gt; ShortHash -&gt; Bool
$c/= :: ShortHash -&gt; ShortHash -&gt; Bool
== :: ShortHash -&gt; ShortHash -&gt; Bool
$c== :: ShortHash -&gt; ShortHash -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679194710"><span id="local-6989586621679194712"><span id="local-6989586621679194714"><span id="local-6989586621679194716"><span id="local-6989586621679194718"><span id="local-6989586621679194720"><span id="local-6989586621679194722"><span class="annot"><span class="annottext">Eq ShortHash
Eq ShortHash
-&gt; (ShortHash -&gt; ShortHash -&gt; Ordering)
-&gt; (ShortHash -&gt; ShortHash -&gt; Bool)
-&gt; (ShortHash -&gt; ShortHash -&gt; Bool)
-&gt; (ShortHash -&gt; ShortHash -&gt; Bool)
-&gt; (ShortHash -&gt; ShortHash -&gt; Bool)
-&gt; (ShortHash -&gt; ShortHash -&gt; ShortHash)
-&gt; (ShortHash -&gt; ShortHash -&gt; ShortHash)
-&gt; Ord ShortHash
ShortHash -&gt; ShortHash -&gt; Bool
ShortHash -&gt; ShortHash -&gt; Ordering
ShortHash -&gt; ShortHash -&gt; ShortHash
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
min :: ShortHash -&gt; ShortHash -&gt; ShortHash
$cmin :: ShortHash -&gt; ShortHash -&gt; ShortHash
max :: ShortHash -&gt; ShortHash -&gt; ShortHash
$cmax :: ShortHash -&gt; ShortHash -&gt; ShortHash
&gt;= :: ShortHash -&gt; ShortHash -&gt; Bool
$c&gt;= :: ShortHash -&gt; ShortHash -&gt; Bool
&gt; :: ShortHash -&gt; ShortHash -&gt; Bool
$c&gt; :: ShortHash -&gt; ShortHash -&gt; Bool
&lt;= :: ShortHash -&gt; ShortHash -&gt; Bool
$c&lt;= :: ShortHash -&gt; ShortHash -&gt; Bool
&lt; :: ShortHash -&gt; ShortHash -&gt; Bool
$c&lt; :: ShortHash -&gt; ShortHash -&gt; Bool
compare :: ShortHash -&gt; ShortHash -&gt; Ordering
$ccompare :: ShortHash -&gt; ShortHash -&gt; Ordering
$cp1Ord :: Eq ShortHash
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679194703"><span id="local-6989586621679194705"><span id="local-6989586621679194707"><span class="annot"><span class="annottext">Int -&gt; ShortHash -&gt; ShowS
[ShortHash] -&gt; ShowS
ShortHash -&gt; String
(Int -&gt; ShortHash -&gt; ShowS)
-&gt; (ShortHash -&gt; String)
-&gt; ([ShortHash] -&gt; ShowS)
-&gt; Show ShortHash
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ShortHash] -&gt; ShowS
$cshowList :: [ShortHash] -&gt; ShowS
show :: ShortHash -&gt; String
$cshow :: ShortHash -&gt; String
showsPrec :: Int -&gt; ShortHash -&gt; ShowS
$cshowsPrec :: Int -&gt; ShortHash -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. ShortHash -&gt; Rep ShortHash x)
-&gt; (forall x. Rep ShortHash x -&gt; ShortHash) -&gt; Generic ShortHash
forall x. Rep ShortHash x -&gt; ShortHash
forall x. ShortHash -&gt; Rep ShortHash x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep ShortHash x -&gt; ShortHash
$cfrom :: forall x. ShortHash -&gt; Rep ShortHash x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-comment">-- currently unused</span><span>
</span><span id="line-19"></span><span class="annot"><a href="Unison.ShortHash.html#isConstructor"><span class="hs-identifier hs-type">isConstructor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.ShortHash.html#ShortHash"><span class="hs-identifier hs-type">ShortHash</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-20"></span><span id="isConstructor"><span class="annot"><span class="annottext">isConstructor :: ShortHash -&gt; Bool
</span><a href="Unison.ShortHash.html#isConstructor"><span class="hs-identifier hs-var hs-var">isConstructor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-21"></span><span>  </span><span class="annot"><a href="Unison.ShortHash.html#ShortHash"><span class="hs-identifier hs-type">ShortHash</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-22"></span><span>  </span><span class="annot"><span class="annottext">ShortHash
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span class="hs-comment">-- Parse a string like those described in Referent.fromText:</span><span>
</span><span id="line-25"></span><span class="hs-comment">-- examples:</span><span>
</span><span id="line-26"></span><span class="hs-comment">-- `##Text.take` &#8212; builtins don&#8217;t have cycles or cids</span><span>
</span><span id="line-27"></span><span class="hs-comment">-- `#2tWjVAuc7` &#8212; term ref, no cycle</span><span>
</span><span id="line-28"></span><span class="hs-comment">-- `#y9ycWkiC1.y9` &#8212; term ref, part of cycle</span><span>
</span><span id="line-29"></span><span class="hs-comment">-- `#cWkiC1x89#1` &#8212; constructor</span><span>
</span><span id="line-30"></span><span class="hs-comment">-- `#DCxrnCAPS.WD#0` &#8212; constructor of a type in a cycle</span><span>
</span><span id="line-31"></span><span class="hs-comment">-- A constructor ID on a builtin is ignored:</span><span>
</span><span id="line-32"></span><span class="hs-comment">--  e.g. ##FileIO#2 is parsed as ##FileIO</span><span>
</span><span id="line-33"></span><span class="hs-comment">-- Anything to the left of the first # is</span><span>
</span><span id="line-34"></span><span class="hs-comment">--   e.g. foo#abc is parsed as #abc</span><span>
</span><span id="line-35"></span><span class="hs-comment">-- Anything including and following a third # is ignored.</span><span>
</span><span id="line-36"></span><span class="hs-comment">--   e.g. foo#abc#2#hello is parsed as #abc#2</span><span>
</span><span id="line-37"></span><span class="hs-comment">-- Anything after a second . before a second # is ignored.</span><span>
</span><span id="line-38"></span><span class="hs-comment">--   e.g. foo#abc.1f.x is parsed as #abc.1f</span><span>
</span><span id="line-39"></span><span class="annot"><a href="Unison.ShortHash.html#fromText"><span class="hs-identifier hs-type">fromText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Unison.ShortHash.html#ShortHash"><span class="hs-identifier hs-type">ShortHash</span></a></span><span>
</span><span id="line-40"></span><span id="fromText"><span class="annot"><span class="annottext">fromText :: Text -&gt; Maybe ShortHash
</span><a href="Unison.ShortHash.html#fromText"><span class="hs-identifier hs-var hs-var">fromText</span></a></span></span><span> </span><span id="local-6989586621679194696"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679194696"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; Text -&gt; [Text]
</span><span class="hs-identifier hs-var">Text.split</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'#'</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679194696"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-41"></span><span>  </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679194694"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679194694"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ShortHash -&gt; Maybe ShortHash
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(ShortHash -&gt; Maybe ShortHash) -&gt; ShortHash -&gt; Maybe ShortHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ShortHash
</span><a href="Unison.ShortHash.html#Builtin"><span class="hs-identifier hs-var">Builtin</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679194694"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-comment">-- builtin starts with ##</span><span>
</span><span id="line-42"></span><span>  </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679194693"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679194693"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- builtin with a CID todo: could be rejected</span><span>
</span><span id="line-43"></span><span>    </span><span class="annot"><span class="annottext">ShortHash -&gt; Maybe ShortHash
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(ShortHash -&gt; Maybe ShortHash) -&gt; ShortHash -&gt; Maybe ShortHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ShortHash
</span><a href="Unison.ShortHash.html#Builtin"><span class="hs-identifier hs-var">Builtin</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679194693"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-44"></span><span>  </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679194692"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679194692"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ShortHash -&gt; Maybe ShortHash
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(ShortHash -&gt; Maybe ShortHash) -&gt; ShortHash -&gt; Maybe ShortHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Maybe Text -&gt; Maybe Text -&gt; ShortHash)
-&gt; (Text, Maybe Text) -&gt; Maybe Text -&gt; ShortHash
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Text -&gt; Maybe Text -&gt; ShortHash
</span><a href="Unison.ShortHash.html#ShortHash"><span class="hs-identifier hs-var">ShortHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; (Text, Maybe Text)
</span><a href="#local-6989586621679194690"><span class="hs-identifier hs-var">getCycle</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679194692"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Text
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-45"></span><span>  </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679194689"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679194689"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679194688"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679194688"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ShortHash -&gt; Maybe ShortHash
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(ShortHash -&gt; Maybe ShortHash) -&gt; ShortHash -&gt; Maybe ShortHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Maybe Text -&gt; Maybe Text -&gt; ShortHash)
-&gt; (Text, Maybe Text) -&gt; Maybe Text -&gt; ShortHash
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Text -&gt; Maybe Text -&gt; ShortHash
</span><a href="Unison.ShortHash.html#ShortHash"><span class="hs-identifier hs-var">ShortHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; (Text, Maybe Text)
</span><a href="#local-6989586621679194690"><span class="hs-identifier hs-var">getCycle</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679194689"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Maybe Text
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679194688"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span>  </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679194687"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679194687"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679194686"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679194686"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679194685"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679194685"><span class="hs-identifier hs-var">_garbage</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- CID with more hash after todo: could be rejected</span><span>
</span><span id="line-47"></span><span>    </span><span class="annot"><span class="annottext">ShortHash -&gt; Maybe ShortHash
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(ShortHash -&gt; Maybe ShortHash) -&gt; ShortHash -&gt; Maybe ShortHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Maybe Text -&gt; Maybe Text -&gt; ShortHash)
-&gt; (Text, Maybe Text) -&gt; Maybe Text -&gt; ShortHash
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Text -&gt; Maybe Text -&gt; ShortHash
</span><a href="Unison.ShortHash.html#ShortHash"><span class="hs-identifier hs-var">ShortHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; (Text, Maybe Text)
</span><a href="#local-6989586621679194690"><span class="hs-identifier hs-var">getCycle</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679194687"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Maybe Text
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679194686"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span>  </span><span class="annot"><span class="annottext">[Text]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe ShortHash
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-49"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-50"></span><span>  </span><span class="annot"><a href="#local-6989586621679194690"><span class="hs-identifier hs-type">getCycle</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span>  </span><span id="local-6989586621679194690"><span class="annot"><span class="annottext">getCycle :: Text -&gt; (Text, Maybe Text)
</span><a href="#local-6989586621679194690"><span class="hs-identifier hs-var hs-var">getCycle</span></a></span></span><span> </span><span id="local-6989586621679194684"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679194684"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; Text -&gt; [Text]
</span><span class="hs-identifier hs-var">Text.split</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'.'</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679194684"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Text
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- e.g. foo#.1j</span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-special">[</span><span id="local-6989586621679194683"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679194683"><span class="hs-identifier hs-var">hash</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679194683"><span class="hs-identifier hs-var">hash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Text
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span>    </span><span id="local-6989586621679194682"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679194682"><span class="hs-identifier hs-var">hash</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679194681"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679194681"><span class="hs-identifier hs-var">suffix</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679194680"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679194680"><span class="hs-identifier hs-var">_garbage</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679194682"><span class="hs-identifier hs-var">hash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Text
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679194681"><span class="hs-identifier hs-var">suffix</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="annot"><a href="Unison.ShortHash.html#unsafeFromText"><span class="hs-identifier hs-type">unsafeFromText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.ShortHash.html#ShortHash"><span class="hs-identifier hs-type">ShortHash</span></a></span><span>
</span><span id="line-57"></span><span id="unsafeFromText"><span class="annot"><span class="annottext">unsafeFromText :: Text -&gt; ShortHash
</span><a href="Unison.ShortHash.html#unsafeFromText"><span class="hs-identifier hs-var hs-var">unsafeFromText</span></a></span></span><span> </span><span id="local-6989586621679194678"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679194678"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShortHash -&gt; Maybe ShortHash -&gt; ShortHash
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; ShortHash
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ShortHash) -&gt; (Text -&gt; String) -&gt; Text -&gt; ShortHash
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">Text.unpack</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ShortHash) -&gt; Text -&gt; ShortHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;can't parse ShortHash from: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679194678"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Maybe ShortHash
</span><a href="Unison.ShortHash.html#fromText"><span class="hs-identifier hs-var">fromText</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679194678"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span class="annot"><a href="Unison.ShortHash.html#toText"><span class="hs-identifier hs-type">toText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.ShortHash.html#ShortHash"><span class="hs-identifier hs-type">ShortHash</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-62"></span><span id="toText"><span class="annot"><span class="annottext">toText :: ShortHash -&gt; Text
</span><a href="Unison.ShortHash.html#toText"><span class="hs-identifier hs-var hs-var">toText</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.ShortHash.html#Builtin"><span class="hs-identifier hs-type">Builtin</span></a></span><span> </span><span id="local-6989586621679194672"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679194672"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;##&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679194672"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-63"></span><span class="annot"><a href="Unison.ShortHash.html#toText"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.ShortHash.html#ShortHash"><span class="hs-identifier hs-type">ShortHash</span></a></span><span> </span><span id="local-6989586621679194671"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679194671"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679194670"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679194670"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679194669"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679194669"><span class="hs-identifier hs-var">cid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;#&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679194671"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679194668"><span class="hs-identifier hs-var">i'</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679194667"><span class="hs-identifier hs-var">c'</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-64"></span><span>  </span><span class="annot"><a href="#local-6989586621679194668"><span class="hs-identifier hs-type">i'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679194667"><span class="hs-identifier hs-type">c'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-65"></span><span>  </span><span id="local-6989586621679194668"><span class="annot"><span class="annottext">i' :: Text
</span><a href="#local-6989586621679194668"><span class="hs-identifier hs-var hs-var">i'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; (Text -&gt; Text) -&gt; Maybe Text -&gt; Text
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.&quot;</span></span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679194670"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-66"></span><span>  </span><span id="local-6989586621679194667"><span class="annot"><span class="annottext">c' :: Text
</span><a href="#local-6989586621679194667"><span class="hs-identifier hs-var hs-var">c'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; (Text -&gt; Text) -&gt; Maybe Text -&gt; Text
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;#&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679194669"><span class="hs-identifier hs-var">cid</span></a></span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="annot"><a href="Unison.ShortHash.html#toString"><span class="hs-identifier hs-type">toString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.ShortHash.html#ShortHash"><span class="hs-identifier hs-type">ShortHash</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-69"></span><span id="toString"><span class="annot"><span class="annottext">toString :: ShortHash -&gt; String
</span><a href="Unison.ShortHash.html#toString"><span class="hs-identifier hs-var hs-var">toString</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">Text.unpack</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; String) -&gt; (ShortHash -&gt; Text) -&gt; ShortHash -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ShortHash -&gt; Text
</span><a href="Unison.ShortHash.html#toText"><span class="hs-identifier hs-var">toText</span></a></span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span class="annot"><a href="Unison.ShortHash.html#fromString"><span class="hs-identifier hs-type">fromString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Unison.ShortHash.html#ShortHash"><span class="hs-identifier hs-type">ShortHash</span></a></span><span>
</span><span id="line-72"></span><span id="fromString"><span class="annot"><span class="annottext">fromString :: String -&gt; Maybe ShortHash
</span><a href="Unison.ShortHash.html#fromString"><span class="hs-identifier hs-var hs-var">fromString</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe ShortHash
</span><a href="Unison.ShortHash.html#fromText"><span class="hs-identifier hs-var">fromText</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Maybe ShortHash)
-&gt; (String -&gt; Text) -&gt; String -&gt; Maybe ShortHash
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="annot"><a href="Unison.ShortHash.html#take"><span class="hs-identifier hs-type">take</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.ShortHash.html#ShortHash"><span class="hs-identifier hs-type">ShortHash</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.ShortHash.html#ShortHash"><span class="hs-identifier hs-type">ShortHash</span></a></span><span>
</span><span id="line-75"></span><span id="take"><span class="annot"><span class="annottext">take :: Int -&gt; ShortHash -&gt; ShortHash
</span><a href="Unison.ShortHash.html#take"><span class="hs-identifier hs-var hs-var">take</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679194661"><span class="annot"><span class="annottext">b :: ShortHash
</span><a href="#local-6989586621679194661"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Unison.ShortHash.html#Builtin"><span class="hs-identifier hs-type">Builtin</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679194661"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-76"></span><span class="annot"><a href="Unison.ShortHash.html#take"><span class="hs-identifier hs-var">take</span></a></span><span> </span><span id="local-6989586621679194660"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679194660"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679194659"><span class="annot"><span class="annottext">s :: ShortHash
</span><a href="#local-6989586621679194659"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Unison.ShortHash.html#ShortHash"><span class="hs-identifier hs-type">ShortHash</span></a></span><span class="hs-special">{</span><span id="local-6989586621679194656"><span id="local-6989586621679194657"><span id="local-6989586621679194658"><span class="annot"><span class="annottext">Maybe Text
Text
cid :: Maybe Text
cycle :: Maybe Text
prefix :: Text
cid :: ShortHash -&gt; Maybe Text
cycle :: ShortHash -&gt; Maybe Text
prefix :: ShortHash -&gt; Text
</span><a href="#local-6989586621679194656"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679194659"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">prefix :: Text
</span><a href="Unison.ShortHash.html#prefix"><span class="hs-identifier hs-var">prefix</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679194660"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679194658"><span class="hs-identifier hs-var">prefix</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="hs-comment">-- x `isPrefixOf` y is True iff x might be a shorter version of y</span><span>
</span><span id="line-79"></span><span class="hs-comment">-- if a constructor id is provided on the right-hand side, the left-hand side</span><span>
</span><span id="line-80"></span><span class="hs-comment">-- needs to match exactly (as of this commit).</span><span>
</span><span id="line-81"></span><span class="annot"><a href="Unison.ShortHash.html#isPrefixOf"><span class="hs-identifier hs-type">isPrefixOf</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.ShortHash.html#ShortHash"><span class="hs-identifier hs-type">ShortHash</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.ShortHash.html#ShortHash"><span class="hs-identifier hs-type">ShortHash</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-82"></span><span id="isPrefixOf"><span class="annot"><span class="annottext">isPrefixOf :: ShortHash -&gt; ShortHash -&gt; Bool
</span><a href="Unison.ShortHash.html#isPrefixOf"><span class="hs-identifier hs-var hs-var">isPrefixOf</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.ShortHash.html#Builtin"><span class="hs-identifier hs-type">Builtin</span></a></span><span> </span><span id="local-6989586621679194653"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679194653"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.ShortHash.html#Builtin"><span class="hs-identifier hs-type">Builtin</span></a></span><span> </span><span id="local-6989586621679194652"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679194652"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679194653"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
</span><span class="hs-operator hs-var">`Text.isPrefixOf`</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679194652"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-83"></span><span class="annot"><a href="Unison.ShortHash.html#isPrefixOf"><span class="hs-identifier hs-var">isPrefixOf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.ShortHash.html#ShortHash"><span class="hs-identifier hs-type">ShortHash</span></a></span><span> </span><span id="local-6989586621679194650"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679194650"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621679194649"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679194649"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679194648"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679194648"><span class="hs-identifier hs-var">cid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.ShortHash.html#ShortHash"><span class="hs-identifier hs-type">ShortHash</span></a></span><span> </span><span id="local-6989586621679194647"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679194647"><span class="hs-identifier hs-var">h2</span></a></span></span><span> </span><span id="local-6989586621679194646"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679194646"><span class="hs-identifier hs-var">n2</span></a></span></span><span> </span><span id="local-6989586621679194645"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679194645"><span class="hs-identifier hs-var">cid2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-84"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
</span><span class="hs-identifier hs-var">Text.isPrefixOf</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679194650"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679194647"><span class="hs-identifier hs-var">h2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Text -&gt; Maybe Text -&gt; Bool
forall a. Eq a =&gt; Maybe a -&gt; Maybe a -&gt; Bool
</span><a href="#local-6989586621679194643"><span class="hs-identifier hs-var">maybePrefixOf</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679194649"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679194646"><span class="hs-identifier hs-var">n2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Text -&gt; Maybe Text -&gt; Bool
forall a. Eq a =&gt; Maybe a -&gt; Maybe a -&gt; Bool
</span><a href="#local-6989586621679194643"><span class="hs-identifier hs-var">maybePrefixOf</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679194648"><span class="hs-identifier hs-var">cid</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679194645"><span class="hs-identifier hs-var">cid2</span></a></span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-86"></span><span>  </span><span class="annot"><span class="annottext">Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span id="local-6989586621679194643"><span class="annot"><span class="annottext">maybePrefixOf :: Maybe a -&gt; Maybe a -&gt; Bool
</span><a href="#local-6989586621679194643"><span class="hs-operator hs-var hs-var">`maybePrefixOf`</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-87"></span><span>  </span><span class="annot"><span class="annottext">Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><a href="#local-6989586621679194643"><span class="hs-operator hs-var">`maybePrefixOf`</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-88"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="#local-6989586621679194643"><span class="hs-operator hs-var">`maybePrefixOf`</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-89"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679194642"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679194642"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679194643"><span class="hs-operator hs-var">`maybePrefixOf`</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679194641"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679194641"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679194642"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679194641"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-90"></span><span class="annot"><a href="Unison.ShortHash.html#isPrefixOf"><span class="hs-identifier hs-var">isPrefixOf</span></a></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span class="hs-comment">--instance Show ShortHash where</span><span>
</span><span id="line-93"></span><span class="hs-comment">--  show = Text.unpack . toText</span><span>
</span><span id="line-94"></span></pre></body></html>