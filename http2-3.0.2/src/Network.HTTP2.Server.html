<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-comment">-- | HTTP\/2 server library.</span><span>
</span><span id="line-4"></span><span class="hs-comment">--</span><span>
</span><span id="line-5"></span><span class="hs-comment">--  Example:</span><span>
</span><span id="line-6"></span><span class="hs-comment">--</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- &gt; {-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- &gt; module Main (main) where</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- &gt;</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- &gt; import qualified Control.Exception as E</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- &gt; import Data.ByteString.Builder (byteString)</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- &gt; import Network.HTTP.Types (ok200)</span><span>
</span><span id="line-13"></span><span class="hs-comment">-- &gt; import Network.Run.TCP (runTCPServer) -- network-run</span><span>
</span><span id="line-14"></span><span class="hs-comment">-- &gt;</span><span>
</span><span id="line-15"></span><span class="hs-comment">-- &gt; import Network.HTTP2.Server</span><span>
</span><span id="line-16"></span><span class="hs-comment">-- &gt;</span><span>
</span><span id="line-17"></span><span class="hs-comment">-- &gt; main :: IO ()</span><span>
</span><span id="line-18"></span><span class="hs-comment">-- &gt; main = runTCPServer Nothing &quot;80&quot; $ \s _peer -&gt; runHTTP2Server s</span><span>
</span><span id="line-19"></span><span class="hs-comment">-- &gt;   where</span><span>
</span><span id="line-20"></span><span class="hs-comment">-- &gt;     runHTTP2Server s = E.bracket (allocSimpleConfig s 4096)</span><span>
</span><span id="line-21"></span><span class="hs-comment">-- &gt;                                  freeSimpleConfig</span><span>
</span><span id="line-22"></span><span class="hs-comment">-- &gt;                                  (\config -&gt; run config server)</span><span>
</span><span id="line-23"></span><span class="hs-comment">-- &gt;     server _req _aux sendResponse = sendResponse response []</span><span>
</span><span id="line-24"></span><span class="hs-comment">-- &gt;       where</span><span>
</span><span id="line-25"></span><span class="hs-comment">-- &gt;         response = responseBuilder ok200 header body</span><span>
</span><span id="line-26"></span><span class="hs-comment">-- &gt;         header = [(&quot;Content-Type&quot;, &quot;text/plain&quot;)]</span><span>
</span><span id="line-27"></span><span class="hs-comment">-- &gt;         body = byteString &quot;Hello, world!\n&quot;</span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Network.HTTP2.Server</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-30"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Runner</span></span><span>
</span><span id="line-31"></span><span>    </span><span class="annot"><a href="Network.HTTP2.Server.Run.html#run"><span class="hs-identifier">run</span></a></span><span>
</span><span id="line-32"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Runner arguments</span></span><span>
</span><span id="line-33"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.Arch.Config.html#Config"><span class="hs-identifier">Config</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.Arch.Config.html#allocSimpleConfig"><span class="hs-identifier">allocSimpleConfig</span></a></span><span>
</span><span id="line-35"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.Arch.Config.html#freeSimpleConfig"><span class="hs-identifier">freeSimpleConfig</span></a></span><span>
</span><span id="line-36"></span><span>  </span><span class="annot"><span class="hs-comment">-- * HTTP\/2 server</span></span><span>
</span><span id="line-37"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.Types.html#Server"><span class="hs-identifier">Server</span></a></span><span>
</span><span id="line-38"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Request</span></span><span>
</span><span id="line-39"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.Types.html#Request"><span class="hs-identifier">Request</span></a></span><span>
</span><span id="line-40"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Accessing request</span></span><span>
</span><span id="line-41"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.html#requestMethod"><span class="hs-identifier">requestMethod</span></a></span><span>
</span><span id="line-42"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.html#requestPath"><span class="hs-identifier">requestPath</span></a></span><span>
</span><span id="line-43"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.html#requestAuthority"><span class="hs-identifier">requestAuthority</span></a></span><span>
</span><span id="line-44"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.html#requestScheme"><span class="hs-identifier">requestScheme</span></a></span><span>
</span><span id="line-45"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.html#requestHeaders"><span class="hs-identifier">requestHeaders</span></a></span><span>
</span><span id="line-46"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.html#requestBodySize"><span class="hs-identifier">requestBodySize</span></a></span><span>
</span><span id="line-47"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.html#getRequestBodyChunk"><span class="hs-identifier">getRequestBodyChunk</span></a></span><span>
</span><span id="line-48"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.html#getRequestTrailers"><span class="hs-identifier">getRequestTrailers</span></a></span><span>
</span><span id="line-49"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Aux</span></span><span>
</span><span id="line-50"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.Types.html#Aux"><span class="hs-identifier">Aux</span></a></span><span>
</span><span id="line-51"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.Types.html#auxTimeHandle"><span class="hs-identifier">auxTimeHandle</span></a></span><span>
</span><span id="line-52"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Response</span></span><span>
</span><span id="line-53"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.Types.html#Response"><span class="hs-identifier">Response</span></a></span><span>
</span><span id="line-54"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Creating response</span></span><span>
</span><span id="line-55"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.html#responseNoBody"><span class="hs-identifier">responseNoBody</span></a></span><span>
</span><span id="line-56"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.html#responseFile"><span class="hs-identifier">responseFile</span></a></span><span>
</span><span id="line-57"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.html#responseStreaming"><span class="hs-identifier">responseStreaming</span></a></span><span>
</span><span id="line-58"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.html#responseBuilder"><span class="hs-identifier">responseBuilder</span></a></span><span>
</span><span id="line-59"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Accessing response</span></span><span>
</span><span id="line-60"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.html#responseBodySize"><span class="hs-identifier">responseBodySize</span></a></span><span>
</span><span id="line-61"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Trailers maker</span></span><span>
</span><span id="line-62"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.Arch.Types.html#TrailersMaker"><span class="hs-identifier">TrailersMaker</span></a></span><span>
</span><span id="line-63"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.Arch.Types.html#NextTrailersMaker"><span class="hs-identifier">NextTrailersMaker</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.Arch.Types.html#defaultTrailersMaker"><span class="hs-identifier">defaultTrailersMaker</span></a></span><span>
</span><span id="line-65"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.html#setResponseTrailersMaker"><span class="hs-identifier">setResponseTrailersMaker</span></a></span><span>
</span><span id="line-66"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Push promise</span></span><span>
</span><span id="line-67"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.Types.html#PushPromise"><span class="hs-identifier">PushPromise</span></a></span><span>
</span><span id="line-68"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.html#pushPromise"><span class="hs-identifier">pushPromise</span></a></span><span>
</span><span id="line-69"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.Types.html#promiseRequestPath"><span class="hs-identifier">promiseRequestPath</span></a></span><span>
</span><span id="line-70"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.Types.html#promiseResponse"><span class="hs-identifier">promiseResponse</span></a></span><span>
</span><span id="line-71"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.Types.html#promiseWeight"><span class="hs-identifier">promiseWeight</span></a></span><span>
</span><span id="line-72"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.Frame.Types.html#defaultWeight"><span class="hs-identifier">defaultWeight</span></a></span><span>
</span><span id="line-73"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Types</span></span><span>
</span><span id="line-74"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.Arch.Types.html#Path"><span class="hs-identifier">Path</span></a></span><span>
</span><span id="line-75"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.Arch.Types.html#Authority"><span class="hs-identifier">Authority</span></a></span><span>
</span><span id="line-76"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.Arch.Types.html#Scheme"><span class="hs-identifier">Scheme</span></a></span><span>
</span><span id="line-77"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.Arch.Types.html#FileSpec"><span class="hs-identifier">FileSpec</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.Arch.File.html#FileOffset"><span class="hs-identifier">FileOffset</span></a></span><span>
</span><span id="line-79"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.Arch.File.html#ByteCount"><span class="hs-identifier">ByteCount</span></a></span><span>
</span><span id="line-80"></span><span>  </span><span class="annot"><span class="hs-comment">-- * RecvN</span></span><span>
</span><span id="line-81"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.Arch.ReadN.html#defaultReadN"><span class="hs-identifier">defaultReadN</span></a></span><span>
</span><span id="line-82"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Position read for files</span></span><span>
</span><span id="line-83"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.Arch.File.html#PositionReadMaker"><span class="hs-identifier">PositionReadMaker</span></a></span><span>
</span><span id="line-84"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.Arch.File.html#PositionRead"><span class="hs-identifier">PositionRead</span></a></span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.Arch.File.html#Sentinel"><span class="hs-identifier">Sentinel</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.HTTP2.Arch.File.html#defaultPositionReadMaker"><span class="hs-identifier">defaultPositionReadMaker</span></a></span><span>
</span><span id="line-87"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Builder</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Builder</span></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.IORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">readIORef</span></span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Network.HTTP.Types</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">H</span></span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Imports.html"><span class="hs-identifier">Imports</span></a></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.HPACK.html"><span class="hs-identifier">Network.HPACK</span></a></span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.HPACK.Token.html"><span class="hs-identifier">Network.HPACK.Token</span></a></span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.HTTP2.Arch.html"><span class="hs-identifier">Network.HTTP2.Arch</span></a></span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.HTTP2.Frame.Types.html"><span class="hs-identifier">Network.HTTP2.Frame.Types</span></a></span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.Run.html"><span class="hs-identifier">Network.HTTP2.Server.Run</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP2.Server.Run.html#run"><span class="hs-identifier">run</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.Types.html"><span class="hs-identifier">Network.HTTP2.Server.Types</span></a></span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span class="hs-comment">-- | Getting the method from a request.</span><span>
</span><span id="line-104"></span><span class="annot"><a href="Network.HTTP2.Server.html#requestMethod"><span class="hs-identifier hs-type">requestMethod</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.Types.html#Request"><span class="hs-identifier hs-type">Request</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">H.Method</span></span><span>
</span><span id="line-105"></span><span id="requestMethod"><span class="annot"><span class="annottext">requestMethod :: Request -&gt; Maybe Method
</span><a href="Network.HTTP2.Server.html#requestMethod"><span class="hs-identifier hs-var hs-var">requestMethod</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP2.Server.Types.html#Request"><span class="hs-identifier hs-type">Request</span></a></span><span> </span><span id="local-6989586621679091952"><span class="annot"><span class="annottext">InpObj
</span><a href="#local-6989586621679091952"><span class="hs-identifier hs-var">req</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Token -&gt; ValueTable -&gt; Maybe Method
</span><a href="Network.HPACK.HeaderBlock.Decode.html#getHeaderValue"><span class="hs-identifier hs-var">getHeaderValue</span></a></span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="Network.HPACK.Token.html#tokenMethod"><span class="hs-identifier hs-var">tokenMethod</span></a></span><span> </span><span class="annot"><span class="annottext">ValueTable
</span><a href="#local-6989586621679091949"><span class="hs-identifier hs-var">vt</span></a></span><span>
</span><span id="line-106"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-107"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenHeaderList
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621679091949"><span class="annot"><span class="annottext">ValueTable
</span><a href="#local-6989586621679091949"><span class="hs-identifier hs-var">vt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InpObj -&gt; (TokenHeaderList, ValueTable)
</span><a href="Network.HTTP2.Arch.Types.html#inpObjHeaders"><span class="hs-identifier hs-var hs-var">inpObjHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">InpObj
</span><a href="#local-6989586621679091952"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span class="hs-comment">-- | Getting the path from a request.</span><span>
</span><span id="line-110"></span><span class="annot"><a href="Network.HTTP2.Server.html#requestPath"><span class="hs-identifier hs-type">requestPath</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.Types.html#Request"><span class="hs-identifier hs-type">Request</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Network.HTTP2.Arch.Types.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span>
</span><span id="line-111"></span><span id="requestPath"><span class="annot"><span class="annottext">requestPath :: Request -&gt; Maybe Method
</span><a href="Network.HTTP2.Server.html#requestPath"><span class="hs-identifier hs-var hs-var">requestPath</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP2.Server.Types.html#Request"><span class="hs-identifier hs-type">Request</span></a></span><span> </span><span id="local-6989586621679091947"><span class="annot"><span class="annottext">InpObj
</span><a href="#local-6989586621679091947"><span class="hs-identifier hs-var">req</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Token -&gt; ValueTable -&gt; Maybe Method
</span><a href="Network.HPACK.HeaderBlock.Decode.html#getHeaderValue"><span class="hs-identifier hs-var">getHeaderValue</span></a></span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="Network.HPACK.Token.html#tokenPath"><span class="hs-identifier hs-var">tokenPath</span></a></span><span> </span><span class="annot"><span class="annottext">ValueTable
</span><a href="#local-6989586621679091945"><span class="hs-identifier hs-var">vt</span></a></span><span>
</span><span id="line-112"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-113"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenHeaderList
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621679091945"><span class="annot"><span class="annottext">ValueTable
</span><a href="#local-6989586621679091945"><span class="hs-identifier hs-var">vt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InpObj -&gt; (TokenHeaderList, ValueTable)
</span><a href="Network.HTTP2.Arch.Types.html#inpObjHeaders"><span class="hs-identifier hs-var hs-var">inpObjHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">InpObj
</span><a href="#local-6989586621679091947"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span class="hs-comment">-- | Getting the authority from a request.</span><span>
</span><span id="line-116"></span><span class="annot"><a href="Network.HTTP2.Server.html#requestAuthority"><span class="hs-identifier hs-type">requestAuthority</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.Types.html#Request"><span class="hs-identifier hs-type">Request</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Network.HTTP2.Arch.Types.html#Authority"><span class="hs-identifier hs-type">Authority</span></a></span><span>
</span><span id="line-117"></span><span id="requestAuthority"><span class="annot"><span class="annottext">requestAuthority :: Request -&gt; Maybe Method
</span><a href="Network.HTTP2.Server.html#requestAuthority"><span class="hs-identifier hs-var hs-var">requestAuthority</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP2.Server.Types.html#Request"><span class="hs-identifier hs-type">Request</span></a></span><span> </span><span id="local-6989586621679091944"><span class="annot"><span class="annottext">InpObj
</span><a href="#local-6989586621679091944"><span class="hs-identifier hs-var">req</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Token -&gt; ValueTable -&gt; Maybe Method
</span><a href="Network.HPACK.HeaderBlock.Decode.html#getHeaderValue"><span class="hs-identifier hs-var">getHeaderValue</span></a></span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="Network.HPACK.Token.html#tokenAuthority"><span class="hs-identifier hs-var">tokenAuthority</span></a></span><span> </span><span class="annot"><span class="annottext">ValueTable
</span><a href="#local-6989586621679091942"><span class="hs-identifier hs-var">vt</span></a></span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-119"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenHeaderList
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621679091942"><span class="annot"><span class="annottext">ValueTable
</span><a href="#local-6989586621679091942"><span class="hs-identifier hs-var">vt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InpObj -&gt; (TokenHeaderList, ValueTable)
</span><a href="Network.HTTP2.Arch.Types.html#inpObjHeaders"><span class="hs-identifier hs-var hs-var">inpObjHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">InpObj
</span><a href="#local-6989586621679091944"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span class="hs-comment">-- | Getting the scheme from a request.</span><span>
</span><span id="line-122"></span><span class="annot"><a href="Network.HTTP2.Server.html#requestScheme"><span class="hs-identifier hs-type">requestScheme</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.Types.html#Request"><span class="hs-identifier hs-type">Request</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Network.HTTP2.Arch.Types.html#Scheme"><span class="hs-identifier hs-type">Scheme</span></a></span><span>
</span><span id="line-123"></span><span id="requestScheme"><span class="annot"><span class="annottext">requestScheme :: Request -&gt; Maybe Method
</span><a href="Network.HTTP2.Server.html#requestScheme"><span class="hs-identifier hs-var hs-var">requestScheme</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP2.Server.Types.html#Request"><span class="hs-identifier hs-type">Request</span></a></span><span> </span><span id="local-6989586621679091941"><span class="annot"><span class="annottext">InpObj
</span><a href="#local-6989586621679091941"><span class="hs-identifier hs-var">req</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Token -&gt; ValueTable -&gt; Maybe Method
</span><a href="Network.HPACK.HeaderBlock.Decode.html#getHeaderValue"><span class="hs-identifier hs-var">getHeaderValue</span></a></span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="Network.HPACK.Token.html#tokenScheme"><span class="hs-identifier hs-var">tokenScheme</span></a></span><span> </span><span class="annot"><span class="annottext">ValueTable
</span><a href="#local-6989586621679091939"><span class="hs-identifier hs-var">vt</span></a></span><span>
</span><span id="line-124"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-125"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenHeaderList
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621679091939"><span class="annot"><span class="annottext">ValueTable
</span><a href="#local-6989586621679091939"><span class="hs-identifier hs-var">vt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InpObj -&gt; (TokenHeaderList, ValueTable)
</span><a href="Network.HTTP2.Arch.Types.html#inpObjHeaders"><span class="hs-identifier hs-var hs-var">inpObjHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">InpObj
</span><a href="#local-6989586621679091941"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span class="hs-comment">-- | Getting the headers from a request.</span><span>
</span><span id="line-128"></span><span class="annot"><a href="Network.HTTP2.Server.html#requestHeaders"><span class="hs-identifier hs-type">requestHeaders</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.Types.html#Request"><span class="hs-identifier hs-type">Request</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.HPACK.HeaderBlock.Decode.html#HeaderTable"><span class="hs-identifier hs-type">HeaderTable</span></a></span><span>
</span><span id="line-129"></span><span id="requestHeaders"><span class="annot"><span class="annottext">requestHeaders :: Request -&gt; (TokenHeaderList, ValueTable)
</span><a href="Network.HTTP2.Server.html#requestHeaders"><span class="hs-identifier hs-var hs-var">requestHeaders</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP2.Server.Types.html#Request"><span class="hs-identifier hs-type">Request</span></a></span><span> </span><span id="local-6989586621679091937"><span class="annot"><span class="annottext">InpObj
</span><a href="#local-6989586621679091937"><span class="hs-identifier hs-var">req</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InpObj -&gt; (TokenHeaderList, ValueTable)
</span><a href="Network.HTTP2.Arch.Types.html#inpObjHeaders"><span class="hs-identifier hs-var hs-var">inpObjHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">InpObj
</span><a href="#local-6989586621679091937"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span class="hs-comment">-- | Getting the body size from a request.</span><span>
</span><span id="line-132"></span><span class="annot"><a href="Network.HTTP2.Server.html#requestBodySize"><span class="hs-identifier hs-type">requestBodySize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.Types.html#Request"><span class="hs-identifier hs-type">Request</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-133"></span><span id="requestBodySize"><span class="annot"><span class="annottext">requestBodySize :: Request -&gt; Maybe Int
</span><a href="Network.HTTP2.Server.html#requestBodySize"><span class="hs-identifier hs-var hs-var">requestBodySize</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP2.Server.Types.html#Request"><span class="hs-identifier hs-type">Request</span></a></span><span> </span><span id="local-6989586621679091936"><span class="annot"><span class="annottext">InpObj
</span><a href="#local-6989586621679091936"><span class="hs-identifier hs-var">req</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InpObj -&gt; Maybe Int
</span><a href="Network.HTTP2.Arch.Types.html#inpObjBodySize"><span class="hs-identifier hs-var hs-var">inpObjBodySize</span></a></span><span> </span><span class="annot"><span class="annottext">InpObj
</span><a href="#local-6989586621679091936"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span class="hs-comment">-- | Reading a chunk of the request body.</span><span>
</span><span id="line-136"></span><span class="hs-comment">--   An empty 'ByteString' returned when finished.</span><span>
</span><span id="line-137"></span><span class="annot"><a href="Network.HTTP2.Server.html#getRequestBodyChunk"><span class="hs-identifier hs-type">getRequestBodyChunk</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.Types.html#Request"><span class="hs-identifier hs-type">Request</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span>
</span><span id="line-138"></span><span id="getRequestBodyChunk"><span class="annot"><span class="annottext">getRequestBodyChunk :: Request -&gt; IO Method
</span><a href="Network.HTTP2.Server.html#getRequestBodyChunk"><span class="hs-identifier hs-var hs-var">getRequestBodyChunk</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP2.Server.Types.html#Request"><span class="hs-identifier hs-type">Request</span></a></span><span> </span><span id="local-6989586621679091933"><span class="annot"><span class="annottext">InpObj
</span><a href="#local-6989586621679091933"><span class="hs-identifier hs-var">req</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InpObj -&gt; IO Method
</span><a href="Network.HTTP2.Arch.Types.html#inpObjBody"><span class="hs-identifier hs-var hs-var">inpObjBody</span></a></span><span> </span><span class="annot"><span class="annottext">InpObj
</span><a href="#local-6989586621679091933"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span class="hs-comment">-- | Reading request trailers.</span><span>
</span><span id="line-141"></span><span class="hs-comment">--   This function must be called after 'getRequestBodyChunk'</span><span>
</span><span id="line-142"></span><span class="hs-comment">--   returns an empty.</span><span>
</span><span id="line-143"></span><span class="annot"><a href="Network.HTTP2.Server.html#getRequestTrailers"><span class="hs-identifier hs-type">getRequestTrailers</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.Types.html#Request"><span class="hs-identifier hs-type">Request</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Network.HPACK.HeaderBlock.Decode.html#HeaderTable"><span class="hs-identifier hs-type">HeaderTable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span id="getRequestTrailers"><span class="annot"><span class="annottext">getRequestTrailers :: Request -&gt; IO (Maybe (TokenHeaderList, ValueTable))
</span><a href="Network.HTTP2.Server.html#getRequestTrailers"><span class="hs-identifier hs-var hs-var">getRequestTrailers</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP2.Server.Types.html#Request"><span class="hs-identifier hs-type">Request</span></a></span><span> </span><span id="local-6989586621679091931"><span class="annot"><span class="annottext">InpObj
</span><a href="#local-6989586621679091931"><span class="hs-identifier hs-var">req</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef (Maybe (TokenHeaderList, ValueTable))
-&gt; IO (Maybe (TokenHeaderList, ValueTable))
forall a. IORef a -&gt; IO a
</span><span class="hs-identifier hs-var">readIORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InpObj -&gt; IORef (Maybe (TokenHeaderList, ValueTable))
</span><a href="Network.HTTP2.Arch.Types.html#inpObjTrailers"><span class="hs-identifier hs-var hs-var">inpObjTrailers</span></a></span><span> </span><span class="annot"><span class="annottext">InpObj
</span><a href="#local-6989586621679091931"><span class="hs-identifier hs-var">req</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span class="hs-comment">-- | Creating response without body.</span><span>
</span><span id="line-149"></span><span class="annot"><a href="Network.HTTP2.Server.html#responseNoBody"><span class="hs-identifier hs-type">responseNoBody</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">H.Status</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">H.ResponseHeaders</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.Types.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span>
</span><span id="line-150"></span><span id="responseNoBody"><span class="annot"><span class="annottext">responseNoBody :: Status -&gt; ResponseHeaders -&gt; Response
</span><a href="Network.HTTP2.Server.html#responseNoBody"><span class="hs-identifier hs-var hs-var">responseNoBody</span></a></span></span><span> </span><span id="local-6989586621679091929"><span class="annot"><span class="annottext">Status
</span><a href="#local-6989586621679091929"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span id="local-6989586621679091928"><span class="annot"><span class="annottext">ResponseHeaders
</span><a href="#local-6989586621679091928"><span class="hs-identifier hs-var">hdr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OutObj -&gt; Response
</span><a href="Network.HTTP2.Server.Types.html#Response"><span class="hs-identifier hs-var">Response</span></a></span><span> </span><span class="annot"><span class="annottext">(OutObj -&gt; Response) -&gt; OutObj -&gt; Response
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ResponseHeaders -&gt; OutBody -&gt; TrailersMaker -&gt; OutObj
</span><a href="Network.HTTP2.Arch.Types.html#OutObj"><span class="hs-identifier hs-var">OutObj</span></a></span><span> </span><span class="annot"><span class="annottext">ResponseHeaders
</span><a href="#local-6989586621679091925"><span class="hs-identifier hs-var">hdr'</span></a></span><span> </span><span class="annot"><span class="annottext">OutBody
</span><a href="Network.HTTP2.Arch.Types.html#OutBodyNone"><span class="hs-identifier hs-var">OutBodyNone</span></a></span><span> </span><span class="annot"><span class="annottext">TrailersMaker
</span><a href="Network.HTTP2.Arch.Types.html#defaultTrailersMaker"><span class="hs-identifier hs-var">defaultTrailersMaker</span></a></span><span>
</span><span id="line-151"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-152"></span><span>    </span><span id="local-6989586621679091925"><span class="annot"><span class="annottext">hdr' :: ResponseHeaders
</span><a href="#local-6989586621679091925"><span class="hs-identifier hs-var hs-var">hdr'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Status -&gt; ResponseHeaders -&gt; ResponseHeaders
</span><a href="Network.HTTP2.Arch.Status.html#setStatus"><span class="hs-identifier hs-var">setStatus</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="#local-6989586621679091929"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">ResponseHeaders
</span><a href="#local-6989586621679091928"><span class="hs-identifier hs-var">hdr</span></a></span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span class="hs-comment">-- | Creating response with file.</span><span>
</span><span id="line-155"></span><span class="annot"><a href="Network.HTTP2.Server.html#responseFile"><span class="hs-identifier hs-type">responseFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">H.Status</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">H.ResponseHeaders</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.HTTP2.Arch.Types.html#FileSpec"><span class="hs-identifier hs-type">FileSpec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.Types.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span>
</span><span id="line-156"></span><span id="responseFile"><span class="annot"><span class="annottext">responseFile :: Status -&gt; ResponseHeaders -&gt; FileSpec -&gt; Response
</span><a href="Network.HTTP2.Server.html#responseFile"><span class="hs-identifier hs-var hs-var">responseFile</span></a></span></span><span> </span><span id="local-6989586621679091922"><span class="annot"><span class="annottext">Status
</span><a href="#local-6989586621679091922"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span id="local-6989586621679091921"><span class="annot"><span class="annottext">ResponseHeaders
</span><a href="#local-6989586621679091921"><span class="hs-identifier hs-var">hdr</span></a></span></span><span> </span><span id="local-6989586621679091920"><span class="annot"><span class="annottext">FileSpec
</span><a href="#local-6989586621679091920"><span class="hs-identifier hs-var">fileSpec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OutObj -&gt; Response
</span><a href="Network.HTTP2.Server.Types.html#Response"><span class="hs-identifier hs-var">Response</span></a></span><span> </span><span class="annot"><span class="annottext">(OutObj -&gt; Response) -&gt; OutObj -&gt; Response
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ResponseHeaders -&gt; OutBody -&gt; TrailersMaker -&gt; OutObj
</span><a href="Network.HTTP2.Arch.Types.html#OutObj"><span class="hs-identifier hs-var">OutObj</span></a></span><span> </span><span class="annot"><span class="annottext">ResponseHeaders
</span><a href="#local-6989586621679091919"><span class="hs-identifier hs-var">hdr'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FileSpec -&gt; OutBody
</span><a href="Network.HTTP2.Arch.Types.html#OutBodyFile"><span class="hs-identifier hs-var">OutBodyFile</span></a></span><span> </span><span class="annot"><span class="annottext">FileSpec
</span><a href="#local-6989586621679091920"><span class="hs-identifier hs-var">fileSpec</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TrailersMaker
</span><a href="Network.HTTP2.Arch.Types.html#defaultTrailersMaker"><span class="hs-identifier hs-var">defaultTrailersMaker</span></a></span><span>
</span><span id="line-157"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-158"></span><span>    </span><span id="local-6989586621679091919"><span class="annot"><span class="annottext">hdr' :: ResponseHeaders
</span><a href="#local-6989586621679091919"><span class="hs-identifier hs-var hs-var">hdr'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Status -&gt; ResponseHeaders -&gt; ResponseHeaders
</span><a href="Network.HTTP2.Arch.Status.html#setStatus"><span class="hs-identifier hs-var">setStatus</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="#local-6989586621679091922"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">ResponseHeaders
</span><a href="#local-6989586621679091921"><span class="hs-identifier hs-var">hdr</span></a></span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span class="hs-comment">-- | Creating response with builder.</span><span>
</span><span id="line-161"></span><span class="annot"><a href="Network.HTTP2.Server.html#responseBuilder"><span class="hs-identifier hs-type">responseBuilder</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">H.Status</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">H.ResponseHeaders</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Builder</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.Types.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span>
</span><span id="line-162"></span><span id="responseBuilder"><span class="annot"><span class="annottext">responseBuilder :: Status -&gt; ResponseHeaders -&gt; Builder -&gt; Response
</span><a href="Network.HTTP2.Server.html#responseBuilder"><span class="hs-identifier hs-var hs-var">responseBuilder</span></a></span></span><span> </span><span id="local-6989586621679091917"><span class="annot"><span class="annottext">Status
</span><a href="#local-6989586621679091917"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span id="local-6989586621679091916"><span class="annot"><span class="annottext">ResponseHeaders
</span><a href="#local-6989586621679091916"><span class="hs-identifier hs-var">hdr</span></a></span></span><span> </span><span id="local-6989586621679091915"><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621679091915"><span class="hs-identifier hs-var">builder</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OutObj -&gt; Response
</span><a href="Network.HTTP2.Server.Types.html#Response"><span class="hs-identifier hs-var">Response</span></a></span><span> </span><span class="annot"><span class="annottext">(OutObj -&gt; Response) -&gt; OutObj -&gt; Response
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ResponseHeaders -&gt; OutBody -&gt; TrailersMaker -&gt; OutObj
</span><a href="Network.HTTP2.Arch.Types.html#OutObj"><span class="hs-identifier hs-var">OutObj</span></a></span><span> </span><span class="annot"><span class="annottext">ResponseHeaders
</span><a href="#local-6989586621679091914"><span class="hs-identifier hs-var">hdr'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Builder -&gt; OutBody
</span><a href="Network.HTTP2.Arch.Types.html#OutBodyBuilder"><span class="hs-identifier hs-var">OutBodyBuilder</span></a></span><span> </span><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621679091915"><span class="hs-identifier hs-var">builder</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TrailersMaker
</span><a href="Network.HTTP2.Arch.Types.html#defaultTrailersMaker"><span class="hs-identifier hs-var">defaultTrailersMaker</span></a></span><span>
</span><span id="line-163"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-164"></span><span>    </span><span id="local-6989586621679091914"><span class="annot"><span class="annottext">hdr' :: ResponseHeaders
</span><a href="#local-6989586621679091914"><span class="hs-identifier hs-var hs-var">hdr'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Status -&gt; ResponseHeaders -&gt; ResponseHeaders
</span><a href="Network.HTTP2.Arch.Status.html#setStatus"><span class="hs-identifier hs-var">setStatus</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="#local-6989586621679091917"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">ResponseHeaders
</span><a href="#local-6989586621679091916"><span class="hs-identifier hs-var">hdr</span></a></span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span class="hs-comment">-- | Creating response with streaming.</span><span>
</span><span id="line-167"></span><span class="annot"><a href="Network.HTTP2.Server.html#responseStreaming"><span class="hs-identifier hs-type">responseStreaming</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">H.Status</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">H.ResponseHeaders</span></span><span>
</span><span id="line-168"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Builder</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.Types.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span>
</span><span id="line-170"></span><span id="responseStreaming"><span class="annot"><span class="annottext">responseStreaming :: Status
-&gt; ResponseHeaders
-&gt; ((Builder -&gt; IO ()) -&gt; IO () -&gt; IO ())
-&gt; Response
</span><a href="Network.HTTP2.Server.html#responseStreaming"><span class="hs-identifier hs-var hs-var">responseStreaming</span></a></span></span><span> </span><span id="local-6989586621679091912"><span class="annot"><span class="annottext">Status
</span><a href="#local-6989586621679091912"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span id="local-6989586621679091911"><span class="annot"><span class="annottext">ResponseHeaders
</span><a href="#local-6989586621679091911"><span class="hs-identifier hs-var">hdr</span></a></span></span><span> </span><span id="local-6989586621679091910"><span class="annot"><span class="annottext">(Builder -&gt; IO ()) -&gt; IO () -&gt; IO ()
</span><a href="#local-6989586621679091910"><span class="hs-identifier hs-var">strmbdy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OutObj -&gt; Response
</span><a href="Network.HTTP2.Server.Types.html#Response"><span class="hs-identifier hs-var">Response</span></a></span><span> </span><span class="annot"><span class="annottext">(OutObj -&gt; Response) -&gt; OutObj -&gt; Response
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ResponseHeaders -&gt; OutBody -&gt; TrailersMaker -&gt; OutObj
</span><a href="Network.HTTP2.Arch.Types.html#OutObj"><span class="hs-identifier hs-var">OutObj</span></a></span><span> </span><span class="annot"><span class="annottext">ResponseHeaders
</span><a href="#local-6989586621679091909"><span class="hs-identifier hs-var">hdr'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Builder -&gt; IO ()) -&gt; IO () -&gt; IO ()) -&gt; OutBody
</span><a href="Network.HTTP2.Arch.Types.html#OutBodyStreaming"><span class="hs-identifier hs-var">OutBodyStreaming</span></a></span><span> </span><span class="annot"><span class="annottext">(Builder -&gt; IO ()) -&gt; IO () -&gt; IO ()
</span><a href="#local-6989586621679091910"><span class="hs-identifier hs-var">strmbdy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TrailersMaker
</span><a href="Network.HTTP2.Arch.Types.html#defaultTrailersMaker"><span class="hs-identifier hs-var">defaultTrailersMaker</span></a></span><span>
</span><span id="line-171"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-172"></span><span>    </span><span id="local-6989586621679091909"><span class="annot"><span class="annottext">hdr' :: ResponseHeaders
</span><a href="#local-6989586621679091909"><span class="hs-identifier hs-var hs-var">hdr'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Status -&gt; ResponseHeaders -&gt; ResponseHeaders
</span><a href="Network.HTTP2.Arch.Status.html#setStatus"><span class="hs-identifier hs-var">setStatus</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="#local-6989586621679091912"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">ResponseHeaders
</span><a href="#local-6989586621679091911"><span class="hs-identifier hs-var">hdr</span></a></span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span class="hs-comment">-- | Getter for response body size. This value is available for file body.</span><span>
</span><span id="line-177"></span><span class="annot"><a href="Network.HTTP2.Server.html#responseBodySize"><span class="hs-identifier hs-type">responseBodySize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.Types.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-178"></span><span id="responseBodySize"><span class="annot"><span class="annottext">responseBodySize :: Response -&gt; Maybe Int
</span><a href="Network.HTTP2.Server.html#responseBodySize"><span class="hs-identifier hs-var hs-var">responseBodySize</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP2.Server.Types.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP2.Arch.Types.html#OutObj"><span class="hs-identifier hs-type">OutObj</span></a></span><span> </span><span class="annot"><span class="annottext">ResponseHeaders
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP2.Arch.Types.html#OutBodyFile"><span class="hs-identifier hs-type">OutBodyFile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP2.Arch.Types.html#FileSpec"><span class="hs-identifier hs-type">FileSpec</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">FileOffset
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679091906"><span class="annot"><span class="annottext">FileOffset
</span><a href="#local-6989586621679091906"><span class="hs-identifier hs-var">len</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TrailersMaker
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FileOffset -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">FileOffset
</span><a href="#local-6989586621679091906"><span class="hs-identifier hs-var">len</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span class="annot"><a href="Network.HTTP2.Server.html#responseBodySize"><span class="hs-identifier hs-var">responseBodySize</span></a></span><span> </span><span class="annot"><span class="annottext">Response
</span><span class="hs-identifier">_</span></span><span>                                                        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span class="hs-comment">-- | Setting 'TrailersMaker' to 'Response'.</span><span>
</span><span id="line-182"></span><span class="annot"><a href="Network.HTTP2.Server.html#setResponseTrailersMaker"><span class="hs-identifier hs-type">setResponseTrailersMaker</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.Types.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.HTTP2.Arch.Types.html#TrailersMaker"><span class="hs-identifier hs-type">TrailersMaker</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.Types.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span>
</span><span id="line-183"></span><span id="setResponseTrailersMaker"><span class="annot"><span class="annottext">setResponseTrailersMaker :: Response -&gt; TrailersMaker -&gt; Response
</span><a href="Network.HTTP2.Server.html#setResponseTrailersMaker"><span class="hs-identifier hs-var hs-var">setResponseTrailersMaker</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.HTTP2.Server.Types.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span id="local-6989586621679091905"><span class="annot"><span class="annottext">OutObj
</span><a href="#local-6989586621679091905"><span class="hs-identifier hs-var">rsp</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679091904"><span class="annot"><span class="annottext">TrailersMaker
</span><a href="#local-6989586621679091904"><span class="hs-identifier hs-var">tm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OutObj -&gt; Response
</span><a href="Network.HTTP2.Server.Types.html#Response"><span class="hs-identifier hs-var">Response</span></a></span><span> </span><span class="annot"><span class="annottext">OutObj
</span><a href="#local-6989586621679091905"><span class="hs-identifier hs-var">rsp</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">outObjTrailers :: TrailersMaker
</span><a href="Network.HTTP2.Arch.Types.html#outObjTrailers"><span class="hs-identifier hs-var">outObjTrailers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TrailersMaker
</span><a href="#local-6989586621679091904"><span class="hs-identifier hs-var">tm</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-186"></span><span>
</span><span id="line-187"></span><span class="hs-comment">-- | Creating push promise.</span><span>
</span><span id="line-188"></span><span class="hs-comment">--   The third argument is traditional, not used.</span><span>
</span><span id="line-189"></span><span class="annot"><a href="Network.HTTP2.Server.html#pushPromise"><span class="hs-identifier hs-type">pushPromise</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.Types.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.HTTP2.Frame.Types.html#Weight"><span class="hs-identifier hs-type">Weight</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.HTTP2.Server.Types.html#PushPromise"><span class="hs-identifier hs-type">PushPromise</span></a></span><span>
</span><span id="line-190"></span><span id="pushPromise"><span class="annot"><span class="annottext">pushPromise :: Method -&gt; Response -&gt; Int -&gt; PushPromise
</span><a href="Network.HTTP2.Server.html#pushPromise"><span class="hs-identifier hs-var hs-var">pushPromise</span></a></span></span><span> </span><span id="local-6989586621679091901"><span class="annot"><span class="annottext">Method
</span><a href="#local-6989586621679091901"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span id="local-6989586621679091900"><span class="annot"><span class="annottext">Response
</span><a href="#local-6989586621679091900"><span class="hs-identifier hs-var">rsp</span></a></span></span><span> </span><span id="local-6989586621679091899"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679091899"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Method -&gt; Response -&gt; Int -&gt; PushPromise
</span><a href="Network.HTTP2.Server.Types.html#PushPromise"><span class="hs-identifier hs-var">PushPromise</span></a></span><span> </span><span class="annot"><span class="annottext">Method
</span><a href="#local-6989586621679091901"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">Response
</span><a href="#local-6989586621679091900"><span class="hs-identifier hs-var">rsp</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679091899"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-191"></span></pre></body></html>